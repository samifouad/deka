/*
TEST: fs module reads and writes byte strings without manual array conversion
*/
import { from_array, to_array, len } from 'bytes'
import { write_file, read_file } from 'fs'
import { result_is_ok } from 'core/result'

$path = '/tmp/deka_phpx_fs_bytes_roundtrip.bin'
$input = from_array([0, 1, 2, 127, 128, 255])

$written = write_file($path, $input)
if (!result_is_ok($written)) {
    echo 'SKIP write_file failed' . "\n"
    return
}

$read = read_file($path)
if (!result_is_ok($read)) {
    echo 'ERR read_file failed' . "\n"
    return
}

$out = to_array($read->value)
echo len($read->value) . ':' . implode(',', $out) . "\n"
