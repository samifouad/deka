/*
TEST: db facade preserves native scalar row values across drivers.
This test uses sqlite for deterministic no-network execution.
*/
import { connectSync, query_one, closeSync } from 'db/sqlite'
import { result_is_ok } from 'core/result'

$path = '/tmp/deka_phpx_row_decode.sqlite'
$conn = connectSync({ path: $path })
if (!result_is_ok($conn)) {
    echo "ERR connectSync\n"
    return
}

$row = query_one($conn->value, 'select 7 as i, 3.5 as f, null as n', [])
closeSync($conn->value)

if (!result_is_ok($row)) {
    echo "ERR querySync\n"
    return
}

if (!is_int($row->value['i']) || !is_float($row->value['f']) || $row->value['n'] !== null) {
    echo "ERR type\n"
    return
}

echo "OK " . $row->value['i'] . ":" . $row->value['f'] . "\n"
