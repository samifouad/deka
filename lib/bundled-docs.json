[
  {
    "slug": [
      "contributing",
      "ledger",
      "intro"
    ],
    "metadata": {
      "title": "Ledger Service",
      "description": "Account and balance management service architecture",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nThe Tana Ledger is the core account and balance management service for the blockchain. It provides a REST API for user accounts, multi-currency balances, and transaction processing.\n\n## Features\n\n- **User Accounts** - Create and manage user accounts with Ed25519 keys\n- **Team Management** - Team creation, membership, and treasury accounts\n- **Multi-Currency Balances** - Track balances across multiple currencies (USD, EUR, BTC, etc.)\n- **Transaction Processing** - Validate and process transactions through block production\n- **REST API** - HTTP API for all account operations\n\n## Architecture\n\n```\nledger/\nâ”œâ”€â”€ src/\nâ”‚   â”œâ”€â”€ index.ts          # Main API server (Hono)\nâ”‚   â”œâ”€â”€ accounts/\nâ”‚   â”‚   â”œâ”€â”€ users.ts      # User account management\nâ”‚   â”‚   â””â”€â”€ teams.ts      # Team account management\nâ”‚   â”œâ”€â”€ balances/\nâ”‚   â”‚   â”œâ”€â”€ index.ts      # Balance operations\nâ”‚   â”‚   â””â”€â”€ currencies.ts # Currency management\nâ”‚   â”œâ”€â”€ transactions/\nâ”‚   â”‚   â”œâ”€â”€ index.ts      # Transaction processing\nâ”‚   â”‚   â””â”€â”€ validator.ts  # Transaction validation\nâ”‚   â”œâ”€â”€ blocks/\nâ”‚   â”‚   â””â”€â”€ producer.ts   # Block production logic\nâ”‚   â”œâ”€â”€ api/\nâ”‚   â”‚   â”œâ”€â”€ routes/       # API route handlers\nâ”‚   â”‚   â””â”€â”€ schemas.ts    # Zod validation schemas\nâ”‚   â””â”€â”€ db/\nâ”‚       â”œâ”€â”€ schema.ts     # Drizzle ORM schema\nâ”‚       â””â”€â”€ index.ts      # Database connection\nâ””â”€â”€ drizzle/              # Database migrations\n```\n\n## Development Setup\n\n### Prerequisites\n\n- Bun 1.1.38+\n- PostgreSQL 16\n- Docker (for local development)\n\n### Installation\n\n```bash\ncd ledger\n\n# Install dependencies\nbun install\n\n# Start PostgreSQL (via Docker)\ndocker-compose up -d postgres\n\n# Run database migrations\nbun run db:migrate\n\n# Start development server\nbun run dev\n```\n\nThe API will be available at `http://localhost:8080`.\n\n### Database Migrations\n\n```bash\n# Generate new migration\nbun run db:generate\n\n# Run migrations\nbun run db:migrate\n\n# Drop database (destructive!)\nbun run db:drop\n\n# Push schema changes (development only)\nbun run db:push\n\n# Open Drizzle Studio (GUI)\nbun run db:studio\n```\n\n## Block Production\n\nTransactions in Tana are processed into blocks. During development, you need to manually produce blocks to finalize pending transactions.\n\n### Manual Block Production\n\n```bash\n# From project root:\nnpm run pending    # Process pending transactions\nnpm run block      # Same as above (alias)\n\n# From ledger directory:\nnpm run pending    # Short command\nnpm run blockchain:produce  # Full command name\n```\n\n**When to run:**\n- After creating users (via mobile app or CLI)\n- After submitting transactions\n- When you want to finalize pending operations\n\n**What it does:**\n1. Finds all pending transactions in the database\n2. Executes them (user creation, transfers, contract calls, etc.)\n3. Creates a new block with those transactions\n4. Updates transaction status from \"pending\" â†’ \"confirmed\"\n5. Updates all affected balances and state\n\n**Example output:**\n```\nğŸ”¨ Producing new block...\nLatest block: 6\nFound 3 pending transaction(s)\n\nProcessing transaction tx_abc123 (user_creation)...\n  âœ“ Created user: @alice (550e8400-e29b-41d4-a716-446655440000)\n\nProcessing transaction tx_def456 (transfer)...\n  âœ“ Transferred 100 USD from @alice to @bob\n\nProcessing transaction tx_ghi789 (contract_call)...\n  âœ“ Executed contract cnt_myapp\n\nâœ… Block produced successfully!\nBlock Details:\n  Height: 7\n  Transactions: 3\n  Gas Used: 63000 / 1000000\n  Block Hash: 0xabc123...\n```\n\n### Automatic Block Production (Future)\n\nIn production, blocks will be produced automatically at regular intervals (e.g., every 6 seconds) by a background worker or consensus mechanism. This is not yet implemented.\n\n## API Endpoints\n\n### Users\n\n```\nGET  /users               # List all users\nPOST /users               # Create new user\nGET  /users/:id           # Get user by ID\nGET  /users/username/:username  # Get user by username\nPATCH /users/:id          # Update user\nDELETE /users/:id         # Delete user\nGET  /users/:id/balances  # Get user balances\n```\n\n### Balances\n\n```\nGET  /balances            # List all balances\nPOST /balances            # Set balance (admin)\nGET  /balances/:id        # Get specific balance\n```\n\n### Transactions\n\n```\nGET  /transactions        # List all transactions\nPOST /transactions        # Create transaction\nGET  /transactions/:id    # Get transaction details\n```\n\n### Blocks\n\n```\nGET  /blocks              # List all blocks\nGET  /blocks/:height      # Get block by height\nGET  /blocks/latest       # Get latest block\n```\n\n### Contracts\n\n```\nGET  /contracts           # List all contracts\nPOST /contracts           # Deploy contract\nGET  /contracts/:id       # Get contract details\n```\n\n## Environment Variables\n\n```env\n# Server Configuration\nPORT=8080\nNODE_ENV=development\n\n# Database\nDATABASE_URL=postgres://tana:tana_dev_password@localhost:5432/tana\n\n# CORS (for playground integration)\nALLOWED_ORIGINS=http://localhost:3000,http://localhost:4321\n\n# Ledger URL (for consistency with other services)\nTANA_LEDGER_URL=http://localhost:8080\n```\n\nSee [Environment Variables](/contributing/env-vars/) for more details.\n\n## Database Schema\n\nThe ledger uses PostgreSQL with Drizzle ORM. Key tables:\n\n**users** - User accounts\n- `id` (UUID, primary key)\n- `username` (unique, must start with @)\n- `publicKey` (Ed25519 public key)\n- `displayName`, `bio`, `avatarData`\n\n**balances** - Account balances\n- `id` (UUID, primary key)\n- `ownerId` (references account)\n- `ownerType` (user, team, contract, system)\n- `amount` (numeric, precise to 8 decimals)\n- `currencyCode` (USD, EUR, BTC, etc.)\n\n**transactions** - All blockchain transactions\n- `id` (UUID, primary key)\n- `type` (user_creation, transfer, contract_call, etc.)\n- `from`, `to` (account references)\n- `amount`, `currencyCode`\n- `status` (pending, confirmed, failed)\n- `blockHeight` (null if pending)\n\n**blocks** - Blockchain blocks\n- `height` (bigint, primary key)\n- `hash` (unique block hash)\n- `timestamp`\n- `gasLimit`, `gasUsed`\n- `transactionCount`\n\n**contracts** - Deployed smart contracts\n- `id` (UUID, primary key)\n- `deployedBy` (user reference)\n- `codeHash` (contract code hash)\n- `storageRoot` (contract storage root)\n\n## Testing\n\n```bash\n# Run all tests\nbun test\n\n# Run specific test file\nbun test src/accounts/users.test.ts\n\n# Watch mode\nbun test --watch\n```\n\n## Building for Production\n\n```bash\n# Build TypeScript\nbun run build\n\n# Output in dist/\nls dist/\n\n# Run production build\nNODE_ENV=production bun dist/index.js\n```\n\n## Deployment\n\nSee the [Production Deployment](/guides/deployment/) guide for deploying the ledger service.\n\nKey points:\n- Use Docker for consistent environments\n- Set `DATABASE_URL` for PostgreSQL connection\n- Configure `ALLOWED_ORIGINS` for CORS\n- Set up Nginx reverse proxy with SSL\n- Enable automated backups\n- Monitor with health checks\n\n## Related Documentation\n\n- [Environment Variables](/contributing/env-vars/) - Configuration\n- [Block Production](/contributing/ledger/blocks/) - Block production details\n- [Transactions](/contributing/ledger/transactions/) - Transaction processing\n- [API Reference](/tana-api/intro/) - Complete API documentation\n- [Deployment Guide](/guides/deployment/) - Production deployment\n",
    "html": "<p>The Tana Ledger is the core account and balance management service for the blockchain. It provides a REST API for user accounts, multi-currency balances, and transaction processing.</p>\n<h2 id=\"features\">Features</h2>\n<ul>\n<li><strong>User Accounts</strong> - Create and manage user accounts with Ed25519 keys</li>\n<li><strong>Team Management</strong> - Team creation, membership, and treasury accounts</li>\n<li><strong>Multi-Currency Balances</strong> - Track balances across multiple currencies (USD, EUR, BTC, etc.)</li>\n<li><strong>Transaction Processing</strong> - Validate and process transactions through block production</li>\n<li><strong>REST API</strong> - HTTP API for all account operations</li>\n</ul>\n<h2 id=\"architecture\">Architecture</h2>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>ledger/</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ src/</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ index.ts          # Main API server (Hono)</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ accounts/</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â”œâ”€â”€ users.ts      # User account management</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â””â”€â”€ teams.ts      # Team account management</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ balances/</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â”œâ”€â”€ index.ts      # Balance operations</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â””â”€â”€ currencies.ts # Currency management</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ transactions/</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â”œâ”€â”€ index.ts      # Transaction processing</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â””â”€â”€ validator.ts  # Transaction validation</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ blocks/</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â””â”€â”€ producer.ts   # Block production logic</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ api/</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â”œâ”€â”€ routes/       # API route handlers</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â””â”€â”€ schemas.ts    # Zod validation schemas</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€ db/</span></span>\n<span class=\"line\"><span>â”‚       â”œâ”€â”€ schema.ts     # Drizzle ORM schema</span></span>\n<span class=\"line\"><span>â”‚       â””â”€â”€ index.ts      # Database connection</span></span>\n<span class=\"line\"><span>â””â”€â”€ drizzle/              # Database migrations</span></span></code></pre><h2 id=\"development-setup\">Development Setup</h2>\n<h3 id=\"prerequisites\">Prerequisites</h3>\n<ul>\n<li>Bun 1.1.38+</li>\n<li>PostgreSQL 16</li>\n<li>Docker (for local development)</li>\n</ul>\n<h3 id=\"installation\">Installation</h3>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<p>The API will be available at <code>http://localhost:8080</code>.</p>\n<h3 id=\"database-migrations\">Database Migrations</h3>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"block-production\">Block Production</h2>\n<p>Transactions in Tana are processed into blocks. During development, you need to manually produce blocks to finalize pending transactions.</p>\n<h3 id=\"manual-block-production\">Manual Block Production</h3>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"bash\"></div>\n\n\n\n<p><strong>When to run:</strong></p>\n<ul>\n<li>After creating users (via mobile app or CLI)</li>\n<li>After submitting transactions</li>\n<li>When you want to finalize pending operations</li>\n</ul>\n<p><strong>What it does:</strong></p>\n<ol>\n<li>Finds all pending transactions in the database</li>\n<li>Executes them (user creation, transfers, contract calls, etc.)</li>\n<li>Creates a new block with those transactions</li>\n<li>Updates transaction status from &quot;pending&quot; â†’ &quot;confirmed&quot;</li>\n<li>Updates all affected balances and state</li>\n</ol>\n<p><strong>Example output:</strong></p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>ğŸ”¨ Producing new block...</span></span>\n<span class=\"line\"><span>Latest block: 6</span></span>\n<span class=\"line\"><span>Found 3 pending transaction(s)</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Processing transaction tx_abc123 (user_creation)...</span></span>\n<span class=\"line\"><span>  âœ“ Created user: @alice (550e8400-e29b-41d4-a716-446655440000)</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Processing transaction tx_def456 (transfer)...</span></span>\n<span class=\"line\"><span>  âœ“ Transferred 100 USD from @alice to @bob</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Processing transaction tx_ghi789 (contract_call)...</span></span>\n<span class=\"line\"><span>  âœ“ Executed contract cnt_myapp</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>âœ… Block produced successfully!</span></span>\n<span class=\"line\"><span>Block Details:</span></span>\n<span class=\"line\"><span>  Height: 7</span></span>\n<span class=\"line\"><span>  Transactions: 3</span></span>\n<span class=\"line\"><span>  Gas Used: 63000 / 1000000</span></span>\n<span class=\"line\"><span>  Block Hash: 0xabc123...</span></span></code></pre><h3 id=\"automatic-block-production-future\">Automatic Block Production (Future)</h3>\n<p>In production, blocks will be produced automatically at regular intervals (e.g., every 6 seconds) by a background worker or consensus mechanism. This is not yet implemented.</p>\n<h2 id=\"api-endpoints\">API Endpoints</h2>\n<h3 id=\"users\">Users</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>GET  /users               # List all users</span></span>\n<span class=\"line\"><span>POST /users               # Create new user</span></span>\n<span class=\"line\"><span>GET  /users/:id           # Get user by ID</span></span>\n<span class=\"line\"><span>GET  /users/username/:username  # Get user by username</span></span>\n<span class=\"line\"><span>PATCH /users/:id          # Update user</span></span>\n<span class=\"line\"><span>DELETE /users/:id         # Delete user</span></span>\n<span class=\"line\"><span>GET  /users/:id/balances  # Get user balances</span></span></code></pre><h3 id=\"balances\">Balances</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>GET  /balances            # List all balances</span></span>\n<span class=\"line\"><span>POST /balances            # Set balance (admin)</span></span>\n<span class=\"line\"><span>GET  /balances/:id        # Get specific balance</span></span></code></pre><h3 id=\"transactions\">Transactions</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>GET  /transactions        # List all transactions</span></span>\n<span class=\"line\"><span>POST /transactions        # Create transaction</span></span>\n<span class=\"line\"><span>GET  /transactions/:id    # Get transaction details</span></span></code></pre><h3 id=\"blocks\">Blocks</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>GET  /blocks              # List all blocks</span></span>\n<span class=\"line\"><span>GET  /blocks/:height      # Get block by height</span></span>\n<span class=\"line\"><span>GET  /blocks/latest       # Get latest block</span></span></code></pre><h3 id=\"contracts\">Contracts</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>GET  /contracts           # List all contracts</span></span>\n<span class=\"line\"><span>POST /contracts           # Deploy contract</span></span>\n<span class=\"line\"><span>GET  /contracts/:id       # Get contract details</span></span></code></pre><h2 id=\"environment-variables\">Environment Variables</h2>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"env\"></div>\n\n\n\n<p>See <a href=\"/contributing/env-vars/\">Environment Variables</a> for more details.</p>\n<h2 id=\"database-schema\">Database Schema</h2>\n<p>The ledger uses PostgreSQL with Drizzle ORM. Key tables:</p>\n<p><strong>users</strong> - User accounts</p>\n<ul>\n<li><code>id</code> (UUID, primary key)</li>\n<li><code>username</code> (unique, must start with @)</li>\n<li><code>publicKey</code> (Ed25519 public key)</li>\n<li><code>displayName</code>, <code>bio</code>, <code>avatarData</code></li>\n</ul>\n<p><strong>balances</strong> - Account balances</p>\n<ul>\n<li><code>id</code> (UUID, primary key)</li>\n<li><code>ownerId</code> (references account)</li>\n<li><code>ownerType</code> (user, team, contract, system)</li>\n<li><code>amount</code> (numeric, precise to 8 decimals)</li>\n<li><code>currencyCode</code> (USD, EUR, BTC, etc.)</li>\n</ul>\n<p><strong>transactions</strong> - All blockchain transactions</p>\n<ul>\n<li><code>id</code> (UUID, primary key)</li>\n<li><code>type</code> (user_creation, transfer, contract_call, etc.)</li>\n<li><code>from</code>, <code>to</code> (account references)</li>\n<li><code>amount</code>, <code>currencyCode</code></li>\n<li><code>status</code> (pending, confirmed, failed)</li>\n<li><code>blockHeight</code> (null if pending)</li>\n</ul>\n<p><strong>blocks</strong> - Blockchain blocks</p>\n<ul>\n<li><code>height</code> (bigint, primary key)</li>\n<li><code>hash</code> (unique block hash)</li>\n<li><code>timestamp</code></li>\n<li><code>gasLimit</code>, <code>gasUsed</code></li>\n<li><code>transactionCount</code></li>\n</ul>\n<p><strong>contracts</strong> - Deployed smart contracts</p>\n<ul>\n<li><code>id</code> (UUID, primary key)</li>\n<li><code>deployedBy</code> (user reference)</li>\n<li><code>codeHash</code> (contract code hash)</li>\n<li><code>storageRoot</code> (contract storage root)</li>\n</ul>\n<h2 id=\"testing\">Testing</h2>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"building-for-production\">Building for Production</h2>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"deployment\">Deployment</h2>\n<p>See the <a href=\"/guides/deployment/\">Production Deployment</a> guide for deploying the ledger service.</p>\n<p>Key points:</p>\n<ul>\n<li>Use Docker for consistent environments</li>\n<li>Set <code>DATABASE_URL</code> for PostgreSQL connection</li>\n<li>Configure <code>ALLOWED_ORIGINS</code> for CORS</li>\n<li>Set up Nginx reverse proxy with SSL</li>\n<li>Enable automated backups</li>\n<li>Monitor with health checks</li>\n</ul>\n<h2 id=\"related-documentation\">Related Documentation</h2>\n<ul>\n<li><a href=\"/contributing/env-vars/\">Environment Variables</a> - Configuration</li>\n<li><a href=\"/contributing/ledger/blocks/\">Block Production</a> - Block production details</li>\n<li><a href=\"/contributing/ledger/transactions/\">Transactions</a> - Transaction processing</li>\n<li><a href=\"/tana-api/intro/\">API Reference</a> - Complete API documentation</li>\n<li><a href=\"/guides/deployment/\">Deployment Guide</a> - Production deployment</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "cd ledger\n\n# Install dependencies\nbun install\n\n# Start PostgreSQL (via Docker)\ndocker-compose up -d postgres\n\n# Run database migrations\nbun run db:migrate\n\n# Start development server\nbun run dev"
      },
      {
        "lang": "bash",
        "code": "# Generate new migration\nbun run db:generate\n\n# Run migrations\nbun run db:migrate\n\n# Drop database (destructive!)\nbun run db:drop\n\n# Push schema changes (development only)\nbun run db:push\n\n# Open Drizzle Studio (GUI)\nbun run db:studio"
      },
      {
        "lang": "bash",
        "code": "# From project root:\nnpm run pending    # Process pending transactions\nnpm run block      # Same as above (alias)\n\n# From ledger directory:\nnpm run pending    # Short command\nnpm run blockchain:produce  # Full command name"
      },
      {
        "lang": "env",
        "code": "# Server Configuration\nPORT=8080\nNODE_ENV=development\n\n# Database\nDATABASE_URL=postgres://tana:tana_dev_password@localhost:5432/tana\n\n# CORS (for playground integration)\nALLOWED_ORIGINS=http://localhost:3000,http://localhost:4321\n\n# Ledger URL (for consistency with other services)\nTANA_LEDGER_URL=http://localhost:8080"
      },
      {
        "lang": "bash",
        "code": "# Run all tests\nbun test\n\n# Run specific test file\nbun test src/accounts/users.test.ts\n\n# Watch mode\nbun test --watch"
      },
      {
        "lang": "bash",
        "code": "# Build TypeScript\nbun run build\n\n# Output in dist/\nls dist/\n\n# Run production build\nNODE_ENV=production bun dist/index.js"
      }
    ],
    "tableOfContents": [
      {
        "id": "features",
        "text": "Features",
        "level": 2
      },
      {
        "id": "architecture",
        "text": "Architecture",
        "level": 2
      },
      {
        "id": "development-setup",
        "text": "Development Setup",
        "level": 2
      },
      {
        "id": "prerequisites",
        "text": "Prerequisites",
        "level": 3
      },
      {
        "id": "installation",
        "text": "Installation",
        "level": 3
      },
      {
        "id": "database-migrations",
        "text": "Database Migrations",
        "level": 3
      },
      {
        "id": "block-production",
        "text": "Block Production",
        "level": 2
      },
      {
        "id": "manual-block-production",
        "text": "Manual Block Production",
        "level": 3
      },
      {
        "id": "automatic-block-production-future",
        "text": "Automatic Block Production (Future)",
        "level": 3
      },
      {
        "id": "api-endpoints",
        "text": "API Endpoints",
        "level": 2
      },
      {
        "id": "users",
        "text": "Users",
        "level": 3
      },
      {
        "id": "balances",
        "text": "Balances",
        "level": 3
      },
      {
        "id": "transactions",
        "text": "Transactions",
        "level": 3
      },
      {
        "id": "blocks",
        "text": "Blocks",
        "level": 3
      },
      {
        "id": "contracts",
        "text": "Contracts",
        "level": 3
      },
      {
        "id": "environment-variables",
        "text": "Environment Variables",
        "level": 2
      },
      {
        "id": "database-schema",
        "text": "Database Schema",
        "level": 2
      },
      {
        "id": "testing",
        "text": "Testing",
        "level": 2
      },
      {
        "id": "building-for-production",
        "text": "Building for Production",
        "level": 2
      },
      {
        "id": "deployment",
        "text": "Deployment",
        "level": 2
      },
      {
        "id": "related-documentation",
        "text": "Related Documentation",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "contributing",
      "architecture"
    ],
    "metadata": {
      "title": "System Architecture",
      "description": "Learn how Tana's components work together"
    },
    "content": "\n## Overview\n\nTana consists of **five compiled binaries** and integrated services working together to provide a complete blockchain platform.\n\n## Binary Structure\n\n### 1. `tana` (CLI Binary)\n\n- **Built from:** `cli/` directory (TypeScript/Bun)\n- **Compiled with:** `bun build --compile`\n- **Purpose:** Main user interface and orchestrator\n- **Published:** `@tananetwork/tana` on npm\n\n**Contains:**\n- All commands (`new`, `deploy`, `balance`, `transfer`, `status`, `test`)\n- Configuration management (`~/.config/tana/`)\n- Network communication\n- Most business logic\n\n### 2. `tana-runtime` (Execution Binary)\n\n- **Built from:** `runtime/` directory (Rust)\n- **Compiled with:** `cargo build --release`\n- **Purpose:** Sandboxed TypeScript contract execution for on-chain execution\n- **Invoked by:** Block producer during consensus\n- **Not persistent:** One-shot execution per contract run\n\n### 3. `tana-edge` (Edge Server Binary)\n\n- **Built from:** `edge/` directory (Rust)\n- **Compiled with:** `cargo build --release`\n- **Purpose:** High-performance HTTP server for off-chain contract execution\n- **Port:** 8082 (default)\n- **Persistent:** Runs as long-lived HTTP service\n- **Features:**\n  - GET/POST endpoints for smart contracts\n  - Fresh V8 isolate per request (Cloudflare Workers-style)\n  - Sub-100ms latency for blockchain queries\n  - Read-only access (cannot modify state)\n  - Accesses ledger API for blockchain data\n\n### 4. `tana-mesh` (Network Coordinator)\n\n- **Built from:** `mesh/` directory (TypeScript/Bun)\n- **Purpose:** Network coordination and validator discovery\n- **Port:** 8190 (default)\n- **Features:**\n  - Validator registration via heartbeats\n  - Network topology visualization\n  - Chaos engineering controls\n  - Real-time WebSocket updates\n\n### 5. `tana-t4` (Content Storage)\n\n- **Built from:** `t4/` directory (TypeScript/Bun)\n- **Purpose:** Content-addressable storage service\n- **Port:** 8180 (default)\n- **Features:**\n  - Static asset storage\n  - Content addressing (hash-based)\n\n## Integrated Services\n\n### Ledger Service\n\n- **Location:** `cli/services/ledger`\n- **Built into:** Standalone service\n- **Purpose:** Blockchain state management (users, balances, transactions, blocks)\n- **Port:** 8080\n- **Persistent:** Runs as a long-lived service\n\n**Stack:** TypeScript/Bun, Hono, Drizzle ORM, PostgreSQL\n\n**Responsibilities:**\n- User/Team account management\n- Multi-currency balance tracking\n- Transaction validation\n- Block storage and queries\n- REST API for all blockchain data\n\n### Queue Service\n\n- **Location:** `cli/services/queue`\n- **Package:** `@tana/queue` (independent workspace)\n- **Purpose:** High-performance transaction queue using Redis Streams\n- **Shared by:** All validators for distributed block production\n\n**Stack:** TypeScript/Bun, ioredis\n\n**Responsibilities:**\n- Transaction queueing with O(1) submission (100,000+ tx/sec)\n- Consumer groups for distributed validators\n- Exactly-once processing with XACK\n- Deterministic transaction ordering via Stream IDs\n- Pub/Sub notifications for instant updates\n\n### Identity Service\n\n- **Location:** `cli/services/identity`\n- **Package:** `@tana/identity` (independent workspace)\n- **Purpose:** User authentication and session management (NOT blockchain data)\n- **Port:** 8090\n- **Database:** Separate PostgreSQL tables (not replicated across validators)\n\n**Stack:** TypeScript/Bun, Hono, Drizzle ORM, PostgreSQL\n\n**Responsibilities:**\n- Mobile-first QR code authentication (like WhatsApp Web)\n- Session management with real-time updates (Server-Sent Events)\n- Device token management for push notifications\n- Transaction approval workflow for mobile apps\n- Secure authentication without exposing private keys to desktop/laptop\n\n**Security Model:**\n- Private keys ONLY exist on mobile devices (hardware security)\n- Desktop/laptop computers receive session tokens only (read-only interface)\n- No MetaMask-style browser extensions (protects against malware)\n- Ed25519 signature verification for all approvals\n\n## Data Flow\n\n### Contract Deployment Flow\n\n```\nUser runs: tana deploy contract\n          â†“\n    [tana CLI binary]\n          â†“\n    1. Read config from ~/.config/tana/\n    2. Determine deployment target (local/remote)\n    3. Sign transaction with Ed25519\n    4. Validate contract code\n          â†“\n    [Ledger API] â† HTTP POST /contracts\n          â†“\n    1. Verify signature\n    2. Create transaction\n    3. Queue to Redis Streams\n          â†“\n    [Redis Queue Service] â† XADD\n          â†“\n    [Block Producer] â† XREADGROUP (consumer)\n          â†“\n    1. Consume pending transactions\n    2. Sort by Stream ID (deterministic ordering)\n    3. Execute transactions\n    4. Create new block\n    5. XACK processed transactions\n          â†“\n    [tana-runtime binary] â† Execute contracts\n          â†“\n    Return state changes\n          â†“\n    [Ledger Service] â† Commit to PostgreSQL\n```\n\n### Authentication Flow (Mobile QR Login)\n\n```\nUser clicks \"Login\" on website\n          â†“\n    [Website] â† POST /auth/session/create\n          â†“\n    [Identity Service] creates session\n          â†“\n    Returns: sessionId + challenge + QR data\n          â†“\n    [Website] displays QR code\n    [Website] opens SSE connection (/auth/session/:id/events)\n          â†“\n    [User scans QR with mobile app]\n          â†“\n    [Mobile App] â† GET /auth/session/:id\n          â†“\n    [Identity Service] marks as \"scanned\"\n          â†“\n    [SSE] â†’ \"scanned\" event to website\n          â†“\n    [User approves on mobile]\n          â†“\n    [Mobile App] signs challenge with Ed25519\n    [Mobile App] â† POST /auth/session/:id/approve\n          â†“\n    [Identity Service] verifies signature\n    [Identity Service] generates session token\n          â†“\n    [SSE] â†’ \"approved\" event with token to website\n          â†“\n    [Website] receives session token\n    [Website] redirects to app with authentication\n```\n\n## Configuration Structure\n\n### Global Configuration\n\n```\n~/.config/tana/\nâ”œâ”€â”€ config.json              # Global settings (default chain, user)\nâ”œâ”€â”€ chains/\nâ”‚   â”œâ”€â”€ local.json          # Local chain config\nâ”‚   â””â”€â”€ mainnet.json        # Remote chain configs\nâ”œâ”€â”€ nodes/\nâ”‚   â””â”€â”€ node-xyz.json       # Node participation configs\nâ””â”€â”€ users/\n    â””â”€â”€ alice.json          # User credentials (keys)\n```\n\n### Project Structure\n\n```\nmy-app/\nâ”œâ”€â”€ contract.ts             # Contract code\nâ””â”€â”€ contract.json           # Contract metadata\n```\n\n## Component Details\n\n### Ledger Service (Port 8080)\n\n**Endpoints:**\n- `GET /health` - Health check\n- `GET /users` - List users\n- `POST /users` - Create user\n- `GET /balances` - Query balances\n- `POST /balances` - Set balance\n- `GET /transactions` - List transactions\n- `POST /transactions` - Create transaction (queues to Redis)\n- `GET /blocks` - Query blocks\n- `POST /blocks` - Create block\n- `GET /contracts` - List contracts\n- `POST /contracts` - Deploy contract\n\n**Database Tables:**\n- `users` - User accounts\n- `balances` - Multi-currency balances\n- `transactions` - Transaction history (confirmed only)\n- `currencies` - Supported currencies\n- `blocks` - Blockchain blocks\n- `contracts` - Deployed smart contracts\n\n### Identity Service (Port 8090)\n\n**Endpoints:**\n- `GET /health` - Health check\n- `POST /auth/session/create` - Create QR code authentication session\n- `GET /auth/session/:id` - Get session details (mobile app scans QR)\n- `GET /auth/session/:id/events` - SSE stream for real-time session updates\n- `POST /auth/session/:id/approve` - Mobile app approves login with signature\n- `POST /auth/session/:id/reject` - Mobile app rejects login\n- `POST /auth/session/validate` - Validate session token\n\n**Database Tables (Separate from blockchain):**\n- `auth_sessions` - QR code login sessions with status tracking\n- `transaction_requests` - Pending transaction approvals from mobile\n- `device_tokens` - Push notification tokens for mobile devices\n\n**Authentication Flow:**\n1. Website creates session with `/auth/session/create` â†’ receives session ID + challenge\n2. Website displays QR code with session data\n3. Website opens SSE connection to `/auth/session/:id/events` for real-time updates\n4. Mobile app scans QR â†’ calls `/auth/session/:id` â†’ marks as \"scanned\"\n5. User approves on mobile â†’ signs challenge with Ed25519 private key\n6. Mobile calls `/auth/session/:id/approve` with signature\n7. SSE stream notifies website â†’ session approved with token\n8. Website receives session token for subsequent authenticated requests\n\n### Consensus Service\n\n- **Location:** `cli/services/consensus`\n- **Purpose:** Multi-validator P2P consensus coordination\n- **Ports:** 9000 (WebSocket P2P), 9001 (HTTP API)\n- **Features:**\n  - Validator-to-validator P2P communication\n  - Block proposal and voting\n  - Leader election\n  - State synchronization\n\n### Rust Runtime\n\n**Purpose:** Sandboxed V8 TypeScript execution engine\n\n- Execute smart contracts in isolated environment\n- No network access, filesystem, or system calls\n- Deterministic execution\n- Gas metering\n\n**Modules Provided:**\n- `tana/core` or `tana:core` - Console, version info\n- `tana/kv` or `tana:kv` - Cloudflare-compatible KV storage\n- `tana/context` or `tana:context` - Execution context (owner, caller, block, input)\n- `tana/block` or `tana:block` - Blockchain queries (getUser, getBalance, getTransaction)\n- `tana/tx` or `tana:tx` - Transaction staging and execution\n- `tana/utils` or `tana:utils` - Whitelisted fetch API\n\n## Monorepo Structure\n\n```\ntana/                        # Monorepo root\nâ”œâ”€â”€ runtime/                 # Rust - V8 TypeScript execution engine\nâ”‚   â”œâ”€â”€ src/                 # Rust source (deno_core)\nâ”‚   â””â”€â”€ Cargo.toml\nâ”‚\nâ”œâ”€â”€ tana-edge/               # Rust - High-performance edge server\nâ”‚   â”œâ”€â”€ src/                 # Rust source (Actix Web + V8)\nâ”‚   â””â”€â”€ Cargo.toml\nâ”‚\nâ”œâ”€â”€ cli/                     # TypeScript/Bun - Command-line tools\nâ”‚   â”œâ”€â”€ core/                # Core commands and logic\nâ”‚   â”œâ”€â”€ services/            # Integrated services\nâ”‚   â”‚   â”œâ”€â”€ ledger/          # @tana/ledger - Blockchain state (port 8080)\nâ”‚   â”‚   â”œâ”€â”€ queue/           # @tana/queue - Redis transaction queue\nâ”‚   â”‚   â””â”€â”€ identity/        # @tana/identity - Authentication (port 8090)\nâ”‚   â””â”€â”€ package.json\nâ”‚\nâ”œâ”€â”€ websites/                # Web applications\nâ”‚   â”œâ”€â”€ playground/          # Interactive contract playground\nâ”‚   â”œâ”€â”€ landing/             # Landing page\nâ”‚   â””â”€â”€ docs/                # Documentation site (you are here!)\nâ”‚\nâ”œâ”€â”€ types/                   # Shared TypeScript type definitions\nâ”‚   â”œâ”€â”€ tana-core.d.ts\nâ”‚   â”œâ”€â”€ tana-kv.d.ts         # KV storage (Cloudflare-compatible)\nâ”‚   â”œâ”€â”€ tana-utils.d.ts\nâ”‚   â”œâ”€â”€ tana-block.d.ts\nâ”‚   â”œâ”€â”€ tana-context.d.ts    # Execution context\nâ”‚   â”œâ”€â”€ tana-net.d.ts        # HTTP request/response\nâ”‚   â””â”€â”€ tana-tx.d.ts\nâ”‚\nâ”œâ”€â”€ examples/                # Example smart contracts\nâ”œâ”€â”€ docs/                    # Technical documentation (markdown)\nâ”œâ”€â”€ mprocs.yaml              # Multi-process configuration\nâ””â”€â”€ package.json             # Workspace management\n```\n\n## Development Workflow\n\n### Database Setup\n\nPostgreSQL stores both blockchain data and authentication data in separate tables:\n\n#### Blockchain Tables (Ledger Service)\n\n```sql\n-- Users\nCREATE TABLE users (\n  id TEXT PRIMARY KEY,\n  username TEXT UNIQUE,\n  display_name TEXT,\n  public_key TEXT,\n  nonce INTEGER DEFAULT 0,\n  bio TEXT,\n  created_at TIMESTAMP\n);\n\n-- Balances\nCREATE TABLE balances (\n  owner_id TEXT,\n  owner_type TEXT,\n  currency_code TEXT,\n  amount TEXT,\n  updated_at TIMESTAMP\n);\n\n-- Transactions (confirmed only - pending in Redis queue)\nCREATE TABLE transactions (\n  id TEXT PRIMARY KEY,\n  from_id TEXT,\n  to_id TEXT,\n  amount TEXT,\n  currency_code TEXT,\n  type TEXT,\n  status TEXT,\n  metadata JSONB,\n  created_at TIMESTAMP,\n  confirmed_at TIMESTAMP\n);\n\n-- Blocks\nCREATE TABLE blocks (\n  height INTEGER PRIMARY KEY,\n  hash TEXT,\n  parent_hash TEXT,\n  state_root TEXT,\n  timestamp TIMESTAMP,\n  producer TEXT,\n  transactions JSONB\n);\n\n-- Contracts\nCREATE TABLE contracts (\n  id TEXT PRIMARY KEY,\n  code TEXT,\n  code_hash TEXT,\n  owner_id TEXT,\n  created_at TIMESTAMP\n);\n```\n\n#### Authentication Tables (Identity Service)\n\n**Note:** These tables are separate from blockchain data and NOT replicated across validators.\n\n```sql\n-- Auth Sessions (QR code login)\nCREATE TABLE auth_sessions (\n  id TEXT PRIMARY KEY,\n  challenge TEXT NOT NULL UNIQUE,\n  status auth_session_status NOT NULL DEFAULT 'waiting',\n  user_id TEXT,\n  username TEXT,\n  public_key TEXT,\n  session_token TEXT UNIQUE,\n  return_url TEXT NOT NULL,\n  app_name TEXT,\n  app_icon TEXT,\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  expires_at TIMESTAMP NOT NULL,\n  approved_at TIMESTAMP,\n  scanned_at TIMESTAMP\n);\n\n-- Transaction Requests (mobile approval)\nCREATE TABLE transaction_requests (\n  id TEXT PRIMARY KEY,\n  session_id TEXT NOT NULL REFERENCES auth_sessions(id),\n  user_id TEXT NOT NULL,\n  transaction_type TEXT NOT NULL,\n  transaction_data TEXT NOT NULL,\n  status transaction_request_status NOT NULL DEFAULT 'pending',\n  transaction_id TEXT,\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  expires_at TIMESTAMP NOT NULL,\n  responded_at TIMESTAMP\n);\n\n-- Device Tokens (push notifications)\nCREATE TABLE device_tokens (\n  id TEXT PRIMARY KEY,\n  user_id TEXT NOT NULL,\n  push_token TEXT NOT NULL UNIQUE,\n  device_name TEXT,\n  platform TEXT,\n  app_version TEXT,\n  is_active TEXT NOT NULL DEFAULT 'true',\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  last_used_at TIMESTAMP NOT NULL DEFAULT NOW()\n);\n```\n\n### Environment Configuration\n\nAll sensitive configuration is stored in `.env` files:\n\n```bash\n# .env\n\n# Database URLs\nDATABASE_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'\nIDENTITY_DB_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'  # Can use same DB\nREDIS_URL='redis://localhost:6379'\n\n# Service Ports\nPORT=8080                    # Ledger service\nIDENTITY_PORT=8090           # Identity service\nEDGE_PORT=8180              # Edge server (tana-edge)\n\n# Environment\nNODE_ENV=development\n```\n\n**Environment Variable Reference:**\n\n- `DATABASE_URL` - PostgreSQL connection string for blockchain data (ledger service)\n- `IDENTITY_DB_URL` - PostgreSQL connection string for authentication data (identity service)\n  - Can use the same database as `DATABASE_URL` (tables are separate)\n  - Identity data is NOT replicated across validators\n- `REDIS_URL` - Redis connection string for transaction queue\n  - Shared by all validators\n  - Must support Redis Streams\n- `PORT` - HTTP port for ledger service API (default: 8080)\n- `IDENTITY_PORT` - HTTP port for identity service API (default: 8090)\n- `EDGE_PORT` - HTTP port for edge server (default: 8180)\n\n## Security Model\n\n### Sandbox Isolation\n\nThe Rust runtime provides complete isolation:\n\n- No filesystem access\n- No network access (except whitelisted fetch via `tana/utils`)\n- No process spawning\n- No system calls\n- Memory limits enforced\n- Gas metering for execution costs\n\n### API Security\n\n- CORS enabled for allowed origins\n- Rate limiting on all endpoints\n- Input validation with Zod schemas\n- SQL injection protection via Drizzle ORM\n- Environment-based configuration\n\n## Deployment Architecture\n\n### Development\n\n```\nmprocs â†’ Multiple services in one terminal\n  â”œâ”€â”€ PostgreSQL (Docker) - Blockchain + Auth data\n  â”œâ”€â”€ Redis (Docker) - Transaction queue\n  â”œâ”€â”€ Ledger Service (Bun:8080) - Blockchain API\n  â”œâ”€â”€ Identity Service (Bun:8090) - Authentication API\n  â”œâ”€â”€ Edge Server (Rust:8180) - Contract execution\n  â””â”€â”€ Docs/Playground (Astro/Node)\n```\n\n### Production - Single Node\n\n```\nSingle VPS:\n  â”œâ”€â”€ Nginx (Reverse proxy, SSL)\n  â”‚   â”œâ”€â”€ /api â†’ Ledger Service (8080)\n  â”‚   â”œâ”€â”€ /auth â†’ Identity Service (8090)\n  â”‚   â””â”€â”€ /edge â†’ Edge Server (8180)\n  â”œâ”€â”€ Docker Compose\n  â”‚   â”œâ”€â”€ Ledger Service (port 8080)\n  â”‚   â”œâ”€â”€ Identity Service (port 8090)\n  â”‚   â”œâ”€â”€ PostgreSQL (blockchain + auth)\n  â”‚   â””â”€â”€ Redis (transaction queue)\n  â”œâ”€â”€ tana-runtime (Binary)\n  â””â”€â”€ tana-edge (Binary on 8180)\n```\n\n### Production - Multi-Validator Network\n\n```\nNetwork Topology:\n\n[Queue Service Node]\n  â””â”€â”€ Redis (shared by all validators)\n\n[Validator Node 1]\n  â”œâ”€â”€ PostgreSQL (own copy)\n  â”œâ”€â”€ Ledger Service (8080)\n  â””â”€â”€ Block Producer (consumes from shared Redis)\n\n[Validator Node 2]\n  â”œâ”€â”€ PostgreSQL (own copy)\n  â”œâ”€â”€ Ledger Service (8080)\n  â””â”€â”€ Block Producer (consumes from shared Redis)\n\n[API Node] (public-facing, read-only)\n  â”œâ”€â”€ PostgreSQL (synced via consensus)\n  â”œâ”€â”€ Ledger Service (8080)\n  â”œâ”€â”€ Identity Service (8090)\n  â””â”€â”€ Edge Server (8180)\n\n[Mobile App]\n  â””â”€â”€ Connects to Identity Service for auth\n```\n\n**Key Points:**\n- Each validator runs its own PostgreSQL (database replication via blockchain consensus)\n- Redis queue is shared by all validators\n- Identity service typically runs on API nodes (not validators)\n- Mobile apps connect to identity service for authentication\n- Deterministic transaction ordering ensures consensus\n\n## Next Steps\n\n- [Quick Start Guide](/guides/quickstart/) - Set up your development environment\n- [CLI Reference](/tana-cli/intro/) - Learn the CLI commands\n- [API Reference](/tana-api/intro/) - Explore the REST API\n",
    "html": "<h2 id=\"overview\">Overview</h2>\n<p>Tana consists of <strong>five compiled binaries</strong> and integrated services working together to provide a complete blockchain platform.</p>\n<h2 id=\"binary-structure\">Binary Structure</h2>\n<h3 id=\"1-tana-cli-binary\">1. <code>tana</code> (CLI Binary)</h3>\n<ul>\n<li><strong>Built from:</strong> <code>cli/</code> directory (TypeScript/Bun)</li>\n<li><strong>Compiled with:</strong> <code>bun build --compile</code></li>\n<li><strong>Purpose:</strong> Main user interface and orchestrator</li>\n<li><strong>Published:</strong> <code>@tananetwork/tana</code> on npm</li>\n</ul>\n<p><strong>Contains:</strong></p>\n<ul>\n<li>All commands (<code>new</code>, <code>deploy</code>, <code>balance</code>, <code>transfer</code>, <code>status</code>, <code>test</code>)</li>\n<li>Configuration management (<code>~/.config/tana/</code>)</li>\n<li>Network communication</li>\n<li>Most business logic</li>\n</ul>\n<h3 id=\"2-tana-runtime-execution-binary\">2. <code>tana-runtime</code> (Execution Binary)</h3>\n<ul>\n<li><strong>Built from:</strong> <code>runtime/</code> directory (Rust)</li>\n<li><strong>Compiled with:</strong> <code>cargo build --release</code></li>\n<li><strong>Purpose:</strong> Sandboxed TypeScript contract execution for on-chain execution</li>\n<li><strong>Invoked by:</strong> Block producer during consensus</li>\n<li><strong>Not persistent:</strong> One-shot execution per contract run</li>\n</ul>\n<h3 id=\"3-tana-edge-edge-server-binary\">3. <code>tana-edge</code> (Edge Server Binary)</h3>\n<ul>\n<li><strong>Built from:</strong> <code>edge/</code> directory (Rust)</li>\n<li><strong>Compiled with:</strong> <code>cargo build --release</code></li>\n<li><strong>Purpose:</strong> High-performance HTTP server for off-chain contract execution</li>\n<li><strong>Port:</strong> 8082 (default)</li>\n<li><strong>Persistent:</strong> Runs as long-lived HTTP service</li>\n<li><strong>Features:</strong><ul>\n<li>GET/POST endpoints for smart contracts</li>\n<li>Fresh V8 isolate per request (Cloudflare Workers-style)</li>\n<li>Sub-100ms latency for blockchain queries</li>\n<li>Read-only access (cannot modify state)</li>\n<li>Accesses ledger API for blockchain data</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"4-tana-mesh-network-coordinator\">4. <code>tana-mesh</code> (Network Coordinator)</h3>\n<ul>\n<li><strong>Built from:</strong> <code>mesh/</code> directory (TypeScript/Bun)</li>\n<li><strong>Purpose:</strong> Network coordination and validator discovery</li>\n<li><strong>Port:</strong> 8190 (default)</li>\n<li><strong>Features:</strong><ul>\n<li>Validator registration via heartbeats</li>\n<li>Network topology visualization</li>\n<li>Chaos engineering controls</li>\n<li>Real-time WebSocket updates</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"5-tana-t4-content-storage\">5. <code>tana-t4</code> (Content Storage)</h3>\n<ul>\n<li><strong>Built from:</strong> <code>t4/</code> directory (TypeScript/Bun)</li>\n<li><strong>Purpose:</strong> Content-addressable storage service</li>\n<li><strong>Port:</strong> 8180 (default)</li>\n<li><strong>Features:</strong><ul>\n<li>Static asset storage</li>\n<li>Content addressing (hash-based)</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"integrated-services\">Integrated Services</h2>\n<h3 id=\"ledger-service\">Ledger Service</h3>\n<ul>\n<li><strong>Location:</strong> <code>cli/services/ledger</code></li>\n<li><strong>Built into:</strong> Standalone service</li>\n<li><strong>Purpose:</strong> Blockchain state management (users, balances, transactions, blocks)</li>\n<li><strong>Port:</strong> 8080</li>\n<li><strong>Persistent:</strong> Runs as a long-lived service</li>\n</ul>\n<p><strong>Stack:</strong> TypeScript/Bun, Hono, Drizzle ORM, PostgreSQL</p>\n<p><strong>Responsibilities:</strong></p>\n<ul>\n<li>User/Team account management</li>\n<li>Multi-currency balance tracking</li>\n<li>Transaction validation</li>\n<li>Block storage and queries</li>\n<li>REST API for all blockchain data</li>\n</ul>\n<h3 id=\"queue-service\">Queue Service</h3>\n<ul>\n<li><strong>Location:</strong> <code>cli/services/queue</code></li>\n<li><strong>Package:</strong> <code>@tana/queue</code> (independent workspace)</li>\n<li><strong>Purpose:</strong> High-performance transaction queue using Redis Streams</li>\n<li><strong>Shared by:</strong> All validators for distributed block production</li>\n</ul>\n<p><strong>Stack:</strong> TypeScript/Bun, ioredis</p>\n<p><strong>Responsibilities:</strong></p>\n<ul>\n<li>Transaction queueing with O(1) submission (100,000+ tx/sec)</li>\n<li>Consumer groups for distributed validators</li>\n<li>Exactly-once processing with XACK</li>\n<li>Deterministic transaction ordering via Stream IDs</li>\n<li>Pub/Sub notifications for instant updates</li>\n</ul>\n<h3 id=\"identity-service\">Identity Service</h3>\n<ul>\n<li><strong>Location:</strong> <code>cli/services/identity</code></li>\n<li><strong>Package:</strong> <code>@tana/identity</code> (independent workspace)</li>\n<li><strong>Purpose:</strong> User authentication and session management (NOT blockchain data)</li>\n<li><strong>Port:</strong> 8090</li>\n<li><strong>Database:</strong> Separate PostgreSQL tables (not replicated across validators)</li>\n</ul>\n<p><strong>Stack:</strong> TypeScript/Bun, Hono, Drizzle ORM, PostgreSQL</p>\n<p><strong>Responsibilities:</strong></p>\n<ul>\n<li>Mobile-first QR code authentication (like WhatsApp Web)</li>\n<li>Session management with real-time updates (Server-Sent Events)</li>\n<li>Device token management for push notifications</li>\n<li>Transaction approval workflow for mobile apps</li>\n<li>Secure authentication without exposing private keys to desktop/laptop</li>\n</ul>\n<p><strong>Security Model:</strong></p>\n<ul>\n<li>Private keys ONLY exist on mobile devices (hardware security)</li>\n<li>Desktop/laptop computers receive session tokens only (read-only interface)</li>\n<li>No MetaMask-style browser extensions (protects against malware)</li>\n<li>Ed25519 signature verification for all approvals</li>\n</ul>\n<h2 id=\"data-flow\">Data Flow</h2>\n<h3 id=\"contract-deployment-flow\">Contract Deployment Flow</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User runs: tana deploy contract</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [tana CLI binary]</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    1. Read config from ~/.config/tana/</span></span>\n<span class=\"line\"><span>    2. Determine deployment target (local/remote)</span></span>\n<span class=\"line\"><span>    3. Sign transaction with Ed25519</span></span>\n<span class=\"line\"><span>    4. Validate contract code</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [Ledger API] â† HTTP POST /contracts</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    1. Verify signature</span></span>\n<span class=\"line\"><span>    2. Create transaction</span></span>\n<span class=\"line\"><span>    3. Queue to Redis Streams</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [Redis Queue Service] â† XADD</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [Block Producer] â† XREADGROUP (consumer)</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    1. Consume pending transactions</span></span>\n<span class=\"line\"><span>    2. Sort by Stream ID (deterministic ordering)</span></span>\n<span class=\"line\"><span>    3. Execute transactions</span></span>\n<span class=\"line\"><span>    4. Create new block</span></span>\n<span class=\"line\"><span>    5. XACK processed transactions</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [tana-runtime binary] â† Execute contracts</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    Return state changes</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [Ledger Service] â† Commit to PostgreSQL</span></span></code></pre><h3 id=\"authentication-flow-mobile-qr-login\">Authentication Flow (Mobile QR Login)</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User clicks \"Login\" on website</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [Website] â† POST /auth/session/create</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [Identity Service] creates session</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    Returns: sessionId + challenge + QR data</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [Website] displays QR code</span></span>\n<span class=\"line\"><span>    [Website] opens SSE connection (/auth/session/:id/events)</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [User scans QR with mobile app]</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [Mobile App] â† GET /auth/session/:id</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [Identity Service] marks as \"scanned\"</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [SSE] â†’ \"scanned\" event to website</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [User approves on mobile]</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [Mobile App] signs challenge with Ed25519</span></span>\n<span class=\"line\"><span>    [Mobile App] â† POST /auth/session/:id/approve</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [Identity Service] verifies signature</span></span>\n<span class=\"line\"><span>    [Identity Service] generates session token</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [SSE] â†’ \"approved\" event with token to website</span></span>\n<span class=\"line\"><span>          â†“</span></span>\n<span class=\"line\"><span>    [Website] receives session token</span></span>\n<span class=\"line\"><span>    [Website] redirects to app with authentication</span></span></code></pre><h2 id=\"configuration-structure\">Configuration Structure</h2>\n<h3 id=\"global-configuration\">Global Configuration</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>~/.config/tana/</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ config.json              # Global settings (default chain, user)</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ chains/</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ local.json          # Local chain config</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€ mainnet.json        # Remote chain configs</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ nodes/</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€ node-xyz.json       # Node participation configs</span></span>\n<span class=\"line\"><span>â””â”€â”€ users/</span></span>\n<span class=\"line\"><span>    â””â”€â”€ alice.json          # User credentials (keys)</span></span></code></pre><h3 id=\"project-structure\">Project Structure</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>my-app/</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ contract.ts             # Contract code</span></span>\n<span class=\"line\"><span>â””â”€â”€ contract.json           # Contract metadata</span></span></code></pre><h2 id=\"component-details\">Component Details</h2>\n<h3 id=\"ledger-service-port-8080\">Ledger Service (Port 8080)</h3>\n<p><strong>Endpoints:</strong></p>\n<ul>\n<li><code>GET /health</code> - Health check</li>\n<li><code>GET /users</code> - List users</li>\n<li><code>POST /users</code> - Create user</li>\n<li><code>GET /balances</code> - Query balances</li>\n<li><code>POST /balances</code> - Set balance</li>\n<li><code>GET /transactions</code> - List transactions</li>\n<li><code>POST /transactions</code> - Create transaction (queues to Redis)</li>\n<li><code>GET /blocks</code> - Query blocks</li>\n<li><code>POST /blocks</code> - Create block</li>\n<li><code>GET /contracts</code> - List contracts</li>\n<li><code>POST /contracts</code> - Deploy contract</li>\n</ul>\n<p><strong>Database Tables:</strong></p>\n<ul>\n<li><code>users</code> - User accounts</li>\n<li><code>balances</code> - Multi-currency balances</li>\n<li><code>transactions</code> - Transaction history (confirmed only)</li>\n<li><code>currencies</code> - Supported currencies</li>\n<li><code>blocks</code> - Blockchain blocks</li>\n<li><code>contracts</code> - Deployed smart contracts</li>\n</ul>\n<h3 id=\"identity-service-port-8090\">Identity Service (Port 8090)</h3>\n<p><strong>Endpoints:</strong></p>\n<ul>\n<li><code>GET /health</code> - Health check</li>\n<li><code>POST /auth/session/create</code> - Create QR code authentication session</li>\n<li><code>GET /auth/session/:id</code> - Get session details (mobile app scans QR)</li>\n<li><code>GET /auth/session/:id/events</code> - SSE stream for real-time session updates</li>\n<li><code>POST /auth/session/:id/approve</code> - Mobile app approves login with signature</li>\n<li><code>POST /auth/session/:id/reject</code> - Mobile app rejects login</li>\n<li><code>POST /auth/session/validate</code> - Validate session token</li>\n</ul>\n<p><strong>Database Tables (Separate from blockchain):</strong></p>\n<ul>\n<li><code>auth_sessions</code> - QR code login sessions with status tracking</li>\n<li><code>transaction_requests</code> - Pending transaction approvals from mobile</li>\n<li><code>device_tokens</code> - Push notification tokens for mobile devices</li>\n</ul>\n<p><strong>Authentication Flow:</strong></p>\n<ol>\n<li>Website creates session with <code>/auth/session/create</code> â†’ receives session ID + challenge</li>\n<li>Website displays QR code with session data</li>\n<li>Website opens SSE connection to <code>/auth/session/:id/events</code> for real-time updates</li>\n<li>Mobile app scans QR â†’ calls <code>/auth/session/:id</code> â†’ marks as &quot;scanned&quot;</li>\n<li>User approves on mobile â†’ signs challenge with Ed25519 private key</li>\n<li>Mobile calls <code>/auth/session/:id/approve</code> with signature</li>\n<li>SSE stream notifies website â†’ session approved with token</li>\n<li>Website receives session token for subsequent authenticated requests</li>\n</ol>\n<h3 id=\"consensus-service\">Consensus Service</h3>\n<ul>\n<li><strong>Location:</strong> <code>cli/services/consensus</code></li>\n<li><strong>Purpose:</strong> Multi-validator P2P consensus coordination</li>\n<li><strong>Ports:</strong> 9000 (WebSocket P2P), 9001 (HTTP API)</li>\n<li><strong>Features:</strong><ul>\n<li>Validator-to-validator P2P communication</li>\n<li>Block proposal and voting</li>\n<li>Leader election</li>\n<li>State synchronization</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"rust-runtime\">Rust Runtime</h3>\n<p><strong>Purpose:</strong> Sandboxed V8 TypeScript execution engine</p>\n<ul>\n<li>Execute smart contracts in isolated environment</li>\n<li>No network access, filesystem, or system calls</li>\n<li>Deterministic execution</li>\n<li>Gas metering</li>\n</ul>\n<p><strong>Modules Provided:</strong></p>\n<ul>\n<li><code>tana/core</code> or <code>tana:core</code> - Console, version info</li>\n<li><code>tana/kv</code> or <code>tana:kv</code> - Cloudflare-compatible KV storage</li>\n<li><code>tana/context</code> or <code>tana:context</code> - Execution context (owner, caller, block, input)</li>\n<li><code>tana/block</code> or <code>tana:block</code> - Blockchain queries (getUser, getBalance, getTransaction)</li>\n<li><code>tana/tx</code> or <code>tana:tx</code> - Transaction staging and execution</li>\n<li><code>tana/utils</code> or <code>tana:utils</code> - Whitelisted fetch API</li>\n</ul>\n<h2 id=\"monorepo-structure\">Monorepo Structure</h2>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>tana/                        # Monorepo root</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ runtime/                 # Rust - V8 TypeScript execution engine</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ src/                 # Rust source (deno_core)</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€ Cargo.toml</span></span>\n<span class=\"line\"><span>â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ tana-edge/               # Rust - High-performance edge server</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ src/                 # Rust source (Actix Web + V8)</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€ Cargo.toml</span></span>\n<span class=\"line\"><span>â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ cli/                     # TypeScript/Bun - Command-line tools</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ core/                # Core commands and logic</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ services/            # Integrated services</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â”œâ”€â”€ ledger/          # @tana/ledger - Blockchain state (port 8080)</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â”œâ”€â”€ queue/           # @tana/queue - Redis transaction queue</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â””â”€â”€ identity/        # @tana/identity - Authentication (port 8090)</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€ package.json</span></span>\n<span class=\"line\"><span>â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ websites/                # Web applications</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ playground/          # Interactive contract playground</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ landing/             # Landing page</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€ docs/                # Documentation site (you are here!)</span></span>\n<span class=\"line\"><span>â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ types/                   # Shared TypeScript type definitions</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ tana-core.d.ts</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ tana-kv.d.ts         # KV storage (Cloudflare-compatible)</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ tana-utils.d.ts</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ tana-block.d.ts</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ tana-context.d.ts    # Execution context</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ tana-net.d.ts        # HTTP request/response</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€ tana-tx.d.ts</span></span>\n<span class=\"line\"><span>â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ examples/                # Example smart contracts</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ docs/                    # Technical documentation (markdown)</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ mprocs.yaml              # Multi-process configuration</span></span>\n<span class=\"line\"><span>â””â”€â”€ package.json             # Workspace management</span></span></code></pre><h2 id=\"development-workflow\">Development Workflow</h2>\n<h3 id=\"database-setup\">Database Setup</h3>\n<p>PostgreSQL stores both blockchain data and authentication data in separate tables:</p>\n<h4 id=\"blockchain-tables-ledger-service\">Blockchain Tables (Ledger Service)</h4>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"sql\"></div>\n\n\n\n<h4 id=\"authentication-tables-identity-service\">Authentication Tables (Identity Service)</h4>\n<p><strong>Note:</strong> These tables are separate from blockchain data and NOT replicated across validators.</p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"sql\"></div>\n\n\n\n<h3 id=\"environment-configuration\">Environment Configuration</h3>\n<p>All sensitive configuration is stored in <code>.env</code> files:</p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"bash\"></div>\n\n\n\n<p><strong>Environment Variable Reference:</strong></p>\n<ul>\n<li><code>DATABASE_URL</code> - PostgreSQL connection string for blockchain data (ledger service)</li>\n<li><code>IDENTITY_DB_URL</code> - PostgreSQL connection string for authentication data (identity service)<ul>\n<li>Can use the same database as <code>DATABASE_URL</code> (tables are separate)</li>\n<li>Identity data is NOT replicated across validators</li>\n</ul>\n</li>\n<li><code>REDIS_URL</code> - Redis connection string for transaction queue<ul>\n<li>Shared by all validators</li>\n<li>Must support Redis Streams</li>\n</ul>\n</li>\n<li><code>PORT</code> - HTTP port for ledger service API (default: 8080)</li>\n<li><code>IDENTITY_PORT</code> - HTTP port for identity service API (default: 8090)</li>\n<li><code>EDGE_PORT</code> - HTTP port for edge server (default: 8180)</li>\n</ul>\n<h2 id=\"security-model\">Security Model</h2>\n<h3 id=\"sandbox-isolation\">Sandbox Isolation</h3>\n<p>The Rust runtime provides complete isolation:</p>\n<ul>\n<li>No filesystem access</li>\n<li>No network access (except whitelisted fetch via <code>tana/utils</code>)</li>\n<li>No process spawning</li>\n<li>No system calls</li>\n<li>Memory limits enforced</li>\n<li>Gas metering for execution costs</li>\n</ul>\n<h3 id=\"api-security\">API Security</h3>\n<ul>\n<li>CORS enabled for allowed origins</li>\n<li>Rate limiting on all endpoints</li>\n<li>Input validation with Zod schemas</li>\n<li>SQL injection protection via Drizzle ORM</li>\n<li>Environment-based configuration</li>\n</ul>\n<h2 id=\"deployment-architecture\">Deployment Architecture</h2>\n<h3 id=\"development\">Development</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>mprocs â†’ Multiple services in one terminal</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ PostgreSQL (Docker) - Blockchain + Auth data</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ Redis (Docker) - Transaction queue</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ Ledger Service (Bun:8080) - Blockchain API</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ Identity Service (Bun:8090) - Authentication API</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ Edge Server (Rust:8180) - Contract execution</span></span>\n<span class=\"line\"><span>  â””â”€â”€ Docs/Playground (Astro/Node)</span></span></code></pre><h3 id=\"production---single-node\">Production - Single Node</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Single VPS:</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ Nginx (Reverse proxy, SSL)</span></span>\n<span class=\"line\"><span>  â”‚   â”œâ”€â”€ /api â†’ Ledger Service (8080)</span></span>\n<span class=\"line\"><span>  â”‚   â”œâ”€â”€ /auth â†’ Identity Service (8090)</span></span>\n<span class=\"line\"><span>  â”‚   â””â”€â”€ /edge â†’ Edge Server (8180)</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ Docker Compose</span></span>\n<span class=\"line\"><span>  â”‚   â”œâ”€â”€ Ledger Service (port 8080)</span></span>\n<span class=\"line\"><span>  â”‚   â”œâ”€â”€ Identity Service (port 8090)</span></span>\n<span class=\"line\"><span>  â”‚   â”œâ”€â”€ PostgreSQL (blockchain + auth)</span></span>\n<span class=\"line\"><span>  â”‚   â””â”€â”€ Redis (transaction queue)</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ tana-runtime (Binary)</span></span>\n<span class=\"line\"><span>  â””â”€â”€ tana-edge (Binary on 8180)</span></span></code></pre><h3 id=\"production---multi-validator-network\">Production - Multi-Validator Network</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Network Topology:</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[Queue Service Node]</span></span>\n<span class=\"line\"><span>  â””â”€â”€ Redis (shared by all validators)</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[Validator Node 1]</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ PostgreSQL (own copy)</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ Ledger Service (8080)</span></span>\n<span class=\"line\"><span>  â””â”€â”€ Block Producer (consumes from shared Redis)</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[Validator Node 2]</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ PostgreSQL (own copy)</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ Ledger Service (8080)</span></span>\n<span class=\"line\"><span>  â””â”€â”€ Block Producer (consumes from shared Redis)</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[API Node] (public-facing, read-only)</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ PostgreSQL (synced via consensus)</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ Ledger Service (8080)</span></span>\n<span class=\"line\"><span>  â”œâ”€â”€ Identity Service (8090)</span></span>\n<span class=\"line\"><span>  â””â”€â”€ Edge Server (8180)</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[Mobile App]</span></span>\n<span class=\"line\"><span>  â””â”€â”€ Connects to Identity Service for auth</span></span></code></pre><p><strong>Key Points:</strong></p>\n<ul>\n<li>Each validator runs its own PostgreSQL (database replication via blockchain consensus)</li>\n<li>Redis queue is shared by all validators</li>\n<li>Identity service typically runs on API nodes (not validators)</li>\n<li>Mobile apps connect to identity service for authentication</li>\n<li>Deterministic transaction ordering ensures consensus</li>\n</ul>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/guides/quickstart/\">Quick Start Guide</a> - Set up your development environment</li>\n<li><a href=\"/tana-cli/intro/\">CLI Reference</a> - Learn the CLI commands</li>\n<li><a href=\"/tana-api/intro/\">API Reference</a> - Explore the REST API</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "sql",
        "code": "-- Users\nCREATE TABLE users (\n  id TEXT PRIMARY KEY,\n  username TEXT UNIQUE,\n  display_name TEXT,\n  public_key TEXT,\n  nonce INTEGER DEFAULT 0,\n  bio TEXT,\n  created_at TIMESTAMP\n);\n\n-- Balances\nCREATE TABLE balances (\n  owner_id TEXT,\n  owner_type TEXT,\n  currency_code TEXT,\n  amount TEXT,\n  updated_at TIMESTAMP\n);\n\n-- Transactions (confirmed only - pending in Redis queue)\nCREATE TABLE transactions (\n  id TEXT PRIMARY KEY,\n  from_id TEXT,\n  to_id TEXT,\n  amount TEXT,\n  currency_code TEXT,\n  type TEXT,\n  status TEXT,\n  metadata JSONB,\n  created_at TIMESTAMP,\n  confirmed_at TIMESTAMP\n);\n\n-- Blocks\nCREATE TABLE blocks (\n  height INTEGER PRIMARY KEY,\n  hash TEXT,\n  parent_hash TEXT,\n  state_root TEXT,\n  timestamp TIMESTAMP,\n  producer TEXT,\n  transactions JSONB\n);\n\n-- Contracts\nCREATE TABLE contracts (\n  id TEXT PRIMARY KEY,\n  code TEXT,\n  code_hash TEXT,\n  owner_id TEXT,\n  created_at TIMESTAMP\n);"
      },
      {
        "lang": "sql",
        "code": "-- Auth Sessions (QR code login)\nCREATE TABLE auth_sessions (\n  id TEXT PRIMARY KEY,\n  challenge TEXT NOT NULL UNIQUE,\n  status auth_session_status NOT NULL DEFAULT 'waiting',\n  user_id TEXT,\n  username TEXT,\n  public_key TEXT,\n  session_token TEXT UNIQUE,\n  return_url TEXT NOT NULL,\n  app_name TEXT,\n  app_icon TEXT,\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  expires_at TIMESTAMP NOT NULL,\n  approved_at TIMESTAMP,\n  scanned_at TIMESTAMP\n);\n\n-- Transaction Requests (mobile approval)\nCREATE TABLE transaction_requests (\n  id TEXT PRIMARY KEY,\n  session_id TEXT NOT NULL REFERENCES auth_sessions(id),\n  user_id TEXT NOT NULL,\n  transaction_type TEXT NOT NULL,\n  transaction_data TEXT NOT NULL,\n  status transaction_request_status NOT NULL DEFAULT 'pending',\n  transaction_id TEXT,\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  expires_at TIMESTAMP NOT NULL,\n  responded_at TIMESTAMP\n);\n\n-- Device Tokens (push notifications)\nCREATE TABLE device_tokens (\n  id TEXT PRIMARY KEY,\n  user_id TEXT NOT NULL,\n  push_token TEXT NOT NULL UNIQUE,\n  device_name TEXT,\n  platform TEXT,\n  app_version TEXT,\n  is_active TEXT NOT NULL DEFAULT 'true',\n  created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n  last_used_at TIMESTAMP NOT NULL DEFAULT NOW()\n);"
      },
      {
        "lang": "bash",
        "code": "# .env\n\n# Database URLs\nDATABASE_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'\nIDENTITY_DB_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'  # Can use same DB\nREDIS_URL='redis://localhost:6379'\n\n# Service Ports\nPORT=8080                    # Ledger service\nIDENTITY_PORT=8090           # Identity service\nEDGE_PORT=8180              # Edge server (tana-edge)\n\n# Environment\nNODE_ENV=development"
      }
    ],
    "tableOfContents": [
      {
        "id": "overview",
        "text": "Overview",
        "level": 2
      },
      {
        "id": "binary-structure",
        "text": "Binary Structure",
        "level": 2
      },
      {
        "id": "1-tana-cli-binary",
        "text": "1. `tana` (CLI Binary)",
        "level": 3
      },
      {
        "id": "2-tana-runtime-execution-binary",
        "text": "2. `tana-runtime` (Execution Binary)",
        "level": 3
      },
      {
        "id": "3-tana-edge-edge-server-binary",
        "text": "3. `tana-edge` (Edge Server Binary)",
        "level": 3
      },
      {
        "id": "4-tana-mesh-network-coordinator",
        "text": "4. `tana-mesh` (Network Coordinator)",
        "level": 3
      },
      {
        "id": "5-tana-t4-content-storage",
        "text": "5. `tana-t4` (Content Storage)",
        "level": 3
      },
      {
        "id": "integrated-services",
        "text": "Integrated Services",
        "level": 2
      },
      {
        "id": "ledger-service",
        "text": "Ledger Service",
        "level": 3
      },
      {
        "id": "queue-service",
        "text": "Queue Service",
        "level": 3
      },
      {
        "id": "identity-service",
        "text": "Identity Service",
        "level": 3
      },
      {
        "id": "data-flow",
        "text": "Data Flow",
        "level": 2
      },
      {
        "id": "contract-deployment-flow",
        "text": "Contract Deployment Flow",
        "level": 3
      },
      {
        "id": "authentication-flow-mobile-qr-login",
        "text": "Authentication Flow (Mobile QR Login)",
        "level": 3
      },
      {
        "id": "configuration-structure",
        "text": "Configuration Structure",
        "level": 2
      },
      {
        "id": "global-configuration",
        "text": "Global Configuration",
        "level": 3
      },
      {
        "id": "project-structure",
        "text": "Project Structure",
        "level": 3
      },
      {
        "id": "component-details",
        "text": "Component Details",
        "level": 2
      },
      {
        "id": "ledger-service-port-8080",
        "text": "Ledger Service (Port 8080)",
        "level": 3
      },
      {
        "id": "identity-service-port-8090",
        "text": "Identity Service (Port 8090)",
        "level": 3
      },
      {
        "id": "consensus-service",
        "text": "Consensus Service",
        "level": 3
      },
      {
        "id": "rust-runtime",
        "text": "Rust Runtime",
        "level": 3
      },
      {
        "id": "monorepo-structure",
        "text": "Monorepo Structure",
        "level": 2
      },
      {
        "id": "development-workflow",
        "text": "Development Workflow",
        "level": 2
      },
      {
        "id": "database-setup",
        "text": "Database Setup",
        "level": 3
      },
      {
        "id": "environment-configuration",
        "text": "Environment Configuration",
        "level": 3
      },
      {
        "id": "security-model",
        "text": "Security Model",
        "level": 2
      },
      {
        "id": "sandbox-isolation",
        "text": "Sandbox Isolation",
        "level": 3
      },
      {
        "id": "api-security",
        "text": "API Security",
        "level": 3
      },
      {
        "id": "deployment-architecture",
        "text": "Deployment Architecture",
        "level": 2
      },
      {
        "id": "development",
        "text": "Development",
        "level": 3
      },
      {
        "id": "production---single-node",
        "text": "Production - Single Node",
        "level": 3
      },
      {
        "id": "production---multi-validator-network",
        "text": "Production - Multi-Validator Network",
        "level": 3
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "contributing",
      "core",
      "blocks"
    ],
    "metadata": {
      "title": "Blocks & Blockchain",
      "description": "Understanding Tana's block structure and production"
    },
    "content": "\nBlocks are the fundamental unit of Tana's blockchain, packaging transactions and establishing a tamper-proof history of all state changes.\n\n## Block Structure\n\n### Database Schema\n\n```sql\nCREATE TABLE blocks (\n  -- Block identification\n  height        BIGINT PRIMARY KEY,           -- 0 for genesis, then 1, 2, 3...\n  hash          VARCHAR(64) NOT NULL UNIQUE,  -- SHA256 of block contents\n  parent_hash   VARCHAR(64) NOT NULL,         -- Hash of previous block\n\n  -- Block metadata\n  timestamp     TIMESTAMP NOT NULL,           -- Block creation time\n  producer      UUID NOT NULL,                -- Node/user that produced this block\n\n  -- Block contents\n  transactions  JSONB NOT NULL,               -- Array of transaction IDs\n  state_root    VARCHAR(64) NOT NULL,         -- Merkle root of state\n\n  -- Execution\n  gas_used      BIGINT NOT NULL DEFAULT 0,    -- Total gas consumed\n  gas_limit     BIGINT NOT NULL,              -- Maximum gas allowed\n\n  -- Timestamps\n  created_at    TIMESTAMP NOT NULL DEFAULT NOW()\n);\n```\n\n### TypeScript Interface\n\n```typescript\ninterface Block {\n  // Identity\n  height: number          // Block number (0 = genesis)\n  hash: string           // Block hash\n  previousHash: string   // Previous block hash\n\n  // Metadata\n  timestamp: number      // Unix timestamp (ms)\n  producer: string       // Producer ID\n\n  // Contents\n  transactions: string[] // Array of transaction IDs\n  stateRoot: string      // State merkle root\n\n  // Execution\n  gasUsed: number        // Gas consumed\n  gasLimit: number       // Gas limit\n\n  // Timestamps\n  createdAt: Date\n}\n```\n\n## Genesis Block (Block 0)\n\nThe **genesis block** is block #0 - the first block in the blockchain. It establishes the initial state and network parameters.\n\n### Genesis Block Example\n\n```typescript\n{\n  // Identity\n  height: 0,\n  hash: \"0xa1b2c3d4e5f6...\",\n  previousHash: \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n\n  // Metadata\n  timestamp: 1730678400000,  // Launch date\n  producer: \"tana:genesis\",\n\n  // Contents\n  transactions: [],\n  stateRoot: \"0x...\",\n\n  // Execution\n  gasUsed: 0,\n  gasLimit: 1000000,\n\n  // Genesis metadata\n  metadata: {\n    version: \"0.1.0\",\n    networkName: \"tana\",\n    chainId: 1,\n    genesisMessage: \"Tana blockchain - TypeScript smart contracts\",\n    blockTime: 6000,  // 6 second blocks\n  }\n}\n```\n\n## Block Production Flow\n\n### Current State (Development)\n\n```\nTransaction submitted\n    â†“\nDirectly applied to database\n    â†“\nBlock created with transaction\n    â†“\nState root calculated\n    â†“\nBlock finalized\n```\n\n### Future State (Production)\n\n```\n1. Transactions submitted to mempool\n    â†“\n2. Block producer selects transactions\n    â†“\n3. Execute transactions in order\n    â†“\n4. Calculate state root\n    â†“\n5. Create block with:\n   - Transactions included\n   - State root\n   - Gas used\n    â†“\n6. Sign block\n    â†“\n7. Insert block into database\n    â†“\n8. Propagate to network\n```\n\n## Block Hash Calculation\n\nBlocks are identified by the hash of their contents:\n\n```typescript\nfunction calculateBlockHash(block: Block): string {\n  const data = JSON.stringify({\n    height: block.height,\n    previousHash: block.previousHash,\n    timestamp: block.timestamp,\n    stateRoot: block.stateRoot,\n    transactions: block.transactions,\n    gasUsed: block.gasUsed,\n  })\n\n  return crypto.createHash('sha256')\n    .update(data)\n    .digest('hex')\n}\n```\n\n## State Root\n\nThe state root is a Merkle root of all account states after executing the block's transactions. This allows:\n\n- **Efficient verification** - Prove account state without full blockchain\n- **Light clients** - Verify transactions without downloading everything\n- **State snapshots** - Quick sync for new nodes\n- **Fraud proofs** - Prove invalid state transitions\n\n### State Root Calculation\n\n```typescript\nfunction calculateStateRoot(accounts: Account[]): string {\n  // Sort accounts by ID for deterministic hashing\n  const sorted = accounts.sort((a, b) => a.id.localeCompare(b.id))\n\n  // Hash each account state\n  const accountHashes = sorted.map(account => {\n    const state = {\n      id: account.id,\n      balances: account.balances,\n      nonce: account.nonce,\n    }\n    return hash(JSON.stringify(state))\n  })\n\n  // Build Merkle tree and return root\n  return buildMerkleRoot(accountHashes)\n}\n```\n\n## Block Queries\n\n### Get Latest Block\n\n```typescript\n// Via API\nGET /blocks/latest\n\n// Response\n{\n  \"height\": 12345,\n  \"hash\": \"0xa1b2c3d4...\",\n  \"timestamp\": 1699999999000,\n  \"transactions\": [\"tx1\", \"tx2\", \"tx3\"],\n  \"stateRoot\": \"0x...\",\n  \"gasUsed\": 150000,\n  \"gasLimit\": 1000000\n}\n```\n\n### Get Specific Block\n\n```typescript\n// Via API\nGET /blocks/12345\n\n// Or by hash\nGET /blocks/0xa1b2c3d4...\n```\n\n### Get Block Range\n\n```typescript\n// Via API\nGET /blocks?from=100&to=200\n\n// Returns array of blocks\n```\n\n## Block Context in Contracts\n\nSmart contracts can access block information:\n\n```typescript\nimport { console } from 'tana/core'\nimport { block } from 'tana/block'\n\n// Current block context\nconsole.log('Block height:', block.height)\nconsole.log('Block hash:', block.hash)\nconsole.log('Block timestamp:', block.timestamp)\nconsole.log('Block producer:', block.producer)\nconsole.log('Gas limit:', block.gasLimit)\n\n// Query historical blocks (future)\nconst genesis = await block.getBlock(0)\nconsole.log('Genesis message:', genesis.metadata.genesisMessage)\n```\n\n## Block Explorer\n\nQuery blocks via the API or CLI:\n\n```bash\n# Get latest block\ncurl http://localhost:8080/blocks/latest\n\n# Get specific block\ncurl http://localhost:8080/blocks/12345\n\n# Get block transactions\ncurl http://localhost:8080/blocks/12345/transactions\n```\n\n## Development Roadmap\n\n### Phase 1: Basic Blocks (Current)\n- âœ… Blocks table\n- âœ… Genesis block\n- âœ… Block creation on transaction\n- âœ… Block queries via API\n\n### Phase 2: Block Production\n- â³ Mempool for pending transactions\n- â³ Block producer service\n- â³ Transaction selection\n- â³ Automated block creation\n\n### Phase 3: Consensus\n- â³ Multiple validators\n- â³ Consensus mechanism\n- â³ Fork resolution\n- â³ Finality rules\n\n## Next Steps\n\n- [Data Model](/guides/core/data-model/) - Learn about Tana's data structures\n- [Contract Execution](/guides/core/contract-execution/) - How contracts interact with blocks\n- [API Reference](/tana-api/intro/) - Query blocks via the REST API\n",
    "html": "<p>Blocks are the fundamental unit of Tana&#39;s blockchain, packaging transactions and establishing a tamper-proof history of all state changes.</p>\n<h2 id=\"block-structure\">Block Structure</h2>\n<h3 id=\"database-schema\">Database Schema</h3>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"sql\"></div>\n\n\n\n<h3 id=\"typescript-interface\">TypeScript Interface</h3>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"genesis-block-block-0\">Genesis Block (Block 0)</h2>\n<p>The <strong>genesis block</strong> is block #0 - the first block in the blockchain. It establishes the initial state and network parameters.</p>\n<h3 id=\"genesis-block-example\">Genesis Block Example</h3>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"block-production-flow\">Block Production Flow</h2>\n<h3 id=\"current-state-development\">Current State (Development)</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Transaction submitted</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Directly applied to database</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Block created with transaction</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>State root calculated</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Block finalized</span></span></code></pre><h3 id=\"future-state-production\">Future State (Production)</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>1. Transactions submitted to mempool</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>2. Block producer selects transactions</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>3. Execute transactions in order</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>4. Calculate state root</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>5. Create block with:</span></span>\n<span class=\"line\"><span>   - Transactions included</span></span>\n<span class=\"line\"><span>   - State root</span></span>\n<span class=\"line\"><span>   - Gas used</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>6. Sign block</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>7. Insert block into database</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>8. Propagate to network</span></span></code></pre><h2 id=\"block-hash-calculation\">Block Hash Calculation</h2>\n<p>Blocks are identified by the hash of their contents:</p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"state-root\">State Root</h2>\n<p>The state root is a Merkle root of all account states after executing the block&#39;s transactions. This allows:</p>\n<ul>\n<li><strong>Efficient verification</strong> - Prove account state without full blockchain</li>\n<li><strong>Light clients</strong> - Verify transactions without downloading everything</li>\n<li><strong>State snapshots</strong> - Quick sync for new nodes</li>\n<li><strong>Fraud proofs</strong> - Prove invalid state transitions</li>\n</ul>\n<h3 id=\"state-root-calculation\">State Root Calculation</h3>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"block-queries\">Block Queries</h2>\n<h3 id=\"get-latest-block\">Get Latest Block</h3>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"get-specific-block\">Get Specific Block</h3>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"get-block-range\">Get Block Range</h3>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"block-context-in-contracts\">Block Context in Contracts</h2>\n<p>Smart contracts can access block information:</p>\n<div class=\"code-block-placeholder\" data-index=\"8\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"block-explorer\">Block Explorer</h2>\n<p>Query blocks via the API or CLI:</p>\n<div class=\"code-block-placeholder\" data-index=\"9\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"development-roadmap\">Development Roadmap</h2>\n<h3 id=\"phase-1-basic-blocks-current\">Phase 1: Basic Blocks (Current)</h3>\n<ul>\n<li>âœ… Blocks table</li>\n<li>âœ… Genesis block</li>\n<li>âœ… Block creation on transaction</li>\n<li>âœ… Block queries via API</li>\n</ul>\n<h3 id=\"phase-2-block-production\">Phase 2: Block Production</h3>\n<ul>\n<li>â³ Mempool for pending transactions</li>\n<li>â³ Block producer service</li>\n<li>â³ Transaction selection</li>\n<li>â³ Automated block creation</li>\n</ul>\n<h3 id=\"phase-3-consensus\">Phase 3: Consensus</h3>\n<ul>\n<li>â³ Multiple validators</li>\n<li>â³ Consensus mechanism</li>\n<li>â³ Fork resolution</li>\n<li>â³ Finality rules</li>\n</ul>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/guides/core/data-model/\">Data Model</a> - Learn about Tana&#39;s data structures</li>\n<li><a href=\"/guides/core/contract-execution/\">Contract Execution</a> - How contracts interact with blocks</li>\n<li><a href=\"/tana-api/intro/\">API Reference</a> - Query blocks via the REST API</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "sql",
        "code": "CREATE TABLE blocks (\n  -- Block identification\n  height        BIGINT PRIMARY KEY,           -- 0 for genesis, then 1, 2, 3...\n  hash          VARCHAR(64) NOT NULL UNIQUE,  -- SHA256 of block contents\n  parent_hash   VARCHAR(64) NOT NULL,         -- Hash of previous block\n\n  -- Block metadata\n  timestamp     TIMESTAMP NOT NULL,           -- Block creation time\n  producer      UUID NOT NULL,                -- Node/user that produced this block\n\n  -- Block contents\n  transactions  JSONB NOT NULL,               -- Array of transaction IDs\n  state_root    VARCHAR(64) NOT NULL,         -- Merkle root of state\n\n  -- Execution\n  gas_used      BIGINT NOT NULL DEFAULT 0,    -- Total gas consumed\n  gas_limit     BIGINT NOT NULL,              -- Maximum gas allowed\n\n  -- Timestamps\n  created_at    TIMESTAMP NOT NULL DEFAULT NOW()\n);"
      },
      {
        "lang": "typescript",
        "code": "interface Block {\n  // Identity\n  height: number          // Block number (0 = genesis)\n  hash: string           // Block hash\n  previousHash: string   // Previous block hash\n\n  // Metadata\n  timestamp: number      // Unix timestamp (ms)\n  producer: string       // Producer ID\n\n  // Contents\n  transactions: string[] // Array of transaction IDs\n  stateRoot: string      // State merkle root\n\n  // Execution\n  gasUsed: number        // Gas consumed\n  gasLimit: number       // Gas limit\n\n  // Timestamps\n  createdAt: Date\n}"
      },
      {
        "lang": "typescript",
        "code": "{\n  // Identity\n  height: 0,\n  hash: \"0xa1b2c3d4e5f6...\",\n  previousHash: \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n\n  // Metadata\n  timestamp: 1730678400000,  // Launch date\n  producer: \"tana:genesis\",\n\n  // Contents\n  transactions: [],\n  stateRoot: \"0x...\",\n\n  // Execution\n  gasUsed: 0,\n  gasLimit: 1000000,\n\n  // Genesis metadata\n  metadata: {\n    version: \"0.1.0\",\n    networkName: \"tana\",\n    chainId: 1,\n    genesisMessage: \"Tana blockchain - TypeScript smart contracts\",\n    blockTime: 6000,  // 6 second blocks\n  }\n}"
      },
      {
        "lang": "typescript",
        "code": "function calculateBlockHash(block: Block): string {\n  const data = JSON.stringify({\n    height: block.height,\n    previousHash: block.previousHash,\n    timestamp: block.timestamp,\n    stateRoot: block.stateRoot,\n    transactions: block.transactions,\n    gasUsed: block.gasUsed,\n  })\n\n  return crypto.createHash('sha256')\n    .update(data)\n    .digest('hex')\n}"
      },
      {
        "lang": "typescript",
        "code": "function calculateStateRoot(accounts: Account[]): string {\n  // Sort accounts by ID for deterministic hashing\n  const sorted = accounts.sort((a, b) => a.id.localeCompare(b.id))\n\n  // Hash each account state\n  const accountHashes = sorted.map(account => {\n    const state = {\n      id: account.id,\n      balances: account.balances,\n      nonce: account.nonce,\n    }\n    return hash(JSON.stringify(state))\n  })\n\n  // Build Merkle tree and return root\n  return buildMerkleRoot(accountHashes)\n}"
      },
      {
        "lang": "typescript",
        "code": "// Via API\nGET /blocks/latest\n\n// Response\n{\n  \"height\": 12345,\n  \"hash\": \"0xa1b2c3d4...\",\n  \"timestamp\": 1699999999000,\n  \"transactions\": [\"tx1\", \"tx2\", \"tx3\"],\n  \"stateRoot\": \"0x...\",\n  \"gasUsed\": 150000,\n  \"gasLimit\": 1000000\n}"
      },
      {
        "lang": "typescript",
        "code": "// Via API\nGET /blocks/12345\n\n// Or by hash\nGET /blocks/0xa1b2c3d4..."
      },
      {
        "lang": "typescript",
        "code": "// Via API\nGET /blocks?from=100&to=200\n\n// Returns array of blocks"
      },
      {
        "lang": "typescript",
        "code": "import { console } from 'tana/core'\nimport { block } from 'tana/block'\n\n// Current block context\nconsole.log('Block height:', block.height)\nconsole.log('Block hash:', block.hash)\nconsole.log('Block timestamp:', block.timestamp)\nconsole.log('Block producer:', block.producer)\nconsole.log('Gas limit:', block.gasLimit)\n\n// Query historical blocks (future)\nconst genesis = await block.getBlock(0)\nconsole.log('Genesis message:', genesis.metadata.genesisMessage)"
      },
      {
        "lang": "bash",
        "code": "# Get latest block\ncurl http://localhost:8080/blocks/latest\n\n# Get specific block\ncurl http://localhost:8080/blocks/12345\n\n# Get block transactions\ncurl http://localhost:8080/blocks/12345/transactions"
      }
    ],
    "tableOfContents": [
      {
        "id": "block-structure",
        "text": "Block Structure",
        "level": 2
      },
      {
        "id": "database-schema",
        "text": "Database Schema",
        "level": 3
      },
      {
        "id": "typescript-interface",
        "text": "TypeScript Interface",
        "level": 3
      },
      {
        "id": "genesis-block-block-0",
        "text": "Genesis Block (Block 0)",
        "level": 2
      },
      {
        "id": "genesis-block-example",
        "text": "Genesis Block Example",
        "level": 3
      },
      {
        "id": "block-production-flow",
        "text": "Block Production Flow",
        "level": 2
      },
      {
        "id": "current-state-development",
        "text": "Current State (Development)",
        "level": 3
      },
      {
        "id": "future-state-production",
        "text": "Future State (Production)",
        "level": 3
      },
      {
        "id": "block-hash-calculation",
        "text": "Block Hash Calculation",
        "level": 2
      },
      {
        "id": "state-root",
        "text": "State Root",
        "level": 2
      },
      {
        "id": "state-root-calculation",
        "text": "State Root Calculation",
        "level": 3
      },
      {
        "id": "block-queries",
        "text": "Block Queries",
        "level": 2
      },
      {
        "id": "get-latest-block",
        "text": "Get Latest Block",
        "level": 3
      },
      {
        "id": "get-specific-block",
        "text": "Get Specific Block",
        "level": 3
      },
      {
        "id": "get-block-range",
        "text": "Get Block Range",
        "level": 3
      },
      {
        "id": "block-context-in-contracts",
        "text": "Block Context in Contracts",
        "level": 2
      },
      {
        "id": "block-explorer",
        "text": "Block Explorer",
        "level": 2
      },
      {
        "id": "development-roadmap",
        "text": "Development Roadmap",
        "level": 2
      },
      {
        "id": "phase-1-basic-blocks-current",
        "text": "Phase 1: Basic Blocks (Current)",
        "level": 3
      },
      {
        "id": "phase-2-block-production",
        "text": "Phase 2: Block Production",
        "level": 3
      },
      {
        "id": "phase-3-consensus",
        "text": "Phase 3: Consensus",
        "level": 3
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "contributing",
      "core",
      "system-flows"
    ],
    "metadata": {
      "title": "System Flows",
      "description": "How data flows through Tana's services"
    },
    "content": "\nThis guide maps out the key user actions and how they flow through Tana's services.\n\n## Core User Actions\n\n### 1. User Creates Account\n\n```\nUser submits:\n  - username\n  - display_name\n  - public_key\n    â†“\nPOST /users\n    â†“\nLedger Service validates:\n  - username unique?\n  - valid format?\n    â†“\nPostgreSQL INSERT\n    â†“\nReturns: user object with ID\n```\n\n**Services Required:**\n- âœ… Ledger API\n- âœ… PostgreSQL\n\n**Status:** âœ… **READY**\n\n### 2. User Checks Balance\n\n```\nUser queries: GET /balances?ownerId=alice&currencyCode=USD\n    â†“\nLedger Service queries DB\n    â†“\nPostgreSQL SELECT\n    â†“\nReturns: { amount: \"1000.00\", currencyCode: \"USD\" }\n```\n\n**Services Required:**\n- âœ… Ledger API\n- âœ… PostgreSQL\n\n**Status:** âœ… **READY**\n\n### 3. User Sends Funds\n\n```\nUser submits: POST /transactions\n  {\n    from: \"alice\",\n    to: \"bob\",\n    amount: \"100.00\",\n    currency: \"USD\"\n  }\n    â†“\nLedger Service validates:\n  - Alice has balance >= 100?\n  - Bob exists?\n    â†“\nBEGIN TRANSACTION\n  UPDATE balances SET amount = amount - 100 WHERE owner_id = 'alice'\n  UPDATE balances SET amount = amount + 100 WHERE owner_id = 'bob'\n  INSERT INTO transactions (...)\nCOMMIT\n    â†“\nReturns: transaction ID\n```\n\n**Services Required:**\n- âœ… Ledger API\n- âœ… PostgreSQL\n\n**Status:** âœ… **READY**\n\n### 4. User Tests Contract in Playground\n\n```\nUser writes TypeScript in browser\n    â†“\nClicks \"Run\"\n    â†“\nBrowser sandbox executes:\n  - Transpiles TS â†’ JS\n  - Runs in isolated context\n  - tana/* modules available\n    â†“\nContract reads data:\n  GET /balances (read-only)\n    â†“\nContract simulates writes:\n  tx.transfer() - staged locally\n  tx.execute() - returns mock result\n    â†“\nBrowser displays output\n```\n\n**Services Required:**\n- âœ… Playground Website\n- âœ… Ledger API (read-only)\n- âœ… Browser Sandbox\n\n**Status:** âœ… **READY**\n\n### 5. User Deploys Contract (via CLI)\n\n```\nUser runs: tana deploy contract ./my-contract.ts\n    â†“\nCLI validates contract code\n    â†“\nPOST /contracts\n  {\n    code: \"...\",\n    owner: \"alice\"\n  }\n    â†“\nLedger Service:\n  - Stores contract code\n  - Generates contract ID\n    â†“\nPostgreSQL INSERT\n    â†“\nReturns: contract_id\n```\n\n**Services Required:**\n- âœ… CLI\n- âœ… Ledger API\n- âœ… PostgreSQL\n\n**Status:** â³ **IN PROGRESS**\n\n### 6. User Executes Contract (Future)\n\n```\nUser calls: POST /contracts/:id/execute { args: {...} }\n    â†“\nContracts Service:\n  - Loads contract code from DB\n  - Spawns Rust runtime process\n    â†“\nRuntime executes:\n  - Reads state via tana/block\n  - Stages changes via tana/tx\n  - Returns execution result\n    â†“\nContracts Service validates:\n  - Gas limit not exceeded?\n  - Valid state transitions?\n    â†“\nIf valid:\n  POST /transactions (apply changes)\n    â†“\nReturns: execution result\n```\n\n**Services Required:**\n- â³ Contracts Service\n- âœ… Rust Runtime\n- âœ… Ledger API\n\n**Status:** â³ **PLANNED**\n\n## Data Flow Patterns\n\n### Pattern 1: Read-Only Query\n\n```\nUser â†’ API â†’ PostgreSQL â†’ Response\n```\n\n**Example:** Get balance, list users, query transactions\n\n**Status:** âœ… Working\n\n### Pattern 2: Direct State Change\n\n```\nUser â†’ API â†’ Validate â†’ PostgreSQL Transaction â†’ Response\n```\n\n**Example:** Create user, transfer funds\n\n**Status:** âœ… Working\n\n### Pattern 3: Contract Execution (Future)\n\n```\nUser â†’ API â†’ Runtime â†’ Validate â†’ PostgreSQL â†’ Response\n         â†“        â†“\n    Load Code  Execute\n```\n\n**Example:** Deploy contract, execute contract\n\n**Status:** â³ Planned\n\n## Service Dependencies\n\n### Current Architecture\n\n```\nCLI/Playground\n    â†“ HTTP\nLedger Service\n    â†“ TCP\nPostgreSQL\n```\n\n**Status:** âœ… Fully operational\n\n### Future Architecture\n\n```\nCLI/Playground\n    â†“ HTTP\nLedger Service\n    â†“ Subprocess\nRuntime (Rust)\n    â†“ HTTP\nLedger Service\n    â†“ TCP\nPostgreSQL + Redis\n```\n\n**Status:** â³ Partially implemented\n\n## Transaction Lifecycle\n\n### 1. Submission\n\n```\nUser creates transaction\n    â†“\nValidate locally (signature, format)\n    â†“\nSubmit to ledger API\n```\n\n### 2. Validation\n\n```\nLedger receives transaction\n    â†“\nValidate:\n  - Valid signature?\n  - Sufficient balance?\n  - Valid recipient?\n    â†“\nIf invalid: Reject\nIf valid: Continue\n```\n\n### 3. Execution\n\n```\nBegin database transaction\n    â†“\nUpdate balances\n    â†“\nInsert transaction record\n    â†“\nCommit\n```\n\n### 4. Confirmation\n\n```\nTransaction included in block\n    â†“\nState root updated\n    â†“\nTransaction confirmed\n```\n\n## Next Steps\n\n- [Data Model](/guides/core/data-model/) - Understand the data structures\n- [Blocks & Blockchain](/guides/core/blocks/) - Learn about block production\n- [CLI Reference](/tana-cli/intro/) - Use the command-line interface\n",
    "html": "<p>This guide maps out the key user actions and how they flow through Tana&#39;s services.</p>\n<h2 id=\"core-user-actions\">Core User Actions</h2>\n<h3 id=\"1-user-creates-account\">1. User Creates Account</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User submits:</span></span>\n<span class=\"line\"><span>  - username</span></span>\n<span class=\"line\"><span>  - display_name</span></span>\n<span class=\"line\"><span>  - public_key</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>POST /users</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Ledger Service validates:</span></span>\n<span class=\"line\"><span>  - username unique?</span></span>\n<span class=\"line\"><span>  - valid format?</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>PostgreSQL INSERT</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Returns: user object with ID</span></span></code></pre><p><strong>Services Required:</strong></p>\n<ul>\n<li>âœ… Ledger API</li>\n<li>âœ… PostgreSQL</li>\n</ul>\n<p><strong>Status:</strong> âœ… <strong>READY</strong></p>\n<h3 id=\"2-user-checks-balance\">2. User Checks Balance</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User queries: GET /balances?ownerId=alice&#x26;currencyCode=USD</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Ledger Service queries DB</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>PostgreSQL SELECT</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Returns: { amount: \"1000.00\", currencyCode: \"USD\" }</span></span></code></pre><p><strong>Services Required:</strong></p>\n<ul>\n<li>âœ… Ledger API</li>\n<li>âœ… PostgreSQL</li>\n</ul>\n<p><strong>Status:</strong> âœ… <strong>READY</strong></p>\n<h3 id=\"3-user-sends-funds\">3. User Sends Funds</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User submits: POST /transactions</span></span>\n<span class=\"line\"><span>  {</span></span>\n<span class=\"line\"><span>    from: \"alice\",</span></span>\n<span class=\"line\"><span>    to: \"bob\",</span></span>\n<span class=\"line\"><span>    amount: \"100.00\",</span></span>\n<span class=\"line\"><span>    currency: \"USD\"</span></span>\n<span class=\"line\"><span>  }</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Ledger Service validates:</span></span>\n<span class=\"line\"><span>  - Alice has balance >= 100?</span></span>\n<span class=\"line\"><span>  - Bob exists?</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>BEGIN TRANSACTION</span></span>\n<span class=\"line\"><span>  UPDATE balances SET amount = amount - 100 WHERE owner_id = 'alice'</span></span>\n<span class=\"line\"><span>  UPDATE balances SET amount = amount + 100 WHERE owner_id = 'bob'</span></span>\n<span class=\"line\"><span>  INSERT INTO transactions (...)</span></span>\n<span class=\"line\"><span>COMMIT</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Returns: transaction ID</span></span></code></pre><p><strong>Services Required:</strong></p>\n<ul>\n<li>âœ… Ledger API</li>\n<li>âœ… PostgreSQL</li>\n</ul>\n<p><strong>Status:</strong> âœ… <strong>READY</strong></p>\n<h3 id=\"4-user-tests-contract-in-playground\">4. User Tests Contract in Playground</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User writes TypeScript in browser</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Clicks \"Run\"</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Browser sandbox executes:</span></span>\n<span class=\"line\"><span>  - Transpiles TS â†’ JS</span></span>\n<span class=\"line\"><span>  - Runs in isolated context</span></span>\n<span class=\"line\"><span>  - tana/* modules available</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Contract reads data:</span></span>\n<span class=\"line\"><span>  GET /balances (read-only)</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Contract simulates writes:</span></span>\n<span class=\"line\"><span>  tx.transfer() - staged locally</span></span>\n<span class=\"line\"><span>  tx.execute() - returns mock result</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Browser displays output</span></span></code></pre><p><strong>Services Required:</strong></p>\n<ul>\n<li>âœ… Playground Website</li>\n<li>âœ… Ledger API (read-only)</li>\n<li>âœ… Browser Sandbox</li>\n</ul>\n<p><strong>Status:</strong> âœ… <strong>READY</strong></p>\n<h3 id=\"5-user-deploys-contract-via-cli\">5. User Deploys Contract (via CLI)</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User runs: tana deploy contract ./my-contract.ts</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>CLI validates contract code</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>POST /contracts</span></span>\n<span class=\"line\"><span>  {</span></span>\n<span class=\"line\"><span>    code: \"...\",</span></span>\n<span class=\"line\"><span>    owner: \"alice\"</span></span>\n<span class=\"line\"><span>  }</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Ledger Service:</span></span>\n<span class=\"line\"><span>  - Stores contract code</span></span>\n<span class=\"line\"><span>  - Generates contract ID</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>PostgreSQL INSERT</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Returns: contract_id</span></span></code></pre><p><strong>Services Required:</strong></p>\n<ul>\n<li>âœ… CLI</li>\n<li>âœ… Ledger API</li>\n<li>âœ… PostgreSQL</li>\n</ul>\n<p><strong>Status:</strong> â³ <strong>IN PROGRESS</strong></p>\n<h3 id=\"6-user-executes-contract-future\">6. User Executes Contract (Future)</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User calls: POST /contracts/:id/execute { args: {...} }</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Contracts Service:</span></span>\n<span class=\"line\"><span>  - Loads contract code from DB</span></span>\n<span class=\"line\"><span>  - Spawns Rust runtime process</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Runtime executes:</span></span>\n<span class=\"line\"><span>  - Reads state via tana/block</span></span>\n<span class=\"line\"><span>  - Stages changes via tana/tx</span></span>\n<span class=\"line\"><span>  - Returns execution result</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Contracts Service validates:</span></span>\n<span class=\"line\"><span>  - Gas limit not exceeded?</span></span>\n<span class=\"line\"><span>  - Valid state transitions?</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>If valid:</span></span>\n<span class=\"line\"><span>  POST /transactions (apply changes)</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Returns: execution result</span></span></code></pre><p><strong>Services Required:</strong></p>\n<ul>\n<li>â³ Contracts Service</li>\n<li>âœ… Rust Runtime</li>\n<li>âœ… Ledger API</li>\n</ul>\n<p><strong>Status:</strong> â³ <strong>PLANNED</strong></p>\n<h2 id=\"data-flow-patterns\">Data Flow Patterns</h2>\n<h3 id=\"pattern-1-read-only-query\">Pattern 1: Read-Only Query</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User â†’ API â†’ PostgreSQL â†’ Response</span></span></code></pre><p><strong>Example:</strong> Get balance, list users, query transactions</p>\n<p><strong>Status:</strong> âœ… Working</p>\n<h3 id=\"pattern-2-direct-state-change\">Pattern 2: Direct State Change</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User â†’ API â†’ Validate â†’ PostgreSQL Transaction â†’ Response</span></span></code></pre><p><strong>Example:</strong> Create user, transfer funds</p>\n<p><strong>Status:</strong> âœ… Working</p>\n<h3 id=\"pattern-3-contract-execution-future\">Pattern 3: Contract Execution (Future)</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User â†’ API â†’ Runtime â†’ Validate â†’ PostgreSQL â†’ Response</span></span>\n<span class=\"line\"><span>         â†“        â†“</span></span>\n<span class=\"line\"><span>    Load Code  Execute</span></span></code></pre><p><strong>Example:</strong> Deploy contract, execute contract</p>\n<p><strong>Status:</strong> â³ Planned</p>\n<h2 id=\"service-dependencies\">Service Dependencies</h2>\n<h3 id=\"current-architecture\">Current Architecture</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>CLI/Playground</span></span>\n<span class=\"line\"><span>    â†“ HTTP</span></span>\n<span class=\"line\"><span>Ledger Service</span></span>\n<span class=\"line\"><span>    â†“ TCP</span></span>\n<span class=\"line\"><span>PostgreSQL</span></span></code></pre><p><strong>Status:</strong> âœ… Fully operational</p>\n<h3 id=\"future-architecture\">Future Architecture</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>CLI/Playground</span></span>\n<span class=\"line\"><span>    â†“ HTTP</span></span>\n<span class=\"line\"><span>Ledger Service</span></span>\n<span class=\"line\"><span>    â†“ Subprocess</span></span>\n<span class=\"line\"><span>Runtime (Rust)</span></span>\n<span class=\"line\"><span>    â†“ HTTP</span></span>\n<span class=\"line\"><span>Ledger Service</span></span>\n<span class=\"line\"><span>    â†“ TCP</span></span>\n<span class=\"line\"><span>PostgreSQL + Redis</span></span></code></pre><p><strong>Status:</strong> â³ Partially implemented</p>\n<h2 id=\"transaction-lifecycle\">Transaction Lifecycle</h2>\n<h3 id=\"1-submission\">1. Submission</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User creates transaction</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Validate locally (signature, format)</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Submit to ledger API</span></span></code></pre><h3 id=\"2-validation\">2. Validation</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Ledger receives transaction</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Validate:</span></span>\n<span class=\"line\"><span>  - Valid signature?</span></span>\n<span class=\"line\"><span>  - Sufficient balance?</span></span>\n<span class=\"line\"><span>  - Valid recipient?</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>If invalid: Reject</span></span>\n<span class=\"line\"><span>If valid: Continue</span></span></code></pre><h3 id=\"3-execution\">3. Execution</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Begin database transaction</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Update balances</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Insert transaction record</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Commit</span></span></code></pre><h3 id=\"4-confirmation\">4. Confirmation</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Transaction included in block</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>State root updated</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Transaction confirmed</span></span></code></pre><h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/guides/core/data-model/\">Data Model</a> - Understand the data structures</li>\n<li><a href=\"/guides/core/blocks/\">Blocks &amp; Blockchain</a> - Learn about block production</li>\n<li><a href=\"/tana-cli/intro/\">CLI Reference</a> - Use the command-line interface</li>\n</ul>\n",
    "codeBlocks": [],
    "tableOfContents": [
      {
        "id": "core-user-actions",
        "text": "Core User Actions",
        "level": 2
      },
      {
        "id": "1-user-creates-account",
        "text": "1. User Creates Account",
        "level": 3
      },
      {
        "id": "2-user-checks-balance",
        "text": "2. User Checks Balance",
        "level": 3
      },
      {
        "id": "3-user-sends-funds",
        "text": "3. User Sends Funds",
        "level": 3
      },
      {
        "id": "4-user-tests-contract-in-playground",
        "text": "4. User Tests Contract in Playground",
        "level": 3
      },
      {
        "id": "5-user-deploys-contract-via-cli",
        "text": "5. User Deploys Contract (via CLI)",
        "level": 3
      },
      {
        "id": "6-user-executes-contract-future",
        "text": "6. User Executes Contract (Future)",
        "level": 3
      },
      {
        "id": "data-flow-patterns",
        "text": "Data Flow Patterns",
        "level": 2
      },
      {
        "id": "pattern-1-read-only-query",
        "text": "Pattern 1: Read-Only Query",
        "level": 3
      },
      {
        "id": "pattern-2-direct-state-change",
        "text": "Pattern 2: Direct State Change",
        "level": 3
      },
      {
        "id": "pattern-3-contract-execution-future",
        "text": "Pattern 3: Contract Execution (Future)",
        "level": 3
      },
      {
        "id": "service-dependencies",
        "text": "Service Dependencies",
        "level": 2
      },
      {
        "id": "current-architecture",
        "text": "Current Architecture",
        "level": 3
      },
      {
        "id": "future-architecture",
        "text": "Future Architecture",
        "level": 3
      },
      {
        "id": "transaction-lifecycle",
        "text": "Transaction Lifecycle",
        "level": 2
      },
      {
        "id": "1-submission",
        "text": "1. Submission",
        "level": 3
      },
      {
        "id": "2-validation",
        "text": "2. Validation",
        "level": 3
      },
      {
        "id": "3-execution",
        "text": "3. Execution",
        "level": 3
      },
      {
        "id": "4-confirmation",
        "text": "4. Confirmation",
        "level": 3
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "contributing",
      "core",
      "data-model"
    ],
    "metadata": {
      "title": "Data Model",
      "description": "Core data structures in Tana blockchain"
    },
    "content": "\nTana's blockchain stores users, balances, transactions, contracts, and blocks. This page describes the core data model.\n\n## Primary Objects\n\n### User\n\nUser accounts are the foundation of Tana. Each user has a unique ID, public key for signatures, and multi-currency balances.\n\n```typescript\ninterface User {\n  id: string                    // Unique ID (address)\n  publicKey: string             // Ed25519 public key\n  username: string              // @alice\n  displayName: string           // \"Alice Johnson\"\n  metadata: {\n    bio?: string\n    avatarData?: string         // Small image stored on-chain (<100KB base64)\n    avatarHash?: string         // Or content hash if stored off-chain\n  }\n  balances: Map<Currency, Decimal>  // Multi-currency\n  createdAt: timestamp\n  stateHash: string             // Merkle root of account state\n}\n```\n\n### Transaction\n\nAll blockchain state changes are recorded as transactions.\n\n```typescript\ninterface Transaction {\n  id: string                    // Tx hash\n  from: string                  // User/Team ID\n  to: string                    // User/Team ID\n  amount: Decimal\n  currency: Currency            // USD, BTC, ETH, etc.\n  type: 'transfer' | 'deposit' | 'withdraw' | 'contract_call' | 'user_creation'\n  contractId?: string           // If contract execution\n  contractInput?: any           // Arguments\n  signature: string             // Ed25519\n  timestamp: timestamp\n  blockHeight: number           // Block inclusion\n  status: 'pending' | 'confirmed' | 'failed'\n}\n```\n\n### Currency\n\nTana supports multi-currency balances without requiring a native token.\n\n```typescript\ninterface Currency {\n  code: string                  // \"USD\", \"BTC\", \"ETH\"\n  name: string                  // \"US Dollar\", \"Bitcoin\"\n  symbol: string                // \"$\", \"â‚¿\"\n  decimals: number              // Precision (e.g., 2 for USD, 8 for BTC)\n  type: 'fiat' | 'crypto'\n  verified: boolean             // Is this a recognized currency?\n}\n```\n\n### Smart Contract\n\nContracts are TypeScript code deployed on-chain with isolated key-value storage.\n\n```typescript\ninterface SmartContract {\n  id: string                    // Contract address\n  codeHash: string              // SHA-256 of code\n  code: string                  // TypeScript source\n  author: string                // User ID\n  deployedAt: timestamp\n  storage: Map<string, string>  // Key-value state (tana/data)\n  metadata: {\n    name?: string\n    description?: string\n    version?: string\n  }\n}\n```\n\n### Block\n\nBlocks package transactions and establish blockchain state.\n\n```typescript\ninterface Block {\n  id: string                    // Block hash\n  height: number                // Block number (0 = genesis)\n  timestamp: timestamp\n  previousHash: string          // Previous block\n  transactions: string[]        // Tx hashes\n  stateRoot: string             // Merkle root of all account states\n  validatorSignature: string    // Block producer signature\n  gasUsed: number              // Gas consumed\n  gasLimit: number             // Gas limit\n}\n```\n\n## Database Schema\n\n### Users Table\n\n```sql\nCREATE TABLE users (\n  id TEXT PRIMARY KEY,\n  username TEXT UNIQUE NOT NULL,\n  display_name TEXT,\n  public_key TEXT NOT NULL,\n  bio TEXT,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Balances Table\n\n```sql\nCREATE TABLE balances (\n  owner_id TEXT NOT NULL,\n  owner_type TEXT NOT NULL,\n  currency_code TEXT NOT NULL,\n  amount TEXT NOT NULL,  -- Stored as string for precision\n  updated_at TIMESTAMP DEFAULT NOW(),\n  PRIMARY KEY (owner_id, currency_code)\n);\n```\n\n### Transactions Table\n\n```sql\nCREATE TABLE transactions (\n  id TEXT PRIMARY KEY,\n  from_id TEXT,\n  to_id TEXT,\n  amount TEXT,\n  currency_code TEXT NOT NULL,\n  type TEXT NOT NULL,\n  status TEXT NOT NULL DEFAULT 'pending',\n  block_height INTEGER,\n  metadata JSONB,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Currencies Table\n\n```sql\nCREATE TABLE currencies (\n  code TEXT PRIMARY KEY,\n  name TEXT NOT NULL,\n  symbol TEXT NOT NULL,\n  decimals INTEGER NOT NULL,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Blocks Table\n\n```sql\nCREATE TABLE blocks (\n  height INTEGER PRIMARY KEY,\n  hash TEXT UNIQUE NOT NULL,\n  parent_hash TEXT NOT NULL,\n  state_root TEXT NOT NULL,\n  timestamp TIMESTAMP NOT NULL,\n  producer TEXT NOT NULL,\n  transactions JSONB NOT NULL,\n  gas_used BIGINT DEFAULT 0,\n  gas_limit BIGINT NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Contracts Table\n\n```sql\nCREATE TABLE contracts (\n  id TEXT PRIMARY KEY,\n  code TEXT NOT NULL,\n  owner_id TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### KV Storage Table\n\nPer-contract key-value storage for `tana/kv` module.\n\n```sql\nCREATE TABLE kv_storage (\n  contract_name TEXT NOT NULL,\n  key TEXT NOT NULL,\n  value TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (contract_name, key)\n);\n\nCREATE INDEX idx_kv_contract ON kv_storage(contract_name);\n```\n\n**Notes:**\n- Each contract has isolated namespace via `contract_name`\n- Keys automatically prefixed: `\"{contract_name}:{key}\"`\n- Max key length: 512 bytes\n- Max value size: 25 MB\n- Used by `tana/kv` module (Cloudflare Workers-compatible API)\n\n## State Management\n\n### Account State\n\nEach user and team has a state hash that represents their complete state:\n\n- All balances across all currencies\n- Account metadata\n- Contract storage (if applicable)\n\n### State Root\n\nEach block has a state root - a Merkle root of all account state hashes. This allows:\n\n- Efficient state verification\n- Light client support\n- State snapshots\n- Fraud proofs\n\n### Transaction Flow\n\n```\nUser submits transaction\n    â†“\nValidate (signature, balance, etc.)\n    â†“\nAdd to pending transactions\n    â†“\nBlock producer includes in block\n    â†“\nExecute transaction\n    â†“\nUpdate account states\n    â†“\nCalculate new state root\n    â†“\nFinalize block\n```\n\n## Next Steps\n\n- [Blocks & Blockchain](/guides/core/blocks/) - Learn about block structure\n- [Contract Execution](/guides/core/contract-execution/) - How contracts interact with state\n- [API Reference](/tana-api/intro/) - Interact with the data model via API\n",
    "html": "<p>Tana&#39;s blockchain stores users, balances, transactions, contracts, and blocks. This page describes the core data model.</p>\n<h2 id=\"primary-objects\">Primary Objects</h2>\n<h3 id=\"user\">User</h3>\n<p>User accounts are the foundation of Tana. Each user has a unique ID, public key for signatures, and multi-currency balances.</p>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"transaction\">Transaction</h3>\n<p>All blockchain state changes are recorded as transactions.</p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"currency\">Currency</h3>\n<p>Tana supports multi-currency balances without requiring a native token.</p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"smart-contract\">Smart Contract</h3>\n<p>Contracts are TypeScript code deployed on-chain with isolated key-value storage.</p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"block\">Block</h3>\n<p>Blocks package transactions and establish blockchain state.</p>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"database-schema\">Database Schema</h2>\n<h3 id=\"users-table\">Users Table</h3>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"sql\"></div>\n\n\n\n<h3 id=\"balances-table\">Balances Table</h3>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"sql\"></div>\n\n\n\n<h3 id=\"transactions-table\">Transactions Table</h3>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"sql\"></div>\n\n\n\n<h3 id=\"currencies-table\">Currencies Table</h3>\n<div class=\"code-block-placeholder\" data-index=\"8\" data-lang=\"sql\"></div>\n\n\n\n<h3 id=\"blocks-table\">Blocks Table</h3>\n<div class=\"code-block-placeholder\" data-index=\"9\" data-lang=\"sql\"></div>\n\n\n\n<h3 id=\"contracts-table\">Contracts Table</h3>\n<div class=\"code-block-placeholder\" data-index=\"10\" data-lang=\"sql\"></div>\n\n\n\n<h3 id=\"kv-storage-table\">KV Storage Table</h3>\n<p>Per-contract key-value storage for <code>tana/kv</code> module.</p>\n<div class=\"code-block-placeholder\" data-index=\"11\" data-lang=\"sql\"></div>\n\n\n\n<p><strong>Notes:</strong></p>\n<ul>\n<li>Each contract has isolated namespace via <code>contract_name</code></li>\n<li>Keys automatically prefixed: <code>&quot;{contract_name}:{key}&quot;</code></li>\n<li>Max key length: 512 bytes</li>\n<li>Max value size: 25 MB</li>\n<li>Used by <code>tana/kv</code> module (Cloudflare Workers-compatible API)</li>\n</ul>\n<h2 id=\"state-management\">State Management</h2>\n<h3 id=\"account-state\">Account State</h3>\n<p>Each user and team has a state hash that represents their complete state:</p>\n<ul>\n<li>All balances across all currencies</li>\n<li>Account metadata</li>\n<li>Contract storage (if applicable)</li>\n</ul>\n<h3 id=\"state-root\">State Root</h3>\n<p>Each block has a state root - a Merkle root of all account state hashes. This allows:</p>\n<ul>\n<li>Efficient state verification</li>\n<li>Light client support</li>\n<li>State snapshots</li>\n<li>Fraud proofs</li>\n</ul>\n<h3 id=\"transaction-flow\">Transaction Flow</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>User submits transaction</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Validate (signature, balance, etc.)</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Add to pending transactions</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Block producer includes in block</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Execute transaction</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Update account states</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Calculate new state root</span></span>\n<span class=\"line\"><span>    â†“</span></span>\n<span class=\"line\"><span>Finalize block</span></span></code></pre><h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/guides/core/blocks/\">Blocks &amp; Blockchain</a> - Learn about block structure</li>\n<li><a href=\"/guides/core/contract-execution/\">Contract Execution</a> - How contracts interact with state</li>\n<li><a href=\"/tana-api/intro/\">API Reference</a> - Interact with the data model via API</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "typescript",
        "code": "interface User {\n  id: string                    // Unique ID (address)\n  publicKey: string             // Ed25519 public key\n  username: string              // @alice\n  displayName: string           // \"Alice Johnson\"\n  metadata: {\n    bio?: string\n    avatarData?: string         // Small image stored on-chain (<100KB base64)\n    avatarHash?: string         // Or content hash if stored off-chain\n  }\n  balances: Map<Currency, Decimal>  // Multi-currency\n  createdAt: timestamp\n  stateHash: string             // Merkle root of account state\n}"
      },
      {
        "lang": "typescript",
        "code": "interface Transaction {\n  id: string                    // Tx hash\n  from: string                  // User/Team ID\n  to: string                    // User/Team ID\n  amount: Decimal\n  currency: Currency            // USD, BTC, ETH, etc.\n  type: 'transfer' | 'deposit' | 'withdraw' | 'contract_call' | 'user_creation'\n  contractId?: string           // If contract execution\n  contractInput?: any           // Arguments\n  signature: string             // Ed25519\n  timestamp: timestamp\n  blockHeight: number           // Block inclusion\n  status: 'pending' | 'confirmed' | 'failed'\n}"
      },
      {
        "lang": "typescript",
        "code": "interface Currency {\n  code: string                  // \"USD\", \"BTC\", \"ETH\"\n  name: string                  // \"US Dollar\", \"Bitcoin\"\n  symbol: string                // \"$\", \"â‚¿\"\n  decimals: number              // Precision (e.g., 2 for USD, 8 for BTC)\n  type: 'fiat' | 'crypto'\n  verified: boolean             // Is this a recognized currency?\n}"
      },
      {
        "lang": "typescript",
        "code": "interface SmartContract {\n  id: string                    // Contract address\n  codeHash: string              // SHA-256 of code\n  code: string                  // TypeScript source\n  author: string                // User ID\n  deployedAt: timestamp\n  storage: Map<string, string>  // Key-value state (tana/data)\n  metadata: {\n    name?: string\n    description?: string\n    version?: string\n  }\n}"
      },
      {
        "lang": "typescript",
        "code": "interface Block {\n  id: string                    // Block hash\n  height: number                // Block number (0 = genesis)\n  timestamp: timestamp\n  previousHash: string          // Previous block\n  transactions: string[]        // Tx hashes\n  stateRoot: string             // Merkle root of all account states\n  validatorSignature: string    // Block producer signature\n  gasUsed: number              // Gas consumed\n  gasLimit: number             // Gas limit\n}"
      },
      {
        "lang": "sql",
        "code": "CREATE TABLE users (\n  id TEXT PRIMARY KEY,\n  username TEXT UNIQUE NOT NULL,\n  display_name TEXT,\n  public_key TEXT NOT NULL,\n  bio TEXT,\n  created_at TIMESTAMP DEFAULT NOW()\n);"
      },
      {
        "lang": "sql",
        "code": "CREATE TABLE balances (\n  owner_id TEXT NOT NULL,\n  owner_type TEXT NOT NULL,\n  currency_code TEXT NOT NULL,\n  amount TEXT NOT NULL,  -- Stored as string for precision\n  updated_at TIMESTAMP DEFAULT NOW(),\n  PRIMARY KEY (owner_id, currency_code)\n);"
      },
      {
        "lang": "sql",
        "code": "CREATE TABLE transactions (\n  id TEXT PRIMARY KEY,\n  from_id TEXT,\n  to_id TEXT,\n  amount TEXT,\n  currency_code TEXT NOT NULL,\n  type TEXT NOT NULL,\n  status TEXT NOT NULL DEFAULT 'pending',\n  block_height INTEGER,\n  metadata JSONB,\n  created_at TIMESTAMP DEFAULT NOW()\n);"
      },
      {
        "lang": "sql",
        "code": "CREATE TABLE currencies (\n  code TEXT PRIMARY KEY,\n  name TEXT NOT NULL,\n  symbol TEXT NOT NULL,\n  decimals INTEGER NOT NULL,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMP DEFAULT NOW()\n);"
      },
      {
        "lang": "sql",
        "code": "CREATE TABLE blocks (\n  height INTEGER PRIMARY KEY,\n  hash TEXT UNIQUE NOT NULL,\n  parent_hash TEXT NOT NULL,\n  state_root TEXT NOT NULL,\n  timestamp TIMESTAMP NOT NULL,\n  producer TEXT NOT NULL,\n  transactions JSONB NOT NULL,\n  gas_used BIGINT DEFAULT 0,\n  gas_limit BIGINT NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);"
      },
      {
        "lang": "sql",
        "code": "CREATE TABLE contracts (\n  id TEXT PRIMARY KEY,\n  code TEXT NOT NULL,\n  owner_id TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);"
      },
      {
        "lang": "sql",
        "code": "CREATE TABLE kv_storage (\n  contract_name TEXT NOT NULL,\n  key TEXT NOT NULL,\n  value TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (contract_name, key)\n);\n\nCREATE INDEX idx_kv_contract ON kv_storage(contract_name);"
      }
    ],
    "tableOfContents": [
      {
        "id": "primary-objects",
        "text": "Primary Objects",
        "level": 2
      },
      {
        "id": "user",
        "text": "User",
        "level": 3
      },
      {
        "id": "transaction",
        "text": "Transaction",
        "level": 3
      },
      {
        "id": "currency",
        "text": "Currency",
        "level": 3
      },
      {
        "id": "smart-contract",
        "text": "Smart Contract",
        "level": 3
      },
      {
        "id": "block",
        "text": "Block",
        "level": 3
      },
      {
        "id": "database-schema",
        "text": "Database Schema",
        "level": 2
      },
      {
        "id": "users-table",
        "text": "Users Table",
        "level": 3
      },
      {
        "id": "balances-table",
        "text": "Balances Table",
        "level": 3
      },
      {
        "id": "transactions-table",
        "text": "Transactions Table",
        "level": 3
      },
      {
        "id": "currencies-table",
        "text": "Currencies Table",
        "level": 3
      },
      {
        "id": "blocks-table",
        "text": "Blocks Table",
        "level": 3
      },
      {
        "id": "contracts-table",
        "text": "Contracts Table",
        "level": 3
      },
      {
        "id": "kv-storage-table",
        "text": "KV Storage Table",
        "level": 3
      },
      {
        "id": "state-management",
        "text": "State Management",
        "level": 2
      },
      {
        "id": "account-state",
        "text": "Account State",
        "level": 3
      },
      {
        "id": "state-root",
        "text": "State Root",
        "level": 3
      },
      {
        "id": "transaction-flow",
        "text": "Transaction Flow",
        "level": 3
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "contributing",
      "setup"
    ],
    "metadata": {
      "title": "Development Setup",
      "description": "Build Tana from source for development",
      "sidebar": {
        "order": 2
      }
    },
    "content": "\nThis guide is for **contributors** who want to build Tana from source. If you just want to use Tana, see the [Quick Start](/guides/quickstart/) instead.\n\n## Prerequisites\n\n- [Bun](https://bun.sh) >= 1.0 (TypeScript runtime)\n- [Rust](https://rustup.rs) >= 1.70 (for runtime binary)\n- [Docker](https://docker.com) (for PostgreSQL and Redis)\n- [mprocs](https://github.com/pvolok/mprocs) (optional, for multi-process management)\n\n## Clone Repository\n\nThe Tana project is organized as multiple repositories under the `tananetwork` organization:\n\n```bash\n# Clone the main development environment\ngit clone https://github.com/tananetwork/tana-dev-env.git\ncd tana-dev-env\n\n# Or clone individual repos as needed:\n# git clone https://github.com/tananetwork/tana-cli.git\n# git clone https://github.com/tananetwork/tana-runtime.git\n# git clone https://github.com/tananetwork/tana-edge.git\n```\n\n## Install Dependencies\n\n```bash\n# Install all workspace dependencies\nbun install\n```\n\n## Build Rust Runtime\n\n```bash\ncd runtime\ncargo build --release\ncd ..\n```\n\nThis creates the `tana-runtime` binary at `runtime/target/release/tana-runtime`.\n\n## Build CLI (Optional)\n\n```bash\ncd cli\nbun run make\ncd ..\n```\n\nThis creates a standalone `tana` binary at `cli/dist/tana`.\n\n## Start Development Environment\n\n### Option 1: Quick Start with Tana CLI\n\n```bash\n# Create a user\nbun cli/main.ts new user @alice --name \"Alice\"\n\n# Start Tana\nbun cli/main.ts start\n```\n\nThis automatically starts all required services:\n- âœ… PostgreSQL\n- âœ… Redis\n- âœ… Mesh Service\n- âœ… T4 Service\n- âœ… Ledger Service - http://localhost:8080\n\n### Option 2: All Services with mprocs\n\n```bash\nnpm run dev\n# or\n./dev.sh\n```\n\nThis starts all services including the playground and other development tools.\n\n**mprocs shortcuts:**\n- `Tab` - Switch between processes\n- `Space` - Start/stop a process\n- `Ctrl+A` then `Q` - Quit all processes\n- `Ctrl+A` then `K` - Kill a process\n- `Arrow keys` - Navigate\n\n### Option 3: Manual Database Management\n\nIf you need to manually manage databases:\n\n```bash\n# Start databases only\nnpm run db:up\n\n# Stop databases\nnpm run db:down\n\n# Restart databases\nnpm run db:restart\n\n# View database logs\nnpm run db:logs\n```\n\nNote: `tana start` will automatically start required databases if they're not running.\n\n## Environment Configuration\n\nCreate a `.env` file in the project root:\n\n```bash\ncp .env.example .env\n```\n\nEdit `.env` to configure:\n\n```bash\n# Database\nDATABASE_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'\n\n# Redis\nREDIS_URL='redis://localhost:6379'\n\n# Service Ports\nLEDGER_PORT=8080\nCONTRACTS_PORT=8081\nNODE_PORT=9933\n\n# Environment\nNODE_ENV=development\n```\n\n## Initialize Validator (Optional)\n\nIf you want to run as a validator node:\n\n```bash\n# Initialize validator with custom ports\nbun cli/main.ts init validator --ws-port 9000 --http-port 9001\n\n# Or use default ports\nbun cli/main.ts init validator\n```\n\nThis sets up your node to participate in consensus and validate blocks.\n\n## Testing\n\n```bash\n# Run all tests\nbun test\n\n# Test specific service\nbun run --filter @tana/ledger test\n\n# Test Rust runtime\ncd runtime && cargo test\n```\n\n## Common Development Tasks\n\n### Database Management\n\n```bash\n# Start databases\nnpm run db:up\n\n# Stop databases\nnpm run db:down\n\n# View logs\nnpm run db:logs\n\n# Reset databases (warning: deletes all data)\ndocker compose down -v && npm run db:up\n```\n\n### Building\n\n```bash\n# Build all services\nnpm run build\n\n# Build Rust runtime\nnpm run build:runtime\n\n# Build CLI binary\ncd cli && bun run make\n```\n\n### Running Examples\n\n```bash\n# Test the runtime\nbun run chaintest\n\n# Run a contract\ncd runtime\ncargo run -- ../examples/default.ts\n```\n\n## Troubleshooting\n\n### Port Already in Use\n\n```bash\n# Kill process on port 8080\nlsof -ti:8080 | xargs kill -9\n\n# Check what's using a port\nlsof -i :8080\n```\n\n### Database Connection Errors\n\n```bash\n# Restart PostgreSQL\ndocker compose restart postgres\n\n# Check logs\ndocker compose logs postgres\n\n# Verify DATABASE_URL in .env\ncat .env | grep DATABASE_URL\n```\n\n### Build Errors\n\n```bash\n# Clean and rebuild\nrm -rf node_modules\nbun install\n\n# Rust\ncd runtime\ncargo clean\ncargo build --release\n```\n\n## Project Structure\n\n```\ntana/\nâ”œâ”€â”€ cli/             # CLI binary (TypeScript/Bun)\nâ”œâ”€â”€ runtime/         # Contract execution (Rust)\nâ”œâ”€â”€ ledger/          # Ledger service (TypeScript/Bun)\nâ”œâ”€â”€ contracts/       # Contract executor (TypeScript/Bun)\nâ”œâ”€â”€ node/            # Blockchain node (TypeScript/Bun)\nâ”œâ”€â”€ websites/\nâ”‚   â”œâ”€â”€ docs/        # Documentation (Astro/Starlight)\nâ”‚   â”œâ”€â”€ playground/  # Contract playground (Astro/Svelte)\nâ”‚   â””â”€â”€ landing/     # Landing page (Next.js)\nâ”œâ”€â”€ types/           # Shared TypeScript types\nâ”œâ”€â”€ examples/        # Example contracts\nâ””â”€â”€ docs/            # Technical documentation\n```\n\n## Next Steps\n\n- Read [System Architecture](/contributing/architecture/) to understand how Tana works\n- Explore [Core Concepts](/contributing/core/data-model/) for technical details\n- Check out [Testing Guide](/contributing/testing/) for writing tests\n",
    "html": "<p>This guide is for <strong>contributors</strong> who want to build Tana from source. If you just want to use Tana, see the <a href=\"/guides/quickstart/\">Quick Start</a> instead.</p>\n<h2 id=\"prerequisites\">Prerequisites</h2>\n<ul>\n<li><a href=\"https://bun.sh\">Bun</a> &gt;= 1.0 (TypeScript runtime)</li>\n<li><a href=\"https://rustup.rs\">Rust</a> &gt;= 1.70 (for runtime binary)</li>\n<li><a href=\"https://docker.com\">Docker</a> (for PostgreSQL and Redis)</li>\n<li><a href=\"https://github.com/pvolok/mprocs\">mprocs</a> (optional, for multi-process management)</li>\n</ul>\n<h2 id=\"clone-repository\">Clone Repository</h2>\n<p>The Tana project is organized as multiple repositories under the <code>tananetwork</code> organization:</p>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"install-dependencies\">Install Dependencies</h2>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"build-rust-runtime\">Build Rust Runtime</h2>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"bash\"></div>\n\n\n\n<p>This creates the <code>tana-runtime</code> binary at <code>runtime/target/release/tana-runtime</code>.</p>\n<h2 id=\"build-cli-optional\">Build CLI (Optional)</h2>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"bash\"></div>\n\n\n\n<p>This creates a standalone <code>tana</code> binary at <code>cli/dist/tana</code>.</p>\n<h2 id=\"start-development-environment\">Start Development Environment</h2>\n<h3 id=\"option-1-quick-start-with-tana-cli\">Option 1: Quick Start with Tana CLI</h3>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"bash\"></div>\n\n\n\n<p>This automatically starts all required services:</p>\n<ul>\n<li>âœ… PostgreSQL</li>\n<li>âœ… Redis</li>\n<li>âœ… Mesh Service</li>\n<li>âœ… T4 Service</li>\n<li>âœ… Ledger Service - <a href=\"http://localhost:8080\">http://localhost:8080</a></li>\n</ul>\n<h3 id=\"option-2-all-services-with-mprocs\">Option 2: All Services with mprocs</h3>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"bash\"></div>\n\n\n\n<p>This starts all services including the playground and other development tools.</p>\n<p><strong>mprocs shortcuts:</strong></p>\n<ul>\n<li><code>Tab</code> - Switch between processes</li>\n<li><code>Space</code> - Start/stop a process</li>\n<li><code>Ctrl+A</code> then <code>Q</code> - Quit all processes</li>\n<li><code>Ctrl+A</code> then <code>K</code> - Kill a process</li>\n<li><code>Arrow keys</code> - Navigate</li>\n</ul>\n<h3 id=\"option-3-manual-database-management\">Option 3: Manual Database Management</h3>\n<p>If you need to manually manage databases:</p>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"bash\"></div>\n\n\n\n<p>Note: <code>tana start</code> will automatically start required databases if they&#39;re not running.</p>\n<h2 id=\"environment-configuration\">Environment Configuration</h2>\n<p>Create a <code>.env</code> file in the project root:</p>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"bash\"></div>\n\n\n\n<p>Edit <code>.env</code> to configure:</p>\n<div class=\"code-block-placeholder\" data-index=\"8\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"initialize-validator-optional\">Initialize Validator (Optional)</h2>\n<p>If you want to run as a validator node:</p>\n<div class=\"code-block-placeholder\" data-index=\"9\" data-lang=\"bash\"></div>\n\n\n\n<p>This sets up your node to participate in consensus and validate blocks.</p>\n<h2 id=\"testing\">Testing</h2>\n<div class=\"code-block-placeholder\" data-index=\"10\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"common-development-tasks\">Common Development Tasks</h2>\n<h3 id=\"database-management\">Database Management</h3>\n<div class=\"code-block-placeholder\" data-index=\"11\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"building\">Building</h3>\n<div class=\"code-block-placeholder\" data-index=\"12\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"running-examples\">Running Examples</h3>\n<div class=\"code-block-placeholder\" data-index=\"13\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"troubleshooting\">Troubleshooting</h2>\n<h3 id=\"port-already-in-use\">Port Already in Use</h3>\n<div class=\"code-block-placeholder\" data-index=\"14\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"database-connection-errors\">Database Connection Errors</h3>\n<div class=\"code-block-placeholder\" data-index=\"15\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"build-errors\">Build Errors</h3>\n<div class=\"code-block-placeholder\" data-index=\"16\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"project-structure\">Project Structure</h2>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>tana/</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ cli/             # CLI binary (TypeScript/Bun)</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ runtime/         # Contract execution (Rust)</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ ledger/          # Ledger service (TypeScript/Bun)</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ contracts/       # Contract executor (TypeScript/Bun)</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ node/            # Blockchain node (TypeScript/Bun)</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ websites/</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ docs/        # Documentation (Astro/Starlight)</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ playground/  # Contract playground (Astro/Svelte)</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€ landing/     # Landing page (Next.js)</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ types/           # Shared TypeScript types</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ examples/        # Example contracts</span></span>\n<span class=\"line\"><span>â””â”€â”€ docs/            # Technical documentation</span></span></code></pre><h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li>Read <a href=\"/contributing/architecture/\">System Architecture</a> to understand how Tana works</li>\n<li>Explore <a href=\"/contributing/core/data-model/\">Core Concepts</a> for technical details</li>\n<li>Check out <a href=\"/contributing/testing/\">Testing Guide</a> for writing tests</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "# Clone the main development environment\ngit clone https://github.com/tananetwork/tana-dev-env.git\ncd tana-dev-env\n\n# Or clone individual repos as needed:\n# git clone https://github.com/tananetwork/tana-cli.git\n# git clone https://github.com/tananetwork/tana-runtime.git\n# git clone https://github.com/tananetwork/tana-edge.git"
      },
      {
        "lang": "bash",
        "code": "# Install all workspace dependencies\nbun install"
      },
      {
        "lang": "bash",
        "code": "cd runtime\ncargo build --release\ncd .."
      },
      {
        "lang": "bash",
        "code": "cd cli\nbun run make\ncd .."
      },
      {
        "lang": "bash",
        "code": "# Create a user\nbun cli/main.ts new user @alice --name \"Alice\"\n\n# Start Tana\nbun cli/main.ts start"
      },
      {
        "lang": "bash",
        "code": "npm run dev\n# or\n./dev.sh"
      },
      {
        "lang": "bash",
        "code": "# Start databases only\nnpm run db:up\n\n# Stop databases\nnpm run db:down\n\n# Restart databases\nnpm run db:restart\n\n# View database logs\nnpm run db:logs"
      },
      {
        "lang": "bash",
        "code": "cp .env.example .env"
      },
      {
        "lang": "bash",
        "code": "# Database\nDATABASE_URL='postgres://tana:[PASSWORD]@localhost:5432/tana'\n\n# Redis\nREDIS_URL='redis://localhost:6379'\n\n# Service Ports\nLEDGER_PORT=8080\nCONTRACTS_PORT=8081\nNODE_PORT=9933\n\n# Environment\nNODE_ENV=development"
      },
      {
        "lang": "bash",
        "code": "# Initialize validator with custom ports\nbun cli/main.ts init validator --ws-port 9000 --http-port 9001\n\n# Or use default ports\nbun cli/main.ts init validator"
      },
      {
        "lang": "bash",
        "code": "# Run all tests\nbun test\n\n# Test specific service\nbun run --filter @tana/ledger test\n\n# Test Rust runtime\ncd runtime && cargo test"
      },
      {
        "lang": "bash",
        "code": "# Start databases\nnpm run db:up\n\n# Stop databases\nnpm run db:down\n\n# View logs\nnpm run db:logs\n\n# Reset databases (warning: deletes all data)\ndocker compose down -v && npm run db:up"
      },
      {
        "lang": "bash",
        "code": "# Build all services\nnpm run build\n\n# Build Rust runtime\nnpm run build:runtime\n\n# Build CLI binary\ncd cli && bun run make"
      },
      {
        "lang": "bash",
        "code": "# Test the runtime\nbun run chaintest\n\n# Run a contract\ncd runtime\ncargo run -- ../examples/default.ts"
      },
      {
        "lang": "bash",
        "code": "# Kill process on port 8080\nlsof -ti:8080 | xargs kill -9\n\n# Check what's using a port\nlsof -i :8080"
      },
      {
        "lang": "bash",
        "code": "# Restart PostgreSQL\ndocker compose restart postgres\n\n# Check logs\ndocker compose logs postgres\n\n# Verify DATABASE_URL in .env\ncat .env | grep DATABASE_URL"
      },
      {
        "lang": "bash",
        "code": "# Clean and rebuild\nrm -rf node_modules\nbun install\n\n# Rust\ncd runtime\ncargo clean\ncargo build --release"
      }
    ],
    "tableOfContents": [
      {
        "id": "prerequisites",
        "text": "Prerequisites",
        "level": 2
      },
      {
        "id": "clone-repository",
        "text": "Clone Repository",
        "level": 2
      },
      {
        "id": "install-dependencies",
        "text": "Install Dependencies",
        "level": 2
      },
      {
        "id": "build-rust-runtime",
        "text": "Build Rust Runtime",
        "level": 2
      },
      {
        "id": "build-cli-optional",
        "text": "Build CLI (Optional)",
        "level": 2
      },
      {
        "id": "start-development-environment",
        "text": "Start Development Environment",
        "level": 2
      },
      {
        "id": "option-1-quick-start-with-tana-cli",
        "text": "Option 1: Quick Start with Tana CLI",
        "level": 3
      },
      {
        "id": "option-2-all-services-with-mprocs",
        "text": "Option 2: All Services with mprocs",
        "level": 3
      },
      {
        "id": "option-3-manual-database-management",
        "text": "Option 3: Manual Database Management",
        "level": 3
      },
      {
        "id": "environment-configuration",
        "text": "Environment Configuration",
        "level": 2
      },
      {
        "id": "initialize-validator-optional",
        "text": "Initialize Validator (Optional)",
        "level": 2
      },
      {
        "id": "testing",
        "text": "Testing",
        "level": 2
      },
      {
        "id": "common-development-tasks",
        "text": "Common Development Tasks",
        "level": 2
      },
      {
        "id": "database-management",
        "text": "Database Management",
        "level": 3
      },
      {
        "id": "building",
        "text": "Building",
        "level": 3
      },
      {
        "id": "running-examples",
        "text": "Running Examples",
        "level": 3
      },
      {
        "id": "troubleshooting",
        "text": "Troubleshooting",
        "level": 2
      },
      {
        "id": "port-already-in-use",
        "text": "Port Already in Use",
        "level": 3
      },
      {
        "id": "database-connection-errors",
        "text": "Database Connection Errors",
        "level": 3
      },
      {
        "id": "build-errors",
        "text": "Build Errors",
        "level": 3
      },
      {
        "id": "project-structure",
        "text": "Project Structure",
        "level": 2
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "contributing",
      "intro"
    ],
    "metadata": {
      "title": "Contributing",
      "description": "Guide for contributing to Tana development",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nThank you for your interest in contributing to Tana! This section contains documentation for developers who want to contribute to the project.\n\n## For Users vs Contributors\n\n**If you're a user** looking to use Tana:\n- See [Quick Start](/guides/quickstart/) for installation\n- See [CLI Reference](/tana-cli/intro/) for commands\n- See [API Reference](/tana-api/intro/) for API endpoints\n\n**If you're a contributor** looking to develop Tana:\n- Continue reading this section\n- See [Development Setup](/contributing/setup/) to build from source\n- See [System Architecture](/contributing/architecture/) to understand the codebase\n\n## What's in This Section\n\n### Development\n- [Development Setup](/contributing/setup/) - Build Tana from source\n- [System Architecture](/contributing/architecture/) - How Tana works internally\n- [Testing](/contributing/testing/) - Running tests\n\n### Technical Details\n- [Data Model](/contributing/core/data-model/) - Database schemas and structures\n- [Blocks & Blockchain](/contributing/core/blocks/) - Block production and validation\n- [System Flows](/contributing/core/system-flows/) - Internal data flows\n\n## Ways to Contribute\n\n### Code Contributions\n- Fix bugs\n- Add features\n- Improve performance\n- Write tests\n\n### Documentation\n- Improve existing docs\n- Add examples\n- Fix typos\n- Translate documentation\n\n### Community\n- Help others in discussions\n- Report bugs\n- Suggest features\n- Write blog posts or tutorials\n\n## Getting Help\n\n- **GitHub Issues**: Report bugs or request features\n- **GitHub Discussions**: Ask questions and share ideas\n- **Discord**: Join the community (coming soon)\n\n## Code of Conduct\n\nBe respectful, inclusive, and professional. We're all here to learn and build together.\n",
    "html": "<p>Thank you for your interest in contributing to Tana! This section contains documentation for developers who want to contribute to the project.</p>\n<h2 id=\"for-users-vs-contributors\">For Users vs Contributors</h2>\n<p><strong>If you&#39;re a user</strong> looking to use Tana:</p>\n<ul>\n<li>See <a href=\"/guides/quickstart/\">Quick Start</a> for installation</li>\n<li>See <a href=\"/tana-cli/intro/\">CLI Reference</a> for commands</li>\n<li>See <a href=\"/tana-api/intro/\">API Reference</a> for API endpoints</li>\n</ul>\n<p><strong>If you&#39;re a contributor</strong> looking to develop Tana:</p>\n<ul>\n<li>Continue reading this section</li>\n<li>See <a href=\"/contributing/setup/\">Development Setup</a> to build from source</li>\n<li>See <a href=\"/contributing/architecture/\">System Architecture</a> to understand the codebase</li>\n</ul>\n<h2 id=\"whats-in-this-section\">What&#39;s in This Section</h2>\n<h3 id=\"development\">Development</h3>\n<ul>\n<li><a href=\"/contributing/setup/\">Development Setup</a> - Build Tana from source</li>\n<li><a href=\"/contributing/architecture/\">System Architecture</a> - How Tana works internally</li>\n<li><a href=\"/contributing/testing/\">Testing</a> - Running tests</li>\n</ul>\n<h3 id=\"technical-details\">Technical Details</h3>\n<ul>\n<li><a href=\"/contributing/core/data-model/\">Data Model</a> - Database schemas and structures</li>\n<li><a href=\"/contributing/core/blocks/\">Blocks &amp; Blockchain</a> - Block production and validation</li>\n<li><a href=\"/contributing/core/system-flows/\">System Flows</a> - Internal data flows</li>\n</ul>\n<h2 id=\"ways-to-contribute\">Ways to Contribute</h2>\n<h3 id=\"code-contributions\">Code Contributions</h3>\n<ul>\n<li>Fix bugs</li>\n<li>Add features</li>\n<li>Improve performance</li>\n<li>Write tests</li>\n</ul>\n<h3 id=\"documentation\">Documentation</h3>\n<ul>\n<li>Improve existing docs</li>\n<li>Add examples</li>\n<li>Fix typos</li>\n<li>Translate documentation</li>\n</ul>\n<h3 id=\"community\">Community</h3>\n<ul>\n<li>Help others in discussions</li>\n<li>Report bugs</li>\n<li>Suggest features</li>\n<li>Write blog posts or tutorials</li>\n</ul>\n<h2 id=\"getting-help\">Getting Help</h2>\n<ul>\n<li><strong>GitHub Issues</strong>: Report bugs or request features</li>\n<li><strong>GitHub Discussions</strong>: Ask questions and share ideas</li>\n<li><strong>Discord</strong>: Join the community (coming soon)</li>\n</ul>\n<h2 id=\"code-of-conduct\">Code of Conduct</h2>\n<p>Be respectful, inclusive, and professional. We&#39;re all here to learn and build together.</p>\n",
    "codeBlocks": [],
    "tableOfContents": [
      {
        "id": "for-users-vs-contributors",
        "text": "For Users vs Contributors",
        "level": 2
      },
      {
        "id": "whats-in-this-section",
        "text": "What's in This Section",
        "level": 2
      },
      {
        "id": "development",
        "text": "Development",
        "level": 3
      },
      {
        "id": "technical-details",
        "text": "Technical Details",
        "level": 3
      },
      {
        "id": "ways-to-contribute",
        "text": "Ways to Contribute",
        "level": 2
      },
      {
        "id": "code-contributions",
        "text": "Code Contributions",
        "level": 3
      },
      {
        "id": "documentation",
        "text": "Documentation",
        "level": 3
      },
      {
        "id": "community",
        "text": "Community",
        "level": 3
      },
      {
        "id": "getting-help",
        "text": "Getting Help",
        "level": 2
      },
      {
        "id": "code-of-conduct",
        "text": "Code of Conduct",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "contributing",
      "runtime",
      "edge-internals"
    ],
    "metadata": {
      "title": "Edge Internals",
      "description": "How the tana-edge HTTP server works internally",
      "sidebar": {
        "order": 3
      }
    },
    "content": "\nThis document explains how `tana-edge` works internally for developers who want to contribute to or understand the codebase.\n\n## Architecture Overview\n\nEdge is a Rust HTTP server using Actix-web with embedded V8 via `deno_core`:\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                   tana-edge                         â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                     â”‚\nâ”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚   â”‚ Actix-web   â”‚â”€â”€â”€â–ºâ”‚ Request Router          â”‚   â”‚\nâ”‚   â”‚ HTTP Server â”‚    â”‚ /{contract_id}          â”‚   â”‚\nâ”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                  â”‚                 â”‚\nâ”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚                      â”‚ V8 Isolate Pool         â”‚   â”‚\nâ”‚                      â”‚ (fresh per request)     â”‚   â”‚\nâ”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                  â”‚                 â”‚\nâ”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚   â”‚ Contract    â”‚â—„â”€â”€â”€â”‚ JavaScript Runtime      â”‚   â”‚\nâ”‚   â”‚ Code        â”‚    â”‚ (deno_core)             â”‚   â”‚\nâ”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                  â”‚                 â”‚\nâ”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚                      â”‚ Tana Modules            â”‚   â”‚\nâ”‚                      â”‚ tana:core, tana:kv, ... â”‚   â”‚\nâ”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Key Components\n\n### 1. HTTP Server (Actix-web)\n\nLocated in `edge/src/main.rs`:\n\n```rust\nHttpServer::new(move || {\n    App::new()\n        .route(\"/health\", web::get().to(health_check))\n        .route(\"/{contract_id}\", web::get().to(handle_get))\n        .route(\"/{contract_id}\", web::post().to(handle_post))\n})\n.bind((\"0.0.0.0\", port))?\n.run()\n```\n\n### 2. V8 Isolate Creation\n\nEach request gets a fresh V8 isolate (Cloudflare Workers model):\n\n```rust\nasync fn handle_get(path: web::Path<String>, req: HttpRequest) -> impl Responder {\n    let contract_id = path.into_inner();\n\n    // Create fresh isolate\n    let mut runtime = JsRuntime::new(RuntimeOptions {\n        module_loader: Some(Rc::new(TanaModuleLoader)),\n        ..Default::default()\n    });\n\n    // Execute contract\n    let result = execute_contract(&mut runtime, &contract_id, \"get\").await;\n\n    // Isolate is dropped here - no state leakage\n    HttpResponse::Ok().json(result)\n}\n```\n\n### 3. Module System\n\nTana modules are injected into the V8 runtime via `deno_core`:\n\n```rust\n// edge/src/modules.rs\npub fn get_tana_modules() -> Vec<Extension> {\n    vec![\n        tana_core::init_ops(),\n        tana_kv::init_ops(),\n        tana_block::init_ops(),\n        tana_context::init_ops(),\n    ]\n}\n```\n\n### 4. Contract Loading\n\nContracts are loaded from the database:\n\n```rust\nasync fn load_contract(contract_id: &str) -> Result<Contract> {\n    let contract = sqlx::query_as!(\n        Contract,\n        \"SELECT * FROM contracts WHERE id = $1 AND is_active = true\",\n        contract_id\n    )\n    .fetch_one(&pool)\n    .await?;\n\n    Ok(contract)\n}\n```\n\n## Request Flow\n\n1. **HTTP Request** arrives at Actix-web\n2. **Router** extracts `contract_id` from path\n3. **Contract Loader** fetches contract code from database\n4. **V8 Isolate** is created with Tana modules\n5. **Contract Code** is executed (`get()` or `post()`)\n6. **Response** is serialized to JSON\n7. **Isolate** is dropped (memory freed)\n\n## Security Model\n\n### Sandbox Isolation\n\nEach request runs in a completely isolated V8 environment:\n\n- **No filesystem access** - `fs` module not available\n- **No network access** - Only whitelisted `fetch` via `tana:utils`\n- **No process access** - No `child_process`, `os`, etc.\n- **Memory limits** - V8 heap size constrained\n\n### Read-Only Execution\n\nEdge handlers (`get`/`post`) cannot write to blockchain state:\n\n```rust\n// KV operations in edge are read-only\nimpl TanaKv for EdgeKv {\n    async fn get(&self, key: &str) -> Option<String> {\n        // Allowed - reads from database\n        self.db.get_kv(self.contract_id, key).await\n    }\n\n    async fn put(&self, key: &str, value: &str) -> Result<()> {\n        // Blocked in edge mode\n        Err(Error::ReadOnlyMode)\n    }\n}\n```\n\n## Performance Optimizations\n\n### Isolate Pooling (Future)\n\nCurrently each request creates a new isolate. Future optimization:\n\n```rust\n// Potential isolate pool implementation\nstruct IsolatePool {\n    available: Vec<JsRuntime>,\n    max_size: usize,\n}\n\nimpl IsolatePool {\n    fn acquire(&mut self) -> JsRuntime {\n        self.available.pop().unwrap_or_else(|| create_isolate())\n    }\n\n    fn release(&mut self, runtime: JsRuntime) {\n        if self.available.len() < self.max_size {\n            // Reset isolate state\n            runtime.clear_context();\n            self.available.push(runtime);\n        }\n        // Otherwise drop\n    }\n}\n```\n\n### Contract Caching\n\nCompiled contract code is cached:\n\n```rust\nlazy_static! {\n    static ref CONTRACT_CACHE: RwLock<HashMap<String, CompiledContract>> =\n        RwLock::new(HashMap::new());\n}\n```\n\n## Building from Source\n\n```bash\ncd edge\ncargo build --release\n\n# Binary at: target/release/tana-edge\n```\n\n### Dependencies\n\n- `deno_core` - V8 JavaScript runtime\n- `actix-web` - HTTP server\n- `sqlx` - Database access\n- `tokio` - Async runtime\n\n## Testing\n\n```bash\n# Run tests\ncd edge\ncargo test\n\n# Integration tests\ncargo test --features integration\n```\n\n## Contributing\n\nKey files:\n\n| File | Purpose |\n|------|---------|\n| `src/main.rs` | HTTP server setup, routing |\n| `src/runtime.rs` | V8 isolate management |\n| `src/modules/` | Tana module implementations |\n| `src/contract.rs` | Contract loading and execution |\n\n## Related\n\n- [Runtime Internals](/docs/contributing/runtime/intro/) - How tana-runtime works\n- [Architecture](/docs/contributing/architecture/) - System overview\n",
    "html": "<p>This document explains how <code>tana-edge</code> works internally for developers who want to contribute to or understand the codebase.</p>\n<h2 id=\"architecture-overview\">Architecture Overview</h2>\n<p>Edge is a Rust HTTP server using Actix-web with embedded V8 via <code>deno_core</code>:</p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>\n<span class=\"line\"><span>â”‚                   tana-edge                         â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>\n<span class=\"line\"><span>â”‚                                                     â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚ Actix-web   â”‚â”€â”€â”€â–ºâ”‚ Request Router          â”‚   â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚ HTTP Server â”‚    â”‚ /{contract_id}          â”‚   â”‚</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span></span>\n<span class=\"line\"><span>â”‚                                  â”‚                 â”‚</span></span>\n<span class=\"line\"><span>â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span></span>\n<span class=\"line\"><span>â”‚                      â”‚ V8 Isolate Pool         â”‚   â”‚</span></span>\n<span class=\"line\"><span>â”‚                      â”‚ (fresh per request)     â”‚   â”‚</span></span>\n<span class=\"line\"><span>â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span></span>\n<span class=\"line\"><span>â”‚                                  â”‚                 â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚ Contract    â”‚â—„â”€â”€â”€â”‚ JavaScript Runtime      â”‚   â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚ Code        â”‚    â”‚ (deno_core)             â”‚   â”‚</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span></span>\n<span class=\"line\"><span>â”‚                                  â”‚                 â”‚</span></span>\n<span class=\"line\"><span>â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span></span>\n<span class=\"line\"><span>â”‚                      â”‚ Tana Modules            â”‚   â”‚</span></span>\n<span class=\"line\"><span>â”‚                      â”‚ tana:core, tana:kv, ... â”‚   â”‚</span></span>\n<span class=\"line\"><span>â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span></span>\n<span class=\"line\"><span>â”‚                                                     â”‚</span></span>\n<span class=\"line\"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><h2 id=\"key-components\">Key Components</h2>\n<h3 id=\"1-http-server-actix-web\">1. HTTP Server (Actix-web)</h3>\n<p>Located in <code>edge/src/main.rs</code>:</p>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"rust\"></div>\n\n\n\n<h3 id=\"2-v8-isolate-creation\">2. V8 Isolate Creation</h3>\n<p>Each request gets a fresh V8 isolate (Cloudflare Workers model):</p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"rust\"></div>\n\n\n\n<h3 id=\"3-module-system\">3. Module System</h3>\n<p>Tana modules are injected into the V8 runtime via <code>deno_core</code>:</p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"rust\"></div>\n\n\n\n<h3 id=\"4-contract-loading\">4. Contract Loading</h3>\n<p>Contracts are loaded from the database:</p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"rust\"></div>\n\n\n\n<h2 id=\"request-flow\">Request Flow</h2>\n<ol>\n<li><strong>HTTP Request</strong> arrives at Actix-web</li>\n<li><strong>Router</strong> extracts <code>contract_id</code> from path</li>\n<li><strong>Contract Loader</strong> fetches contract code from database</li>\n<li><strong>V8 Isolate</strong> is created with Tana modules</li>\n<li><strong>Contract Code</strong> is executed (<code>get()</code> or <code>post()</code>)</li>\n<li><strong>Response</strong> is serialized to JSON</li>\n<li><strong>Isolate</strong> is dropped (memory freed)</li>\n</ol>\n<h2 id=\"security-model\">Security Model</h2>\n<h3 id=\"sandbox-isolation\">Sandbox Isolation</h3>\n<p>Each request runs in a completely isolated V8 environment:</p>\n<ul>\n<li><strong>No filesystem access</strong> - <code>fs</code> module not available</li>\n<li><strong>No network access</strong> - Only whitelisted <code>fetch</code> via <code>tana:utils</code></li>\n<li><strong>No process access</strong> - No <code>child_process</code>, <code>os</code>, etc.</li>\n<li><strong>Memory limits</strong> - V8 heap size constrained</li>\n</ul>\n<h3 id=\"read-only-execution\">Read-Only Execution</h3>\n<p>Edge handlers (<code>get</code>/<code>post</code>) cannot write to blockchain state:</p>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"rust\"></div>\n\n\n\n<h2 id=\"performance-optimizations\">Performance Optimizations</h2>\n<h3 id=\"isolate-pooling-future\">Isolate Pooling (Future)</h3>\n<p>Currently each request creates a new isolate. Future optimization:</p>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"rust\"></div>\n\n\n\n<h3 id=\"contract-caching\">Contract Caching</h3>\n<p>Compiled contract code is cached:</p>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"rust\"></div>\n\n\n\n<h2 id=\"building-from-source\">Building from Source</h2>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"dependencies\">Dependencies</h3>\n<ul>\n<li><code>deno_core</code> - V8 JavaScript runtime</li>\n<li><code>actix-web</code> - HTTP server</li>\n<li><code>sqlx</code> - Database access</li>\n<li><code>tokio</code> - Async runtime</li>\n</ul>\n<h2 id=\"testing\">Testing</h2>\n<div class=\"code-block-placeholder\" data-index=\"8\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"contributing\">Contributing</h2>\n<p>Key files:</p>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th>Purpose</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>src/main.rs</code></td>\n<td>HTTP server setup, routing</td>\n</tr>\n<tr>\n<td><code>src/runtime.rs</code></td>\n<td>V8 isolate management</td>\n</tr>\n<tr>\n<td><code>src/modules/</code></td>\n<td>Tana module implementations</td>\n</tr>\n<tr>\n<td><code>src/contract.rs</code></td>\n<td>Contract loading and execution</td>\n</tr>\n</tbody></table>\n<h2 id=\"related\">Related</h2>\n<ul>\n<li><a href=\"/docs/contributing/runtime/intro/\">Runtime Internals</a> - How tana-runtime works</li>\n<li><a href=\"/docs/contributing/architecture/\">Architecture</a> - System overview</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "rust",
        "code": "HttpServer::new(move || {\n    App::new()\n        .route(\"/health\", web::get().to(health_check))\n        .route(\"/{contract_id}\", web::get().to(handle_get))\n        .route(\"/{contract_id}\", web::post().to(handle_post))\n})\n.bind((\"0.0.0.0\", port))?\n.run()"
      },
      {
        "lang": "rust",
        "code": "async fn handle_get(path: web::Path<String>, req: HttpRequest) -> impl Responder {\n    let contract_id = path.into_inner();\n\n    // Create fresh isolate\n    let mut runtime = JsRuntime::new(RuntimeOptions {\n        module_loader: Some(Rc::new(TanaModuleLoader)),\n        ..Default::default()\n    });\n\n    // Execute contract\n    let result = execute_contract(&mut runtime, &contract_id, \"get\").await;\n\n    // Isolate is dropped here - no state leakage\n    HttpResponse::Ok().json(result)\n}"
      },
      {
        "lang": "rust",
        "code": "// edge/src/modules.rs\npub fn get_tana_modules() -> Vec<Extension> {\n    vec![\n        tana_core::init_ops(),\n        tana_kv::init_ops(),\n        tana_block::init_ops(),\n        tana_context::init_ops(),\n    ]\n}"
      },
      {
        "lang": "rust",
        "code": "async fn load_contract(contract_id: &str) -> Result<Contract> {\n    let contract = sqlx::query_as!(\n        Contract,\n        \"SELECT * FROM contracts WHERE id = $1 AND is_active = true\",\n        contract_id\n    )\n    .fetch_one(&pool)\n    .await?;\n\n    Ok(contract)\n}"
      },
      {
        "lang": "rust",
        "code": "// KV operations in edge are read-only\nimpl TanaKv for EdgeKv {\n    async fn get(&self, key: &str) -> Option<String> {\n        // Allowed - reads from database\n        self.db.get_kv(self.contract_id, key).await\n    }\n\n    async fn put(&self, key: &str, value: &str) -> Result<()> {\n        // Blocked in edge mode\n        Err(Error::ReadOnlyMode)\n    }\n}"
      },
      {
        "lang": "rust",
        "code": "// Potential isolate pool implementation\nstruct IsolatePool {\n    available: Vec<JsRuntime>,\n    max_size: usize,\n}\n\nimpl IsolatePool {\n    fn acquire(&mut self) -> JsRuntime {\n        self.available.pop().unwrap_or_else(|| create_isolate())\n    }\n\n    fn release(&mut self, runtime: JsRuntime) {\n        if self.available.len() < self.max_size {\n            // Reset isolate state\n            runtime.clear_context();\n            self.available.push(runtime);\n        }\n        // Otherwise drop\n    }\n}"
      },
      {
        "lang": "rust",
        "code": "lazy_static! {\n    static ref CONTRACT_CACHE: RwLock<HashMap<String, CompiledContract>> =\n        RwLock::new(HashMap::new());\n}"
      },
      {
        "lang": "bash",
        "code": "cd edge\ncargo build --release\n\n# Binary at: target/release/tana-edge"
      },
      {
        "lang": "bash",
        "code": "# Run tests\ncd edge\ncargo test\n\n# Integration tests\ncargo test --features integration"
      }
    ],
    "tableOfContents": [
      {
        "id": "architecture-overview",
        "text": "Architecture Overview",
        "level": 2
      },
      {
        "id": "key-components",
        "text": "Key Components",
        "level": 2
      },
      {
        "id": "1-http-server-actix-web",
        "text": "1. HTTP Server (Actix-web)",
        "level": 3
      },
      {
        "id": "2-v8-isolate-creation",
        "text": "2. V8 Isolate Creation",
        "level": 3
      },
      {
        "id": "3-module-system",
        "text": "3. Module System",
        "level": 3
      },
      {
        "id": "4-contract-loading",
        "text": "4. Contract Loading",
        "level": 3
      },
      {
        "id": "request-flow",
        "text": "Request Flow",
        "level": 2
      },
      {
        "id": "security-model",
        "text": "Security Model",
        "level": 2
      },
      {
        "id": "sandbox-isolation",
        "text": "Sandbox Isolation",
        "level": 3
      },
      {
        "id": "read-only-execution",
        "text": "Read-Only Execution",
        "level": 3
      },
      {
        "id": "performance-optimizations",
        "text": "Performance Optimizations",
        "level": 2
      },
      {
        "id": "isolate-pooling-future",
        "text": "Isolate Pooling (Future)",
        "level": 3
      },
      {
        "id": "contract-caching",
        "text": "Contract Caching",
        "level": 3
      },
      {
        "id": "building-from-source",
        "text": "Building from Source",
        "level": 2
      },
      {
        "id": "dependencies",
        "text": "Dependencies",
        "level": 3
      },
      {
        "id": "testing",
        "text": "Testing",
        "level": 2
      },
      {
        "id": "contributing",
        "text": "Contributing",
        "level": 2
      },
      {
        "id": "related",
        "text": "Related",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "contributing",
      "runtime",
      "intro"
    ],
    "metadata": {
      "title": "Runtime Architecture",
      "description": "V8-based TypeScript runtime for smart contracts",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nTana Runtime is a lightweight JavaScript/TypeScript runtime built on **deno_core** (Deno's V8 engine). It provides a sandboxed execution environment for TypeScript smart contracts, similar to Cloudflare Workers.\n\n## Overview\n\nThe runtime creates a secure sandbox for executing TypeScript with:\n\n1. **V8 JavaScript Engine** - Via deno_core for native performance\n2. **TypeScript Compiler** - Dynamically transpiles TypeScript to JavaScript\n3. **Custom Module System** - Virtual modules like `tana:core`, `tana:data`, `tana:utils`\n4. **Sandbox Isolation** - Hides Deno API, exposes only whitelisted functionality\n5. **Dual Environment Support** - Same code runs in CLI runtime and browser playground\n\n## Quick Start\n\n```bash\n# Run the Rust CLI runtime\ncd runtime\ncargo run\n\n# Or run a specific script\ncargo run example.ts\n```\n\n## Architecture\n\n### Runtime Stack\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   TypeScript Smart Contracts        â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚   Virtual Modules (tana:core, etc)  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚   TypeScript Compiler (typescript.js)â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚   Sandboxed V8 Runtime (deno_core)  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚   Rust Runtime / Browser Playground â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Core Components\n\n**src/main.rs** - Main runtime entry point\n- Initializes `JsRuntime` with deno_core\n- Loads internal modules\n- Defines ops (Rustâ†”JavaScript bridge)\n- Bootstraps V8 with tana-globals.ts\n\n**src/lib.rs** - Library exports for WASM builds\n\n**build.rs** - Build script\n- Extracts version info (Tana, Deno Core, V8)\n- Embeds metadata at compile time\n\n**tana-globals.ts** - Bootstrap code\n- Defines `globalThis.tana`\n- Hides `Deno` API for isolation\n- Sets up module loader\n\n**typescript.js** - Embedded TypeScript compiler\n- Bundled compiler for `.ts` â†’ `.js` transpilation\n- Loaded into V8 at runtime\n\n### Execution Flow\n\n1. `main.rs` bootstraps V8 + deno_core runtime\n2. Loads `typescript.js` compiler into V8\n3. Injects `tana-globals.ts` and hides `Deno` API\n4. Registers virtual modules (`tana:core`, `tana:data`, etc.)\n5. Reads user script (e.g., `example.ts`)\n6. Transpiles TypeScript â†’ JavaScript\n7. Executes in sandbox with isolated state\n\n## Implemented Features\n\n### Storage API (`tana:data`)\n\n**Status:** âœ… Feature parity achieved (works identically in both environments)\n\n```typescript\nimport { data } from 'tana:data'\n\n// Set values (staged, not committed yet)\nawait data.set('counter', 42)\nawait data.set('user', { name: 'Alice', balance: 1000 })\n\n// Read values\nconst count = await data.get('counter')  // 42\nconst user = await data.get('user')      // { name: 'Alice', balance: 1000 }\n\n// Pattern matching\nawait data.set('user:1:name', 'Bob')\nawait data.set('user:2:name', 'Charlie')\nconst userKeys = await data.keys('user:*')  // ['user:1:name', 'user:2:name']\n\n// Atomic commit (all or nothing)\nawait data.commit()\n```\n\n**Implementation:**\n- **Playground:** localStorage backend with full persistence\n- **Rust Runtime:** In-memory HashMap (resets each run)\n- **Planned:** Redis backend for production persistence\n\n**Storage Limits:**\n- Max key size: 256 bytes\n- Max value size: 10 KB\n- Max total size: 100 KB per contract\n- Max keys: 1000\n\n**Key Features:**\n- Staging buffer with atomic commits\n- Size validation before persistence\n- JSON auto-serialization\n- Glob pattern matching support\n\n### Fetch API (`tana:utils`)\n\n**Status:** âœ… Working in both environments\n\n```typescript\nimport { fetch } from 'tana:utils'\n\n// Whitelisted domains only\nconst data = await fetch('https://pokeapi.co/api/v2/pokemon/ditto')\nconsole.log(data)\n```\n\n**Security:**\n- Domain whitelist: `pokeapi.co`, `tana.dev`, `localhost`, etc.\n- Rust: reqwest + tokio async runtime\n- Playground: browser fetch with same whitelist\n\n### Console API (`tana:core`)\n\n**Status:** âœ… Working in both environments\n\n```typescript\nimport { console } from 'tana:core'\n\nconsole.log('Hello from Tana!')\nconsole.error('Error message')\n\n// Runtime version info\nimport { version } from 'tana:core'\nconsole.log(version.tana)       // \"0.1.0\"\nconsole.log(version.deno_core)  // \"0.338\"\nconsole.log(version.v8)         // \"13.2.281.5\"\n```\n\n## Feature Parity Strategy\n\n**Dual Environment Support:**\n\n1. **Rust CLI Runtime** (`cargo run`) - Production-ready V8 sandbox\n2. **Browser Playground** (Astro/Svelte web app) - Development/testing UI\n\n**Synchronization Points:**\n- `src/main.rs` - Rust ops definitions\n- `playground/src/pages/sandbox.astro` - JavaScript module implementations\n- `types/*.d.ts` - Shared TypeScript definitions\n- `playground/src/components/Editor.svelte` - Monaco type definitions\n\n**Rule:** If it's in the type definitions, it MUST work in BOTH environments.\n\n## File Structure\n\n### Core Runtime Files\n\n| File | Description |\n|------|-------------|\n| **src/main.rs** | Main entry point, initializes JsRuntime, defines ops |\n| **src/lib.rs** | Library exports for WASM builds |\n| **build.rs** | Build script extracting version info |\n| **Cargo.toml** | Rust dependencies and package configuration |\n| **typescript.js** | Embedded TypeScript compiler |\n| **tana-globals.ts** | Bootstrap defining `globalThis.tana` |\n\n### TypeScript & Type Definitions\n\n| File | Description |\n|------|-------------|\n| **types/tana.d.ts** | Type declarations for `tana` and `tana:core` |\n| **types/tana-data.d.ts** | Type declarations for `tana:data` storage |\n| **types/tana-utils.d.ts** | Type declarations for `tana:utils` |\n| **tsconfig.json** | TypeScript config mapping `\"tana:*\"` paths |\n\n### Example & Test Files\n\n| File | Description |\n|------|-------------|\n| **example.ts** | Example TypeScript program |\n| **counter-test.ts** | Simple counter demonstrating storage API |\n| **test-storage.ts** | Comprehensive storage API tests |\n| **test-fetch.ts** | Fetch API tests |\n\n## Technical Stack\n\n### Rust Dependencies\n\n```toml\ndeno_core = \"0.338\"          # V8 runtime\ndeno_error = \"0.5.7\"         # Error handling\nreqwest = \"0.12\"             # HTTP client\ntokio = \"1\"                  # Async runtime\nredis = \"0.27\"               # Database client (planned)\nserde_json = \"1.0\"           # JSON handling\nwasm-bindgen = \"0.2\"         # WASM support\n```\n\n## Example Smart Contract\n\n```typescript\nimport { console } from 'tana:core'\nimport { data } from 'tana:data'\n\n// Simple token transfer contract\nasync function transfer(from: string, to: string, amount: number) {\n  // Read current balances\n  const fromBalance = parseInt((await data.get(`balance:${from}`)) as string)\n  const toBalance = parseInt((await data.get(`balance:${to}`)) as string)\n\n  // Validate\n  if (fromBalance < amount) {\n    throw new Error('Insufficient balance')\n  }\n\n  // Update balances\n  await data.set(`balance:${from}`, String(fromBalance - amount))\n  await data.set(`balance:${to}`, String(toBalance + amount))\n\n  // Commit atomically (both balances updated or neither)\n  await data.commit()\n\n  console.log(`Transferred ${amount} from ${from} to ${to}`)\n}\n\n// Initialize balances\nawait data.set('balance:alice', '1000')\nawait data.set('balance:bob', '500')\nawait data.commit()\n\n// Execute transfer\nawait transfer('alice', 'bob', 200)\n\n// Check new balances\nconsole.log('Alice:', await data.get('balance:alice'))  // '800'\nconsole.log('Bob:', await data.get('balance:bob'))      // '700'\n```\n\n## Testing\n\n### CLI Runtime\n\n```bash\n# Run example script\ncargo run\n\n# Run specific test\ncargo run counter-test.ts\ncargo run test-storage.ts\ncargo run test-fetch.ts\n```\n\n### Browser Playground\n\n```bash\ncd playground\nnpm install\nnpm run dev\n```\n\nOpen http://localhost:4322/ and use the Monaco editor to write and run TypeScript contracts.\n\n**Inspect Storage:**\n1. Open Browser DevTools (F12)\n2. Go to **Application > Local Storage**\n3. Look for keys starting with `tana:data:`\n\n## Development Status\n\n### Working âœ…\n\n- V8 runtime bootstrapping\n- TypeScript transpilation\n- Module system (`tana:core`, `tana:data`, `tana:utils`)\n- Storage API with staging + atomic commits\n- Fetch API with domain whitelist\n- Browser playground with Monaco editor\n- Feature parity between CLI and playground\n- JSON auto-serialization for storage\n- Glob pattern matching for keys\n\n### In Progress ğŸš§\n\n- Redis backend for persistent storage (Rust runtime)\n- Docker setup for database services\n- Blockchain integration (`tana:blockchain` module)\n- Data View tab in playground UI\n- Gas costs and storage rent model\n\n### Planned ğŸ“‹\n\n- PostgreSQL integration for ledger state\n- Ed25519 signature verification\n- Block batching and Merkle proofs\n- Multi-currency account system\n- Contract deployment and versioning\n- API endpoints for network access\n\n## Next Steps\n\n1. **Redis Integration** - Add persistent storage backend to Rust runtime\n2. **Docker Compose** - Setup Redis + PostgreSQL services\n3. **Data View Tab** - Add UI to visualize storage in playground\n4. **Blockchain Module** - Implement `tana:blockchain` API\n5. **Gas Costs** - Add metering for storage operations\n6. **Contract Deployment** - Support uploading and versioning contracts\n\n## Important Notes\n\n- `globalThis.Deno` is deleted to ensure true sandbox isolation\n- The current module system will be replaced by a Rust `ModuleLoader`\n- Storage limits prevent abuse (similar to Ethereum gas model)\n- Same TypeScript code runs in CLI and browser playground\n- Contracts are deterministic state machines identified by code hash\n\n## Related Documentation\n\n- [Smart Contract Examples](/guides/smart-contracts/) - Writing contracts\n- [Edge Server](/contributing/edge/intro/) - Production contract execution\n- [Environment Variables](/contributing/env-vars/) - Configuration\n",
    "html": "<p>Tana Runtime is a lightweight JavaScript/TypeScript runtime built on <strong>deno_core</strong> (Deno&#39;s V8 engine). It provides a sandboxed execution environment for TypeScript smart contracts, similar to Cloudflare Workers.</p>\n<h2 id=\"overview\">Overview</h2>\n<p>The runtime creates a secure sandbox for executing TypeScript with:</p>\n<ol>\n<li><strong>V8 JavaScript Engine</strong> - Via deno_core for native performance</li>\n<li><strong>TypeScript Compiler</strong> - Dynamically transpiles TypeScript to JavaScript</li>\n<li><strong>Custom Module System</strong> - Virtual modules like <code>tana:core</code>, <code>tana:data</code>, <code>tana:utils</code></li>\n<li><strong>Sandbox Isolation</strong> - Hides Deno API, exposes only whitelisted functionality</li>\n<li><strong>Dual Environment Support</strong> - Same code runs in CLI runtime and browser playground</li>\n</ol>\n<h2 id=\"quick-start\">Quick Start</h2>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"architecture\">Architecture</h2>\n<h3 id=\"runtime-stack\">Runtime Stack</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>\n<span class=\"line\"><span>â”‚   TypeScript Smart Contracts        â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>\n<span class=\"line\"><span>â”‚   Virtual Modules (tana:core, etc)  â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>\n<span class=\"line\"><span>â”‚   TypeScript Compiler (typescript.js)â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>\n<span class=\"line\"><span>â”‚   Sandboxed V8 Runtime (deno_core)  â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>\n<span class=\"line\"><span>â”‚   Rust Runtime / Browser Playground â”‚</span></span>\n<span class=\"line\"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><h3 id=\"core-components\">Core Components</h3>\n<p><strong>src/main.rs</strong> - Main runtime entry point</p>\n<ul>\n<li>Initializes <code>JsRuntime</code> with deno_core</li>\n<li>Loads internal modules</li>\n<li>Defines ops (Rustâ†”JavaScript bridge)</li>\n<li>Bootstraps V8 with tana-globals.ts</li>\n</ul>\n<p><strong>src/lib.rs</strong> - Library exports for WASM builds</p>\n<p><strong>build.rs</strong> - Build script</p>\n<ul>\n<li>Extracts version info (Tana, Deno Core, V8)</li>\n<li>Embeds metadata at compile time</li>\n</ul>\n<p><strong>tana-globals.ts</strong> - Bootstrap code</p>\n<ul>\n<li>Defines <code>globalThis.tana</code></li>\n<li>Hides <code>Deno</code> API for isolation</li>\n<li>Sets up module loader</li>\n</ul>\n<p><strong>typescript.js</strong> - Embedded TypeScript compiler</p>\n<ul>\n<li>Bundled compiler for <code>.ts</code> â†’ <code>.js</code> transpilation</li>\n<li>Loaded into V8 at runtime</li>\n</ul>\n<h3 id=\"execution-flow\">Execution Flow</h3>\n<ol>\n<li><code>main.rs</code> bootstraps V8 + deno_core runtime</li>\n<li>Loads <code>typescript.js</code> compiler into V8</li>\n<li>Injects <code>tana-globals.ts</code> and hides <code>Deno</code> API</li>\n<li>Registers virtual modules (<code>tana:core</code>, <code>tana:data</code>, etc.)</li>\n<li>Reads user script (e.g., <code>example.ts</code>)</li>\n<li>Transpiles TypeScript â†’ JavaScript</li>\n<li>Executes in sandbox with isolated state</li>\n</ol>\n<h2 id=\"implemented-features\">Implemented Features</h2>\n<h3 id=\"storage-api-tanadata\">Storage API (<code>tana:data</code>)</h3>\n<p><strong>Status:</strong> âœ… Feature parity achieved (works identically in both environments)</p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Implementation:</strong></p>\n<ul>\n<li><strong>Playground:</strong> localStorage backend with full persistence</li>\n<li><strong>Rust Runtime:</strong> In-memory HashMap (resets each run)</li>\n<li><strong>Planned:</strong> Redis backend for production persistence</li>\n</ul>\n<p><strong>Storage Limits:</strong></p>\n<ul>\n<li>Max key size: 256 bytes</li>\n<li>Max value size: 10 KB</li>\n<li>Max total size: 100 KB per contract</li>\n<li>Max keys: 1000</li>\n</ul>\n<p><strong>Key Features:</strong></p>\n<ul>\n<li>Staging buffer with atomic commits</li>\n<li>Size validation before persistence</li>\n<li>JSON auto-serialization</li>\n<li>Glob pattern matching support</li>\n</ul>\n<h3 id=\"fetch-api-tanautils\">Fetch API (<code>tana:utils</code>)</h3>\n<p><strong>Status:</strong> âœ… Working in both environments</p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Security:</strong></p>\n<ul>\n<li>Domain whitelist: <code>pokeapi.co</code>, <code>tana.dev</code>, <code>localhost</code>, etc.</li>\n<li>Rust: reqwest + tokio async runtime</li>\n<li>Playground: browser fetch with same whitelist</li>\n</ul>\n<h3 id=\"console-api-tanacore\">Console API (<code>tana:core</code>)</h3>\n<p><strong>Status:</strong> âœ… Working in both environments</p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"feature-parity-strategy\">Feature Parity Strategy</h2>\n<p><strong>Dual Environment Support:</strong></p>\n<ol>\n<li><strong>Rust CLI Runtime</strong> (<code>cargo run</code>) - Production-ready V8 sandbox</li>\n<li><strong>Browser Playground</strong> (Astro/Svelte web app) - Development/testing UI</li>\n</ol>\n<p><strong>Synchronization Points:</strong></p>\n<ul>\n<li><code>src/main.rs</code> - Rust ops definitions</li>\n<li><code>playground/src/pages/sandbox.astro</code> - JavaScript module implementations</li>\n<li><code>types/*.d.ts</code> - Shared TypeScript definitions</li>\n<li><code>playground/src/components/Editor.svelte</code> - Monaco type definitions</li>\n</ul>\n<p><strong>Rule:</strong> If it&#39;s in the type definitions, it MUST work in BOTH environments.</p>\n<h2 id=\"file-structure\">File Structure</h2>\n<h3 id=\"core-runtime-files\">Core Runtime Files</h3>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>src/main.rs</strong></td>\n<td>Main entry point, initializes JsRuntime, defines ops</td>\n</tr>\n<tr>\n<td><strong>src/lib.rs</strong></td>\n<td>Library exports for WASM builds</td>\n</tr>\n<tr>\n<td><strong>build.rs</strong></td>\n<td>Build script extracting version info</td>\n</tr>\n<tr>\n<td><strong>Cargo.toml</strong></td>\n<td>Rust dependencies and package configuration</td>\n</tr>\n<tr>\n<td><strong>typescript.js</strong></td>\n<td>Embedded TypeScript compiler</td>\n</tr>\n<tr>\n<td><strong>tana-globals.ts</strong></td>\n<td>Bootstrap defining <code>globalThis.tana</code></td>\n</tr>\n</tbody></table>\n<h3 id=\"typescript--type-definitions\">TypeScript &amp; Type Definitions</h3>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>types/tana.d.ts</strong></td>\n<td>Type declarations for <code>tana</code> and <code>tana:core</code></td>\n</tr>\n<tr>\n<td><strong>types/tana-data.d.ts</strong></td>\n<td>Type declarations for <code>tana:data</code> storage</td>\n</tr>\n<tr>\n<td><strong>types/tana-utils.d.ts</strong></td>\n<td>Type declarations for <code>tana:utils</code></td>\n</tr>\n<tr>\n<td><strong>tsconfig.json</strong></td>\n<td>TypeScript config mapping <code>&quot;tana:*&quot;</code> paths</td>\n</tr>\n</tbody></table>\n<h3 id=\"example--test-files\">Example &amp; Test Files</h3>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>example.ts</strong></td>\n<td>Example TypeScript program</td>\n</tr>\n<tr>\n<td><strong>counter-test.ts</strong></td>\n<td>Simple counter demonstrating storage API</td>\n</tr>\n<tr>\n<td><strong>test-storage.ts</strong></td>\n<td>Comprehensive storage API tests</td>\n</tr>\n<tr>\n<td><strong>test-fetch.ts</strong></td>\n<td>Fetch API tests</td>\n</tr>\n</tbody></table>\n<h2 id=\"technical-stack\">Technical Stack</h2>\n<h3 id=\"rust-dependencies\">Rust Dependencies</h3>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"toml\"></div>\n\n\n\n<h2 id=\"example-smart-contract\">Example Smart Contract</h2>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"testing\">Testing</h2>\n<h3 id=\"cli-runtime\">CLI Runtime</h3>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"browser-playground\">Browser Playground</h3>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"bash\"></div>\n\n\n\n<p>Open <a href=\"http://localhost:4322/\">http://localhost:4322/</a> and use the Monaco editor to write and run TypeScript contracts.</p>\n<p><strong>Inspect Storage:</strong></p>\n<ol>\n<li>Open Browser DevTools (F12)</li>\n<li>Go to <strong>Application &gt; Local Storage</strong></li>\n<li>Look for keys starting with <code>tana:data:</code></li>\n</ol>\n<h2 id=\"development-status\">Development Status</h2>\n<h3 id=\"working-\">Working âœ…</h3>\n<ul>\n<li>V8 runtime bootstrapping</li>\n<li>TypeScript transpilation</li>\n<li>Module system (<code>tana:core</code>, <code>tana:data</code>, <code>tana:utils</code>)</li>\n<li>Storage API with staging + atomic commits</li>\n<li>Fetch API with domain whitelist</li>\n<li>Browser playground with Monaco editor</li>\n<li>Feature parity between CLI and playground</li>\n<li>JSON auto-serialization for storage</li>\n<li>Glob pattern matching for keys</li>\n</ul>\n<h3 id=\"in-progress-\">In Progress ğŸš§</h3>\n<ul>\n<li>Redis backend for persistent storage (Rust runtime)</li>\n<li>Docker setup for database services</li>\n<li>Blockchain integration (<code>tana:blockchain</code> module)</li>\n<li>Data View tab in playground UI</li>\n<li>Gas costs and storage rent model</li>\n</ul>\n<h3 id=\"planned-\">Planned ğŸ“‹</h3>\n<ul>\n<li>PostgreSQL integration for ledger state</li>\n<li>Ed25519 signature verification</li>\n<li>Block batching and Merkle proofs</li>\n<li>Multi-currency account system</li>\n<li>Contract deployment and versioning</li>\n<li>API endpoints for network access</li>\n</ul>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ol>\n<li><strong>Redis Integration</strong> - Add persistent storage backend to Rust runtime</li>\n<li><strong>Docker Compose</strong> - Setup Redis + PostgreSQL services</li>\n<li><strong>Data View Tab</strong> - Add UI to visualize storage in playground</li>\n<li><strong>Blockchain Module</strong> - Implement <code>tana:blockchain</code> API</li>\n<li><strong>Gas Costs</strong> - Add metering for storage operations</li>\n<li><strong>Contract Deployment</strong> - Support uploading and versioning contracts</li>\n</ol>\n<h2 id=\"important-notes\">Important Notes</h2>\n<ul>\n<li><code>globalThis.Deno</code> is deleted to ensure true sandbox isolation</li>\n<li>The current module system will be replaced by a Rust <code>ModuleLoader</code></li>\n<li>Storage limits prevent abuse (similar to Ethereum gas model)</li>\n<li>Same TypeScript code runs in CLI and browser playground</li>\n<li>Contracts are deterministic state machines identified by code hash</li>\n</ul>\n<h2 id=\"related-documentation\">Related Documentation</h2>\n<ul>\n<li><a href=\"/guides/smart-contracts/\">Smart Contract Examples</a> - Writing contracts</li>\n<li><a href=\"/contributing/edge/intro/\">Edge Server</a> - Production contract execution</li>\n<li><a href=\"/contributing/env-vars/\">Environment Variables</a> - Configuration</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "# Run the Rust CLI runtime\ncd runtime\ncargo run\n\n# Or run a specific script\ncargo run example.ts"
      },
      {
        "lang": "typescript",
        "code": "import { data } from 'tana:data'\n\n// Set values (staged, not committed yet)\nawait data.set('counter', 42)\nawait data.set('user', { name: 'Alice', balance: 1000 })\n\n// Read values\nconst count = await data.get('counter')  // 42\nconst user = await data.get('user')      // { name: 'Alice', balance: 1000 }\n\n// Pattern matching\nawait data.set('user:1:name', 'Bob')\nawait data.set('user:2:name', 'Charlie')\nconst userKeys = await data.keys('user:*')  // ['user:1:name', 'user:2:name']\n\n// Atomic commit (all or nothing)\nawait data.commit()"
      },
      {
        "lang": "typescript",
        "code": "import { fetch } from 'tana:utils'\n\n// Whitelisted domains only\nconst data = await fetch('https://pokeapi.co/api/v2/pokemon/ditto')\nconsole.log(data)"
      },
      {
        "lang": "typescript",
        "code": "import { console } from 'tana:core'\n\nconsole.log('Hello from Tana!')\nconsole.error('Error message')\n\n// Runtime version info\nimport { version } from 'tana:core'\nconsole.log(version.tana)       // \"0.1.0\"\nconsole.log(version.deno_core)  // \"0.338\"\nconsole.log(version.v8)         // \"13.2.281.5\""
      },
      {
        "lang": "toml",
        "code": "deno_core = \"0.338\"          # V8 runtime\ndeno_error = \"0.5.7\"         # Error handling\nreqwest = \"0.12\"             # HTTP client\ntokio = \"1\"                  # Async runtime\nredis = \"0.27\"               # Database client (planned)\nserde_json = \"1.0\"           # JSON handling\nwasm-bindgen = \"0.2\"         # WASM support"
      },
      {
        "lang": "typescript",
        "code": "import { console } from 'tana:core'\nimport { data } from 'tana:data'\n\n// Simple token transfer contract\nasync function transfer(from: string, to: string, amount: number) {\n  // Read current balances\n  const fromBalance = parseInt((await data.get(`balance:${from}`)) as string)\n  const toBalance = parseInt((await data.get(`balance:${to}`)) as string)\n\n  // Validate\n  if (fromBalance < amount) {\n    throw new Error('Insufficient balance')\n  }\n\n  // Update balances\n  await data.set(`balance:${from}`, String(fromBalance - amount))\n  await data.set(`balance:${to}`, String(toBalance + amount))\n\n  // Commit atomically (both balances updated or neither)\n  await data.commit()\n\n  console.log(`Transferred ${amount} from ${from} to ${to}`)\n}\n\n// Initialize balances\nawait data.set('balance:alice', '1000')\nawait data.set('balance:bob', '500')\nawait data.commit()\n\n// Execute transfer\nawait transfer('alice', 'bob', 200)\n\n// Check new balances\nconsole.log('Alice:', await data.get('balance:alice'))  // '800'\nconsole.log('Bob:', await data.get('balance:bob'))      // '700'"
      },
      {
        "lang": "bash",
        "code": "# Run example script\ncargo run\n\n# Run specific test\ncargo run counter-test.ts\ncargo run test-storage.ts\ncargo run test-fetch.ts"
      },
      {
        "lang": "bash",
        "code": "cd playground\nnpm install\nnpm run dev"
      }
    ],
    "tableOfContents": [
      {
        "id": "overview",
        "text": "Overview",
        "level": 2
      },
      {
        "id": "quick-start",
        "text": "Quick Start",
        "level": 2
      },
      {
        "id": "architecture",
        "text": "Architecture",
        "level": 2
      },
      {
        "id": "runtime-stack",
        "text": "Runtime Stack",
        "level": 3
      },
      {
        "id": "core-components",
        "text": "Core Components",
        "level": 3
      },
      {
        "id": "execution-flow",
        "text": "Execution Flow",
        "level": 3
      },
      {
        "id": "implemented-features",
        "text": "Implemented Features",
        "level": 2
      },
      {
        "id": "storage-api-tanadata",
        "text": "Storage API (`tana:data`)",
        "level": 3
      },
      {
        "id": "fetch-api-tanautils",
        "text": "Fetch API (`tana:utils`)",
        "level": 3
      },
      {
        "id": "console-api-tanacore",
        "text": "Console API (`tana:core`)",
        "level": 3
      },
      {
        "id": "feature-parity-strategy",
        "text": "Feature Parity Strategy",
        "level": 2
      },
      {
        "id": "file-structure",
        "text": "File Structure",
        "level": 2
      },
      {
        "id": "core-runtime-files",
        "text": "Core Runtime Files",
        "level": 3
      },
      {
        "id": "typescript-type-definitions",
        "text": "TypeScript & Type Definitions",
        "level": 3
      },
      {
        "id": "example-test-files",
        "text": "Example & Test Files",
        "level": 3
      },
      {
        "id": "technical-stack",
        "text": "Technical Stack",
        "level": 2
      },
      {
        "id": "rust-dependencies",
        "text": "Rust Dependencies",
        "level": 3
      },
      {
        "id": "example-smart-contract",
        "text": "Example Smart Contract",
        "level": 2
      },
      {
        "id": "testing",
        "text": "Testing",
        "level": 2
      },
      {
        "id": "cli-runtime",
        "text": "CLI Runtime",
        "level": 3
      },
      {
        "id": "browser-playground",
        "text": "Browser Playground",
        "level": 3
      },
      {
        "id": "development-status",
        "text": "Development Status",
        "level": 2
      },
      {
        "id": "working-",
        "text": "Working âœ…",
        "level": 3
      },
      {
        "id": "in-progress-",
        "text": "In Progress ğŸš§",
        "level": 3
      },
      {
        "id": "planned-",
        "text": "Planned ğŸ“‹",
        "level": 3
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      },
      {
        "id": "important-notes",
        "text": "Important Notes",
        "level": 2
      },
      {
        "id": "related-documentation",
        "text": "Related Documentation",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "contributing",
      "runtime",
      "modules",
      "kv"
    ],
    "metadata": {
      "title": "KV Storage Implementation",
      "description": "Technical details of tana/kv module across all runtimes"
    },
    "content": "\nTechnical reference for the `tana/kv` module implementation across tana-runtime, tana-edge, and playground environments.\n\n## Architecture Overview\n\nKV storage provides Cloudflare Workers-compatible key-value storage with automatic per-contract namespace isolation.\n\n### Namespace Isolation\n\nAll keys are internally prefixed with the contract name:\n```\nStored Key Format: \"{contract_name}:{user_key}\"\nExample: \"my_contract:username\" â†’ \"alice\"\n```\n\nThis ensures contracts cannot access each other's data.\n\n## Runtime Implementations\n\n### tana-runtime (Rust CLI)\n\n**Location:** `runtime/src/tana_kv.rs`, `runtime/src/main.rs`\n\n**Storage Backend:** PostgreSQL (migration `0011_kv_storage.sql`)\n\n**Schema:**\n```sql\nCREATE TABLE kv_storage (\n  contract_name TEXT NOT NULL,\n  key TEXT NOT NULL,\n  value TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (contract_name, key)\n);\n```\n\n**Rust Ops:**\n```rust\n#[op2]\n#[string]\nfn op_kv_get_raw(\n    state: &OpState,\n    #[string] key: String,\n) -> Result<Option<String>, JsErrorBox>\n\n#[op2(fast)]\nfn op_kv_put_raw(\n    state: &OpState,\n    #[string] key: String,\n    #[string] value: String,\n) -> Result<(), JsErrorBox>\n\n#[op2(fast)]\nfn op_kv_delete_raw(\n    state: &OpState,\n    #[string] key: String,\n) -> Result<(), JsErrorBox>\n\n#[op2]\n#[serde]\nfn op_kv_list_keys(\n    state: &OpState,\n    #[string] prefix: Option<String>,\n    #[serde] limit: Option<usize>,\n) -> Result<Vec<String>, JsErrorBox>\n```\n\n**JavaScript Bridge:**\n```typescript\n// Uses context.contract_name() from OpState\nconst contractName = globalThis.__tanaCore.ops.op_context_contract_name()\nglobalThis.__tanaCore.ops.op_kv_get_raw(key) // Automatically namespaced\n```\n\n**Characteristics:**\n- âœ… Persistent across restarts\n- âœ… ACID transactions via PostgreSQL\n- âœ… Production-ready\n- ğŸ“Š Performance: ~1-5ms per operation\n\n---\n\n### tana-edge (Rust HTTP Server)\n\n**Location:** `tana-edge/src/main.rs` (lines 41-49, 335-460, 1163-1196)\n\n**Storage Backend:** In-memory HashMap (Redis-ready)\n\n**Data Structure:**\n```rust\nstatic KV_STORAGE: Mutex<Option<HashMap<String, String>>> = Mutex::new(None);\n```\n\n**Rust Ops:**\n```rust\n// Same signatures as tana-runtime, but contract_name passed as parameter\n#[op2]\n#[string]\nfn op_kv_get_raw(\n    #[string] contract_name: String,\n    #[string] key: String,\n) -> Result<Option<String>, JsErrorBox>\n\n// ... put, delete, list ops similar\n```\n\n**JavaScript Bridge:**\n```typescript\n// Hardcoded contract name for development\nconst contractName = \"edge_contract\"\nconst rawValue = globalThis.__tanaCore.ops.op_kv_get_raw(contractName, key)\n```\n\n**Characteristics:**\n- âš¡ Very fast (in-memory)\n- âŒ Not persistent (resets on restart)\n- ğŸ”§ Development/testing use\n- ğŸš€ Production: Replace with Redis backend\n- ğŸ“Š Performance: <0.1ms per operation\n\n---\n\n### playground (Browser/TypeScript)\n\n**Location:**\n- `websites/playground/src/pages/sandbox.astro` (lines 691-811)\n- `websites/playground/src/components/Editor.svelte` (lines 277-318)\n\n**Storage Backend:** Browser localStorage\n\n**Key Format:**\n```\nlocalStorage Key: \"tana_kv_playground:playground_contract:{user_key}\"\nExample: \"tana_kv_playground:playground_contract:username\"\n```\n\n**Implementation:**\n```typescript\nconst kv = {\n  async get(key: string, options?: KVGetOptions) {\n    const storageKey = `tana_kv_playground:playground_contract:${key}`\n    const value = localStorage.getItem(storageKey)\n    if (!value) return null\n\n    const type = options?.type || 'text'\n    return type === 'json' ? JSON.parse(value) : value\n  },\n\n  async put(key: string, value: string | object) {\n    const storageKey = `tana_kv_playground:playground_contract:${key}`\n    const serialized = typeof value === 'string' ? value : JSON.stringify(value)\n    localStorage.setItem(storageKey, serialized)\n  },\n\n  async delete(key: string) {\n    const storageKey = `tana_kv_playground:playground_contract:${key}`\n    localStorage.removeItem(storageKey)\n  },\n\n  async list(options?: KVListOptions): Promise<KVListResult> {\n    const prefix = `tana_kv_playground:playground_contract:${options?.prefix || ''}`\n    const limit = options?.limit || 1000\n    const keys: string[] = []\n\n    for (let i = 0; i < localStorage.length; i++) {\n      const fullKey = localStorage.key(i)\n      if (fullKey?.startsWith(prefix)) {\n        const userKey = fullKey.replace('tana_kv_playground:playground_contract:', '')\n        keys.push(userKey)\n        if (keys.length >= limit) break\n      }\n    }\n\n    keys.sort()\n    return {\n      keys: keys.map(name => ({ name })),\n      list_complete: true,\n      cursor: null\n    }\n  }\n}\n```\n\n**Characteristics:**\n- ğŸ’¾ Persistent per-browser\n- ğŸš€ Instant execution\n- ğŸ“ Limited to ~5-10MB total\n- ğŸ§ª Great for experimentation\n- ğŸ“Š Performance: <0.1ms per operation\n\n## API Consistency\n\nAll three runtimes implement identical JavaScript API:\n\n```typescript\ninterface KV {\n  get(key: string, options?: { type?: 'text' | 'json' }): Promise<string | object | null>\n  put(key: string, value: string | object, options?: KVPutOptions): Promise<void>\n  delete(key: string): Promise<void>\n  list(options?: { prefix?: string, limit?: number }): Promise<KVListResult>\n}\n```\n\nThis ensures contracts are **portable** - code written in playground works identically in tana-runtime and tana-edge.\n\n## Validation & Limits\n\nAll runtimes enforce:\n\n| Constraint | Value | Error |\n|------------|-------|-------|\n| Max key length | 512 bytes | \"KV key too long\" |\n| Max value size | 25 MB | \"KV value too large\" |\n| Max list() keys | 1000 | Silently limited |\n\nValidation happens in Rust ops before storage:\n\n```rust\nif key.len() > MAX_KV_KEY_LENGTH {\n    return Err(JsErrorBox::new(\"Error\",\n        format!(\"KV key too long: {} bytes (max {})\", key.len(), MAX_KV_KEY_LENGTH)\n    ));\n}\n\nif value.len() > MAX_KV_VALUE_SIZE {\n    return Err(JsErrorBox::new(\"Error\",\n        format!(\"KV value too large: {} bytes (max {})\", value.len(), MAX_KV_VALUE_SIZE)\n    ));\n}\n```\n\n## Type Definitions\n\n**Location:** `types/tana-kv.d.ts`\n\nProvides full TypeScript definitions with:\n- Method overloads for type inference\n- JSDoc documentation\n- Cloudflare Workers compatibility notes\n\nExample type inference:\n```typescript\n// TypeScript knows this returns string | null\nconst text = await kv.get('key')\n\n// TypeScript knows this returns any | null\nconst json = await kv.get('key', { type: 'json' })\n```\n\n## Performance Characteristics\n\n| Operation | Runtime | Edge | Playground |\n|-----------|---------|------|------------|\n| get() | 1-5ms | <0.1ms | <0.1ms |\n| put() | 2-10ms | <0.1ms | <0.1ms |\n| delete() | 1-5ms | <0.1ms | <0.1ms |\n| list(100) | 5-20ms | <1ms | <1ms |\n| list(1000) | 20-100ms | 1-5ms | 5-10ms |\n\n**Notes:**\n- Runtime: PostgreSQL network + query time\n- Edge: Pure in-memory HashMap lookups\n- Playground: localStorage DOM API overhead\n\n## Future Enhancements\n\n### Planned Features\n- â° **TTL Support** - Automatic expiration\n- ğŸ“Š **Metadata** - Custom key metadata\n- ğŸ“„ **Pagination** - Cursor-based list()\n- ğŸ”„ **Bulk Operations** - Batch get/put/delete\n- ğŸ” **Range Queries** - Key range scans\n\n### Implementation Notes\n\n**TTL (expirationTtl/expiration):**\n```sql\n-- PostgreSQL schema addition\nALTER TABLE kv_storage ADD COLUMN expires_at TIMESTAMP;\nCREATE INDEX idx_kv_expires ON kv_storage(expires_at) WHERE expires_at IS NOT NULL;\n```\n\n**Metadata:**\n```sql\nALTER TABLE kv_storage ADD COLUMN metadata JSONB;\n```\n\n**Pagination:**\n```typescript\n// Return cursor in list() results\nreturn {\n  keys: [...],\n  list_complete: false,\n  cursor: \"offset:1000\" // For next page\n}\n```\n\n## Testing\n\nRun KV storage tests:\n\n```bash\n# tana-runtime\n./target/release/tana-runtime examples/kv-test.ts\n\n# tana-edge\n./target/release/tana-edge\ncurl -X POST http://localhost:8082/test \\\n  -H \"Content-Type: text/plain\" \\\n  -d \"$(cat examples/kv-test.ts)\"\n\n# playground\n# Open browser, paste code from examples/kv-test.ts\n```\n\n## Common Issues\n\n**\"KV key too long\"**\n- Key exceeds 512 bytes\n- Solution: Use shorter keys or hash long identifiers\n\n**\"KV value too large\"**\n- Value exceeds 25 MB\n- Solution: Split large data across multiple keys\n\n**Namespace collision**\n- Different contracts trying to access same data\n- This is prevented by automatic namespacing\n\n**list() returns empty**\n- No keys match prefix\n- Check prefix syntax (no wildcards, exact string match)\n\n## Migration Guide\n\n### From tana/data to tana/kv\n\n```typescript\n// OLD: tana/data (synchronous)\nimport { data } from 'tana/data'\ndata.set('key', 'value')\nconst value = data.get('key')\n\n// NEW: tana/kv (async)\nimport { kv } from 'tana/kv'\nawait kv.put('key', 'value')\nconst value = await kv.get('key')\n```\n\n**Key differences:**\n- `kv.*` is async (returns Promises)\n- `kv.put()` auto-serializes objects\n- `kv.list()` provides structured results\n- `kv.get()` supports type hints\n\nBoth modules remain available. Use `tana/data` for simple synchronous storage, `tana/kv` for Cloudflare-compatible async patterns.\n",
    "html": "<p>Technical reference for the <code>tana/kv</code> module implementation across tana-runtime, tana-edge, and playground environments.</p>\n<h2 id=\"architecture-overview\">Architecture Overview</h2>\n<p>KV storage provides Cloudflare Workers-compatible key-value storage with automatic per-contract namespace isolation.</p>\n<h3 id=\"namespace-isolation\">Namespace Isolation</h3>\n<p>All keys are internally prefixed with the contract name:</p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Stored Key Format: \"{contract_name}:{user_key}\"</span></span>\n<span class=\"line\"><span>Example: \"my_contract:username\" â†’ \"alice\"</span></span></code></pre><p>This ensures contracts cannot access each other&#39;s data.</p>\n<h2 id=\"runtime-implementations\">Runtime Implementations</h2>\n<h3 id=\"tana-runtime-rust-cli\">tana-runtime (Rust CLI)</h3>\n<p><strong>Location:</strong> <code>runtime/src/tana_kv.rs</code>, <code>runtime/src/main.rs</code></p>\n<p><strong>Storage Backend:</strong> PostgreSQL (migration <code>0011_kv_storage.sql</code>)</p>\n<p><strong>Schema:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"sql\"></div>\n\n\n\n<p><strong>Rust Ops:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"rust\"></div>\n\n\n\n<p><strong>JavaScript Bridge:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Characteristics:</strong></p>\n<ul>\n<li>âœ… Persistent across restarts</li>\n<li>âœ… ACID transactions via PostgreSQL</li>\n<li>âœ… Production-ready</li>\n<li>ğŸ“Š Performance: ~1-5ms per operation</li>\n</ul>\n<hr>\n<h3 id=\"tana-edge-rust-http-server\">tana-edge (Rust HTTP Server)</h3>\n<p><strong>Location:</strong> <code>tana-edge/src/main.rs</code> (lines 41-49, 335-460, 1163-1196)</p>\n<p><strong>Storage Backend:</strong> In-memory HashMap (Redis-ready)</p>\n<p><strong>Data Structure:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"rust\"></div>\n\n\n\n<p><strong>Rust Ops:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"rust\"></div>\n\n\n\n<p><strong>JavaScript Bridge:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Characteristics:</strong></p>\n<ul>\n<li>âš¡ Very fast (in-memory)</li>\n<li>âŒ Not persistent (resets on restart)</li>\n<li>ğŸ”§ Development/testing use</li>\n<li>ğŸš€ Production: Replace with Redis backend</li>\n<li>ğŸ“Š Performance: &lt;0.1ms per operation</li>\n</ul>\n<hr>\n<h3 id=\"playground-browsertypescript\">playground (Browser/TypeScript)</h3>\n<p><strong>Location:</strong></p>\n<ul>\n<li><code>websites/playground/src/pages/sandbox.astro</code> (lines 691-811)</li>\n<li><code>websites/playground/src/components/Editor.svelte</code> (lines 277-318)</li>\n</ul>\n<p><strong>Storage Backend:</strong> Browser localStorage</p>\n<p><strong>Key Format:</strong></p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>localStorage Key: \"tana_kv_playground:playground_contract:{user_key}\"</span></span>\n<span class=\"line\"><span>Example: \"tana_kv_playground:playground_contract:username\"</span></span></code></pre><p><strong>Implementation:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Characteristics:</strong></p>\n<ul>\n<li>ğŸ’¾ Persistent per-browser</li>\n<li>ğŸš€ Instant execution</li>\n<li>ğŸ“ Limited to ~5-10MB total</li>\n<li>ğŸ§ª Great for experimentation</li>\n<li>ğŸ“Š Performance: &lt;0.1ms per operation</li>\n</ul>\n<h2 id=\"api-consistency\">API Consistency</h2>\n<p>All three runtimes implement identical JavaScript API:</p>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"typescript\"></div>\n\n\n\n<p>This ensures contracts are <strong>portable</strong> - code written in playground works identically in tana-runtime and tana-edge.</p>\n<h2 id=\"validation--limits\">Validation &amp; Limits</h2>\n<p>All runtimes enforce:</p>\n<table>\n<thead>\n<tr>\n<th>Constraint</th>\n<th>Value</th>\n<th>Error</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Max key length</td>\n<td>512 bytes</td>\n<td>&quot;KV key too long&quot;</td>\n</tr>\n<tr>\n<td>Max value size</td>\n<td>25 MB</td>\n<td>&quot;KV value too large&quot;</td>\n</tr>\n<tr>\n<td>Max list() keys</td>\n<td>1000</td>\n<td>Silently limited</td>\n</tr>\n</tbody></table>\n<p>Validation happens in Rust ops before storage:</p>\n<div class=\"code-block-placeholder\" data-index=\"8\" data-lang=\"rust\"></div>\n\n\n\n<h2 id=\"type-definitions\">Type Definitions</h2>\n<p><strong>Location:</strong> <code>types/tana-kv.d.ts</code></p>\n<p>Provides full TypeScript definitions with:</p>\n<ul>\n<li>Method overloads for type inference</li>\n<li>JSDoc documentation</li>\n<li>Cloudflare Workers compatibility notes</li>\n</ul>\n<p>Example type inference:</p>\n<div class=\"code-block-placeholder\" data-index=\"9\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"performance-characteristics\">Performance Characteristics</h2>\n<table>\n<thead>\n<tr>\n<th>Operation</th>\n<th>Runtime</th>\n<th>Edge</th>\n<th>Playground</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>get()</td>\n<td>1-5ms</td>\n<td>&lt;0.1ms</td>\n<td>&lt;0.1ms</td>\n</tr>\n<tr>\n<td>put()</td>\n<td>2-10ms</td>\n<td>&lt;0.1ms</td>\n<td>&lt;0.1ms</td>\n</tr>\n<tr>\n<td>delete()</td>\n<td>1-5ms</td>\n<td>&lt;0.1ms</td>\n<td>&lt;0.1ms</td>\n</tr>\n<tr>\n<td>list(100)</td>\n<td>5-20ms</td>\n<td>&lt;1ms</td>\n<td>&lt;1ms</td>\n</tr>\n<tr>\n<td>list(1000)</td>\n<td>20-100ms</td>\n<td>1-5ms</td>\n<td>5-10ms</td>\n</tr>\n</tbody></table>\n<p><strong>Notes:</strong></p>\n<ul>\n<li>Runtime: PostgreSQL network + query time</li>\n<li>Edge: Pure in-memory HashMap lookups</li>\n<li>Playground: localStorage DOM API overhead</li>\n</ul>\n<h2 id=\"future-enhancements\">Future Enhancements</h2>\n<h3 id=\"planned-features\">Planned Features</h3>\n<ul>\n<li>â° <strong>TTL Support</strong> - Automatic expiration</li>\n<li>ğŸ“Š <strong>Metadata</strong> - Custom key metadata</li>\n<li>ğŸ“„ <strong>Pagination</strong> - Cursor-based list()</li>\n<li>ğŸ”„ <strong>Bulk Operations</strong> - Batch get/put/delete</li>\n<li>ğŸ” <strong>Range Queries</strong> - Key range scans</li>\n</ul>\n<h3 id=\"implementation-notes\">Implementation Notes</h3>\n<p><strong>TTL (expirationTtl/expiration):</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"10\" data-lang=\"sql\"></div>\n\n\n\n<p><strong>Metadata:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"11\" data-lang=\"sql\"></div>\n\n\n\n<p><strong>Pagination:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"12\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"testing\">Testing</h2>\n<p>Run KV storage tests:</p>\n<div class=\"code-block-placeholder\" data-index=\"13\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"common-issues\">Common Issues</h2>\n<p><strong>&quot;KV key too long&quot;</strong></p>\n<ul>\n<li>Key exceeds 512 bytes</li>\n<li>Solution: Use shorter keys or hash long identifiers</li>\n</ul>\n<p><strong>&quot;KV value too large&quot;</strong></p>\n<ul>\n<li>Value exceeds 25 MB</li>\n<li>Solution: Split large data across multiple keys</li>\n</ul>\n<p><strong>Namespace collision</strong></p>\n<ul>\n<li>Different contracts trying to access same data</li>\n<li>This is prevented by automatic namespacing</li>\n</ul>\n<p><strong>list() returns empty</strong></p>\n<ul>\n<li>No keys match prefix</li>\n<li>Check prefix syntax (no wildcards, exact string match)</li>\n</ul>\n<h2 id=\"migration-guide\">Migration Guide</h2>\n<h3 id=\"from-tanadata-to-tanakv\">From tana/data to tana/kv</h3>\n<div class=\"code-block-placeholder\" data-index=\"14\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Key differences:</strong></p>\n<ul>\n<li><code>kv.*</code> is async (returns Promises)</li>\n<li><code>kv.put()</code> auto-serializes objects</li>\n<li><code>kv.list()</code> provides structured results</li>\n<li><code>kv.get()</code> supports type hints</li>\n</ul>\n<p>Both modules remain available. Use <code>tana/data</code> for simple synchronous storage, <code>tana/kv</code> for Cloudflare-compatible async patterns.</p>\n",
    "codeBlocks": [
      {
        "lang": "sql",
        "code": "CREATE TABLE kv_storage (\n  contract_name TEXT NOT NULL,\n  key TEXT NOT NULL,\n  value TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (contract_name, key)\n);"
      },
      {
        "lang": "rust",
        "code": "#[op2]\n#[string]\nfn op_kv_get_raw(\n    state: &OpState,\n    #[string] key: String,\n) -> Result<Option<String>, JsErrorBox>\n\n#[op2(fast)]\nfn op_kv_put_raw(\n    state: &OpState,\n    #[string] key: String,\n    #[string] value: String,\n) -> Result<(), JsErrorBox>\n\n#[op2(fast)]\nfn op_kv_delete_raw(\n    state: &OpState,\n    #[string] key: String,\n) -> Result<(), JsErrorBox>\n\n#[op2]\n#[serde]\nfn op_kv_list_keys(\n    state: &OpState,\n    #[string] prefix: Option<String>,\n    #[serde] limit: Option<usize>,\n) -> Result<Vec<String>, JsErrorBox>"
      },
      {
        "lang": "typescript",
        "code": "// Uses context.contract_name() from OpState\nconst contractName = globalThis.__tanaCore.ops.op_context_contract_name()\nglobalThis.__tanaCore.ops.op_kv_get_raw(key) // Automatically namespaced"
      },
      {
        "lang": "rust",
        "code": "static KV_STORAGE: Mutex<Option<HashMap<String, String>>> = Mutex::new(None);"
      },
      {
        "lang": "rust",
        "code": "// Same signatures as tana-runtime, but contract_name passed as parameter\n#[op2]\n#[string]\nfn op_kv_get_raw(\n    #[string] contract_name: String,\n    #[string] key: String,\n) -> Result<Option<String>, JsErrorBox>\n\n// ... put, delete, list ops similar"
      },
      {
        "lang": "typescript",
        "code": "// Hardcoded contract name for development\nconst contractName = \"edge_contract\"\nconst rawValue = globalThis.__tanaCore.ops.op_kv_get_raw(contractName, key)"
      },
      {
        "lang": "typescript",
        "code": "const kv = {\n  async get(key: string, options?: KVGetOptions) {\n    const storageKey = `tana_kv_playground:playground_contract:${key}`\n    const value = localStorage.getItem(storageKey)\n    if (!value) return null\n\n    const type = options?.type || 'text'\n    return type === 'json' ? JSON.parse(value) : value\n  },\n\n  async put(key: string, value: string | object) {\n    const storageKey = `tana_kv_playground:playground_contract:${key}`\n    const serialized = typeof value === 'string' ? value : JSON.stringify(value)\n    localStorage.setItem(storageKey, serialized)\n  },\n\n  async delete(key: string) {\n    const storageKey = `tana_kv_playground:playground_contract:${key}`\n    localStorage.removeItem(storageKey)\n  },\n\n  async list(options?: KVListOptions): Promise<KVListResult> {\n    const prefix = `tana_kv_playground:playground_contract:${options?.prefix || ''}`\n    const limit = options?.limit || 1000\n    const keys: string[] = []\n\n    for (let i = 0; i < localStorage.length; i++) {\n      const fullKey = localStorage.key(i)\n      if (fullKey?.startsWith(prefix)) {\n        const userKey = fullKey.replace('tana_kv_playground:playground_contract:', '')\n        keys.push(userKey)\n        if (keys.length >= limit) break\n      }\n    }\n\n    keys.sort()\n    return {\n      keys: keys.map(name => ({ name })),\n      list_complete: true,\n      cursor: null\n    }\n  }\n}"
      },
      {
        "lang": "typescript",
        "code": "interface KV {\n  get(key: string, options?: { type?: 'text' | 'json' }): Promise<string | object | null>\n  put(key: string, value: string | object, options?: KVPutOptions): Promise<void>\n  delete(key: string): Promise<void>\n  list(options?: { prefix?: string, limit?: number }): Promise<KVListResult>\n}"
      },
      {
        "lang": "rust",
        "code": "if key.len() > MAX_KV_KEY_LENGTH {\n    return Err(JsErrorBox::new(\"Error\",\n        format!(\"KV key too long: {} bytes (max {})\", key.len(), MAX_KV_KEY_LENGTH)\n    ));\n}\n\nif value.len() > MAX_KV_VALUE_SIZE {\n    return Err(JsErrorBox::new(\"Error\",\n        format!(\"KV value too large: {} bytes (max {})\", value.len(), MAX_KV_VALUE_SIZE)\n    ));\n}"
      },
      {
        "lang": "typescript",
        "code": "// TypeScript knows this returns string | null\nconst text = await kv.get('key')\n\n// TypeScript knows this returns any | null\nconst json = await kv.get('key', { type: 'json' })"
      },
      {
        "lang": "sql",
        "code": "-- PostgreSQL schema addition\nALTER TABLE kv_storage ADD COLUMN expires_at TIMESTAMP;\nCREATE INDEX idx_kv_expires ON kv_storage(expires_at) WHERE expires_at IS NOT NULL;"
      },
      {
        "lang": "sql",
        "code": "ALTER TABLE kv_storage ADD COLUMN metadata JSONB;"
      },
      {
        "lang": "typescript",
        "code": "// Return cursor in list() results\nreturn {\n  keys: [...],\n  list_complete: false,\n  cursor: \"offset:1000\" // For next page\n}"
      },
      {
        "lang": "bash",
        "code": "# tana-runtime\n./target/release/tana-runtime examples/kv-test.ts\n\n# tana-edge\n./target/release/tana-edge\ncurl -X POST http://localhost:8082/test \\\n  -H \"Content-Type: text/plain\" \\\n  -d \"$(cat examples/kv-test.ts)\"\n\n# playground\n# Open browser, paste code from examples/kv-test.ts"
      },
      {
        "lang": "typescript",
        "code": "// OLD: tana/data (synchronous)\nimport { data } from 'tana/data'\ndata.set('key', 'value')\nconst value = data.get('key')\n\n// NEW: tana/kv (async)\nimport { kv } from 'tana/kv'\nawait kv.put('key', 'value')\nconst value = await kv.get('key')"
      }
    ],
    "tableOfContents": [
      {
        "id": "architecture-overview",
        "text": "Architecture Overview",
        "level": 2
      },
      {
        "id": "namespace-isolation",
        "text": "Namespace Isolation",
        "level": 3
      },
      {
        "id": "runtime-implementations",
        "text": "Runtime Implementations",
        "level": 2
      },
      {
        "id": "tana-runtime-rust-cli",
        "text": "tana-runtime (Rust CLI)",
        "level": 3
      },
      {
        "id": "tana-edge-rust-http-server",
        "text": "tana-edge (Rust HTTP Server)",
        "level": 3
      },
      {
        "id": "playground-browsertypescript",
        "text": "playground (Browser/TypeScript)",
        "level": 3
      },
      {
        "id": "api-consistency",
        "text": "API Consistency",
        "level": 2
      },
      {
        "id": "validation-limits",
        "text": "Validation & Limits",
        "level": 2
      },
      {
        "id": "type-definitions",
        "text": "Type Definitions",
        "level": 2
      },
      {
        "id": "performance-characteristics",
        "text": "Performance Characteristics",
        "level": 2
      },
      {
        "id": "future-enhancements",
        "text": "Future Enhancements",
        "level": 2
      },
      {
        "id": "planned-features",
        "text": "Planned Features",
        "level": 3
      },
      {
        "id": "implementation-notes",
        "text": "Implementation Notes",
        "level": 3
      },
      {
        "id": "testing",
        "text": "Testing",
        "level": 2
      },
      {
        "id": "common-issues",
        "text": "Common Issues",
        "level": 2
      },
      {
        "id": "migration-guide",
        "text": "Migration Guide",
        "level": 2
      },
      {
        "id": "from-tanadata-to-tanakv",
        "text": "From tana/data to tana/kv",
        "level": 3
      }
    ]
  },
  {
    "slug": [
      "contributing",
      "smart-contracts"
    ],
    "metadata": {
      "title": "Smart Contracts",
      "description": "Learn to write TypeScript smart contracts for Tana",
      "sidebar": {
        "order": 3
      }
    },
    "content": "\nTana smart contracts are TypeScript files that export up to 4 functions: `init()`, `contract()`, `get()`, and `post()`. All functions must return JSON-serializable objects.\n\n## Quick Start\n\n### 1. Scaffold a Contract\n\n```bash\ntana new contract mycontract\n```\n\nThis creates two files:\n- `contract.ts` - Your contract code\n- `contract.json` - Contract metadata\n\n### 2. Edit Your Contract\n\n```typescript\n// contract.ts\nimport { console } from 'tana:core'\nimport { block } from 'tana:block'\nimport { kv } from 'tana:kv'\nimport { context } from 'tana:context'\n\n// On-chain execution (called via transactions)\nexport function contract() {\n  const caller = context.caller()\n  const owner = context.owner()\n\n  if (!caller || caller.id !== owner.id) {\n    return { error: 'Unauthorized: owner only' }\n  }\n\n  return { success: true, caller: caller.username }\n}\n\n// HTTP GET handler (served by tana-edge)\nexport function get() {\n  return {\n    message: 'Hello from Tana!',\n    timestamp: Date.now()\n  }\n}\n```\n\n### 3. Test Locally\n\n```bash\ntana run contract.ts\n```\n\n### 4. Deploy\n\n```bash\ntana deploy contract contract.ts\n```\n\n## Contract Structure\n\nEvery contract exports up to 4 functions. None are strictly required - export only what you need.\n\n| Function | Runs When | Writes Allowed | Context |\n|----------|-----------|----------------|---------|\n| `init()` | Contract deployment | âœ… Yes | `context.owner()`, `context.block()` |\n| `contract()` | Transaction execution | âœ… Yes | `context.owner()`, `context.caller()`, `context.block()`, `context.input()` |\n| `get()` | HTTP GET request | âŒ Read-only | Basic request info |\n| `post()` | HTTP POST request | âŒ Read-only | Basic request info + body |\n\n### init() - Deployment Hook\n\nRuns **once** when the contract is deployed. Use for initial setup.\n\n```typescript\nimport { context } from 'tana:context'\nimport { kv } from 'tana:kv'\n\nexport function init() {\n  const owner = context.owner()\n  const block = context.block()\n\n  // Store deployment info\n  await kv.put('owner_id', owner.id)\n  await kv.put('deployed_at', String(block.timestamp))\n\n  return {\n    initialized: true,\n    owner: owner.username,\n    block: block.height\n  }\n}\n```\n\n### contract() - On-Chain Logic\n\nRuns when users call your contract via blockchain transactions. This is where state changes happen.\n\n```typescript\nimport { context } from 'tana:context'\nimport { kv } from 'tana:kv'\n\nexport async function contract() {\n  const caller = context.caller()\n  const owner = context.owner()\n  const input = context.input()\n\n  // Only owner can execute\n  if (!caller || caller.id !== owner.id) {\n    return { error: 'Unauthorized' }\n  }\n\n  // Read and update state\n  const count = await kv.get('count') || '0'\n  await kv.put('count', String(parseInt(count) + 1))\n\n  return {\n    success: true,\n    count: parseInt(count) + 1,\n    caller: caller.username\n  }\n}\n```\n\n### get() - HTTP Read Endpoint\n\nHandles HTTP GET requests via tana-edge. **Read-only** - cannot modify state.\n\n```typescript\nimport { kv } from 'tana:kv'\n\nexport async function get() {\n  // Read state\n  const count = await kv.get('count') || '0'\n\n  return {\n    count: parseInt(count),\n    timestamp: Date.now()\n  }\n}\n```\n\n### post() - HTTP Write Endpoint\n\nHandles HTTP POST requests via tana-edge. **Read-only** - cannot modify state directly.\n\n```typescript\nexport function post(body: any) {\n  // Validate input\n  if (!body.name) {\n    return { error: 'Name is required' }\n  }\n\n  // Return response (cannot write to KV here)\n  return {\n    received: body,\n    message: `Hello, ${body.name}!`\n  }\n}\n```\n\n> **Note:** Even `post()` handlers cannot write to KV storage. State changes must happen through blockchain transactions (`contract()` function).\n\n## Available Modules\n\n### tana:core - Logging\n\n```typescript\nimport { console } from 'tana:core'\n\nconsole.log('Debug message')\nconsole.error('Error message')\n```\n\n### tana:kv - Key-Value Storage\n\nCloudflare Workers-compatible KV storage. Each contract has isolated storage.\n\n```typescript\nimport { kv } from 'tana:kv'\n\n// Store values\nawait kv.put('username', 'alice')\nawait kv.put('user', { name: 'Alice', balance: 1000 })\n\n// Read values\nconst username = await kv.get('username')  // 'alice'\nconst user = await kv.get('user', { type: 'json' })  // { name: 'Alice', ... }\n\n// List keys\nconst result = await kv.list({ prefix: 'user:' })\nconsole.log(result.keys)  // [{ name: 'user:1' }, { name: 'user:2' }]\n\n// Delete\nawait kv.delete('username')\n```\n\n### tana:context - Execution Context\n\nAvailable in `init()` and `contract()` functions only.\n\n```typescript\nimport { context } from 'tana:context'\n\n// Who deployed the contract\nconst owner = context.owner()\n// { id: 'usr_...', username: 'alice', publicKey: '...' }\n\n// Who is calling (null in init())\nconst caller = context.caller()\n// { id: 'usr_...', username: 'bob', publicKey: '...', nonce: 1 }\n\n// Current block info\nconst block = context.block()\n// { height: 12345, timestamp: 1700000000, hash: '0x...', producer: 'usr_...' }\n\n// Transaction input (null in init())\nconst input = context.input()\n// { action: 'transfer', amount: 100 }\n```\n\n### tana:block - Blockchain Queries\n\nQuery blockchain state from any function.\n\n```typescript\nimport { block } from 'tana:block'\n\n// Current block info\nconst height = block.height\nconst timestamp = block.timestamp\nconst hash = block.hash\n\n// Query users\nconst user = await block.getUser('usr_abc123')\nconst users = await block.getUser(['usr_1', 'usr_2'])  // Batch query\n\n// Query balances\nconst balance = await block.getBalance('usr_abc123', 'USD')\n\n// Query transactions\nconst tx = await block.getTransaction('tx_xyz789')\n```\n\n### tana:tx - Transaction Creation\n\nStage transactions for execution.\n\n```typescript\nimport { tx } from 'tana:tx'\n\n// Transfer funds\ntx.transfer('usr_from', 'usr_to', 100, 'USD')\n\n// Set balance directly (privileged)\ntx.setBalance('usr_id', 1000, 'USD')\n\n// Execute staged transactions\nconst result = await tx.execute()\n// { success: true, changes: [...], gasUsed: 100 }\n```\n\n### tana:utils - External HTTP\n\nMake HTTP requests to whitelisted domains.\n\n```typescript\nimport { fetch } from 'tana:utils'\n\nconst response = await fetch('https://api.example.com/data')\nconst json = await response.json()\n```\n\n> **Note:** Only whitelisted domains are allowed. See [Security](#security) for details.\n\n## Import Syntax\n\nBoth import styles work:\n\n```typescript\n// Colon style (recommended)\nimport { kv } from 'tana:kv'\nimport { console } from 'tana:core'\n\n// Slash style (also works)\nimport { kv } from 'tana/kv'\nimport { console } from 'tana/core'\n```\n\n## Return Values\n\n**All functions must return JSON-serializable objects.**\n\n```typescript\n// âœ… Valid returns\nreturn { success: true }\nreturn { items: [1, 2, 3], count: 3 }\nreturn { user: { name: 'Alice', age: 30 } }\nreturn { value: null }\n\n// âŒ Invalid returns\nreturn 'string'           // Must be object\nreturn 42                 // Must be object\nreturn undefined          // Use { value: null }\nreturn { fn: () => {} }   // No functions\nreturn { date: new Date() }  // Use timestamps\n```\n\n## Authorization Patterns\n\n### Owner-Only Access\n\n```typescript\nexport function contract() {\n  const caller = context.caller()\n  const owner = context.owner()\n\n  if (!caller || caller.id !== owner.id) {\n    return { error: 'Unauthorized: owner only' }\n  }\n\n  // Owner-only logic here\n  return { success: true }\n}\n```\n\n### Role-Based Access\n\n```typescript\nexport async function contract() {\n  const caller = context.caller()\n  if (!caller) {\n    return { error: 'Authentication required' }\n  }\n\n  // Check user role from blockchain\n  const user = await block.getUser(caller.id)\n  if (user?.role !== 'staff' && user?.role !== 'sovereign') {\n    return { error: 'Staff access required' }\n  }\n\n  return { success: true }\n}\n```\n\n## Security\n\n### Sandboxed Execution\n\nContracts run in isolated V8 sandboxes:\n- No filesystem access\n- No system calls\n- Limited network (whitelisted domains only)\n- Memory limits enforced\n- Gas metering (limits computation)\n\n### Network Whitelist\n\nExternal `fetch()` is limited to:\n- `tana.dev` and subdomains\n- `localhost` (development only)\n- Additional domains as configured\n\n### Transaction Signing\n\nAll contract deployments and calls require Ed25519 signatures:\n- Owner tracked on-chain\n- Replay protection via nonces\n- Timestamp validation\n\n## Testing\n\n### Local Testing\n\n```bash\n# Test contract execution\ntana run contract.ts\n\n# Check system health\ntana test\n```\n\n### HTTP Testing\n\nAfter deployment, test HTTP handlers:\n\n```bash\n# GET request\ncurl http://localhost:8180/mycontract\n\n# POST request\ncurl -X POST http://localhost:8180/mycontract \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"Alice\"}'\n```\n\n## Next Steps\n\n- [KV Storage Guide](/docs/guides/kv-storage) - Advanced storage patterns\n- [CLI Commands](/docs/tana-cli/commands) - All CLI options\n- [API Reference](/docs/tana-api/intro) - REST API endpoints\n",
    "html": "<p>Tana smart contracts are TypeScript files that export up to 4 functions: <code>init()</code>, <code>contract()</code>, <code>get()</code>, and <code>post()</code>. All functions must return JSON-serializable objects.</p>\n<h2 id=\"quick-start\">Quick Start</h2>\n<h3 id=\"1-scaffold-a-contract\">1. Scaffold a Contract</h3>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<p>This creates two files:</p>\n<ul>\n<li><code>contract.ts</code> - Your contract code</li>\n<li><code>contract.json</code> - Contract metadata</li>\n</ul>\n<h3 id=\"2-edit-your-contract\">2. Edit Your Contract</h3>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"3-test-locally\">3. Test Locally</h3>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"4-deploy\">4. Deploy</h3>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"contract-structure\">Contract Structure</h2>\n<p>Every contract exports up to 4 functions. None are strictly required - export only what you need.</p>\n<table>\n<thead>\n<tr>\n<th>Function</th>\n<th>Runs When</th>\n<th>Writes Allowed</th>\n<th>Context</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>init()</code></td>\n<td>Contract deployment</td>\n<td>âœ… Yes</td>\n<td><code>context.owner()</code>, <code>context.block()</code></td>\n</tr>\n<tr>\n<td><code>contract()</code></td>\n<td>Transaction execution</td>\n<td>âœ… Yes</td>\n<td><code>context.owner()</code>, <code>context.caller()</code>, <code>context.block()</code>, <code>context.input()</code></td>\n</tr>\n<tr>\n<td><code>get()</code></td>\n<td>HTTP GET request</td>\n<td>âŒ Read-only</td>\n<td>Basic request info</td>\n</tr>\n<tr>\n<td><code>post()</code></td>\n<td>HTTP POST request</td>\n<td>âŒ Read-only</td>\n<td>Basic request info + body</td>\n</tr>\n</tbody></table>\n<h3 id=\"init---deployment-hook\">init() - Deployment Hook</h3>\n<p>Runs <strong>once</strong> when the contract is deployed. Use for initial setup.</p>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"contract---on-chain-logic\">contract() - On-Chain Logic</h3>\n<p>Runs when users call your contract via blockchain transactions. This is where state changes happen.</p>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"get---http-read-endpoint\">get() - HTTP Read Endpoint</h3>\n<p>Handles HTTP GET requests via tana-edge. <strong>Read-only</strong> - cannot modify state.</p>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"post---http-write-endpoint\">post() - HTTP Write Endpoint</h3>\n<p>Handles HTTP POST requests via tana-edge. <strong>Read-only</strong> - cannot modify state directly.</p>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"typescript\"></div>\n\n\n\n<blockquote>\n<p><strong>Note:</strong> Even <code>post()</code> handlers cannot write to KV storage. State changes must happen through blockchain transactions (<code>contract()</code> function).</p>\n</blockquote>\n<h2 id=\"available-modules\">Available Modules</h2>\n<h3 id=\"tanacore---logging\">tana:core - Logging</h3>\n<div class=\"code-block-placeholder\" data-index=\"8\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"tanakv---key-value-storage\">tana:kv - Key-Value Storage</h3>\n<p>Cloudflare Workers-compatible KV storage. Each contract has isolated storage.</p>\n<div class=\"code-block-placeholder\" data-index=\"9\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"tanacontext---execution-context\">tana:context - Execution Context</h3>\n<p>Available in <code>init()</code> and <code>contract()</code> functions only.</p>\n<div class=\"code-block-placeholder\" data-index=\"10\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"tanablock---blockchain-queries\">tana:block - Blockchain Queries</h3>\n<p>Query blockchain state from any function.</p>\n<div class=\"code-block-placeholder\" data-index=\"11\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"tanatx---transaction-creation\">tana:tx - Transaction Creation</h3>\n<p>Stage transactions for execution.</p>\n<div class=\"code-block-placeholder\" data-index=\"12\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"tanautils---external-http\">tana:utils - External HTTP</h3>\n<p>Make HTTP requests to whitelisted domains.</p>\n<div class=\"code-block-placeholder\" data-index=\"13\" data-lang=\"typescript\"></div>\n\n\n\n<blockquote>\n<p><strong>Note:</strong> Only whitelisted domains are allowed. See <a href=\"#security\">Security</a> for details.</p>\n</blockquote>\n<h2 id=\"import-syntax\">Import Syntax</h2>\n<p>Both import styles work:</p>\n<div class=\"code-block-placeholder\" data-index=\"14\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"return-values\">Return Values</h2>\n<p><strong>All functions must return JSON-serializable objects.</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"15\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"authorization-patterns\">Authorization Patterns</h2>\n<h3 id=\"owner-only-access\">Owner-Only Access</h3>\n<div class=\"code-block-placeholder\" data-index=\"16\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"role-based-access\">Role-Based Access</h3>\n<div class=\"code-block-placeholder\" data-index=\"17\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"security\">Security</h2>\n<h3 id=\"sandboxed-execution\">Sandboxed Execution</h3>\n<p>Contracts run in isolated V8 sandboxes:</p>\n<ul>\n<li>No filesystem access</li>\n<li>No system calls</li>\n<li>Limited network (whitelisted domains only)</li>\n<li>Memory limits enforced</li>\n<li>Gas metering (limits computation)</li>\n</ul>\n<h3 id=\"network-whitelist\">Network Whitelist</h3>\n<p>External <code>fetch()</code> is limited to:</p>\n<ul>\n<li><code>tana.dev</code> and subdomains</li>\n<li><code>localhost</code> (development only)</li>\n<li>Additional domains as configured</li>\n</ul>\n<h3 id=\"transaction-signing\">Transaction Signing</h3>\n<p>All contract deployments and calls require Ed25519 signatures:</p>\n<ul>\n<li>Owner tracked on-chain</li>\n<li>Replay protection via nonces</li>\n<li>Timestamp validation</li>\n</ul>\n<h2 id=\"testing\">Testing</h2>\n<h3 id=\"local-testing\">Local Testing</h3>\n<div class=\"code-block-placeholder\" data-index=\"18\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"http-testing\">HTTP Testing</h3>\n<p>After deployment, test HTTP handlers:</p>\n<div class=\"code-block-placeholder\" data-index=\"19\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/docs/guides/kv-storage\">KV Storage Guide</a> - Advanced storage patterns</li>\n<li><a href=\"/docs/tana-cli/commands\">CLI Commands</a> - All CLI options</li>\n<li><a href=\"/docs/tana-api/intro\">API Reference</a> - REST API endpoints</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "tana new contract mycontract"
      },
      {
        "lang": "typescript",
        "code": "// contract.ts\nimport { console } from 'tana:core'\nimport { block } from 'tana:block'\nimport { kv } from 'tana:kv'\nimport { context } from 'tana:context'\n\n// On-chain execution (called via transactions)\nexport function contract() {\n  const caller = context.caller()\n  const owner = context.owner()\n\n  if (!caller || caller.id !== owner.id) {\n    return { error: 'Unauthorized: owner only' }\n  }\n\n  return { success: true, caller: caller.username }\n}\n\n// HTTP GET handler (served by tana-edge)\nexport function get() {\n  return {\n    message: 'Hello from Tana!',\n    timestamp: Date.now()\n  }\n}"
      },
      {
        "lang": "bash",
        "code": "tana run contract.ts"
      },
      {
        "lang": "bash",
        "code": "tana deploy contract contract.ts"
      },
      {
        "lang": "typescript",
        "code": "import { context } from 'tana:context'\nimport { kv } from 'tana:kv'\n\nexport function init() {\n  const owner = context.owner()\n  const block = context.block()\n\n  // Store deployment info\n  await kv.put('owner_id', owner.id)\n  await kv.put('deployed_at', String(block.timestamp))\n\n  return {\n    initialized: true,\n    owner: owner.username,\n    block: block.height\n  }\n}"
      },
      {
        "lang": "typescript",
        "code": "import { context } from 'tana:context'\nimport { kv } from 'tana:kv'\n\nexport async function contract() {\n  const caller = context.caller()\n  const owner = context.owner()\n  const input = context.input()\n\n  // Only owner can execute\n  if (!caller || caller.id !== owner.id) {\n    return { error: 'Unauthorized' }\n  }\n\n  // Read and update state\n  const count = await kv.get('count') || '0'\n  await kv.put('count', String(parseInt(count) + 1))\n\n  return {\n    success: true,\n    count: parseInt(count) + 1,\n    caller: caller.username\n  }\n}"
      },
      {
        "lang": "typescript",
        "code": "import { kv } from 'tana:kv'\n\nexport async function get() {\n  // Read state\n  const count = await kv.get('count') || '0'\n\n  return {\n    count: parseInt(count),\n    timestamp: Date.now()\n  }\n}"
      },
      {
        "lang": "typescript",
        "code": "export function post(body: any) {\n  // Validate input\n  if (!body.name) {\n    return { error: 'Name is required' }\n  }\n\n  // Return response (cannot write to KV here)\n  return {\n    received: body,\n    message: `Hello, ${body.name}!`\n  }\n}"
      },
      {
        "lang": "typescript",
        "code": "import { console } from 'tana:core'\n\nconsole.log('Debug message')\nconsole.error('Error message')"
      },
      {
        "lang": "typescript",
        "code": "import { kv } from 'tana:kv'\n\n// Store values\nawait kv.put('username', 'alice')\nawait kv.put('user', { name: 'Alice', balance: 1000 })\n\n// Read values\nconst username = await kv.get('username')  // 'alice'\nconst user = await kv.get('user', { type: 'json' })  // { name: 'Alice', ... }\n\n// List keys\nconst result = await kv.list({ prefix: 'user:' })\nconsole.log(result.keys)  // [{ name: 'user:1' }, { name: 'user:2' }]\n\n// Delete\nawait kv.delete('username')"
      },
      {
        "lang": "typescript",
        "code": "import { context } from 'tana:context'\n\n// Who deployed the contract\nconst owner = context.owner()\n// { id: 'usr_...', username: 'alice', publicKey: '...' }\n\n// Who is calling (null in init())\nconst caller = context.caller()\n// { id: 'usr_...', username: 'bob', publicKey: '...', nonce: 1 }\n\n// Current block info\nconst block = context.block()\n// { height: 12345, timestamp: 1700000000, hash: '0x...', producer: 'usr_...' }\n\n// Transaction input (null in init())\nconst input = context.input()\n// { action: 'transfer', amount: 100 }"
      },
      {
        "lang": "typescript",
        "code": "import { block } from 'tana:block'\n\n// Current block info\nconst height = block.height\nconst timestamp = block.timestamp\nconst hash = block.hash\n\n// Query users\nconst user = await block.getUser('usr_abc123')\nconst users = await block.getUser(['usr_1', 'usr_2'])  // Batch query\n\n// Query balances\nconst balance = await block.getBalance('usr_abc123', 'USD')\n\n// Query transactions\nconst tx = await block.getTransaction('tx_xyz789')"
      },
      {
        "lang": "typescript",
        "code": "import { tx } from 'tana:tx'\n\n// Transfer funds\ntx.transfer('usr_from', 'usr_to', 100, 'USD')\n\n// Set balance directly (privileged)\ntx.setBalance('usr_id', 1000, 'USD')\n\n// Execute staged transactions\nconst result = await tx.execute()\n// { success: true, changes: [...], gasUsed: 100 }"
      },
      {
        "lang": "typescript",
        "code": "import { fetch } from 'tana:utils'\n\nconst response = await fetch('https://api.example.com/data')\nconst json = await response.json()"
      },
      {
        "lang": "typescript",
        "code": "// Colon style (recommended)\nimport { kv } from 'tana:kv'\nimport { console } from 'tana:core'\n\n// Slash style (also works)\nimport { kv } from 'tana/kv'\nimport { console } from 'tana/core'"
      },
      {
        "lang": "typescript",
        "code": "// âœ… Valid returns\nreturn { success: true }\nreturn { items: [1, 2, 3], count: 3 }\nreturn { user: { name: 'Alice', age: 30 } }\nreturn { value: null }\n\n// âŒ Invalid returns\nreturn 'string'           // Must be object\nreturn 42                 // Must be object\nreturn undefined          // Use { value: null }\nreturn { fn: () => {} }   // No functions\nreturn { date: new Date() }  // Use timestamps"
      },
      {
        "lang": "typescript",
        "code": "export function contract() {\n  const caller = context.caller()\n  const owner = context.owner()\n\n  if (!caller || caller.id !== owner.id) {\n    return { error: 'Unauthorized: owner only' }\n  }\n\n  // Owner-only logic here\n  return { success: true }\n}"
      },
      {
        "lang": "typescript",
        "code": "export async function contract() {\n  const caller = context.caller()\n  if (!caller) {\n    return { error: 'Authentication required' }\n  }\n\n  // Check user role from blockchain\n  const user = await block.getUser(caller.id)\n  if (user?.role !== 'staff' && user?.role !== 'sovereign') {\n    return { error: 'Staff access required' }\n  }\n\n  return { success: true }\n}"
      },
      {
        "lang": "bash",
        "code": "# Test contract execution\ntana run contract.ts\n\n# Check system health\ntana test"
      },
      {
        "lang": "bash",
        "code": "# GET request\ncurl http://localhost:8180/mycontract\n\n# POST request\ncurl -X POST http://localhost:8180/mycontract \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"Alice\"}'"
      }
    ],
    "tableOfContents": [
      {
        "id": "quick-start",
        "text": "Quick Start",
        "level": 2
      },
      {
        "id": "1-scaffold-a-contract",
        "text": "1. Scaffold a Contract",
        "level": 3
      },
      {
        "id": "2-edit-your-contract",
        "text": "2. Edit Your Contract",
        "level": 3
      },
      {
        "id": "3-test-locally",
        "text": "3. Test Locally",
        "level": 3
      },
      {
        "id": "4-deploy",
        "text": "4. Deploy",
        "level": 3
      },
      {
        "id": "contract-structure",
        "text": "Contract Structure",
        "level": 2
      },
      {
        "id": "init---deployment-hook",
        "text": "init() - Deployment Hook",
        "level": 3
      },
      {
        "id": "contract---on-chain-logic",
        "text": "contract() - On-Chain Logic",
        "level": 3
      },
      {
        "id": "get---http-read-endpoint",
        "text": "get() - HTTP Read Endpoint",
        "level": 3
      },
      {
        "id": "post---http-write-endpoint",
        "text": "post() - HTTP Write Endpoint",
        "level": 3
      },
      {
        "id": "available-modules",
        "text": "Available Modules",
        "level": 2
      },
      {
        "id": "tanacore---logging",
        "text": "tana:core - Logging",
        "level": 3
      },
      {
        "id": "tanakv---key-value-storage",
        "text": "tana:kv - Key-Value Storage",
        "level": 3
      },
      {
        "id": "tanacontext---execution-context",
        "text": "tana:context - Execution Context",
        "level": 3
      },
      {
        "id": "tanablock---blockchain-queries",
        "text": "tana:block - Blockchain Queries",
        "level": 3
      },
      {
        "id": "tanatx---transaction-creation",
        "text": "tana:tx - Transaction Creation",
        "level": 3
      },
      {
        "id": "tanautils---external-http",
        "text": "tana:utils - External HTTP",
        "level": 3
      },
      {
        "id": "import-syntax",
        "text": "Import Syntax",
        "level": 2
      },
      {
        "id": "return-values",
        "text": "Return Values",
        "level": 2
      },
      {
        "id": "authorization-patterns",
        "text": "Authorization Patterns",
        "level": 2
      },
      {
        "id": "owner-only-access",
        "text": "Owner-Only Access",
        "level": 3
      },
      {
        "id": "role-based-access",
        "text": "Role-Based Access",
        "level": 3
      },
      {
        "id": "security",
        "text": "Security",
        "level": 2
      },
      {
        "id": "sandboxed-execution",
        "text": "Sandboxed Execution",
        "level": 3
      },
      {
        "id": "network-whitelist",
        "text": "Network Whitelist",
        "level": 3
      },
      {
        "id": "transaction-signing",
        "text": "Transaction Signing",
        "level": 3
      },
      {
        "id": "testing",
        "text": "Testing",
        "level": 2
      },
      {
        "id": "local-testing",
        "text": "Local Testing",
        "level": 3
      },
      {
        "id": "http-testing",
        "text": "HTTP Testing",
        "level": 3
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "contributing",
      "transaction-signing"
    ],
    "metadata": {
      "title": "Transaction Signing",
      "description": "How to sign and verify transactions with Ed25519",
      "sidebar": {
        "order": 4
      }
    },
    "content": "\nAll transactions on Tana require Ed25519 cryptographic signatures to ensure authenticity and prevent unauthorized actions.\n\n## Overview\n\nEvery transaction must be signed by the private key of the account initiating the transaction. This prevents:\n\n- **Impersonation** - No one can create transactions on your behalf\n- **Replay attacks** - Transactions cannot be reused (thanks to nonces)\n- **Tampering** - Transaction data cannot be modified after signing\n\n## Signature Requirements\n\nEvery transaction (except user creation) must include:\n\n1. **Signature** - Ed25519 signature (hex string with `ed25519_` prefix)\n2. **Timestamp** - Unix timestamp in milliseconds (must be within 5 minutes of current time)\n3. **Nonce** - Sequential number that increments with each transaction\n\n## How Signing Works\n\n### 1. Get Your Current Nonce\n\nBefore creating a transaction, fetch your current nonce:\n\n```bash\n# Get nonce for user\ncurl http://localhost:8080/users/{userId}/nonce\n\n# Response:\n{\n  \"userId\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"username\": \"@alice\",\n  \"currentNonce\": 5,\n  \"nextNonce\": 6,\n  \"message\": \"Use nextNonce for your next transaction\"\n}\n```\n\n**Important:** Use `nextNonce` for your transaction, not `currentNonce`.\n\n### 2. Create Transaction Message\n\nBuild a canonical message for signing:\n\n```typescript\nimport { createTransactionMessage } from '@tana/cli/utils/crypto'\n\nconst transactionData = {\n  type: 'transfer',\n  from: '550e8400-e29b-41d4-a716-446655440000', // Your user ID\n  to: '7c9e6679-7425-40de-944b-e07fc1f90ae7',   // Recipient ID\n  amount: '100.00',\n  currencyCode: 'USD',\n  timestamp: Date.now(),\n  nonce: 6 // The nextNonce from step 1\n}\n\nconst message = createTransactionMessage(transactionData)\n```\n\n### 3. Sign the Message\n\nSign with your private key:\n\n```typescript\nimport { signMessage } from '@tana/cli/utils/crypto'\n\nconst signature = await signMessage(\n  message,\n  userConfig.privateKey // From ~/.config/tana/users/@alice.json\n)\n\n// signature: \"ed25519_a7f3b2c1d4e5f6a7b8c9d0e1f2a3b4c5...\"\n```\n\n### 4. Submit Transaction\n\nSend the signed transaction to the ledger:\n\n```typescript\nconst response = await fetch('http://localhost:8080/transactions', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    type: 'transfer',\n    from: '550e8400-e29b-41d4-a716-446655440000',\n    to: '7c9e6679-7425-40de-944b-e07fc1f90ae7',\n    amount: '100.00',\n    currencyCode: 'USD',\n    signature, // Include the signature\n    timestamp: transactionData.timestamp,\n    nonce: transactionData.nonce\n  })\n})\n```\n\n## Signature Verification\n\nWhen the ledger receives a transaction, it:\n\n1. **Validates timestamp** - Must be within 5 minutes\n2. **Fetches user** - Gets user record by `from` field\n3. **Checks nonce** - Must be exactly `currentNonce + 1`\n4. **Verifies signature** - Recreates message and verifies with user's public key\n5. **Checks balances** - Ensures sufficient funds (for transfers)\n\nIf any check fails, the transaction is rejected.\n\n## Transaction Types\n\n### User Creation\n\n**Special case:** User creation doesn't require signature verification (no user exists yet to verify against). Instead:\n\n- Nonce is always `0`\n- Signature is verified against the `publicKey` field in the request itself\n- This proves you control the private key for the public key you're registering\n\n```typescript\nconst transactionData = {\n  type: 'user_creation',\n  from: '00000000-0000-0000-0000-000000000000', // System\n  to: '00000000-0000-0000-0000-000000000000',   // Will be assigned\n  timestamp: Date.now(),\n  nonce: 0, // Always 0 for user creation\n  contractInput: {\n    username: '@alice',\n    displayName: 'Alice',\n    publicKey: 'ed25519_abc123...',\n    bio: '',\n    role: 'user'\n  }\n}\n```\n\n### Transfers\n\nTransfer currency between accounts:\n\n```typescript\n{\n  type: 'transfer',\n  from: userId,\n  to: recipientId,\n  amount: '50.00',\n  currencyCode: 'USD',\n  signature: 'ed25519_...',\n  timestamp: Date.now(),\n  nonce: nextNonce\n}\n```\n\n### Deposits\n\nRequest to deposit fiat currency into blockchain:\n\n```typescript\n{\n  type: 'deposit',\n  from: userId, // The requestor\n  to: userId,   // Same (depositing to self)\n  amount: '1000.00',\n  currencyCode: 'CAD',\n  signature: 'ed25519_...',\n  timestamp: Date.now(),\n  nonce: nextNonce,\n  metadata: {\n    // Optional: e-transfer details\n  }\n}\n```\n\n**Note:** Deposits create a pending transaction that must be confirmed by the sovereign user after receiving the actual fiat currency.\n\n### Withdraws\n\nRequest to withdraw currency from blockchain to fiat:\n\n```typescript\n{\n  type: 'withdraw',\n  from: userId, // Your account (will be debited)\n  to: userId,   // Same\n  amount: '500.00',\n  currencyCode: 'USD',\n  signature: 'ed25519_...',\n  timestamp: Date.now(),\n  nonce: nextNonce,\n  metadata: {\n    email: 'alice@example.com' // Where to send e-transfer\n  }\n}\n```\n\n**Note:** Withdraws also require sovereign confirmation before the fiat currency is sent.\n\n## Nonce Management\n\n### What is a Nonce?\n\nA **nonce** (number used once) is a counter that prevents replay attacks. Each user has their own nonce that:\n\n- Starts at `0` when the user is created\n- Increments by `1` every time a transaction is confirmed\n- Must be sequential (can't skip numbers)\n\n### Why Nonces Matter\n\nWithout nonces, an attacker could:\n1. Capture a valid signed transaction\n2. Re-submit it multiple times\n3. Drain your account\n\nWith nonces, each transaction has a unique sequence number, so replays are detected and rejected.\n\n### Handling Nonce Errors\n\nIf you get a nonce mismatch error:\n\n```json\n{\n  \"error\": \"Invalid nonce. Expected 7, got 6\"\n}\n```\n\n**Solutions:**\n\n1. **Fetch fresh nonce** - Call `GET /users/:id/nonce` again\n2. **Don't parallelize** - Wait for each transaction to be confirmed before submitting the next\n3. **Check pending transactions** - Your transaction might be pending, increasing the nonce\n\n### Pending Transactions\n\nNonces only increment when transactions are **confirmed** in a block. If you have pending transactions:\n\n- Your `currentNonce` hasn't changed yet\n- Use `nextNonce` based on the pending transaction count\n- Wait for block production to confirm transactions\n\n## CLI Signing Example\n\nThe `tana-cli` handles all signing automatically:\n\n```bash\n# Create user (signs automatically)\ntana new user @alice\ntana deploy user @alice\n\n# Transfers (coming soon - will sign automatically)\ntana transfer @alice @bob 50 USD\n```\n\n## TypeScript Library Example\n\n```typescript\nimport * as ed from '@noble/ed25519'\nimport { createTransactionMessage, signMessage } from '@tana/cli/utils/crypto'\n\n// 1. Load user config\nconst userConfig = readUserConfig('@alice')\n\n// 2. Get current nonce\nconst nonceResponse = await fetch(`http://localhost:8080/users/${userConfig.id}/nonce`)\nconst { nextNonce } = await nonceResponse.json()\n\n// 3. Create transaction data\nconst txData = {\n  type: 'transfer',\n  from: userConfig.id,\n  to: recipientId,\n  amount: '100.00',\n  currencyCode: 'USD',\n  timestamp: Date.now(),\n  nonce: nextNonce\n}\n\n// 4. Sign the transaction\nconst message = createTransactionMessage(txData)\nconst signature = await signMessage(message, userConfig.privateKey)\n\n// 5. Submit\nawait fetch('http://localhost:8080/transactions', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({ ...txData, signature })\n})\n```\n\n## Security Best Practices\n\n### Keep Private Keys Safe\n\n- **Never share** your private key\n- **Never commit** private keys to git\n- **Store securely** in `~/.config/tana/users/` with proper permissions\n- **Backup** to encrypted storage\n\n### Verify Timestamps\n\nAlways use current timestamps:\n\n```typescript\nconst timestamp = Date.now() // Current time in milliseconds\n```\n\n**Don't:**\n- Use hardcoded timestamps\n- Reuse old timestamps\n- Set timestamps in the future\n\n### Handle Nonces Carefully\n\n- Always fetch fresh nonces before signing\n- Wait for transactions to confirm before submitting more\n- Don't parallelize transactions from the same account\n\n### Verify Before Signing\n\nAlways review transaction details before signing:\n\n```typescript\nconsole.log('Transaction to sign:')\nconsole.log(`  Type: ${txData.type}`)\nconsole.log(`  To: ${txData.to}`)\nconsole.log(`  Amount: ${txData.amount} ${txData.currencyCode}`)\nconsole.log(`  Nonce: ${txData.nonce}`)\n\n// Only sign if everything looks correct\nconst signature = await signMessage(message, privateKey)\n```\n\n## Error Reference\n\nCommon signature-related errors:\n\n| Error | Cause | Solution |\n|-------|-------|----------|\n| `Invalid transaction signature` | Signature doesn't match | Regenerate signature with correct private key |\n| `Invalid nonce. Expected X, got Y` | Wrong nonce | Fetch fresh nonce from `/users/:id/nonce` |\n| `Transaction timestamp is too old` | Timestamp > 5 minutes old | Use current timestamp `Date.now()` |\n| `Sender user not found` | Invalid `from` user ID | Verify user ID is correct |\n| `Insufficient balance` | Not enough funds | Check balance before transferring |\n\n## Next Steps\n\n- **[Smart Contracts](/guides/smart-contracts/)** - Sign and deploy contracts\n- **[API Reference](/tana-api/transactions/)** - Full transaction API docs\n- **[CLI Commands](/tana-cli/intro/)** - Using the CLI for signed operations\n",
    "html": "<p>All transactions on Tana require Ed25519 cryptographic signatures to ensure authenticity and prevent unauthorized actions.</p>\n<h2 id=\"overview\">Overview</h2>\n<p>Every transaction must be signed by the private key of the account initiating the transaction. This prevents:</p>\n<ul>\n<li><strong>Impersonation</strong> - No one can create transactions on your behalf</li>\n<li><strong>Replay attacks</strong> - Transactions cannot be reused (thanks to nonces)</li>\n<li><strong>Tampering</strong> - Transaction data cannot be modified after signing</li>\n</ul>\n<h2 id=\"signature-requirements\">Signature Requirements</h2>\n<p>Every transaction (except user creation) must include:</p>\n<ol>\n<li><strong>Signature</strong> - Ed25519 signature (hex string with <code>ed25519_</code> prefix)</li>\n<li><strong>Timestamp</strong> - Unix timestamp in milliseconds (must be within 5 minutes of current time)</li>\n<li><strong>Nonce</strong> - Sequential number that increments with each transaction</li>\n</ol>\n<h2 id=\"how-signing-works\">How Signing Works</h2>\n<h3 id=\"1-get-your-current-nonce\">1. Get Your Current Nonce</h3>\n<p>Before creating a transaction, fetch your current nonce:</p>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<p><strong>Important:</strong> Use <code>nextNonce</code> for your transaction, not <code>currentNonce</code>.</p>\n<h3 id=\"2-create-transaction-message\">2. Create Transaction Message</h3>\n<p>Build a canonical message for signing:</p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"3-sign-the-message\">3. Sign the Message</h3>\n<p>Sign with your private key:</p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"4-submit-transaction\">4. Submit Transaction</h3>\n<p>Send the signed transaction to the ledger:</p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"signature-verification\">Signature Verification</h2>\n<p>When the ledger receives a transaction, it:</p>\n<ol>\n<li><strong>Validates timestamp</strong> - Must be within 5 minutes</li>\n<li><strong>Fetches user</strong> - Gets user record by <code>from</code> field</li>\n<li><strong>Checks nonce</strong> - Must be exactly <code>currentNonce + 1</code></li>\n<li><strong>Verifies signature</strong> - Recreates message and verifies with user&#39;s public key</li>\n<li><strong>Checks balances</strong> - Ensures sufficient funds (for transfers)</li>\n</ol>\n<p>If any check fails, the transaction is rejected.</p>\n<h2 id=\"transaction-types\">Transaction Types</h2>\n<h3 id=\"user-creation\">User Creation</h3>\n<p><strong>Special case:</strong> User creation doesn&#39;t require signature verification (no user exists yet to verify against). Instead:</p>\n<ul>\n<li>Nonce is always <code>0</code></li>\n<li>Signature is verified against the <code>publicKey</code> field in the request itself</li>\n<li>This proves you control the private key for the public key you&#39;re registering</li>\n</ul>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"transfers\">Transfers</h3>\n<p>Transfer currency between accounts:</p>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"deposits\">Deposits</h3>\n<p>Request to deposit fiat currency into blockchain:</p>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Note:</strong> Deposits create a pending transaction that must be confirmed by the sovereign user after receiving the actual fiat currency.</p>\n<h3 id=\"withdraws\">Withdraws</h3>\n<p>Request to withdraw currency from blockchain to fiat:</p>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Note:</strong> Withdraws also require sovereign confirmation before the fiat currency is sent.</p>\n<h2 id=\"nonce-management\">Nonce Management</h2>\n<h3 id=\"what-is-a-nonce\">What is a Nonce?</h3>\n<p>A <strong>nonce</strong> (number used once) is a counter that prevents replay attacks. Each user has their own nonce that:</p>\n<ul>\n<li>Starts at <code>0</code> when the user is created</li>\n<li>Increments by <code>1</code> every time a transaction is confirmed</li>\n<li>Must be sequential (can&#39;t skip numbers)</li>\n</ul>\n<h3 id=\"why-nonces-matter\">Why Nonces Matter</h3>\n<p>Without nonces, an attacker could:</p>\n<ol>\n<li>Capture a valid signed transaction</li>\n<li>Re-submit it multiple times</li>\n<li>Drain your account</li>\n</ol>\n<p>With nonces, each transaction has a unique sequence number, so replays are detected and rejected.</p>\n<h3 id=\"handling-nonce-errors\">Handling Nonce Errors</h3>\n<p>If you get a nonce mismatch error:</p>\n<div class=\"code-block-placeholder\" data-index=\"8\" data-lang=\"json\"></div>\n\n\n\n<p><strong>Solutions:</strong></p>\n<ol>\n<li><strong>Fetch fresh nonce</strong> - Call <code>GET /users/:id/nonce</code> again</li>\n<li><strong>Don&#39;t parallelize</strong> - Wait for each transaction to be confirmed before submitting the next</li>\n<li><strong>Check pending transactions</strong> - Your transaction might be pending, increasing the nonce</li>\n</ol>\n<h3 id=\"pending-transactions\">Pending Transactions</h3>\n<p>Nonces only increment when transactions are <strong>confirmed</strong> in a block. If you have pending transactions:</p>\n<ul>\n<li>Your <code>currentNonce</code> hasn&#39;t changed yet</li>\n<li>Use <code>nextNonce</code> based on the pending transaction count</li>\n<li>Wait for block production to confirm transactions</li>\n</ul>\n<h2 id=\"cli-signing-example\">CLI Signing Example</h2>\n<p>The <code>tana-cli</code> handles all signing automatically:</p>\n<div class=\"code-block-placeholder\" data-index=\"9\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"typescript-library-example\">TypeScript Library Example</h2>\n<div class=\"code-block-placeholder\" data-index=\"10\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"security-best-practices\">Security Best Practices</h2>\n<h3 id=\"keep-private-keys-safe\">Keep Private Keys Safe</h3>\n<ul>\n<li><strong>Never share</strong> your private key</li>\n<li><strong>Never commit</strong> private keys to git</li>\n<li><strong>Store securely</strong> in <code>~/.config/tana/users/</code> with proper permissions</li>\n<li><strong>Backup</strong> to encrypted storage</li>\n</ul>\n<h3 id=\"verify-timestamps\">Verify Timestamps</h3>\n<p>Always use current timestamps:</p>\n<div class=\"code-block-placeholder\" data-index=\"11\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Don&#39;t:</strong></p>\n<ul>\n<li>Use hardcoded timestamps</li>\n<li>Reuse old timestamps</li>\n<li>Set timestamps in the future</li>\n</ul>\n<h3 id=\"handle-nonces-carefully\">Handle Nonces Carefully</h3>\n<ul>\n<li>Always fetch fresh nonces before signing</li>\n<li>Wait for transactions to confirm before submitting more</li>\n<li>Don&#39;t parallelize transactions from the same account</li>\n</ul>\n<h3 id=\"verify-before-signing\">Verify Before Signing</h3>\n<p>Always review transaction details before signing:</p>\n<div class=\"code-block-placeholder\" data-index=\"12\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"error-reference\">Error Reference</h2>\n<p>Common signature-related errors:</p>\n<table>\n<thead>\n<tr>\n<th>Error</th>\n<th>Cause</th>\n<th>Solution</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>Invalid transaction signature</code></td>\n<td>Signature doesn&#39;t match</td>\n<td>Regenerate signature with correct private key</td>\n</tr>\n<tr>\n<td><code>Invalid nonce. Expected X, got Y</code></td>\n<td>Wrong nonce</td>\n<td>Fetch fresh nonce from <code>/users/:id/nonce</code></td>\n</tr>\n<tr>\n<td><code>Transaction timestamp is too old</code></td>\n<td>Timestamp &gt; 5 minutes old</td>\n<td>Use current timestamp <code>Date.now()</code></td>\n</tr>\n<tr>\n<td><code>Sender user not found</code></td>\n<td>Invalid <code>from</code> user ID</td>\n<td>Verify user ID is correct</td>\n</tr>\n<tr>\n<td><code>Insufficient balance</code></td>\n<td>Not enough funds</td>\n<td>Check balance before transferring</td>\n</tr>\n</tbody></table>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><strong><a href=\"/guides/smart-contracts/\">Smart Contracts</a></strong> - Sign and deploy contracts</li>\n<li><strong><a href=\"/tana-api/transactions/\">API Reference</a></strong> - Full transaction API docs</li>\n<li><strong><a href=\"/tana-cli/intro/\">CLI Commands</a></strong> - Using the CLI for signed operations</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "# Get nonce for user\ncurl http://localhost:8080/users/{userId}/nonce\n\n# Response:\n{\n  \"userId\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"username\": \"@alice\",\n  \"currentNonce\": 5,\n  \"nextNonce\": 6,\n  \"message\": \"Use nextNonce for your next transaction\"\n}"
      },
      {
        "lang": "typescript",
        "code": "import { createTransactionMessage } from '@tana/cli/utils/crypto'\n\nconst transactionData = {\n  type: 'transfer',\n  from: '550e8400-e29b-41d4-a716-446655440000', // Your user ID\n  to: '7c9e6679-7425-40de-944b-e07fc1f90ae7',   // Recipient ID\n  amount: '100.00',\n  currencyCode: 'USD',\n  timestamp: Date.now(),\n  nonce: 6 // The nextNonce from step 1\n}\n\nconst message = createTransactionMessage(transactionData)"
      },
      {
        "lang": "typescript",
        "code": "import { signMessage } from '@tana/cli/utils/crypto'\n\nconst signature = await signMessage(\n  message,\n  userConfig.privateKey // From ~/.config/tana/users/@alice.json\n)\n\n// signature: \"ed25519_a7f3b2c1d4e5f6a7b8c9d0e1f2a3b4c5...\""
      },
      {
        "lang": "typescript",
        "code": "const response = await fetch('http://localhost:8080/transactions', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    type: 'transfer',\n    from: '550e8400-e29b-41d4-a716-446655440000',\n    to: '7c9e6679-7425-40de-944b-e07fc1f90ae7',\n    amount: '100.00',\n    currencyCode: 'USD',\n    signature, // Include the signature\n    timestamp: transactionData.timestamp,\n    nonce: transactionData.nonce\n  })\n})"
      },
      {
        "lang": "typescript",
        "code": "const transactionData = {\n  type: 'user_creation',\n  from: '00000000-0000-0000-0000-000000000000', // System\n  to: '00000000-0000-0000-0000-000000000000',   // Will be assigned\n  timestamp: Date.now(),\n  nonce: 0, // Always 0 for user creation\n  contractInput: {\n    username: '@alice',\n    displayName: 'Alice',\n    publicKey: 'ed25519_abc123...',\n    bio: '',\n    role: 'user'\n  }\n}"
      },
      {
        "lang": "typescript",
        "code": "{\n  type: 'transfer',\n  from: userId,\n  to: recipientId,\n  amount: '50.00',\n  currencyCode: 'USD',\n  signature: 'ed25519_...',\n  timestamp: Date.now(),\n  nonce: nextNonce\n}"
      },
      {
        "lang": "typescript",
        "code": "{\n  type: 'deposit',\n  from: userId, // The requestor\n  to: userId,   // Same (depositing to self)\n  amount: '1000.00',\n  currencyCode: 'CAD',\n  signature: 'ed25519_...',\n  timestamp: Date.now(),\n  nonce: nextNonce,\n  metadata: {\n    // Optional: e-transfer details\n  }\n}"
      },
      {
        "lang": "typescript",
        "code": "{\n  type: 'withdraw',\n  from: userId, // Your account (will be debited)\n  to: userId,   // Same\n  amount: '500.00',\n  currencyCode: 'USD',\n  signature: 'ed25519_...',\n  timestamp: Date.now(),\n  nonce: nextNonce,\n  metadata: {\n    email: 'alice@example.com' // Where to send e-transfer\n  }\n}"
      },
      {
        "lang": "json",
        "code": "{\n  \"error\": \"Invalid nonce. Expected 7, got 6\"\n}"
      },
      {
        "lang": "bash",
        "code": "# Create user (signs automatically)\ntana new user @alice\ntana deploy user @alice\n\n# Transfers (coming soon - will sign automatically)\ntana transfer @alice @bob 50 USD"
      },
      {
        "lang": "typescript",
        "code": "import * as ed from '@noble/ed25519'\nimport { createTransactionMessage, signMessage } from '@tana/cli/utils/crypto'\n\n// 1. Load user config\nconst userConfig = readUserConfig('@alice')\n\n// 2. Get current nonce\nconst nonceResponse = await fetch(`http://localhost:8080/users/${userConfig.id}/nonce`)\nconst { nextNonce } = await nonceResponse.json()\n\n// 3. Create transaction data\nconst txData = {\n  type: 'transfer',\n  from: userConfig.id,\n  to: recipientId,\n  amount: '100.00',\n  currencyCode: 'USD',\n  timestamp: Date.now(),\n  nonce: nextNonce\n}\n\n// 4. Sign the transaction\nconst message = createTransactionMessage(txData)\nconst signature = await signMessage(message, userConfig.privateKey)\n\n// 5. Submit\nawait fetch('http://localhost:8080/transactions', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({ ...txData, signature })\n})"
      },
      {
        "lang": "typescript",
        "code": "const timestamp = Date.now() // Current time in milliseconds"
      },
      {
        "lang": "typescript",
        "code": "console.log('Transaction to sign:')\nconsole.log(`  Type: ${txData.type}`)\nconsole.log(`  To: ${txData.to}`)\nconsole.log(`  Amount: ${txData.amount} ${txData.currencyCode}`)\nconsole.log(`  Nonce: ${txData.nonce}`)\n\n// Only sign if everything looks correct\nconst signature = await signMessage(message, privateKey)"
      }
    ],
    "tableOfContents": [
      {
        "id": "overview",
        "text": "Overview",
        "level": 2
      },
      {
        "id": "signature-requirements",
        "text": "Signature Requirements",
        "level": 2
      },
      {
        "id": "how-signing-works",
        "text": "How Signing Works",
        "level": 2
      },
      {
        "id": "1-get-your-current-nonce",
        "text": "1. Get Your Current Nonce",
        "level": 3
      },
      {
        "id": "2-create-transaction-message",
        "text": "2. Create Transaction Message",
        "level": 3
      },
      {
        "id": "3-sign-the-message",
        "text": "3. Sign the Message",
        "level": 3
      },
      {
        "id": "4-submit-transaction",
        "text": "4. Submit Transaction",
        "level": 3
      },
      {
        "id": "signature-verification",
        "text": "Signature Verification",
        "level": 2
      },
      {
        "id": "transaction-types",
        "text": "Transaction Types",
        "level": 2
      },
      {
        "id": "user-creation",
        "text": "User Creation",
        "level": 3
      },
      {
        "id": "transfers",
        "text": "Transfers",
        "level": 3
      },
      {
        "id": "deposits",
        "text": "Deposits",
        "level": 3
      },
      {
        "id": "withdraws",
        "text": "Withdraws",
        "level": 3
      },
      {
        "id": "nonce-management",
        "text": "Nonce Management",
        "level": 2
      },
      {
        "id": "what-is-a-nonce",
        "text": "What is a Nonce?",
        "level": 3
      },
      {
        "id": "why-nonces-matter",
        "text": "Why Nonces Matter",
        "level": 3
      },
      {
        "id": "handling-nonce-errors",
        "text": "Handling Nonce Errors",
        "level": 3
      },
      {
        "id": "pending-transactions",
        "text": "Pending Transactions",
        "level": 3
      },
      {
        "id": "cli-signing-example",
        "text": "CLI Signing Example",
        "level": 2
      },
      {
        "id": "typescript-library-example",
        "text": "TypeScript Library Example",
        "level": 2
      },
      {
        "id": "security-best-practices",
        "text": "Security Best Practices",
        "level": 2
      },
      {
        "id": "keep-private-keys-safe",
        "text": "Keep Private Keys Safe",
        "level": 3
      },
      {
        "id": "verify-timestamps",
        "text": "Verify Timestamps",
        "level": 3
      },
      {
        "id": "handle-nonces-carefully",
        "text": "Handle Nonces Carefully",
        "level": 3
      },
      {
        "id": "verify-before-signing",
        "text": "Verify Before Signing",
        "level": 3
      },
      {
        "id": "error-reference",
        "text": "Error Reference",
        "level": 2
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "contributing",
      "env-vars"
    ],
    "metadata": {
      "title": "Environment Variables",
      "description": "Configuration via environment variables",
      "sidebar": {
        "order": 3
      }
    },
    "content": "\nTana uses environment variables for configuration across all components. This provides a simple, consistent way to configure development, testing, and production environments.\n\n## TANA_LEDGER_URL\n\n**Purpose:** Configures the ledger API endpoint for all Tana components\n\n**Default:** `http://localhost:8080`\n\n**Usage:**\n```bash\n# Development (default - no env var needed)\ntana new user @alice\n\n# Remote chain\nexport TANA_LEDGER_URL=https://mainnet.tana.network\ntana new user @alice\n\n# Per-command override\nTANA_LEDGER_URL=https://testnet.tana.network tana deploy user @alice\n```\n\n### Components That Use This Variable\n\n**CLI (TypeScript/Bun):**\n```typescript\n// cli/utils/config.ts\nexport function getLedgerUrl(): string {\n  return process.env.TANA_LEDGER_URL || 'http://localhost:8080'\n}\n```\n\n**Contract Runner Script:**\n```typescript\n// scripts/run-contract.ts\nconst LEDGER_URL = process.env.TANA_LEDGER_URL || 'http://localhost:8080';\n```\n\n**Edge Server (Rust):**\n```rust\n// tana-edge/src/main.rs\nuse std::env;\nlet ledger_url = env::var(\"TANA_LEDGER_URL\")\n    .unwrap_or_else(|_| \"http://localhost:8080\".to_string());\n```\n\n**Mobile App (React Native/Expo):**\n```javascript\n// mobile/app.config.js\nextra: {\n  ledgerApiUrl: process.env.TANA_LEDGER_URL || 'http://localhost:8080'\n}\n```\n\n### Framework-Specific Considerations\n\nDifferent frameworks access environment variables differently:\n\n**Bun/Node.js:**\n```typescript\nprocess.env.TANA_LEDGER_URL\n```\n\n**Astro:**\n```typescript\nimport.meta.env.TANA_LEDGER_URL\n// Add to .env file in project root\n```\n\n**Next.js:**\n```typescript\n// Server-side\nprocess.env.TANA_LEDGER_URL\n\n// Client-side (requires NEXT_PUBLIC_ prefix)\nprocess.env.NEXT_PUBLIC_TANA_LEDGER_URL\n```\n\n**Vite:**\n```typescript\nimport.meta.env.VITE_TANA_LEDGER_URL\n// Add to .env file with VITE_ prefix\n```\n\n**Rust:**\n```rust\nuse std::env;\nenv::var(\"TANA_LEDGER_URL\").unwrap_or_else(|_| \"default\".to_string())\n```\n\n## Development Workflows\n\n### Local Development\n\nFor local development, the default value (`http://localhost:8080`) works automatically:\n\n```bash\n# Start the ledger\ntana start\n\n# Use CLI (automatically connects to localhost:8080)\ntana new user @alice\ntana deploy user @alice\n```\n\n### Multi-Chain Development\n\nSwitch between chains by setting the environment variable:\n\n```bash\n# Work on local development chain\nTANA_LEDGER_URL=http://localhost:8080 tana status\n\n# Work on testnet\nTANA_LEDGER_URL=https://testnet.tana.network tana status\n\n# Work on custom community chain\nTANA_LEDGER_URL=https://my-chain.example.com tana status\n```\n\n### Docker/Container Deployment\n\n**Dockerfile:**\n```dockerfile\nENV TANA_LEDGER_URL=https://mainnet.tana.network\n```\n\n**docker-compose.yml:**\n```yaml\nservices:\n  tana-edge:\n    environment:\n      - TANA_LEDGER_URL=https://mainnet.tana.network\n```\n\n**Kubernetes:**\n```yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: tana-config\ndata:\n  TANA_LEDGER_URL: \"https://mainnet.tana.network\"\n```\n\n### CI/CD Pipelines\n\n**GitHub Actions:**\n```yaml\nenv:\n  TANA_LEDGER_URL: https://testnet.tana.network\n\nsteps:\n  - name: Run tests\n    run: bun test\n    env:\n      TANA_LEDGER_URL: http://localhost:8080\n```\n\n**GitLab CI:**\n```yaml\nvariables:\n  TANA_LEDGER_URL: \"https://testnet.tana.network\"\n```\n\n## Production Configuration\n\n### Managed Hosting (tana.network)\n\nWhen using the official tana.network hosted service:\n\n```bash\nexport TANA_LEDGER_URL=https://api.tana.network\n```\n\n### Self-Hosted\n\nWhen running your own blockchain infrastructure:\n\n```bash\n# Single instance\nexport TANA_LEDGER_URL=https://ledger.mycompany.com\n\n# Load balanced\nexport TANA_LEDGER_URL=https://ledger-lb.mycompany.com\n\n# Internal network\nexport TANA_LEDGER_URL=http://ledger.internal:8080\n```\n\n## Validation and Debugging\n\n### Check Current Configuration\n\n**CLI Status:**\n```bash\ntana status\n# Shows: Ledger: â— Running on http://localhost:8080\n```\n\n**Environment Check:**\n```bash\necho $TANA_LEDGER_URL\n# Should output the URL or be empty (uses default)\n```\n\n### Common Issues\n\n**Issue:** CLI can't connect to ledger\n```bash\n# Check if ledger is reachable\ncurl $TANA_LEDGER_URL/health\n\n# Verify environment variable is set correctly\necho $TANA_LEDGER_URL\n```\n\n**Issue:** Wrong chain being targeted\n```bash\n# Check current configuration\ntana status\n\n# Override temporarily\nTANA_LEDGER_URL=https://correct-chain.com tana status\n```\n\n**Issue:** Docker container can't reach localhost\n```bash\n# In Docker, localhost refers to the container\n# Use host.docker.internal on Mac/Windows or host network mode on Linux\n\n# Docker for Mac/Windows\nexport TANA_LEDGER_URL=http://host.docker.internal:8080\n\n# Docker for Linux (use host network)\ndocker run --network host -e TANA_LEDGER_URL=http://localhost:8080 ...\n```\n\n## DATABASE_URL\n\n**Purpose:** PostgreSQL connection string for blockchain data (ledger service)\n\n**Default:** None (required for ledger service)\n\n**Format:** `postgres://username:password@host:port/database`\n\n**Usage:**\n```bash\n# Development\nexport DATABASE_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\n\n# Production\nexport DATABASE_URL='postgres://prod_user:secure_password@db.example.com:5432/tana_prod'\n```\n\n**Used by:**\n- Ledger service (blockchain state storage)\n- Block producer scripts\n- Database migration tools\n\n## IDENTITY_DB_URL\n\n**Purpose:** PostgreSQL connection string for authentication data (identity service)\n\n**Default:** Falls back to `DATABASE_URL` if not set\n\n**Format:** `postgres://username:password@host:port/database`\n\n**Usage:**\n```bash\n# Development (can use same database as blockchain)\nexport IDENTITY_DB_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\n\n# Production (recommended: separate database for security)\nexport IDENTITY_DB_URL='postgres://identity_user:secure_password@identity-db.example.com:5432/tana_identity'\n```\n\n**Notes:**\n- Authentication tables are separate from blockchain data\n- NOT replicated across validators\n- Can use same database as `DATABASE_URL` (tables don't overlap)\n- Identity service only runs on API nodes (not validators)\n\n**Used by:**\n- Identity service (QR authentication, session management)\n\n## REDIS_URL\n\n**Purpose:** Redis connection string for transaction queue\n\n**Default:** `redis://localhost:6379`\n\n**Format:** `redis://[username:password@]host:port[/database]`\n\n**Usage:**\n```bash\n# Development\nexport REDIS_URL='redis://localhost:6379'\n\n# Production with authentication\nexport REDIS_URL='redis://username:password@redis.example.com:6379'\n\n# Redis Cluster\nexport REDIS_URL='redis://redis-cluster.example.com:6379'\n```\n\n**Requirements:**\n- Redis 7+ required (Redis Streams support)\n- Must support XADD, XREADGROUP, XACK commands\n- Shared by all validators in the network\n\n**Used by:**\n- Ledger service (transaction submission)\n- Queue service (transaction queueing)\n- Block producer scripts (transaction consumption)\n\n## PORT\n\n**Purpose:** HTTP port for ledger service API\n\n**Default:** `8080`\n\n**Usage:**\n```bash\n# Development (default)\nexport PORT=8080\n\n# Production (custom port)\nexport PORT=3000\n```\n\n**Used by:**\n- Ledger service HTTP server\n\n## IDENTITY_PORT\n\n**Purpose:** HTTP port for identity service API\n\n**Default:** `8090`\n\n**Usage:**\n```bash\n# Development (default)\nexport IDENTITY_PORT=8090\n\n# Production (custom port)\nexport IDENTITY_PORT=3001\n```\n\n**Used by:**\n- Identity service HTTP server\n\n## EDGE_PORT\n\n**Purpose:** HTTP port for edge server (contract execution)\n\n**Default:** `8180`\n\n**Usage:**\n```bash\n# Development (default)\nexport EDGE_PORT=8180\n\n# Production (custom port)\nexport EDGE_PORT=8000\n```\n\n**Used by:**\n- Tana Edge server (Rust binary)\n\n## Service URLs for Client Applications\n\n**Purpose:** Configure client apps to connect to Tana services\n\n### TANA_IDENTITY_URL\n\n**Default:** `http://localhost:8090`\n\n**Usage:**\n```bash\n# Development\nexport TANA_IDENTITY_URL=http://localhost:8090\n\n# Production\nexport TANA_IDENTITY_URL=https://auth.tana.network\n```\n\n**Used by:**\n- Website applications (QR login pages)\n- Mobile apps (authentication flows)\n\n### TANA_EDGE_URL\n\n**Default:** `http://localhost:8180`\n\n**Usage:**\n```bash\n# Development\nexport TANA_EDGE_URL=http://localhost:8180\n\n# Production\nexport TANA_EDGE_URL=https://edge.tana.network\n```\n\n**Used by:**\n- Applications calling contract endpoints\n- Edge function deployments\n\n## Complete Development Setup\n\nFor local development, create a `.env` file in your project root:\n\n```bash\n# .env\n\n# Database connections\nDATABASE_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\nIDENTITY_DB_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\nREDIS_URL='redis://localhost:6379'\n\n# Service ports\nPORT=8080                    # Ledger service\nIDENTITY_PORT=8090           # Identity service\nEDGE_PORT=8180              # Edge server\n\n# Client URLs (for connecting to services)\nTANA_LEDGER_URL=http://localhost:8080\nTANA_IDENTITY_URL=http://localhost:8090\nTANA_EDGE_URL=http://localhost:8180\n\n# Environment\nNODE_ENV=development\n```\n\n## Complete Production Setup\n\nFor production deployment:\n\n```bash\n# .env.production\n\n# Database connections (use secure passwords!)\nDATABASE_URL='postgres://prod_user:SECURE_PASSWORD@db.internal:5432/tana_prod'\nIDENTITY_DB_URL='postgres://identity_user:SECURE_PASSWORD@identity-db.internal:5432/tana_identity'\nREDIS_URL='redis://redis_user:SECURE_PASSWORD@redis.internal:6379'\n\n# Service ports (behind reverse proxy)\nPORT=8080\nIDENTITY_PORT=8090\nEDGE_PORT=8180\n\n# Public URLs (with SSL)\nTANA_LEDGER_URL=https://api.tana.network\nTANA_IDENTITY_URL=https://auth.tana.network\nTANA_EDGE_URL=https://edge.tana.network\n\n# Environment\nNODE_ENV=production\n```\n\n## Best Practices\n\n1. **Never commit `.env` files with secrets** - Use `.env.example` instead\n2. **Use different values per environment** - dev, staging, production\n3. **Validate URLs before deployment** - Ensure endpoints are reachable\n4. **Document custom chains** - Keep track of which URL points where\n5. **Use HTTPS in production** - Never use `http://` for production chains\n6. **Set sensible defaults** - localhost:8080 works for most development\n\n## Related Documentation\n\n- [Development Setup](/contributing/setup/) - Initial environment configuration\n- [Architecture](/contributing/architecture/) - System design overview\n- [Deployment Guide](#) - Production deployment best practices (coming soon)\n",
    "html": "<p>Tana uses environment variables for configuration across all components. This provides a simple, consistent way to configure development, testing, and production environments.</p>\n<h2 id=\"tana_ledger_url\">TANA_LEDGER_URL</h2>\n<p><strong>Purpose:</strong> Configures the ledger API endpoint for all Tana components</p>\n<p><strong>Default:</strong> <code>http://localhost:8080</code></p>\n<p><strong>Usage:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"components-that-use-this-variable\">Components That Use This Variable</h3>\n<p><strong>CLI (TypeScript/Bun):</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Contract Runner Script:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Edge Server (Rust):</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"rust\"></div>\n\n\n\n<p><strong>Mobile App (React Native/Expo):</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"javascript\"></div>\n\n\n\n<h3 id=\"framework-specific-considerations\">Framework-Specific Considerations</h3>\n<p>Different frameworks access environment variables differently:</p>\n<p><strong>Bun/Node.js:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Astro:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Next.js:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Vite:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"8\" data-lang=\"typescript\"></div>\n\n\n\n<p><strong>Rust:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"9\" data-lang=\"rust\"></div>\n\n\n\n<h2 id=\"development-workflows\">Development Workflows</h2>\n<h3 id=\"local-development\">Local Development</h3>\n<p>For local development, the default value (<code>http://localhost:8080</code>) works automatically:</p>\n<div class=\"code-block-placeholder\" data-index=\"10\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"multi-chain-development\">Multi-Chain Development</h3>\n<p>Switch between chains by setting the environment variable:</p>\n<div class=\"code-block-placeholder\" data-index=\"11\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"dockercontainer-deployment\">Docker/Container Deployment</h3>\n<p><strong>Dockerfile:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"12\" data-lang=\"dockerfile\"></div>\n\n\n\n<p><strong>docker-compose.yml:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"13\" data-lang=\"yaml\"></div>\n\n\n\n<p><strong>Kubernetes:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"14\" data-lang=\"yaml\"></div>\n\n\n\n<h3 id=\"cicd-pipelines\">CI/CD Pipelines</h3>\n<p><strong>GitHub Actions:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"15\" data-lang=\"yaml\"></div>\n\n\n\n<p><strong>GitLab CI:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"16\" data-lang=\"yaml\"></div>\n\n\n\n<h2 id=\"production-configuration\">Production Configuration</h2>\n<h3 id=\"managed-hosting-tananetwork\">Managed Hosting (tana.network)</h3>\n<p>When using the official tana.network hosted service:</p>\n<div class=\"code-block-placeholder\" data-index=\"17\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"self-hosted\">Self-Hosted</h3>\n<p>When running your own blockchain infrastructure:</p>\n<div class=\"code-block-placeholder\" data-index=\"18\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"validation-and-debugging\">Validation and Debugging</h2>\n<h3 id=\"check-current-configuration\">Check Current Configuration</h3>\n<p><strong>CLI Status:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"19\" data-lang=\"bash\"></div>\n\n\n\n<p><strong>Environment Check:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"20\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"common-issues\">Common Issues</h3>\n<p><strong>Issue:</strong> CLI can&#39;t connect to ledger</p>\n<div class=\"code-block-placeholder\" data-index=\"21\" data-lang=\"bash\"></div>\n\n\n\n<p><strong>Issue:</strong> Wrong chain being targeted</p>\n<div class=\"code-block-placeholder\" data-index=\"22\" data-lang=\"bash\"></div>\n\n\n\n<p><strong>Issue:</strong> Docker container can&#39;t reach localhost</p>\n<div class=\"code-block-placeholder\" data-index=\"23\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"database_url\">DATABASE_URL</h2>\n<p><strong>Purpose:</strong> PostgreSQL connection string for blockchain data (ledger service)</p>\n<p><strong>Default:</strong> None (required for ledger service)</p>\n<p><strong>Format:</strong> <code>postgres://username:password@host:port/database</code></p>\n<p><strong>Usage:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"24\" data-lang=\"bash\"></div>\n\n\n\n<p><strong>Used by:</strong></p>\n<ul>\n<li>Ledger service (blockchain state storage)</li>\n<li>Block producer scripts</li>\n<li>Database migration tools</li>\n</ul>\n<h2 id=\"identity_db_url\">IDENTITY_DB_URL</h2>\n<p><strong>Purpose:</strong> PostgreSQL connection string for authentication data (identity service)</p>\n<p><strong>Default:</strong> Falls back to <code>DATABASE_URL</code> if not set</p>\n<p><strong>Format:</strong> <code>postgres://username:password@host:port/database</code></p>\n<p><strong>Usage:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"25\" data-lang=\"bash\"></div>\n\n\n\n<p><strong>Notes:</strong></p>\n<ul>\n<li>Authentication tables are separate from blockchain data</li>\n<li>NOT replicated across validators</li>\n<li>Can use same database as <code>DATABASE_URL</code> (tables don&#39;t overlap)</li>\n<li>Identity service only runs on API nodes (not validators)</li>\n</ul>\n<p><strong>Used by:</strong></p>\n<ul>\n<li>Identity service (QR authentication, session management)</li>\n</ul>\n<h2 id=\"redis_url\">REDIS_URL</h2>\n<p><strong>Purpose:</strong> Redis connection string for transaction queue</p>\n<p><strong>Default:</strong> <code>redis://localhost:6379</code></p>\n<p><strong>Format:</strong> <code>redis://[username:password@]host:port[/database]</code></p>\n<p><strong>Usage:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"26\" data-lang=\"bash\"></div>\n\n\n\n<p><strong>Requirements:</strong></p>\n<ul>\n<li>Redis 7+ required (Redis Streams support)</li>\n<li>Must support XADD, XREADGROUP, XACK commands</li>\n<li>Shared by all validators in the network</li>\n</ul>\n<p><strong>Used by:</strong></p>\n<ul>\n<li>Ledger service (transaction submission)</li>\n<li>Queue service (transaction queueing)</li>\n<li>Block producer scripts (transaction consumption)</li>\n</ul>\n<h2 id=\"port\">PORT</h2>\n<p><strong>Purpose:</strong> HTTP port for ledger service API</p>\n<p><strong>Default:</strong> <code>8080</code></p>\n<p><strong>Usage:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"27\" data-lang=\"bash\"></div>\n\n\n\n<p><strong>Used by:</strong></p>\n<ul>\n<li>Ledger service HTTP server</li>\n</ul>\n<h2 id=\"identity_port\">IDENTITY_PORT</h2>\n<p><strong>Purpose:</strong> HTTP port for identity service API</p>\n<p><strong>Default:</strong> <code>8090</code></p>\n<p><strong>Usage:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"28\" data-lang=\"bash\"></div>\n\n\n\n<p><strong>Used by:</strong></p>\n<ul>\n<li>Identity service HTTP server</li>\n</ul>\n<h2 id=\"edge_port\">EDGE_PORT</h2>\n<p><strong>Purpose:</strong> HTTP port for edge server (contract execution)</p>\n<p><strong>Default:</strong> <code>8180</code></p>\n<p><strong>Usage:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"29\" data-lang=\"bash\"></div>\n\n\n\n<p><strong>Used by:</strong></p>\n<ul>\n<li>Tana Edge server (Rust binary)</li>\n</ul>\n<h2 id=\"service-urls-for-client-applications\">Service URLs for Client Applications</h2>\n<p><strong>Purpose:</strong> Configure client apps to connect to Tana services</p>\n<h3 id=\"tana_identity_url\">TANA_IDENTITY_URL</h3>\n<p><strong>Default:</strong> <code>http://localhost:8090</code></p>\n<p><strong>Usage:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"30\" data-lang=\"bash\"></div>\n\n\n\n<p><strong>Used by:</strong></p>\n<ul>\n<li>Website applications (QR login pages)</li>\n<li>Mobile apps (authentication flows)</li>\n</ul>\n<h3 id=\"tana_edge_url\">TANA_EDGE_URL</h3>\n<p><strong>Default:</strong> <code>http://localhost:8180</code></p>\n<p><strong>Usage:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"31\" data-lang=\"bash\"></div>\n\n\n\n<p><strong>Used by:</strong></p>\n<ul>\n<li>Applications calling contract endpoints</li>\n<li>Edge function deployments</li>\n</ul>\n<h2 id=\"complete-development-setup\">Complete Development Setup</h2>\n<p>For local development, create a <code>.env</code> file in your project root:</p>\n<div class=\"code-block-placeholder\" data-index=\"32\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"complete-production-setup\">Complete Production Setup</h2>\n<p>For production deployment:</p>\n<div class=\"code-block-placeholder\" data-index=\"33\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"best-practices\">Best Practices</h2>\n<ol>\n<li><strong>Never commit <code>.env</code> files with secrets</strong> - Use <code>.env.example</code> instead</li>\n<li><strong>Use different values per environment</strong> - dev, staging, production</li>\n<li><strong>Validate URLs before deployment</strong> - Ensure endpoints are reachable</li>\n<li><strong>Document custom chains</strong> - Keep track of which URL points where</li>\n<li><strong>Use HTTPS in production</strong> - Never use <code>http://</code> for production chains</li>\n<li><strong>Set sensible defaults</strong> - localhost:8080 works for most development</li>\n</ol>\n<h2 id=\"related-documentation\">Related Documentation</h2>\n<ul>\n<li><a href=\"/contributing/setup/\">Development Setup</a> - Initial environment configuration</li>\n<li><a href=\"/contributing/architecture/\">Architecture</a> - System design overview</li>\n<li><a href=\"#\">Deployment Guide</a> - Production deployment best practices (coming soon)</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "# Development (default - no env var needed)\ntana new user @alice\n\n# Remote chain\nexport TANA_LEDGER_URL=https://mainnet.tana.network\ntana new user @alice\n\n# Per-command override\nTANA_LEDGER_URL=https://testnet.tana.network tana deploy user @alice"
      },
      {
        "lang": "typescript",
        "code": "// cli/utils/config.ts\nexport function getLedgerUrl(): string {\n  return process.env.TANA_LEDGER_URL || 'http://localhost:8080'\n}"
      },
      {
        "lang": "typescript",
        "code": "// scripts/run-contract.ts\nconst LEDGER_URL = process.env.TANA_LEDGER_URL || 'http://localhost:8080';"
      },
      {
        "lang": "rust",
        "code": "// tana-edge/src/main.rs\nuse std::env;\nlet ledger_url = env::var(\"TANA_LEDGER_URL\")\n    .unwrap_or_else(|_| \"http://localhost:8080\".to_string());"
      },
      {
        "lang": "javascript",
        "code": "// mobile/app.config.js\nextra: {\n  ledgerApiUrl: process.env.TANA_LEDGER_URL || 'http://localhost:8080'\n}"
      },
      {
        "lang": "typescript",
        "code": "process.env.TANA_LEDGER_URL"
      },
      {
        "lang": "typescript",
        "code": "import.meta.env.TANA_LEDGER_URL\n// Add to .env file in project root"
      },
      {
        "lang": "typescript",
        "code": "// Server-side\nprocess.env.TANA_LEDGER_URL\n\n// Client-side (requires NEXT_PUBLIC_ prefix)\nprocess.env.NEXT_PUBLIC_TANA_LEDGER_URL"
      },
      {
        "lang": "typescript",
        "code": "import.meta.env.VITE_TANA_LEDGER_URL\n// Add to .env file with VITE_ prefix"
      },
      {
        "lang": "rust",
        "code": "use std::env;\nenv::var(\"TANA_LEDGER_URL\").unwrap_or_else(|_| \"default\".to_string())"
      },
      {
        "lang": "bash",
        "code": "# Start the ledger\ntana start\n\n# Use CLI (automatically connects to localhost:8080)\ntana new user @alice\ntana deploy user @alice"
      },
      {
        "lang": "bash",
        "code": "# Work on local development chain\nTANA_LEDGER_URL=http://localhost:8080 tana status\n\n# Work on testnet\nTANA_LEDGER_URL=https://testnet.tana.network tana status\n\n# Work on custom community chain\nTANA_LEDGER_URL=https://my-chain.example.com tana status"
      },
      {
        "lang": "dockerfile",
        "code": "ENV TANA_LEDGER_URL=https://mainnet.tana.network"
      },
      {
        "lang": "yaml",
        "code": "services:\n  tana-edge:\n    environment:\n      - TANA_LEDGER_URL=https://mainnet.tana.network"
      },
      {
        "lang": "yaml",
        "code": "apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: tana-config\ndata:\n  TANA_LEDGER_URL: \"https://mainnet.tana.network\""
      },
      {
        "lang": "yaml",
        "code": "env:\n  TANA_LEDGER_URL: https://testnet.tana.network\n\nsteps:\n  - name: Run tests\n    run: bun test\n    env:\n      TANA_LEDGER_URL: http://localhost:8080"
      },
      {
        "lang": "yaml",
        "code": "variables:\n  TANA_LEDGER_URL: \"https://testnet.tana.network\""
      },
      {
        "lang": "bash",
        "code": "export TANA_LEDGER_URL=https://api.tana.network"
      },
      {
        "lang": "bash",
        "code": "# Single instance\nexport TANA_LEDGER_URL=https://ledger.mycompany.com\n\n# Load balanced\nexport TANA_LEDGER_URL=https://ledger-lb.mycompany.com\n\n# Internal network\nexport TANA_LEDGER_URL=http://ledger.internal:8080"
      },
      {
        "lang": "bash",
        "code": "tana status\n# Shows: Ledger: â— Running on http://localhost:8080"
      },
      {
        "lang": "bash",
        "code": "echo $TANA_LEDGER_URL\n# Should output the URL or be empty (uses default)"
      },
      {
        "lang": "bash",
        "code": "# Check if ledger is reachable\ncurl $TANA_LEDGER_URL/health\n\n# Verify environment variable is set correctly\necho $TANA_LEDGER_URL"
      },
      {
        "lang": "bash",
        "code": "# Check current configuration\ntana status\n\n# Override temporarily\nTANA_LEDGER_URL=https://correct-chain.com tana status"
      },
      {
        "lang": "bash",
        "code": "# In Docker, localhost refers to the container\n# Use host.docker.internal on Mac/Windows or host network mode on Linux\n\n# Docker for Mac/Windows\nexport TANA_LEDGER_URL=http://host.docker.internal:8080\n\n# Docker for Linux (use host network)\ndocker run --network host -e TANA_LEDGER_URL=http://localhost:8080 ..."
      },
      {
        "lang": "bash",
        "code": "# Development\nexport DATABASE_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\n\n# Production\nexport DATABASE_URL='postgres://prod_user:secure_password@db.example.com:5432/tana_prod'"
      },
      {
        "lang": "bash",
        "code": "# Development (can use same database as blockchain)\nexport IDENTITY_DB_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\n\n# Production (recommended: separate database for security)\nexport IDENTITY_DB_URL='postgres://identity_user:secure_password@identity-db.example.com:5432/tana_identity'"
      },
      {
        "lang": "bash",
        "code": "# Development\nexport REDIS_URL='redis://localhost:6379'\n\n# Production with authentication\nexport REDIS_URL='redis://username:password@redis.example.com:6379'\n\n# Redis Cluster\nexport REDIS_URL='redis://redis-cluster.example.com:6379'"
      },
      {
        "lang": "bash",
        "code": "# Development (default)\nexport PORT=8080\n\n# Production (custom port)\nexport PORT=3000"
      },
      {
        "lang": "bash",
        "code": "# Development (default)\nexport IDENTITY_PORT=8090\n\n# Production (custom port)\nexport IDENTITY_PORT=3001"
      },
      {
        "lang": "bash",
        "code": "# Development (default)\nexport EDGE_PORT=8180\n\n# Production (custom port)\nexport EDGE_PORT=8000"
      },
      {
        "lang": "bash",
        "code": "# Development\nexport TANA_IDENTITY_URL=http://localhost:8090\n\n# Production\nexport TANA_IDENTITY_URL=https://auth.tana.network"
      },
      {
        "lang": "bash",
        "code": "# Development\nexport TANA_EDGE_URL=http://localhost:8180\n\n# Production\nexport TANA_EDGE_URL=https://edge.tana.network"
      },
      {
        "lang": "bash",
        "code": "# .env\n\n# Database connections\nDATABASE_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\nIDENTITY_DB_URL='postgres://tana:tana_dev_password@localhost:5432/tana'\nREDIS_URL='redis://localhost:6379'\n\n# Service ports\nPORT=8080                    # Ledger service\nIDENTITY_PORT=8090           # Identity service\nEDGE_PORT=8180              # Edge server\n\n# Client URLs (for connecting to services)\nTANA_LEDGER_URL=http://localhost:8080\nTANA_IDENTITY_URL=http://localhost:8090\nTANA_EDGE_URL=http://localhost:8180\n\n# Environment\nNODE_ENV=development"
      },
      {
        "lang": "bash",
        "code": "# .env.production\n\n# Database connections (use secure passwords!)\nDATABASE_URL='postgres://prod_user:SECURE_PASSWORD@db.internal:5432/tana_prod'\nIDENTITY_DB_URL='postgres://identity_user:SECURE_PASSWORD@identity-db.internal:5432/tana_identity'\nREDIS_URL='redis://redis_user:SECURE_PASSWORD@redis.internal:6379'\n\n# Service ports (behind reverse proxy)\nPORT=8080\nIDENTITY_PORT=8090\nEDGE_PORT=8180\n\n# Public URLs (with SSL)\nTANA_LEDGER_URL=https://api.tana.network\nTANA_IDENTITY_URL=https://auth.tana.network\nTANA_EDGE_URL=https://edge.tana.network\n\n# Environment\nNODE_ENV=production"
      }
    ],
    "tableOfContents": [
      {
        "id": "tanaledgerurl",
        "text": "TANA_LEDGER_URL",
        "level": 2
      },
      {
        "id": "components-that-use-this-variable",
        "text": "Components That Use This Variable",
        "level": 3
      },
      {
        "id": "framework-specific-considerations",
        "text": "Framework-Specific Considerations",
        "level": 3
      },
      {
        "id": "development-workflows",
        "text": "Development Workflows",
        "level": 2
      },
      {
        "id": "local-development",
        "text": "Local Development",
        "level": 3
      },
      {
        "id": "multi-chain-development",
        "text": "Multi-Chain Development",
        "level": 3
      },
      {
        "id": "dockercontainer-deployment",
        "text": "Docker/Container Deployment",
        "level": 3
      },
      {
        "id": "cicd-pipelines",
        "text": "CI/CD Pipelines",
        "level": 3
      },
      {
        "id": "production-configuration",
        "text": "Production Configuration",
        "level": 2
      },
      {
        "id": "managed-hosting-tananetwork",
        "text": "Managed Hosting (tana.network)",
        "level": 3
      },
      {
        "id": "self-hosted",
        "text": "Self-Hosted",
        "level": 3
      },
      {
        "id": "validation-and-debugging",
        "text": "Validation and Debugging",
        "level": 2
      },
      {
        "id": "check-current-configuration",
        "text": "Check Current Configuration",
        "level": 3
      },
      {
        "id": "common-issues",
        "text": "Common Issues",
        "level": 3
      },
      {
        "id": "databaseurl",
        "text": "DATABASE_URL",
        "level": 2
      },
      {
        "id": "identitydburl",
        "text": "IDENTITY_DB_URL",
        "level": 2
      },
      {
        "id": "redisurl",
        "text": "REDIS_URL",
        "level": 2
      },
      {
        "id": "port",
        "text": "PORT",
        "level": 2
      },
      {
        "id": "identityport",
        "text": "IDENTITY_PORT",
        "level": 2
      },
      {
        "id": "edgeport",
        "text": "EDGE_PORT",
        "level": 2
      },
      {
        "id": "service-urls-for-client-applications",
        "text": "Service URLs for Client Applications",
        "level": 2
      },
      {
        "id": "tanaidentityurl",
        "text": "TANA_IDENTITY_URL",
        "level": 3
      },
      {
        "id": "tanaedgeurl",
        "text": "TANA_EDGE_URL",
        "level": 3
      },
      {
        "id": "complete-development-setup",
        "text": "Complete Development Setup",
        "level": 2
      },
      {
        "id": "complete-production-setup",
        "text": "Complete Production Setup",
        "level": 2
      },
      {
        "id": "best-practices",
        "text": "Best Practices",
        "level": 2
      },
      {
        "id": "related-documentation",
        "text": "Related Documentation",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "contributing",
      "kv-storage"
    ],
    "metadata": {
      "title": "KV Storage",
      "description": "Fast key-value storage for smart contracts"
    },
    "content": "\nTana provides Cloudflare Workers-compatible KV storage for smart contracts. Each contract gets isolated storage with automatic namespacing.\n\n## Quick Start\n\n```typescript\nimport { kv } from 'tana/kv'\n\n// Store text\nawait kv.put('username', 'alice')\n\n// Retrieve text\nconst name = await kv.get('username')\nconsole.log(name) // \"alice\"\n\n// Store JSON\nawait kv.put('user', { name: 'alice', balance: 1000 })\n\n// Retrieve JSON\nconst user = await kv.get('user', { type: 'json' })\nconsole.log(user.balance) // 1000\n\n// Delete\nawait kv.delete('username')\n\n// List keys\nconst result = await kv.list()\nconsole.log(result.keys) // [{ name: \"user\" }]\n```\n\n## API Reference\n\n### `kv.get(key, options?)`\n\nRetrieve a value.\n\n**Parameters:**\n- `key` (string): Storage key\n- `options.type` ('text' | 'json'): Return type (default: 'text')\n\n**Returns:** `Promise<string | object | null>`\n\n```typescript\n// Get as text (default)\nconst text = await kv.get('message')\n\n// Get as JSON\nconst data = await kv.get('config', { type: 'json' })\n\n// Missing key returns null\nconst missing = await kv.get('nonexistent') // null\n```\n\n### `kv.put(key, value, options?)`\n\nStore a value. Objects are automatically JSON-serialized.\n\n**Parameters:**\n- `key` (string): Storage key (max 512 bytes)\n- `value` (string | object): Value to store (max 25 MB)\n- `options` (optional): Reserved for future features (TTL, metadata)\n\n**Returns:** `Promise<void>`\n\n```typescript\n// Store string\nawait kv.put('status', 'active')\n\n// Store object (auto-serialized)\nawait kv.put('user', { id: 1, name: 'alice' })\n```\n\n### `kv.delete(key)`\n\nDelete a key. No error if key doesn't exist.\n\n**Parameters:**\n- `key` (string): Key to delete\n\n**Returns:** `Promise<void>`\n\n```typescript\nawait kv.delete('session')\n```\n\n### `kv.list(options?)`\n\nList keys, optionally filtered by prefix.\n\n**Parameters:**\n- `options.prefix` (string): Filter by prefix\n- `options.limit` (number): Max keys to return (default: 1000)\n\n**Returns:** `Promise<{ keys: Array<{ name: string }>, list_complete: boolean, cursor: string | null }>`\n\n```typescript\n// List all keys\nconst all = await kv.list()\n\n// List with prefix\nconst users = await kv.list({ prefix: 'user:' })\n\n// Limit results\nconst first10 = await kv.list({ limit: 10 })\n```\n\n## Common Patterns\n\n### Counter\n\n```typescript\nconst current = await kv.get('counter', { type: 'json' })\nconst count = (current?.count || 0) + 1\nawait kv.put('counter', { count })\n```\n\n### Session Storage\n\n```typescript\n// Create session\nawait kv.put(`session:${sessionId}`, {\n  userId: 'alice',\n  createdAt: Date.now()\n})\n\n// Get session\nconst session = await kv.get(`session:${sessionId}`, { type: 'json' })\n\n// Delete session\nawait kv.delete(`session:${sessionId}`)\n```\n\n### Cache with Prefix\n\n```typescript\n// Store multiple items\nawait kv.put('cache:user:1', { name: 'alice' })\nawait kv.put('cache:user:2', { name: 'bob' })\nawait kv.put('cache:post:1', { title: 'Hello' })\n\n// List only cache:user: items\nconst users = await kv.list({ prefix: 'cache:user:' })\n// Result: [{ name: \"cache:user:1\" }, { name: \"cache:user:2\" }]\n```\n\n### User Preferences\n\n```typescript\nimport { context } from 'tana/context'\nimport { kv } from 'tana/kv'\n\nexport async function get() {\n  const caller = context.caller()\n  const prefs = await kv.get(`prefs:${caller}`, { type: 'json' })\n\n  return prefs || { theme: 'dark', notifications: true }\n}\n\nexport async function post(req) {\n  const caller = context.caller()\n  const prefs = req.body\n\n  await kv.put(`prefs:${caller}`, prefs)\n  return { success: true }\n}\n```\n\n## Limits & Constraints\n\n- **Key length:** 512 bytes max\n- **Value size:** 25 MB max\n- **Keys per list():** 1000 max (use prefix to narrow)\n- **Namespace:** Automatic per-contract isolation\n- **TTL:** Not yet supported (coming soon)\n- **Metadata:** Not yet supported (coming soon)\n\n## Storage Backends\n\nKV storage uses different backends depending on environment:\n\n| Environment | Backend | Notes |\n|-------------|---------|-------|\n| tana-runtime | PostgreSQL | Persistent across restarts |\n| tana-edge | In-memory | Fast but not persistent |\n| Playground | localStorage | Browser-based, persistent per-browser |\n\nAll backends provide identical API and behavior.\n\n## Best Practices\n\nâœ… **Use prefixes** to organize related keys:\n```typescript\nawait kv.put('user:1:profile', data)\nawait kv.put('user:1:settings', data)\n```\n\nâœ… **Check for null** when retrieving:\n```typescript\nconst data = await kv.get('key', { type: 'json' })\nif (!data) {\n  // Handle missing key\n}\n```\n\nâœ… **Use type parameter** for JSON to get proper typing:\n```typescript\nconst user = await kv.get('user', { type: 'json' }) as User\n```\n\nâŒ **Don't exceed limits:**\n```typescript\n// BAD: Key too long\nawait kv.put('x'.repeat(1000), 'value') // Error!\n\n// GOOD: Keep keys short\nawait kv.put('user:1', 'value')\n```\n\nâŒ **Don't store sensitive data** without encryption:\n```typescript\n// BAD: Plain text password\nawait kv.put('password', 'secret123')\n\n// GOOD: Hash or encrypt first\nawait kv.put('password_hash', hashPassword('secret123'))\n```\n\n## Next Steps\n\n- See [Smart Contracts](/guides/smart-contracts) for full contract development guide\n- Check [examples/kv-demo.ts](https://github.com/yourusername/tana/blob/main/examples/kv-demo.ts) for complete examples\n- Read [KV Patterns](/guides/patterns/kv-patterns) for advanced techniques\n",
    "html": "<p>Tana provides Cloudflare Workers-compatible KV storage for smart contracts. Each contract gets isolated storage with automatic namespacing.</p>\n<h2 id=\"quick-start\">Quick Start</h2>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"api-reference\">API Reference</h2>\n<h3 id=\"kvgetkey-options\"><code>kv.get(key, options?)</code></h3>\n<p>Retrieve a value.</p>\n<p><strong>Parameters:</strong></p>\n<ul>\n<li><code>key</code> (string): Storage key</li>\n<li><code>options.type</code> (&#39;text&#39; | &#39;json&#39;): Return type (default: &#39;text&#39;)</li>\n</ul>\n<p><strong>Returns:</strong> <code>Promise&lt;string | object | null&gt;</code></p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"kvputkey-value-options\"><code>kv.put(key, value, options?)</code></h3>\n<p>Store a value. Objects are automatically JSON-serialized.</p>\n<p><strong>Parameters:</strong></p>\n<ul>\n<li><code>key</code> (string): Storage key (max 512 bytes)</li>\n<li><code>value</code> (string | object): Value to store (max 25 MB)</li>\n<li><code>options</code> (optional): Reserved for future features (TTL, metadata)</li>\n</ul>\n<p><strong>Returns:</strong> <code>Promise&lt;void&gt;</code></p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"kvdeletekey\"><code>kv.delete(key)</code></h3>\n<p>Delete a key. No error if key doesn&#39;t exist.</p>\n<p><strong>Parameters:</strong></p>\n<ul>\n<li><code>key</code> (string): Key to delete</li>\n</ul>\n<p><strong>Returns:</strong> <code>Promise&lt;void&gt;</code></p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"kvlistoptions\"><code>kv.list(options?)</code></h3>\n<p>List keys, optionally filtered by prefix.</p>\n<p><strong>Parameters:</strong></p>\n<ul>\n<li><code>options.prefix</code> (string): Filter by prefix</li>\n<li><code>options.limit</code> (number): Max keys to return (default: 1000)</li>\n</ul>\n<p><strong>Returns:</strong> <code>Promise&lt;{ keys: Array&lt;{ name: string }&gt;, list_complete: boolean, cursor: string | null }&gt;</code></p>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"common-patterns\">Common Patterns</h2>\n<h3 id=\"counter\">Counter</h3>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"session-storage\">Session Storage</h3>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"cache-with-prefix\">Cache with Prefix</h3>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"user-preferences\">User Preferences</h3>\n<div class=\"code-block-placeholder\" data-index=\"8\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"limits--constraints\">Limits &amp; Constraints</h2>\n<ul>\n<li><strong>Key length:</strong> 512 bytes max</li>\n<li><strong>Value size:</strong> 25 MB max</li>\n<li><strong>Keys per list():</strong> 1000 max (use prefix to narrow)</li>\n<li><strong>Namespace:</strong> Automatic per-contract isolation</li>\n<li><strong>TTL:</strong> Not yet supported (coming soon)</li>\n<li><strong>Metadata:</strong> Not yet supported (coming soon)</li>\n</ul>\n<h2 id=\"storage-backends\">Storage Backends</h2>\n<p>KV storage uses different backends depending on environment:</p>\n<table>\n<thead>\n<tr>\n<th>Environment</th>\n<th>Backend</th>\n<th>Notes</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>tana-runtime</td>\n<td>PostgreSQL</td>\n<td>Persistent across restarts</td>\n</tr>\n<tr>\n<td>tana-edge</td>\n<td>In-memory</td>\n<td>Fast but not persistent</td>\n</tr>\n<tr>\n<td>Playground</td>\n<td>localStorage</td>\n<td>Browser-based, persistent per-browser</td>\n</tr>\n</tbody></table>\n<p>All backends provide identical API and behavior.</p>\n<h2 id=\"best-practices\">Best Practices</h2>\n<p>âœ… <strong>Use prefixes</strong> to organize related keys:</p>\n<div class=\"code-block-placeholder\" data-index=\"9\" data-lang=\"typescript\"></div>\n\n\n\n<p>âœ… <strong>Check for null</strong> when retrieving:</p>\n<div class=\"code-block-placeholder\" data-index=\"10\" data-lang=\"typescript\"></div>\n\n\n\n<p>âœ… <strong>Use type parameter</strong> for JSON to get proper typing:</p>\n<div class=\"code-block-placeholder\" data-index=\"11\" data-lang=\"typescript\"></div>\n\n\n\n<p>âŒ <strong>Don&#39;t exceed limits:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"12\" data-lang=\"typescript\"></div>\n\n\n\n<p>âŒ <strong>Don&#39;t store sensitive data</strong> without encryption:</p>\n<div class=\"code-block-placeholder\" data-index=\"13\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li>See <a href=\"/guides/smart-contracts\">Smart Contracts</a> for full contract development guide</li>\n<li>Check <a href=\"https://github.com/yourusername/tana/blob/main/examples/kv-demo.ts\">examples/kv-demo.ts</a> for complete examples</li>\n<li>Read <a href=\"/guides/patterns/kv-patterns\">KV Patterns</a> for advanced techniques</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "typescript",
        "code": "import { kv } from 'tana/kv'\n\n// Store text\nawait kv.put('username', 'alice')\n\n// Retrieve text\nconst name = await kv.get('username')\nconsole.log(name) // \"alice\"\n\n// Store JSON\nawait kv.put('user', { name: 'alice', balance: 1000 })\n\n// Retrieve JSON\nconst user = await kv.get('user', { type: 'json' })\nconsole.log(user.balance) // 1000\n\n// Delete\nawait kv.delete('username')\n\n// List keys\nconst result = await kv.list()\nconsole.log(result.keys) // [{ name: \"user\" }]"
      },
      {
        "lang": "typescript",
        "code": "// Get as text (default)\nconst text = await kv.get('message')\n\n// Get as JSON\nconst data = await kv.get('config', { type: 'json' })\n\n// Missing key returns null\nconst missing = await kv.get('nonexistent') // null"
      },
      {
        "lang": "typescript",
        "code": "// Store string\nawait kv.put('status', 'active')\n\n// Store object (auto-serialized)\nawait kv.put('user', { id: 1, name: 'alice' })"
      },
      {
        "lang": "typescript",
        "code": "await kv.delete('session')"
      },
      {
        "lang": "typescript",
        "code": "// List all keys\nconst all = await kv.list()\n\n// List with prefix\nconst users = await kv.list({ prefix: 'user:' })\n\n// Limit results\nconst first10 = await kv.list({ limit: 10 })"
      },
      {
        "lang": "typescript",
        "code": "const current = await kv.get('counter', { type: 'json' })\nconst count = (current?.count || 0) + 1\nawait kv.put('counter', { count })"
      },
      {
        "lang": "typescript",
        "code": "// Create session\nawait kv.put(`session:${sessionId}`, {\n  userId: 'alice',\n  createdAt: Date.now()\n})\n\n// Get session\nconst session = await kv.get(`session:${sessionId}`, { type: 'json' })\n\n// Delete session\nawait kv.delete(`session:${sessionId}`)"
      },
      {
        "lang": "typescript",
        "code": "// Store multiple items\nawait kv.put('cache:user:1', { name: 'alice' })\nawait kv.put('cache:user:2', { name: 'bob' })\nawait kv.put('cache:post:1', { title: 'Hello' })\n\n// List only cache:user: items\nconst users = await kv.list({ prefix: 'cache:user:' })\n// Result: [{ name: \"cache:user:1\" }, { name: \"cache:user:2\" }]"
      },
      {
        "lang": "typescript",
        "code": "import { context } from 'tana/context'\nimport { kv } from 'tana/kv'\n\nexport async function get() {\n  const caller = context.caller()\n  const prefs = await kv.get(`prefs:${caller}`, { type: 'json' })\n\n  return prefs || { theme: 'dark', notifications: true }\n}\n\nexport async function post(req) {\n  const caller = context.caller()\n  const prefs = req.body\n\n  await kv.put(`prefs:${caller}`, prefs)\n  return { success: true }\n}"
      },
      {
        "lang": "typescript",
        "code": "await kv.put('user:1:profile', data)\nawait kv.put('user:1:settings', data)"
      },
      {
        "lang": "typescript",
        "code": "const data = await kv.get('key', { type: 'json' })\nif (!data) {\n  // Handle missing key\n}"
      },
      {
        "lang": "typescript",
        "code": "const user = await kv.get('user', { type: 'json' }) as User"
      },
      {
        "lang": "typescript",
        "code": "// BAD: Key too long\nawait kv.put('x'.repeat(1000), 'value') // Error!\n\n// GOOD: Keep keys short\nawait kv.put('user:1', 'value')"
      },
      {
        "lang": "typescript",
        "code": "// BAD: Plain text password\nawait kv.put('password', 'secret123')\n\n// GOOD: Hash or encrypt first\nawait kv.put('password_hash', hashPassword('secret123'))"
      }
    ],
    "tableOfContents": [
      {
        "id": "quick-start",
        "text": "Quick Start",
        "level": 2
      },
      {
        "id": "api-reference",
        "text": "API Reference",
        "level": 2
      },
      {
        "id": "kvgetkey-options",
        "text": "`kv.get(key, options?)`",
        "level": 3
      },
      {
        "id": "kvputkey-value-options",
        "text": "`kv.put(key, value, options?)`",
        "level": 3
      },
      {
        "id": "kvdeletekey",
        "text": "`kv.delete(key)`",
        "level": 3
      },
      {
        "id": "kvlistoptions",
        "text": "`kv.list(options?)`",
        "level": 3
      },
      {
        "id": "common-patterns",
        "text": "Common Patterns",
        "level": 2
      },
      {
        "id": "counter",
        "text": "Counter",
        "level": 3
      },
      {
        "id": "session-storage",
        "text": "Session Storage",
        "level": 3
      },
      {
        "id": "cache-with-prefix",
        "text": "Cache with Prefix",
        "level": 3
      },
      {
        "id": "user-preferences",
        "text": "User Preferences",
        "level": 3
      },
      {
        "id": "limits-constraints",
        "text": "Limits & Constraints",
        "level": 2
      },
      {
        "id": "storage-backends",
        "text": "Storage Backends",
        "level": 2
      },
      {
        "id": "best-practices",
        "text": "Best Practices",
        "level": 2
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  },
  {
    "slug": [],
    "metadata": {
      "title": "Tana Documentation",
      "description": "A blockchain with smart contracts written in TypeScript",
      "template": "splash",
      "hero": {
        "tagline": "User-owned blockchain with TypeScript smart contracts. No native token required.",
        "image": {
          "file": "../../assets/houston.webp"
        },
        "actions": [
          {
            "text": "Quick Start",
            "link": "/guides/quickstart/",
            "icon": "right-arrow",
            "variant": "primary"
          },
          {
            "text": "View on GitHub",
            "link": "https://github.com/tananetwork",
            "icon": "external",
            "variant": "minimal"
          }
        ]
      }
    },
    "content": "\nimport { Card, CardGrid } from '@astrojs/starlight/components';\n\n## What is Tana?\n\nTana is a blockchain platform designed to be **user-owned and operated**. Anyone can start their own blockchain or join existing networks as a validator node. Smart contracts are written in familiar **TypeScript** and executed in a sandboxed V8 environment.\n\n## Key Features\n\n<CardGrid>\n  <Card title=\"TypeScript Contracts\" icon=\"seti:typescript\">\n    Write smart contracts in TypeScript - no new language to learn. Full type safety and familiar tooling.\n  </Card>\n\n  <Card title=\"Multi-Currency Support\" icon=\"puzzle\">\n    No native token required. Create and manage any currency directly in your contracts.\n  </Card>\n\n  <Card title=\"CLI-First Design\" icon=\"laptop\">\n    Everything controllable from the terminal. Deploy, manage, and monitor your blockchain from the command line.\n  </Card>\n\n  <Card title=\"Decentralized Nodes\" icon=\"setting\">\n    Start your own chain or join existing networks. Full validator node capabilities.\n  </Card>\n</CardGrid>\n\n## Quick Example\n\n```typescript\nimport { console } from 'tana:core'\nimport { kv } from 'tana:kv'\n\n// Simple counter contract\nconst current = await kv.get('counter')\nconst count = current ? parseInt(current) : 0\n\nawait kv.put('counter', String(count + 1))\n\nconsole.log('Counter:', count + 1)\n```\n\n## For Users\n\n<CardGrid>\n  <Card title=\"Quick Start\" icon=\"rocket\">\n    Install Tana and start using the blockchain.\n\n    [Get Started â†’](/guides/quickstart/)\n  </Card>\n\n  <Card title=\"CLI Reference\" icon=\"laptop\">\n    Complete command reference for the Tana CLI.\n\n    [View Commands â†’](/tana-cli/intro/)\n  </Card>\n\n  <Card title=\"API Reference\" icon=\"open-book\">\n    REST API documentation for the ledger service.\n\n    [View API â†’](/tana-api/intro/)\n  </Card>\n</CardGrid>\n\n## For Sovereigns\n\nRun your own Tana network. Self-host for your organization or launch a public chain.\n\n<CardGrid>\n  <Card title=\"Getting Started\" icon=\"star\">\n    Overview of running your own network.\n\n    [Sovereign Guide â†’](/sovereign/intro/)\n  </Card>\n\n  <Card title=\"Starting Docker\" icon=\"server\">\n    Bring up all services with Docker Compose.\n\n    [Docker Guide â†’](/sovereign/docker/)\n  </Card>\n\n  <Card title=\"Genesis Setup\" icon=\"rocket\">\n    Initialize your blockchain with the genesis block.\n\n    [Genesis Docs â†’](/sovereign/genesis/)\n  </Card>\n\n  <Card title=\"Validators\" icon=\"setting\">\n    Configure multi-validator consensus.\n\n    [Validator Setup â†’](/sovereign/validators/)\n  </Card>\n</CardGrid>\n\n## For Developers\n\n<CardGrid>\n  <Card title=\"Development Setup\" icon=\"setting\">\n    Build Tana from source and set up your dev environment.\n\n    [Get Started â†’](/contributing/setup/)\n  </Card>\n\n  <Card title=\"System Architecture\" icon=\"puzzle\">\n    Learn how Tana's components work together internally.\n\n    [Learn More â†’](/contributing/architecture/)\n  </Card>\n\n  <Card title=\"Core Concepts\" icon=\"document\">\n    Deep dive into data models, blocks, and system flows.\n\n    [Technical Docs â†’](/contributing/core/data-model/)\n  </Card>\n</CardGrid>\n\n## Architecture Overview\n\nTana consists of **five compiled binaries**:\n\n- **`tana`** - Main CLI for managing chains, users, and contracts\n- **`tana-runtime`** - Rust V8 engine for on-chain contract execution\n- **`tana-edge`** - HTTP server for off-chain contract APIs\n- **`tana-mesh`** - Network coordinator for validator discovery\n- **`tana-t4`** - Content-addressable storage service\n\nAll orchestrated through the CLI:\n\n```bash\n# Install Tana\nnpm install -g @tananetwork/tana\n\n# Create a blockchain\ntana new chain local\n\n# Deploy a smart contract\ntana deploy contract ./contract.ts\n```\n\n---\n\n**Status:** Testnet ready - Multi-validator consensus operational\n\nBuilt with Rust (deno_core), TypeScript, Bun, PostgreSQL, and Redis.\n",
    "html": "<p>import { Card, CardGrid } from &#39;@astrojs/starlight/components&#39;;</p>\n<h2 id=\"what-is-tana\">What is Tana?</h2>\n<p>Tana is a blockchain platform designed to be <strong>user-owned and operated</strong>. Anyone can start their own blockchain or join existing networks as a validator node. Smart contracts are written in familiar <strong>TypeScript</strong> and executed in a sandboxed V8 environment.</p>\n<h2 id=\"key-features\">Key Features</h2>\n<CardGrid>\n  <Card title=\"TypeScript Contracts\" icon=\"seti:typescript\">\n    Write smart contracts in TypeScript - no new language to learn. Full type safety and familiar tooling.\n  </Card>\n\n  <Card title=\"Multi-Currency Support\" icon=\"puzzle\">\n    No native token required. Create and manage any currency directly in your contracts.\n  </Card>\n\n  <Card title=\"CLI-First Design\" icon=\"laptop\">\n    Everything controllable from the terminal. Deploy, manage, and monitor your blockchain from the command line.\n  </Card>\n\n  <Card title=\"Decentralized Nodes\" icon=\"setting\">\n    Start your own chain or join existing networks. Full validator node capabilities.\n  </Card>\n</CardGrid>\n\n<h2 id=\"quick-example\">Quick Example</h2>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"for-users\">For Users</h2>\n<CardGrid>\n  <Card title=\"Quick Start\" icon=\"rocket\">\n    Install Tana and start using the blockchain.\n\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[Get Started â†’](/guides/quickstart/)</span></span></code></pre>  </Card>\n\n  <Card title=\"CLI Reference\" icon=\"laptop\">\n    Complete command reference for the Tana CLI.\n\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[View Commands â†’](/tana-cli/intro/)</span></span></code></pre>  </Card>\n\n  <Card title=\"API Reference\" icon=\"open-book\">\n    REST API documentation for the ledger service.\n\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[View API â†’](/tana-api/intro/)</span></span></code></pre>  </Card>\n</CardGrid>\n\n<h2 id=\"for-sovereigns\">For Sovereigns</h2>\n<p>Run your own Tana network. Self-host for your organization or launch a public chain.</p>\n<CardGrid>\n  <Card title=\"Getting Started\" icon=\"star\">\n    Overview of running your own network.\n\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[Sovereign Guide â†’](/sovereign/intro/)</span></span></code></pre>  </Card>\n\n  <Card title=\"Starting Docker\" icon=\"server\">\n    Bring up all services with Docker Compose.\n\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[Docker Guide â†’](/sovereign/docker/)</span></span></code></pre>  </Card>\n\n  <Card title=\"Genesis Setup\" icon=\"rocket\">\n    Initialize your blockchain with the genesis block.\n\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[Genesis Docs â†’](/sovereign/genesis/)</span></span></code></pre>  </Card>\n\n  <Card title=\"Validators\" icon=\"setting\">\n    Configure multi-validator consensus.\n\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[Validator Setup â†’](/sovereign/validators/)</span></span></code></pre>  </Card>\n</CardGrid>\n\n<h2 id=\"for-developers\">For Developers</h2>\n<CardGrid>\n  <Card title=\"Development Setup\" icon=\"setting\">\n    Build Tana from source and set up your dev environment.\n\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[Get Started â†’](/contributing/setup/)</span></span></code></pre>  </Card>\n\n  <Card title=\"System Architecture\" icon=\"puzzle\">\n    Learn how Tana's components work together internally.\n\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[Learn More â†’](/contributing/architecture/)</span></span></code></pre>  </Card>\n\n  <Card title=\"Core Concepts\" icon=\"document\">\n    Deep dive into data models, blocks, and system flows.\n\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[Technical Docs â†’](/contributing/core/data-model/)</span></span></code></pre>  </Card>\n</CardGrid>\n\n<h2 id=\"architecture-overview\">Architecture Overview</h2>\n<p>Tana consists of <strong>five compiled binaries</strong>:</p>\n<ul>\n<li><strong><code>tana</code></strong> - Main CLI for managing chains, users, and contracts</li>\n<li><strong><code>tana-runtime</code></strong> - Rust V8 engine for on-chain contract execution</li>\n<li><strong><code>tana-edge</code></strong> - HTTP server for off-chain contract APIs</li>\n<li><strong><code>tana-mesh</code></strong> - Network coordinator for validator discovery</li>\n<li><strong><code>tana-t4</code></strong> - Content-addressable storage service</li>\n</ul>\n<p>All orchestrated through the CLI:</p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"bash\"></div>\n\n\n\n<hr>\n<p><strong>Status:</strong> Testnet ready - Multi-validator consensus operational</p>\n<p>Built with Rust (deno_core), TypeScript, Bun, PostgreSQL, and Redis.</p>\n",
    "codeBlocks": [
      {
        "lang": "typescript",
        "code": "import { console } from 'tana:core'\nimport { kv } from 'tana:kv'\n\n// Simple counter contract\nconst current = await kv.get('counter')\nconst count = current ? parseInt(current) : 0\n\nawait kv.put('counter', String(count + 1))\n\nconsole.log('Counter:', count + 1)"
      },
      {
        "lang": "bash",
        "code": "# Install Tana\nnpm install -g @tananetwork/tana\n\n# Create a blockchain\ntana new chain local\n\n# Deploy a smart contract\ntana deploy contract ./contract.ts"
      }
    ],
    "tableOfContents": [
      {
        "id": "what-is-tana",
        "text": "What is Tana?",
        "level": 2
      },
      {
        "id": "key-features",
        "text": "Key Features",
        "level": 2
      },
      {
        "id": "quick-example",
        "text": "Quick Example",
        "level": 2
      },
      {
        "id": "for-users",
        "text": "For Users",
        "level": 2
      },
      {
        "id": "for-sovereigns",
        "text": "For Sovereigns",
        "level": 2
      },
      {
        "id": "for-developers",
        "text": "For Developers",
        "level": 2
      },
      {
        "id": "architecture-overview",
        "text": "Architecture Overview",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "tana-app",
      "intro"
    ],
    "metadata": {
      "title": "Mobile App",
      "description": "Secure wallet and signing approvals for Tana",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nTana Mobile is a React Native application built with Expo that provides secure wallet storage, balance visibility, and transaction signing for the Tana blockchain.\n\n## Features\n\n- **Secure Key Storage** - Ed25519 wallet keys stored entirely on-device using secure storage\n- **Balance Visibility** - View your current ledger balances linked to wallet addresses\n- **Transaction Signing** - Authorize external requests (web, CLI) by signing challenge payloads\n- **Automatic Registration** - Wallets are automatically registered on the blockchain when created\n- **Multi-Platform** - iOS, Android, and Web support via Expo\n\n## Getting Started\n\n### Installation\n\n```bash\ncd mobile\nnpm install\nnpm run start  # Opens Expo Dev Tools\n```\n\nLaunch directly on a platform:\n```bash\nnpm run ios      # iOS simulator\nnpm run android  # Android emulator\nnpm run web      # Web browser\n```\n\n### Environment Configuration\n\nBy default, the app connects to your local development ledger at `http://localhost:8080`.\n\nMake sure your local ledger service is running:\n\n```bash\n# Start the app (defaults to localhost:8080)\nnpm start\n```\n\nThen press `i` for iOS simulator or `a` for Android emulator.\n\n**To connect to production:**\n\n```bash\n# Option 1: Use the convenience script\nnpm run start:prod\n\n# Option 2: Set TANA_LEDGER_URL manually\nTANA_LEDGER_URL=https://mainnet.tana.network npm start\n```\n\nSee [Environment Variables](/contributing/env-vars/) for more configuration options.\n\n## Using the App\n\n### Creating a Wallet\n\n1. **Open the Vault screen** - Your main wallet dashboard\n2. **Tap \"Add Wallet\"**\n3. **Choose an option:**\n   - **Generate New** - Creates a new Ed25519 keypair\n   - **Import Existing** - Import from private key\n4. **Enter details:**\n   - Display name (your public blockchain name)\n   - Username (unique blockchain handle, must start with @)\n5. **Tap \"Generate & Register\" or \"Import & Register\"**\n\nYour wallet is automatically registered on the blockchain with your public key!\n\n### Blockchain Registration\n\nEvery wallet creation automatically registers on the blockchain:\n- Username must be unique (app will error if taken)\n- Display name and username are required fields\n- Backend creates a `user_creation` transaction immediately\n- **Registration completes when the next block is produced**\n\n**Transaction Flow:**\n- Wallet is saved locally immediately with a pre-assigned user ID\n- The user creation transaction is marked as \"pending\"\n- User appears on blockchain after block production\n- In production, blocks are produced automatically (e.g., every 6 seconds)\n\n### Viewing Balances\n\nFrom the Vault screen:\n- See all your wallets and their balances\n- Tap a wallet to view details\n- Copy public keys or export private keys (securely!)\n\n### Signing Transactions\n\nThe approval screen accepts QR codes or manual challenges:\n1. Scan a QR code or paste a challenge\n2. Choose which wallet to sign with\n3. Review the transaction details\n4. Approve to generate an Ed25519 signature\n\nYour signature can then be used to authorize transactions on the blockchain.\n\n## Security\n\n- **Wallet metadata** stored in `AsyncStorage`\n- **Private keys** stored in secure storage (`expo-secure-store`)\n- **Keys never leave your device** - all signing happens locally\n- **Export keys before uninstalling** - secure storage is cleared on uninstall\n\n:::caution\nAlways back up your private keys! If you lose your device and haven't exported your keys, they cannot be recovered.\n:::\n\n## Troubleshooting\n\n### White Screen on Launch\n\nIf you see a white screen, ensure all dependencies are installed:\n\n```bash\nnpx expo-doctor  # Check for issues\nnpx expo install --fix  # Fix package versions\n```\n\nCommon fixes:\n- Install `expo-font`: `npx expo install expo-font`\n- Remove `@types/react-native` if installed (types are included with react-native)\n\n### Xcode Version\n\nExpo SDK 51+ requires Xcode â‰¤16.2.0. If you have a newer version:\n- Downgrade Xcode for iOS builds\n- Use the Expo Go app for testing instead of building locally\n\n### Connection Issues\n\nIf the app can't connect to the ledger:\n- Verify the ledger is running: `tana status`\n- Check the `TANA_LEDGER_URL` environment variable\n- For local development on a physical device, use your computer's IP address instead of `localhost`\n\n## Technical Details\n\n### Project Structure\n\n```\nmobile/\nâ”œâ”€â”€ App.tsx                     # Entry point with navigation\nâ”œâ”€â”€ app.config.js               # Expo configuration + env vars\nâ”œâ”€â”€ src/\nâ”‚   â”œâ”€â”€ components/\nâ”‚   â”‚   â””â”€â”€ KeyCard.tsx         # Wallet summary display\nâ”‚   â”œâ”€â”€ contexts/\nâ”‚   â”‚   â””â”€â”€ KeyStoreContext.tsx # Wallet vault + secure storage\nâ”‚   â”œâ”€â”€ lib/\nâ”‚   â”‚   â””â”€â”€ ledgerApi.ts        # REST API client\nâ”‚   â”œâ”€â”€ screens/\nâ”‚   â”‚   â”œâ”€â”€ AddKeyScreen.tsx    # Generate/import wallets\nâ”‚   â”‚   â”œâ”€â”€ LoginApprovalScreen.tsx # Challenge signing\nâ”‚   â”‚   â””â”€â”€ VaultScreen.tsx     # Wallet list, balances\nâ”‚   â””â”€â”€ utils/\nâ”‚       â””â”€â”€ crypto.ts           # Ed25519 cryptography\n```\n\n### Compatibility\n\n- React Native 0.81 / Expo SDK 54\n- TypeScript strict mode enabled\n- Ed25519 via `@noble/ed25519`\n- QR scanning via `expo-camera`\n\n## Future Enhancements\n\n- Biometric authentication for transaction signing\n- QR-powered challenges for easier approvals\n- Push/deep link handling for automatic approval requests\n- Encrypted backup/export flows for device migration\n- Multi-network support with configurable endpoints\n\n## Related Documentation\n\n- [CLI Commands](/tana-cli/commands/) - Command-line interface\n- [API Reference](/tana-api/intro/) - Ledger API endpoints\n- [Environment Variables](/contributing/env-vars/) - Configuration options\n",
    "html": "<p>Tana Mobile is a React Native application built with Expo that provides secure wallet storage, balance visibility, and transaction signing for the Tana blockchain.</p>\n<h2 id=\"features\">Features</h2>\n<ul>\n<li><strong>Secure Key Storage</strong> - Ed25519 wallet keys stored entirely on-device using secure storage</li>\n<li><strong>Balance Visibility</strong> - View your current ledger balances linked to wallet addresses</li>\n<li><strong>Transaction Signing</strong> - Authorize external requests (web, CLI) by signing challenge payloads</li>\n<li><strong>Automatic Registration</strong> - Wallets are automatically registered on the blockchain when created</li>\n<li><strong>Multi-Platform</strong> - iOS, Android, and Web support via Expo</li>\n</ul>\n<h2 id=\"getting-started\">Getting Started</h2>\n<h3 id=\"installation\">Installation</h3>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<p>Launch directly on a platform:</p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"environment-configuration\">Environment Configuration</h3>\n<p>By default, the app connects to your local development ledger at <code>http://localhost:8080</code>.</p>\n<p>Make sure your local ledger service is running:</p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"bash\"></div>\n\n\n\n<p>Then press <code>i</code> for iOS simulator or <code>a</code> for Android emulator.</p>\n<p><strong>To connect to production:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"bash\"></div>\n\n\n\n<p>See <a href=\"/contributing/env-vars/\">Environment Variables</a> for more configuration options.</p>\n<h2 id=\"using-the-app\">Using the App</h2>\n<h3 id=\"creating-a-wallet\">Creating a Wallet</h3>\n<ol>\n<li><strong>Open the Vault screen</strong> - Your main wallet dashboard</li>\n<li><strong>Tap &quot;Add Wallet&quot;</strong></li>\n<li><strong>Choose an option:</strong><ul>\n<li><strong>Generate New</strong> - Creates a new Ed25519 keypair</li>\n<li><strong>Import Existing</strong> - Import from private key</li>\n</ul>\n</li>\n<li><strong>Enter details:</strong><ul>\n<li>Display name (your public blockchain name)</li>\n<li>Username (unique blockchain handle, must start with @)</li>\n</ul>\n</li>\n<li><strong>Tap &quot;Generate &amp; Register&quot; or &quot;Import &amp; Register&quot;</strong></li>\n</ol>\n<p>Your wallet is automatically registered on the blockchain with your public key!</p>\n<h3 id=\"blockchain-registration\">Blockchain Registration</h3>\n<p>Every wallet creation automatically registers on the blockchain:</p>\n<ul>\n<li>Username must be unique (app will error if taken)</li>\n<li>Display name and username are required fields</li>\n<li>Backend creates a <code>user_creation</code> transaction immediately</li>\n<li><strong>Registration completes when the next block is produced</strong></li>\n</ul>\n<p><strong>Transaction Flow:</strong></p>\n<ul>\n<li>Wallet is saved locally immediately with a pre-assigned user ID</li>\n<li>The user creation transaction is marked as &quot;pending&quot;</li>\n<li>User appears on blockchain after block production</li>\n<li>In production, blocks are produced automatically (e.g., every 6 seconds)</li>\n</ul>\n<h3 id=\"viewing-balances\">Viewing Balances</h3>\n<p>From the Vault screen:</p>\n<ul>\n<li>See all your wallets and their balances</li>\n<li>Tap a wallet to view details</li>\n<li>Copy public keys or export private keys (securely!)</li>\n</ul>\n<h3 id=\"signing-transactions\">Signing Transactions</h3>\n<p>The approval screen accepts QR codes or manual challenges:</p>\n<ol>\n<li>Scan a QR code or paste a challenge</li>\n<li>Choose which wallet to sign with</li>\n<li>Review the transaction details</li>\n<li>Approve to generate an Ed25519 signature</li>\n</ol>\n<p>Your signature can then be used to authorize transactions on the blockchain.</p>\n<h2 id=\"security\">Security</h2>\n<ul>\n<li><strong>Wallet metadata</strong> stored in <code>AsyncStorage</code></li>\n<li><strong>Private keys</strong> stored in secure storage (<code>expo-secure-store</code>)</li>\n<li><strong>Keys never leave your device</strong> - all signing happens locally</li>\n<li><strong>Export keys before uninstalling</strong> - secure storage is cleared on uninstall</li>\n</ul>\n<p>:::caution\nAlways back up your private keys! If you lose your device and haven&#39;t exported your keys, they cannot be recovered.\n:::</p>\n<h2 id=\"troubleshooting\">Troubleshooting</h2>\n<h3 id=\"white-screen-on-launch\">White Screen on Launch</h3>\n<p>If you see a white screen, ensure all dependencies are installed:</p>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"bash\"></div>\n\n\n\n<p>Common fixes:</p>\n<ul>\n<li>Install <code>expo-font</code>: <code>npx expo install expo-font</code></li>\n<li>Remove <code>@types/react-native</code> if installed (types are included with react-native)</li>\n</ul>\n<h3 id=\"xcode-version\">Xcode Version</h3>\n<p>Expo SDK 51+ requires Xcode â‰¤16.2.0. If you have a newer version:</p>\n<ul>\n<li>Downgrade Xcode for iOS builds</li>\n<li>Use the Expo Go app for testing instead of building locally</li>\n</ul>\n<h3 id=\"connection-issues\">Connection Issues</h3>\n<p>If the app can&#39;t connect to the ledger:</p>\n<ul>\n<li>Verify the ledger is running: <code>tana status</code></li>\n<li>Check the <code>TANA_LEDGER_URL</code> environment variable</li>\n<li>For local development on a physical device, use your computer&#39;s IP address instead of <code>localhost</code></li>\n</ul>\n<h2 id=\"technical-details\">Technical Details</h2>\n<h3 id=\"project-structure\">Project Structure</h3>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>mobile/</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ App.tsx                     # Entry point with navigation</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ app.config.js               # Expo configuration + env vars</span></span>\n<span class=\"line\"><span>â”œâ”€â”€ src/</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ components/</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â””â”€â”€ KeyCard.tsx         # Wallet summary display</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ contexts/</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â””â”€â”€ KeyStoreContext.tsx # Wallet vault + secure storage</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ lib/</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â””â”€â”€ ledgerApi.ts        # REST API client</span></span>\n<span class=\"line\"><span>â”‚   â”œâ”€â”€ screens/</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â”œâ”€â”€ AddKeyScreen.tsx    # Generate/import wallets</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â”œâ”€â”€ LoginApprovalScreen.tsx # Challenge signing</span></span>\n<span class=\"line\"><span>â”‚   â”‚   â””â”€â”€ VaultScreen.tsx     # Wallet list, balances</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€ utils/</span></span>\n<span class=\"line\"><span>â”‚       â””â”€â”€ crypto.ts           # Ed25519 cryptography</span></span></code></pre><h3 id=\"compatibility\">Compatibility</h3>\n<ul>\n<li>React Native 0.81 / Expo SDK 54</li>\n<li>TypeScript strict mode enabled</li>\n<li>Ed25519 via <code>@noble/ed25519</code></li>\n<li>QR scanning via <code>expo-camera</code></li>\n</ul>\n<h2 id=\"future-enhancements\">Future Enhancements</h2>\n<ul>\n<li>Biometric authentication for transaction signing</li>\n<li>QR-powered challenges for easier approvals</li>\n<li>Push/deep link handling for automatic approval requests</li>\n<li>Encrypted backup/export flows for device migration</li>\n<li>Multi-network support with configurable endpoints</li>\n</ul>\n<h2 id=\"related-documentation\">Related Documentation</h2>\n<ul>\n<li><a href=\"/tana-cli/commands/\">CLI Commands</a> - Command-line interface</li>\n<li><a href=\"/tana-api/intro/\">API Reference</a> - Ledger API endpoints</li>\n<li><a href=\"/contributing/env-vars/\">Environment Variables</a> - Configuration options</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "cd mobile\nnpm install\nnpm run start  # Opens Expo Dev Tools"
      },
      {
        "lang": "bash",
        "code": "npm run ios      # iOS simulator\nnpm run android  # Android emulator\nnpm run web      # Web browser"
      },
      {
        "lang": "bash",
        "code": "# Start the app (defaults to localhost:8080)\nnpm start"
      },
      {
        "lang": "bash",
        "code": "# Option 1: Use the convenience script\nnpm run start:prod\n\n# Option 2: Set TANA_LEDGER_URL manually\nTANA_LEDGER_URL=https://mainnet.tana.network npm start"
      },
      {
        "lang": "bash",
        "code": "npx expo-doctor  # Check for issues\nnpx expo install --fix  # Fix package versions"
      }
    ],
    "tableOfContents": [
      {
        "id": "features",
        "text": "Features",
        "level": 2
      },
      {
        "id": "getting-started",
        "text": "Getting Started",
        "level": 2
      },
      {
        "id": "installation",
        "text": "Installation",
        "level": 3
      },
      {
        "id": "environment-configuration",
        "text": "Environment Configuration",
        "level": 3
      },
      {
        "id": "using-the-app",
        "text": "Using the App",
        "level": 2
      },
      {
        "id": "creating-a-wallet",
        "text": "Creating a Wallet",
        "level": 3
      },
      {
        "id": "blockchain-registration",
        "text": "Blockchain Registration",
        "level": 3
      },
      {
        "id": "viewing-balances",
        "text": "Viewing Balances",
        "level": 3
      },
      {
        "id": "signing-transactions",
        "text": "Signing Transactions",
        "level": 3
      },
      {
        "id": "security",
        "text": "Security",
        "level": 2
      },
      {
        "id": "troubleshooting",
        "text": "Troubleshooting",
        "level": 2
      },
      {
        "id": "white-screen-on-launch",
        "text": "White Screen on Launch",
        "level": 3
      },
      {
        "id": "xcode-version",
        "text": "Xcode Version",
        "level": 3
      },
      {
        "id": "connection-issues",
        "text": "Connection Issues",
        "level": 3
      },
      {
        "id": "technical-details",
        "text": "Technical Details",
        "level": 2
      },
      {
        "id": "project-structure",
        "text": "Project Structure",
        "level": 3
      },
      {
        "id": "compatibility",
        "text": "Compatibility",
        "level": 3
      },
      {
        "id": "future-enhancements",
        "text": "Future Enhancements",
        "level": 2
      },
      {
        "id": "related-documentation",
        "text": "Related Documentation",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "guides",
      "what-is-tana"
    ],
    "metadata": {
      "title": "What is Tana?",
      "description": "Understanding Tana - a user-owned blockchain platform",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nTana is a blockchain platform designed to be **owned and operated by you**. Unlike traditional blockchains that require specialized knowledge and expensive infrastructure, Tana lets anyone run their own blockchain network.\n\n## The Problem with Traditional Blockchains\n\nMost blockchains today are:\n\n- **Complex** - Require learning new programming languages (Solidity, Rust, Move)\n- **Expensive** - High gas fees for every operation\n- **Centralized in practice** - A few large validators control most networks\n- **One-size-fits-all** - You use their chain, their rules, their token\n\n## How Tana is Different\n\n### Write Contracts in TypeScript\n\nNo new language to learn. If you know JavaScript or TypeScript, you can write smart contracts:\n\n```typescript\nimport { kv } from 'tana:kv'\n\nexport async function contract() {\n  const count = await kv.get('visitors') || '0'\n  await kv.put('visitors', String(parseInt(count) + 1))\n  return { visitors: parseInt(count) + 1 }\n}\n```\n\n### No Native Token Required\n\nTana doesn't force you to use a specific cryptocurrency. Create and manage whatever currencies make sense for your use case - USD, loyalty points, in-game gold, or nothing at all.\n\n### Run Your Own Network\n\nYou can:\n- **Join** an existing Tana network as a user\n- **Run** your own single-node instance\n- **Launch** a multi-validator network with others\n\n### Hybrid On-Chain/Off-Chain\n\nNot everything needs to be on the blockchain. Tana separates:\n- **Critical operations** (transfers, state changes) â†’ Blockchain consensus\n- **Read operations** (queries, APIs) â†’ Fast HTTP servers\n\n## Key Concepts\n\n### Users\n\nEvery participant has a **user account** with:\n- A unique username\n- An Ed25519 keypair for signing transactions\n- Balances in multiple currencies\n\n### Contracts\n\nSmart contracts are TypeScript files with up to 4 functions:\n- `init()` - Runs once at deployment\n- `contract()` - Runs via blockchain transactions\n- `get()` - Handles HTTP GET requests\n- `post()` - Handles HTTP POST requests\n\n### Validators\n\nValidators are nodes that:\n- Receive transactions from users\n- Reach consensus on transaction ordering\n- Produce new blocks\n- Maintain the blockchain state\n\n### Sovereigns\n\nA **sovereign** is someone who runs their own Tana network. They control:\n- Who can become a validator\n- Initial currency allocations\n- Core system contracts\n\n## Use Cases\n\n### Private Organizations\n\nRun an internal blockchain for:\n- Asset tracking and provenance\n- Internal currencies and rewards\n- Audit trails and compliance\n\n### Developer Platforms\n\nBuild applications with:\n- User accounts and authentication\n- Multi-currency payments\n- Programmable business logic\n\n### Community Networks\n\nLaunch a blockchain for:\n- DAOs and governance\n- Community currencies\n- Shared infrastructure\n\n## Getting Started\n\n- **As a User** â†’ [Quick Start](/docs/guides/quickstart/) - Start using Tana\n- **As a Sovereign** â†’ [Sovereign Guide](/docs/sovereign/intro/) - Run your own network\n- **As a Developer** â†’ [Developer Setup](/docs/contributing/setup/) - Contribute to Tana\n",
    "html": "<p>Tana is a blockchain platform designed to be <strong>owned and operated by you</strong>. Unlike traditional blockchains that require specialized knowledge and expensive infrastructure, Tana lets anyone run their own blockchain network.</p>\n<h2 id=\"the-problem-with-traditional-blockchains\">The Problem with Traditional Blockchains</h2>\n<p>Most blockchains today are:</p>\n<ul>\n<li><strong>Complex</strong> - Require learning new programming languages (Solidity, Rust, Move)</li>\n<li><strong>Expensive</strong> - High gas fees for every operation</li>\n<li><strong>Centralized in practice</strong> - A few large validators control most networks</li>\n<li><strong>One-size-fits-all</strong> - You use their chain, their rules, their token</li>\n</ul>\n<h2 id=\"how-tana-is-different\">How Tana is Different</h2>\n<h3 id=\"write-contracts-in-typescript\">Write Contracts in TypeScript</h3>\n<p>No new language to learn. If you know JavaScript or TypeScript, you can write smart contracts:</p>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"no-native-token-required\">No Native Token Required</h3>\n<p>Tana doesn&#39;t force you to use a specific cryptocurrency. Create and manage whatever currencies make sense for your use case - USD, loyalty points, in-game gold, or nothing at all.</p>\n<h3 id=\"run-your-own-network\">Run Your Own Network</h3>\n<p>You can:</p>\n<ul>\n<li><strong>Join</strong> an existing Tana network as a user</li>\n<li><strong>Run</strong> your own single-node instance</li>\n<li><strong>Launch</strong> a multi-validator network with others</li>\n</ul>\n<h3 id=\"hybrid-on-chainoff-chain\">Hybrid On-Chain/Off-Chain</h3>\n<p>Not everything needs to be on the blockchain. Tana separates:</p>\n<ul>\n<li><strong>Critical operations</strong> (transfers, state changes) â†’ Blockchain consensus</li>\n<li><strong>Read operations</strong> (queries, APIs) â†’ Fast HTTP servers</li>\n</ul>\n<h2 id=\"key-concepts\">Key Concepts</h2>\n<h3 id=\"users\">Users</h3>\n<p>Every participant has a <strong>user account</strong> with:</p>\n<ul>\n<li>A unique username</li>\n<li>An Ed25519 keypair for signing transactions</li>\n<li>Balances in multiple currencies</li>\n</ul>\n<h3 id=\"contracts\">Contracts</h3>\n<p>Smart contracts are TypeScript files with up to 4 functions:</p>\n<ul>\n<li><code>init()</code> - Runs once at deployment</li>\n<li><code>contract()</code> - Runs via blockchain transactions</li>\n<li><code>get()</code> - Handles HTTP GET requests</li>\n<li><code>post()</code> - Handles HTTP POST requests</li>\n</ul>\n<h3 id=\"validators\">Validators</h3>\n<p>Validators are nodes that:</p>\n<ul>\n<li>Receive transactions from users</li>\n<li>Reach consensus on transaction ordering</li>\n<li>Produce new blocks</li>\n<li>Maintain the blockchain state</li>\n</ul>\n<h3 id=\"sovereigns\">Sovereigns</h3>\n<p>A <strong>sovereign</strong> is someone who runs their own Tana network. They control:</p>\n<ul>\n<li>Who can become a validator</li>\n<li>Initial currency allocations</li>\n<li>Core system contracts</li>\n</ul>\n<h2 id=\"use-cases\">Use Cases</h2>\n<h3 id=\"private-organizations\">Private Organizations</h3>\n<p>Run an internal blockchain for:</p>\n<ul>\n<li>Asset tracking and provenance</li>\n<li>Internal currencies and rewards</li>\n<li>Audit trails and compliance</li>\n</ul>\n<h3 id=\"developer-platforms\">Developer Platforms</h3>\n<p>Build applications with:</p>\n<ul>\n<li>User accounts and authentication</li>\n<li>Multi-currency payments</li>\n<li>Programmable business logic</li>\n</ul>\n<h3 id=\"community-networks\">Community Networks</h3>\n<p>Launch a blockchain for:</p>\n<ul>\n<li>DAOs and governance</li>\n<li>Community currencies</li>\n<li>Shared infrastructure</li>\n</ul>\n<h2 id=\"getting-started\">Getting Started</h2>\n<ul>\n<li><strong>As a User</strong> â†’ <a href=\"/docs/guides/quickstart/\">Quick Start</a> - Start using Tana</li>\n<li><strong>As a Sovereign</strong> â†’ <a href=\"/docs/sovereign/intro/\">Sovereign Guide</a> - Run your own network</li>\n<li><strong>As a Developer</strong> â†’ <a href=\"/docs/contributing/setup/\">Developer Setup</a> - Contribute to Tana</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "typescript",
        "code": "import { kv } from 'tana:kv'\n\nexport async function contract() {\n  const count = await kv.get('visitors') || '0'\n  await kv.put('visitors', String(parseInt(count) + 1))\n  return { visitors: parseInt(count) + 1 }\n}"
      }
    ],
    "tableOfContents": [
      {
        "id": "the-problem-with-traditional-blockchains",
        "text": "The Problem with Traditional Blockchains",
        "level": 2
      },
      {
        "id": "how-tana-is-different",
        "text": "How Tana is Different",
        "level": 2
      },
      {
        "id": "write-contracts-in-typescript",
        "text": "Write Contracts in TypeScript",
        "level": 3
      },
      {
        "id": "no-native-token-required",
        "text": "No Native Token Required",
        "level": 3
      },
      {
        "id": "run-your-own-network",
        "text": "Run Your Own Network",
        "level": 3
      },
      {
        "id": "hybrid-on-chainoff-chain",
        "text": "Hybrid On-Chain/Off-Chain",
        "level": 3
      },
      {
        "id": "key-concepts",
        "text": "Key Concepts",
        "level": 2
      },
      {
        "id": "users",
        "text": "Users",
        "level": 3
      },
      {
        "id": "contracts",
        "text": "Contracts",
        "level": 3
      },
      {
        "id": "validators",
        "text": "Validators",
        "level": 3
      },
      {
        "id": "sovereigns",
        "text": "Sovereigns",
        "level": 3
      },
      {
        "id": "use-cases",
        "text": "Use Cases",
        "level": 2
      },
      {
        "id": "private-organizations",
        "text": "Private Organizations",
        "level": 3
      },
      {
        "id": "developer-platforms",
        "text": "Developer Platforms",
        "level": 3
      },
      {
        "id": "community-networks",
        "text": "Community Networks",
        "level": 3
      },
      {
        "id": "getting-started",
        "text": "Getting Started",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "guides",
      "quickstart"
    ],
    "metadata": {
      "title": "Quick Start",
      "description": "Get started with Tana in 5 minutes",
      "sidebar": {
        "order": 3
      }
    },
    "content": "\nThis guide gets you up and running with Tana as a **user**. You'll create an account, check your balance, and make your first transfer.\n\n## Install the CLI\n\n```bash\nnpm install -g @tananetwork/tana\n```\n\nVerify installation:\n\n```bash\ntana --version\n```\n\n## Create Your Account\n\nCreate a local user account:\n\n```bash\ntana new user alice --name \"Alice\"\n```\n\nThis generates:\n- A unique username\n- An Ed25519 keypair for signing transactions\n- Config stored in `~/.config/tana/users/`\n\n## Connect to a Network\n\nTo use Tana, you need access to a running network.\n\n### Local Development\n\nFor testing locally (requires Docker):\n\n```bash\n# Start local infrastructure\ndocker compose up -d\n\n# Verify services are running\ntana test\n```\n\n### Remote Network\n\nIf connecting to an existing network, configure the endpoint:\n\n```bash\ntana config set ledger-url https://api.example-network.com\n```\n\n## Deploy Your Account\n\nRegister your account on the blockchain:\n\n```bash\ntana deploy user alice\n```\n\nThis creates a transaction that adds your public key to the network.\n\n## Check Your Balance\n\nSee your current balances:\n\n```bash\ntana balance alice\n```\n\nOutput:\n```\nBalances for alice:\n\n  USD    0.00\n\nTotal currencies: 1\n```\n\n> **Note:** New accounts start with zero balance. A sovereign or other user must send you funds first.\n\n## Send Funds\n\nOnce you have a balance, send funds to others:\n\n```bash\ntana transfer alice bob 50 USD\n```\n\nYou'll see:\n```\nTransferring 50 USD from alice to bob...\n\nâœ“ Balance verified\nâœ“ Transaction signed\nâœ“ Transaction submitted\nâœ“ Transfer complete\n\nTransaction ID: tx_abc123\n```\n\n## System Health\n\nVerify the network is working:\n\n```bash\ntana test\n```\n\nThis checks database connectivity, service availability, and block production.\n\n## What's Next?\n\n### Learn More\n- [What is Tana?](/docs/guides/what-is-tana/) - Understand the platform\n- [How Blockchain Works](/docs/guides/how-blockchain-works/) - Core concepts\n- [CLI Commands](/docs/tana-cli/commands/) - All available commands\n\n### Build Applications\n- [Smart Contracts](/docs/contributing/smart-contracts/) - Write TypeScript contracts\n- [API Reference](/docs/tana-api/intro/) - REST API documentation\n\n### Run a Network\n- [Sovereign Guide](/docs/sovereign/intro/) - Self-hosting overview\n",
    "html": "<p>This guide gets you up and running with Tana as a <strong>user</strong>. You&#39;ll create an account, check your balance, and make your first transfer.</p>\n<h2 id=\"install-the-cli\">Install the CLI</h2>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<p>Verify installation:</p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"create-your-account\">Create Your Account</h2>\n<p>Create a local user account:</p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"bash\"></div>\n\n\n\n<p>This generates:</p>\n<ul>\n<li>A unique username</li>\n<li>An Ed25519 keypair for signing transactions</li>\n<li>Config stored in <code>~/.config/tana/users/</code></li>\n</ul>\n<h2 id=\"connect-to-a-network\">Connect to a Network</h2>\n<p>To use Tana, you need access to a running network.</p>\n<h3 id=\"local-development\">Local Development</h3>\n<p>For testing locally (requires Docker):</p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"remote-network\">Remote Network</h3>\n<p>If connecting to an existing network, configure the endpoint:</p>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"deploy-your-account\">Deploy Your Account</h2>\n<p>Register your account on the blockchain:</p>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"bash\"></div>\n\n\n\n<p>This creates a transaction that adds your public key to the network.</p>\n<h2 id=\"check-your-balance\">Check Your Balance</h2>\n<p>See your current balances:</p>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"bash\"></div>\n\n\n\n<p>Output:</p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Balances for alice:</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>  USD    0.00</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Total currencies: 1</span></span></code></pre><blockquote>\n<p><strong>Note:</strong> New accounts start with zero balance. A sovereign or other user must send you funds first.</p>\n</blockquote>\n<h2 id=\"send-funds\">Send Funds</h2>\n<p>Once you have a balance, send funds to others:</p>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"bash\"></div>\n\n\n\n<p>You&#39;ll see:</p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>Transferring 50 USD from alice to bob...</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>âœ“ Balance verified</span></span>\n<span class=\"line\"><span>âœ“ Transaction signed</span></span>\n<span class=\"line\"><span>âœ“ Transaction submitted</span></span>\n<span class=\"line\"><span>âœ“ Transfer complete</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Transaction ID: tx_abc123</span></span></code></pre><h2 id=\"system-health\">System Health</h2>\n<p>Verify the network is working:</p>\n<div class=\"code-block-placeholder\" data-index=\"8\" data-lang=\"bash\"></div>\n\n\n\n<p>This checks database connectivity, service availability, and block production.</p>\n<h2 id=\"whats-next\">What&#39;s Next?</h2>\n<h3 id=\"learn-more\">Learn More</h3>\n<ul>\n<li><a href=\"/docs/guides/what-is-tana/\">What is Tana?</a> - Understand the platform</li>\n<li><a href=\"/docs/guides/how-blockchain-works/\">How Blockchain Works</a> - Core concepts</li>\n<li><a href=\"/docs/tana-cli/commands/\">CLI Commands</a> - All available commands</li>\n</ul>\n<h3 id=\"build-applications\">Build Applications</h3>\n<ul>\n<li><a href=\"/docs/contributing/smart-contracts/\">Smart Contracts</a> - Write TypeScript contracts</li>\n<li><a href=\"/docs/tana-api/intro/\">API Reference</a> - REST API documentation</li>\n</ul>\n<h3 id=\"run-a-network\">Run a Network</h3>\n<ul>\n<li><a href=\"/docs/sovereign/intro/\">Sovereign Guide</a> - Self-hosting overview</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "npm install -g @tananetwork/tana"
      },
      {
        "lang": "bash",
        "code": "tana --version"
      },
      {
        "lang": "bash",
        "code": "tana new user alice --name \"Alice\""
      },
      {
        "lang": "bash",
        "code": "# Start local infrastructure\ndocker compose up -d\n\n# Verify services are running\ntana test"
      },
      {
        "lang": "bash",
        "code": "tana config set ledger-url https://api.example-network.com"
      },
      {
        "lang": "bash",
        "code": "tana deploy user alice"
      },
      {
        "lang": "bash",
        "code": "tana balance alice"
      },
      {
        "lang": "bash",
        "code": "tana transfer alice bob 50 USD"
      },
      {
        "lang": "bash",
        "code": "tana test"
      }
    ],
    "tableOfContents": [
      {
        "id": "install-the-cli",
        "text": "Install the CLI",
        "level": 2
      },
      {
        "id": "create-your-account",
        "text": "Create Your Account",
        "level": 2
      },
      {
        "id": "connect-to-a-network",
        "text": "Connect to a Network",
        "level": 2
      },
      {
        "id": "local-development",
        "text": "Local Development",
        "level": 3
      },
      {
        "id": "remote-network",
        "text": "Remote Network",
        "level": 3
      },
      {
        "id": "deploy-your-account",
        "text": "Deploy Your Account",
        "level": 2
      },
      {
        "id": "check-your-balance",
        "text": "Check Your Balance",
        "level": 2
      },
      {
        "id": "send-funds",
        "text": "Send Funds",
        "level": 2
      },
      {
        "id": "system-health",
        "text": "System Health",
        "level": 2
      },
      {
        "id": "whats-next",
        "text": "What's Next?",
        "level": 2
      },
      {
        "id": "learn-more",
        "text": "Learn More",
        "level": 3
      },
      {
        "id": "build-applications",
        "text": "Build Applications",
        "level": 3
      },
      {
        "id": "run-a-network",
        "text": "Run a Network",
        "level": 3
      }
    ]
  },
  {
    "slug": [
      "guides",
      "how-blockchain-works"
    ],
    "metadata": {
      "title": "How Blockchain Works",
      "description": "A simple introduction to blockchain concepts",
      "sidebar": {
        "order": 2
      }
    },
    "content": "\nIf you're new to blockchain, this guide explains the core concepts in plain language.\n\n## What is a Blockchain?\n\nA blockchain is a **shared database** that multiple computers maintain together. Instead of one company controlling all the data, the network participants collectively agree on what's true.\n\nThink of it like a Google Doc where:\n- Everyone can see the full history of changes\n- No one can secretly edit past entries\n- The group must agree before adding new content\n\n## Why Use a Blockchain?\n\nTraditional databases have a single owner who can:\n- Change records without notice\n- Deny access to certain users\n- Shut down the system entirely\n\nA blockchain provides:\n- **Transparency** - Everyone sees the same data\n- **Immutability** - Past records can't be changed\n- **Availability** - No single point of failure\n- **Trust** - Rules are enforced by code, not people\n\n## Core Concepts\n\n### Transactions\n\nA **transaction** is a request to change something:\n- Transfer money between accounts\n- Update a piece of data\n- Deploy a new program\n\nEvery transaction includes:\n- Who is making the request (sender)\n- What they want to do (action)\n- A digital signature (proof it's really them)\n\n### Blocks\n\nTransactions are grouped into **blocks**. Each block contains:\n- A batch of transactions\n- A timestamp\n- A reference to the previous block\n- A unique fingerprint (hash)\n\nThis chain of references is why it's called a \"block-chain\":\n\n```\n[Block 0] â† [Block 1] â† [Block 2] â† [Block 3]\n Genesis      10 txs      25 txs      15 txs\n```\n\n### Consensus\n\nHow do multiple computers agree on the next block? They use **consensus** - a process where validators:\n\n1. Receive transactions from users\n2. Propose a new block\n3. Vote on whether it's valid\n4. Add it to their copy of the chain\n\nIf validators disagree, the majority wins. This prevents any single validator from cheating.\n\n### Digital Signatures\n\nHow do you prove a transaction is really from you? **Digital signatures** using cryptography:\n\n1. You have a **private key** (secret, like a password)\n2. You have a **public key** (shared, like a username)\n3. You sign transactions with your private key\n4. Anyone can verify with your public key\n\nThis is more secure than passwords because:\n- The private key never leaves your device\n- Each signature is unique to the transaction\n- Forgery is mathematically impossible\n\n## Tana's Approach\n\n### Validators\n\nIn Tana, validators are servers that:\n- Run the consensus protocol\n- Store the blockchain data\n- Execute smart contracts\n\nAnyone can run a validator if the network sovereign approves them.\n\n### Smart Contracts\n\nA **smart contract** is a program stored on the blockchain. When triggered, it executes automatically and predictably.\n\nIn Tana, contracts are written in TypeScript:\n\n```typescript\n// A simple voting contract\nexport async function contract() {\n  const caller = context.caller()\n  const hasVoted = await kv.get(`voted:${caller.id}`)\n\n  if (hasVoted) {\n    return { error: 'Already voted' }\n  }\n\n  await kv.put(`voted:${caller.id}`, 'true')\n  return { success: true }\n}\n```\n\n### State\n\nThe **state** is the current data stored on the blockchain:\n- User accounts and balances\n- Contract storage (key-value pairs)\n- System configuration\n\nState changes only happen through valid transactions that are included in blocks.\n\n## Common Questions\n\n### Is blockchain slow?\n\nTraditional blockchains can be slow because every transaction goes through consensus. Tana uses a hybrid model:\n- **Critical operations** â†’ Blockchain (secure but slower)\n- **Read operations** â†’ HTTP servers (fast)\n\n### Does blockchain use a lot of energy?\n\nSome blockchains (like Bitcoin) use \"proof of work\" which requires massive computation. Tana uses \"proof of authority\" - validators are approved servers, not competing miners. This uses minimal energy.\n\n### Is everything public?\n\nIn Tana, transaction data is visible to validators. For privacy-sensitive applications, you can run a private network where only authorized parties are validators.\n\n### Do I need cryptocurrency?\n\nNo. Tana doesn't require a native token. You can use it without any cryptocurrency, or create your own currencies as needed.\n\n## Next Steps\n\n- [What is Tana?](/docs/guides/what-is-tana/) - Tana-specific concepts\n- [Quick Start](/docs/guides/quickstart/) - Try it yourself\n",
    "html": "<p>If you&#39;re new to blockchain, this guide explains the core concepts in plain language.</p>\n<h2 id=\"what-is-a-blockchain\">What is a Blockchain?</h2>\n<p>A blockchain is a <strong>shared database</strong> that multiple computers maintain together. Instead of one company controlling all the data, the network participants collectively agree on what&#39;s true.</p>\n<p>Think of it like a Google Doc where:</p>\n<ul>\n<li>Everyone can see the full history of changes</li>\n<li>No one can secretly edit past entries</li>\n<li>The group must agree before adding new content</li>\n</ul>\n<h2 id=\"why-use-a-blockchain\">Why Use a Blockchain?</h2>\n<p>Traditional databases have a single owner who can:</p>\n<ul>\n<li>Change records without notice</li>\n<li>Deny access to certain users</li>\n<li>Shut down the system entirely</li>\n</ul>\n<p>A blockchain provides:</p>\n<ul>\n<li><strong>Transparency</strong> - Everyone sees the same data</li>\n<li><strong>Immutability</strong> - Past records can&#39;t be changed</li>\n<li><strong>Availability</strong> - No single point of failure</li>\n<li><strong>Trust</strong> - Rules are enforced by code, not people</li>\n</ul>\n<h2 id=\"core-concepts\">Core Concepts</h2>\n<h3 id=\"transactions\">Transactions</h3>\n<p>A <strong>transaction</strong> is a request to change something:</p>\n<ul>\n<li>Transfer money between accounts</li>\n<li>Update a piece of data</li>\n<li>Deploy a new program</li>\n</ul>\n<p>Every transaction includes:</p>\n<ul>\n<li>Who is making the request (sender)</li>\n<li>What they want to do (action)</li>\n<li>A digital signature (proof it&#39;s really them)</li>\n</ul>\n<h3 id=\"blocks\">Blocks</h3>\n<p>Transactions are grouped into <strong>blocks</strong>. Each block contains:</p>\n<ul>\n<li>A batch of transactions</li>\n<li>A timestamp</li>\n<li>A reference to the previous block</li>\n<li>A unique fingerprint (hash)</li>\n</ul>\n<p>This chain of references is why it&#39;s called a &quot;block-chain&quot;:</p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>[Block 0] â† [Block 1] â† [Block 2] â† [Block 3]</span></span>\n<span class=\"line\"><span> Genesis      10 txs      25 txs      15 txs</span></span></code></pre><h3 id=\"consensus\">Consensus</h3>\n<p>How do multiple computers agree on the next block? They use <strong>consensus</strong> - a process where validators:</p>\n<ol>\n<li>Receive transactions from users</li>\n<li>Propose a new block</li>\n<li>Vote on whether it&#39;s valid</li>\n<li>Add it to their copy of the chain</li>\n</ol>\n<p>If validators disagree, the majority wins. This prevents any single validator from cheating.</p>\n<h3 id=\"digital-signatures\">Digital Signatures</h3>\n<p>How do you prove a transaction is really from you? <strong>Digital signatures</strong> using cryptography:</p>\n<ol>\n<li>You have a <strong>private key</strong> (secret, like a password)</li>\n<li>You have a <strong>public key</strong> (shared, like a username)</li>\n<li>You sign transactions with your private key</li>\n<li>Anyone can verify with your public key</li>\n</ol>\n<p>This is more secure than passwords because:</p>\n<ul>\n<li>The private key never leaves your device</li>\n<li>Each signature is unique to the transaction</li>\n<li>Forgery is mathematically impossible</li>\n</ul>\n<h2 id=\"tanas-approach\">Tana&#39;s Approach</h2>\n<h3 id=\"validators\">Validators</h3>\n<p>In Tana, validators are servers that:</p>\n<ul>\n<li>Run the consensus protocol</li>\n<li>Store the blockchain data</li>\n<li>Execute smart contracts</li>\n</ul>\n<p>Anyone can run a validator if the network sovereign approves them.</p>\n<h3 id=\"smart-contracts\">Smart Contracts</h3>\n<p>A <strong>smart contract</strong> is a program stored on the blockchain. When triggered, it executes automatically and predictably.</p>\n<p>In Tana, contracts are written in TypeScript:</p>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"typescript\"></div>\n\n\n\n<h3 id=\"state\">State</h3>\n<p>The <strong>state</strong> is the current data stored on the blockchain:</p>\n<ul>\n<li>User accounts and balances</li>\n<li>Contract storage (key-value pairs)</li>\n<li>System configuration</li>\n</ul>\n<p>State changes only happen through valid transactions that are included in blocks.</p>\n<h2 id=\"common-questions\">Common Questions</h2>\n<h3 id=\"is-blockchain-slow\">Is blockchain slow?</h3>\n<p>Traditional blockchains can be slow because every transaction goes through consensus. Tana uses a hybrid model:</p>\n<ul>\n<li><strong>Critical operations</strong> â†’ Blockchain (secure but slower)</li>\n<li><strong>Read operations</strong> â†’ HTTP servers (fast)</li>\n</ul>\n<h3 id=\"does-blockchain-use-a-lot-of-energy\">Does blockchain use a lot of energy?</h3>\n<p>Some blockchains (like Bitcoin) use &quot;proof of work&quot; which requires massive computation. Tana uses &quot;proof of authority&quot; - validators are approved servers, not competing miners. This uses minimal energy.</p>\n<h3 id=\"is-everything-public\">Is everything public?</h3>\n<p>In Tana, transaction data is visible to validators. For privacy-sensitive applications, you can run a private network where only authorized parties are validators.</p>\n<h3 id=\"do-i-need-cryptocurrency\">Do I need cryptocurrency?</h3>\n<p>No. Tana doesn&#39;t require a native token. You can use it without any cryptocurrency, or create your own currencies as needed.</p>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/docs/guides/what-is-tana/\">What is Tana?</a> - Tana-specific concepts</li>\n<li><a href=\"/docs/guides/quickstart/\">Quick Start</a> - Try it yourself</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "typescript",
        "code": "// A simple voting contract\nexport async function contract() {\n  const caller = context.caller()\n  const hasVoted = await kv.get(`voted:${caller.id}`)\n\n  if (hasVoted) {\n    return { error: 'Already voted' }\n  }\n\n  await kv.put(`voted:${caller.id}`, 'true')\n  return { success: true }\n}"
      }
    ],
    "tableOfContents": [
      {
        "id": "what-is-a-blockchain",
        "text": "What is a Blockchain?",
        "level": 2
      },
      {
        "id": "why-use-a-blockchain",
        "text": "Why Use a Blockchain?",
        "level": 2
      },
      {
        "id": "core-concepts",
        "text": "Core Concepts",
        "level": 2
      },
      {
        "id": "transactions",
        "text": "Transactions",
        "level": 3
      },
      {
        "id": "blocks",
        "text": "Blocks",
        "level": 3
      },
      {
        "id": "consensus",
        "text": "Consensus",
        "level": 3
      },
      {
        "id": "digital-signatures",
        "text": "Digital Signatures",
        "level": 3
      },
      {
        "id": "tanas-approach",
        "text": "Tana's Approach",
        "level": 2
      },
      {
        "id": "validators",
        "text": "Validators",
        "level": 3
      },
      {
        "id": "smart-contracts",
        "text": "Smart Contracts",
        "level": 3
      },
      {
        "id": "state",
        "text": "State",
        "level": 3
      },
      {
        "id": "common-questions",
        "text": "Common Questions",
        "level": 2
      },
      {
        "id": "is-blockchain-slow",
        "text": "Is blockchain slow?",
        "level": 3
      },
      {
        "id": "does-blockchain-use-a-lot-of-energy",
        "text": "Does blockchain use a lot of energy?",
        "level": 3
      },
      {
        "id": "is-everything-public",
        "text": "Is everything public?",
        "level": 3
      },
      {
        "id": "do-i-need-cryptocurrency",
        "text": "Do I need cryptocurrency?",
        "level": 3
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "sovereign",
      "genesis"
    ],
    "metadata": {
      "title": "Genesis Initialization",
      "description": "Creating the first block and initializing your chain",
      "sidebar": {
        "order": 2
      }
    },
    "content": "\nGenesis initialization creates the first block (block #0) and sets up the foundation of your blockchain. This is a one-time process when starting a new network.\n\n## What Genesis Creates\n\nWhen you initialize genesis, the system creates:\n\n1. **Genesis Block** - Block #0 with empty transactions\n2. **Base Currencies** - USD, CAD, BTC, ETH\n3. **Sovereign Account** - The network administrator\n4. **Core Contracts** - System-level smart contracts\n5. **Initial Balances** - Starting funds for the sovereign\n\n## Prerequisites\n\nBefore running genesis:\n\n```bash\n# Install Tana CLI\nnpm install -g @tananetwork/tana\n\n# Start infrastructure\ndocker compose up -d  # PostgreSQL + Redis\n\n# Ensure database is accessible\ntana test\n```\n\n## Creating a Sovereign User\n\nFirst, create the sovereign user locally:\n\n```bash\ntana new user sovereign --name \"Network Sovereign\" --role sovereign\n```\n\nThis generates:\n- A keypair stored in `~/.config/tana/users/sovereign.json`\n- The public key needed for genesis\n\n## Running Genesis\n\n### Option 1: Environment Variables\n\nSet the sovereign credentials and run genesis:\n\n```bash\n# Export sovereign public key from your user config\nexport SOVEREIGN_PUBLIC_KEY=$(cat ~/.config/tana/users/sovereign.json | jq -r '.publicKey')\nexport SOVEREIGN_USERNAME=\"@sovereign\"\nexport SOVEREIGN_DISPLAY_NAME=\"Network Sovereign\"\n\n# Optional: customize initial balances\nexport SOVEREIGN_INITIAL_USD=1000000000    # 1 billion USD\nexport SOVEREIGN_INITIAL_BTC=100000        # 100k BTC\nexport SOVEREIGN_INITIAL_ETH=1000000       # 1M ETH\n\n# Run genesis\nDATABASE_URL='postgres://...' tana genesis\n```\n\n### Option 2: CLI with Genesis Flag\n\n```bash\ntana new chain mynetwork --genesis\n```\n\nThis combines chain creation and genesis initialization.\n\n## Genesis Output\n\nA successful genesis looks like:\n\n```\nğŸŒ± Creating Genesis Block (Block #0)...\n\nâœ… Genesis block created!\n\nBlock Details:\n  Height: 0\n  Hash: 3a8f2c...\n  Previous Hash: 0000000000000000...\n  Timestamp: 2024-11-03T00:00:00Z\n  Transactions: 0 (self-contained)\n  State Changes: 0\n\nğŸ”’ Cryptographic Verification:\n  âœ“ Block is self-contained (empty genesis state)\n  âœ“ Transaction root computed (empty tree)\n  âœ“ State root computed (empty tree)\n  âœ“ Block hash is deterministic and verifiable\n\nInitializing base currencies...\nâœ… Base currencies initialized\n\nğŸ‘‘ Creating sovereign account...\n  âœ… Sovereign user created: @sovereign\n  ğŸ“‹ User ID: usr_abc123...\n  ğŸ”‘ Public Key: ed25519_...\n\nğŸ’° Allocating sovereign initial balances...\n  âœ… 1,000,000,000 USD\n  âœ… 100,000 BTC\n  âœ… 1,000,000 ETH\n\nğŸ“¦ Deploying core contracts...\n  âœ… transfer\n  âœ… mint\n\nâœ… Deployed 2 core contract(s)\n\nğŸ‰ Blockchain initialized successfully!\n```\n\n## Core Contracts\n\nGenesis deploys contracts from the `contracts/core/` directory. These are system-level contracts owned by the sovereign:\n\n| Contract | Purpose |\n|----------|---------|\n| `transfer` | Standard token transfers |\n| `mint` | Currency minting (sovereign only) |\n\nTo add custom core contracts, place `.ts` files in `contracts/core/` before running genesis.\n\n## Environment Variables\n\n| Variable | Description | Default |\n|----------|-------------|---------|\n| `SOVEREIGN_PUBLIC_KEY` | Ed25519 public key for sovereign | Required |\n| `SOVEREIGN_USERNAME` | Username for sovereign account | `@sovereign` |\n| `SOVEREIGN_DISPLAY_NAME` | Display name | `Network Sovereign` |\n| `SOVEREIGN_INITIAL_USD` | Starting USD balance | `1000000000` |\n| `SOVEREIGN_INITIAL_BTC` | Starting BTC balance | `100000` |\n| `SOVEREIGN_INITIAL_ETH` | Starting ETH balance | `1000000` |\n| `CORE_CONTRACTS_DIR` | Path to core contracts | `./contracts/core` |\n\n## Verifying Genesis\n\nAfter genesis, verify the chain is initialized:\n\n```bash\n# Check block 0 exists\ncurl http://localhost:8080/blocks/0\n\n# Check sovereign user\ncurl http://localhost:8080/users\n\n# Check balances\ncurl \"http://localhost:8080/balances?userId=<sovereign_id>\"\n\n# Run health checks\ntana test\n```\n\n## Resetting Genesis\n\nTo start over with a fresh chain:\n\n```bash\n# Flush all blockchain data (DESTRUCTIVE!)\nDATABASE_URL='postgres://...' tana flush\n\n# Re-run genesis\nDATABASE_URL='postgres://...' tana genesis\n```\n\n> **Warning:** Flushing deletes all users, transactions, blocks, and contracts. Only do this in development or when intentionally resetting.\n\n## Next Steps\n\n- [Validators](/docs/sovereign/validators/) - Add validator nodes to your network\n- [Monitoring](/docs/sovereign/monitoring/) - Set up the dashboard\n",
    "html": "<p>Genesis initialization creates the first block (block #0) and sets up the foundation of your blockchain. This is a one-time process when starting a new network.</p>\n<h2 id=\"what-genesis-creates\">What Genesis Creates</h2>\n<p>When you initialize genesis, the system creates:</p>\n<ol>\n<li><strong>Genesis Block</strong> - Block #0 with empty transactions</li>\n<li><strong>Base Currencies</strong> - USD, CAD, BTC, ETH</li>\n<li><strong>Sovereign Account</strong> - The network administrator</li>\n<li><strong>Core Contracts</strong> - System-level smart contracts</li>\n<li><strong>Initial Balances</strong> - Starting funds for the sovereign</li>\n</ol>\n<h2 id=\"prerequisites\">Prerequisites</h2>\n<p>Before running genesis:</p>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"creating-a-sovereign-user\">Creating a Sovereign User</h2>\n<p>First, create the sovereign user locally:</p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"bash\"></div>\n\n\n\n<p>This generates:</p>\n<ul>\n<li>A keypair stored in <code>~/.config/tana/users/sovereign.json</code></li>\n<li>The public key needed for genesis</li>\n</ul>\n<h2 id=\"running-genesis\">Running Genesis</h2>\n<h3 id=\"option-1-environment-variables\">Option 1: Environment Variables</h3>\n<p>Set the sovereign credentials and run genesis:</p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"option-2-cli-with-genesis-flag\">Option 2: CLI with Genesis Flag</h3>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"bash\"></div>\n\n\n\n<p>This combines chain creation and genesis initialization.</p>\n<h2 id=\"genesis-output\">Genesis Output</h2>\n<p>A successful genesis looks like:</p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>ğŸŒ± Creating Genesis Block (Block #0)...</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>âœ… Genesis block created!</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Block Details:</span></span>\n<span class=\"line\"><span>  Height: 0</span></span>\n<span class=\"line\"><span>  Hash: 3a8f2c...</span></span>\n<span class=\"line\"><span>  Previous Hash: 0000000000000000...</span></span>\n<span class=\"line\"><span>  Timestamp: 2024-11-03T00:00:00Z</span></span>\n<span class=\"line\"><span>  Transactions: 0 (self-contained)</span></span>\n<span class=\"line\"><span>  State Changes: 0</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>ğŸ”’ Cryptographic Verification:</span></span>\n<span class=\"line\"><span>  âœ“ Block is self-contained (empty genesis state)</span></span>\n<span class=\"line\"><span>  âœ“ Transaction root computed (empty tree)</span></span>\n<span class=\"line\"><span>  âœ“ State root computed (empty tree)</span></span>\n<span class=\"line\"><span>  âœ“ Block hash is deterministic and verifiable</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>Initializing base currencies...</span></span>\n<span class=\"line\"><span>âœ… Base currencies initialized</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>ğŸ‘‘ Creating sovereign account...</span></span>\n<span class=\"line\"><span>  âœ… Sovereign user created: @sovereign</span></span>\n<span class=\"line\"><span>  ğŸ“‹ User ID: usr_abc123...</span></span>\n<span class=\"line\"><span>  ğŸ”‘ Public Key: ed25519_...</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>ğŸ’° Allocating sovereign initial balances...</span></span>\n<span class=\"line\"><span>  âœ… 1,000,000,000 USD</span></span>\n<span class=\"line\"><span>  âœ… 100,000 BTC</span></span>\n<span class=\"line\"><span>  âœ… 1,000,000 ETH</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>ğŸ“¦ Deploying core contracts...</span></span>\n<span class=\"line\"><span>  âœ… transfer</span></span>\n<span class=\"line\"><span>  âœ… mint</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>âœ… Deployed 2 core contract(s)</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>ğŸ‰ Blockchain initialized successfully!</span></span></code></pre><h2 id=\"core-contracts\">Core Contracts</h2>\n<p>Genesis deploys contracts from the <code>contracts/core/</code> directory. These are system-level contracts owned by the sovereign:</p>\n<table>\n<thead>\n<tr>\n<th>Contract</th>\n<th>Purpose</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>transfer</code></td>\n<td>Standard token transfers</td>\n</tr>\n<tr>\n<td><code>mint</code></td>\n<td>Currency minting (sovereign only)</td>\n</tr>\n</tbody></table>\n<p>To add custom core contracts, place <code>.ts</code> files in <code>contracts/core/</code> before running genesis.</p>\n<h2 id=\"environment-variables\">Environment Variables</h2>\n<table>\n<thead>\n<tr>\n<th>Variable</th>\n<th>Description</th>\n<th>Default</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>SOVEREIGN<em>PUBLIC</em>KEY</code></td>\n<td>Ed25519 public key for sovereign</td>\n<td>Required</td>\n</tr>\n<tr>\n<td><code>SOVEREIGN_USERNAME</code></td>\n<td>Username for sovereign account</td>\n<td><code>@sovereign</code></td>\n</tr>\n<tr>\n<td><code>SOVEREIGN<em>DISPLAY</em>NAME</code></td>\n<td>Display name</td>\n<td><code>Network Sovereign</code></td>\n</tr>\n<tr>\n<td><code>SOVEREIGN<em>INITIAL</em>USD</code></td>\n<td>Starting USD balance</td>\n<td><code>1000000000</code></td>\n</tr>\n<tr>\n<td><code>SOVEREIGN<em>INITIAL</em>BTC</code></td>\n<td>Starting BTC balance</td>\n<td><code>100000</code></td>\n</tr>\n<tr>\n<td><code>SOVEREIGN<em>INITIAL</em>ETH</code></td>\n<td>Starting ETH balance</td>\n<td><code>1000000</code></td>\n</tr>\n<tr>\n<td><code>CORE<em>CONTRACTS</em>DIR</code></td>\n<td>Path to core contracts</td>\n<td><code>./contracts/core</code></td>\n</tr>\n</tbody></table>\n<h2 id=\"verifying-genesis\">Verifying Genesis</h2>\n<p>After genesis, verify the chain is initialized:</p>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"resetting-genesis\">Resetting Genesis</h2>\n<p>To start over with a fresh chain:</p>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"bash\"></div>\n\n\n\n<blockquote>\n<p><strong>Warning:</strong> Flushing deletes all users, transactions, blocks, and contracts. Only do this in development or when intentionally resetting.</p>\n</blockquote>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/docs/sovereign/validators/\">Validators</a> - Add validator nodes to your network</li>\n<li><a href=\"/docs/sovereign/monitoring/\">Monitoring</a> - Set up the dashboard</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "# Install Tana CLI\nnpm install -g @tananetwork/tana\n\n# Start infrastructure\ndocker compose up -d  # PostgreSQL + Redis\n\n# Ensure database is accessible\ntana test"
      },
      {
        "lang": "bash",
        "code": "tana new user sovereign --name \"Network Sovereign\" --role sovereign"
      },
      {
        "lang": "bash",
        "code": "# Export sovereign public key from your user config\nexport SOVEREIGN_PUBLIC_KEY=$(cat ~/.config/tana/users/sovereign.json | jq -r '.publicKey')\nexport SOVEREIGN_USERNAME=\"@sovereign\"\nexport SOVEREIGN_DISPLAY_NAME=\"Network Sovereign\"\n\n# Optional: customize initial balances\nexport SOVEREIGN_INITIAL_USD=1000000000    # 1 billion USD\nexport SOVEREIGN_INITIAL_BTC=100000        # 100k BTC\nexport SOVEREIGN_INITIAL_ETH=1000000       # 1M ETH\n\n# Run genesis\nDATABASE_URL='postgres://...' tana genesis"
      },
      {
        "lang": "bash",
        "code": "tana new chain mynetwork --genesis"
      },
      {
        "lang": "bash",
        "code": "# Check block 0 exists\ncurl http://localhost:8080/blocks/0\n\n# Check sovereign user\ncurl http://localhost:8080/users\n\n# Check balances\ncurl \"http://localhost:8080/balances?userId=<sovereign_id>\"\n\n# Run health checks\ntana test"
      },
      {
        "lang": "bash",
        "code": "# Flush all blockchain data (DESTRUCTIVE!)\nDATABASE_URL='postgres://...' tana flush\n\n# Re-run genesis\nDATABASE_URL='postgres://...' tana genesis"
      }
    ],
    "tableOfContents": [
      {
        "id": "what-genesis-creates",
        "text": "What Genesis Creates",
        "level": 2
      },
      {
        "id": "prerequisites",
        "text": "Prerequisites",
        "level": 2
      },
      {
        "id": "creating-a-sovereign-user",
        "text": "Creating a Sovereign User",
        "level": 2
      },
      {
        "id": "running-genesis",
        "text": "Running Genesis",
        "level": 2
      },
      {
        "id": "option-1-environment-variables",
        "text": "Option 1: Environment Variables",
        "level": 3
      },
      {
        "id": "option-2-cli-with-genesis-flag",
        "text": "Option 2: CLI with Genesis Flag",
        "level": 3
      },
      {
        "id": "genesis-output",
        "text": "Genesis Output",
        "level": 2
      },
      {
        "id": "core-contracts",
        "text": "Core Contracts",
        "level": 2
      },
      {
        "id": "environment-variables",
        "text": "Environment Variables",
        "level": 2
      },
      {
        "id": "verifying-genesis",
        "text": "Verifying Genesis",
        "level": 2
      },
      {
        "id": "resetting-genesis",
        "text": "Resetting Genesis",
        "level": 2
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "sovereign",
      "intro"
    ],
    "metadata": {
      "title": "Sovereign Overview",
      "description": "Run your own Tana blockchain network",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nTana is designed to be self-hosted. Anyone can become a **sovereign** - running their own blockchain network for a private organization, public testnet, or production deployment.\n\n## Who This Is For\n\nThis section is for **sovereigns** (network operators) who want to:\n\n- Run a single-node Tana instance\n- Set up a multi-validator network\n- Deploy to cloud infrastructure\n- Monitor and manage their chain\n\nIf you just want to use an existing Tana network, see the [Quick Start](/docs/guides/quickstart/) guide instead.\n\n## Requirements\n\n### Single Node (Development/Testing)\n\n- 2 CPU cores\n- 4 GB RAM\n- 20 GB SSD\n- Node.js 18+ or Bun 1.0+\n- PostgreSQL 15+\n- Redis 7+\n\n### Production (Multi-Validator)\n\n- 4+ CPU cores per validator\n- 8+ GB RAM per validator\n- 100+ GB SSD (NVMe recommended)\n- Reliable network connectivity between validators\n\n## Installation\n\n```bash\nnpm install -g @tananetwork/tana\n```\n\nVerify installation:\n\n```bash\ntana --version\n```\n\n## Quick Overview\n\n### 1. Initialize Your Chain\n\n```bash\n# Create a new blockchain with genesis block\ntana new chain mynetwork --genesis\n```\n\nThe `--genesis` flag initializes the chain with:\n- Genesis block (block 0)\n- Core system contracts\n- Default currencies (USD, CAD)\n\n### 2. Create the Sovereign User\n\nThe first user on a chain is the **sovereign** - they have special privileges for network management.\n\n```bash\ntana new user admin --name \"Network Admin\" --role sovereign\ntana deploy user admin\n```\n\n### 3. Start Services\n\nStart the required infrastructure and Tana services:\n\n```bash\n# Start infrastructure (PostgreSQL, Redis)\ndocker compose up -d\n\n# Start ledger service\nDATABASE_URL='postgres://...' tana ledger\n\n# Start consensus (for validators)\nDATABASE_URL='postgres://...' tana consensus\n```\n\n### 4. Add Validators (Multi-Node)\n\nFor a decentralized network, add additional validator nodes:\n\n```bash\n# On validator node 2\ntana new validator --port 9010 --http-port 9011 --peers ws://validator1:9000\n```\n\n## Network Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                      Your Network                           â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                             â”‚\nâ”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚\nâ”‚   â”‚Validator 1â”‚â—„â”€â”€â–ºâ”‚Validator 2â”‚â—„â”€â”€â–ºâ”‚Validator 3â”‚         â”‚\nâ”‚   â”‚  (Leader) â”‚    â”‚           â”‚    â”‚           â”‚         â”‚\nâ”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â”‚\nâ”‚         â”‚                â”‚                â”‚                â”‚\nâ”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚\nâ”‚                          â”‚                                 â”‚\nâ”‚                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                           â”‚\nâ”‚                    â”‚   Redis   â”‚  (Shared tx queue)        â”‚\nâ”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚\nâ”‚                                                             â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚   Public API                                                â”‚\nâ”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚\nâ”‚   â”‚  Ledger   â”‚    â”‚   Edge    â”‚    â”‚ Identity  â”‚         â”‚\nâ”‚   â”‚  :8080    â”‚    â”‚   :8082   â”‚    â”‚   :8090   â”‚         â”‚\nâ”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## What's Next\n\n- [Starting Docker](/docs/sovereign/docker/) - Bring up all services\n- [Genesis Initialization](/docs/sovereign/genesis/) - Understand the genesis process\n- [Validators](/docs/sovereign/validators/) - Configure multi-validator consensus\n- [Monitoring](/docs/sovereign/monitoring/) - Dashboard and health checks\n",
    "html": "<p>Tana is designed to be self-hosted. Anyone can become a <strong>sovereign</strong> - running their own blockchain network for a private organization, public testnet, or production deployment.</p>\n<h2 id=\"who-this-is-for\">Who This Is For</h2>\n<p>This section is for <strong>sovereigns</strong> (network operators) who want to:</p>\n<ul>\n<li>Run a single-node Tana instance</li>\n<li>Set up a multi-validator network</li>\n<li>Deploy to cloud infrastructure</li>\n<li>Monitor and manage their chain</li>\n</ul>\n<p>If you just want to use an existing Tana network, see the <a href=\"/docs/guides/quickstart/\">Quick Start</a> guide instead.</p>\n<h2 id=\"requirements\">Requirements</h2>\n<h3 id=\"single-node-developmenttesting\">Single Node (Development/Testing)</h3>\n<ul>\n<li>2 CPU cores</li>\n<li>4 GB RAM</li>\n<li>20 GB SSD</li>\n<li>Node.js 18+ or Bun 1.0+</li>\n<li>PostgreSQL 15+</li>\n<li>Redis 7+</li>\n</ul>\n<h3 id=\"production-multi-validator\">Production (Multi-Validator)</h3>\n<ul>\n<li>4+ CPU cores per validator</li>\n<li>8+ GB RAM per validator</li>\n<li>100+ GB SSD (NVMe recommended)</li>\n<li>Reliable network connectivity between validators</li>\n</ul>\n<h2 id=\"installation\">Installation</h2>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<p>Verify installation:</p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"quick-overview\">Quick Overview</h2>\n<h3 id=\"1-initialize-your-chain\">1. Initialize Your Chain</h3>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"bash\"></div>\n\n\n\n<p>The <code>--genesis</code> flag initializes the chain with:</p>\n<ul>\n<li>Genesis block (block 0)</li>\n<li>Core system contracts</li>\n<li>Default currencies (USD, CAD)</li>\n</ul>\n<h3 id=\"2-create-the-sovereign-user\">2. Create the Sovereign User</h3>\n<p>The first user on a chain is the <strong>sovereign</strong> - they have special privileges for network management.</p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"3-start-services\">3. Start Services</h3>\n<p>Start the required infrastructure and Tana services:</p>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"4-add-validators-multi-node\">4. Add Validators (Multi-Node)</h3>\n<p>For a decentralized network, add additional validator nodes:</p>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"network-architecture\">Network Architecture</h2>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>\n<span class=\"line\"><span>â”‚                      Your Network                           â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>\n<span class=\"line\"><span>â”‚                                                             â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚Validator 1â”‚â—„â”€â”€â–ºâ”‚Validator 2â”‚â—„â”€â”€â–ºâ”‚Validator 3â”‚         â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚  (Leader) â”‚    â”‚           â”‚    â”‚           â”‚         â”‚</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â”‚</span></span>\n<span class=\"line\"><span>â”‚         â”‚                â”‚                â”‚                â”‚</span></span>\n<span class=\"line\"><span>â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚</span></span>\n<span class=\"line\"><span>â”‚                          â”‚                                 â”‚</span></span>\n<span class=\"line\"><span>â”‚                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                           â”‚</span></span>\n<span class=\"line\"><span>â”‚                    â”‚   Redis   â”‚  (Shared tx queue)        â”‚</span></span>\n<span class=\"line\"><span>â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚</span></span>\n<span class=\"line\"><span>â”‚                                                             â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>\n<span class=\"line\"><span>â”‚   Public API                                                â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚  Ledger   â”‚    â”‚   Edge    â”‚    â”‚ Identity  â”‚         â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚  :8080    â”‚    â”‚   :8082   â”‚    â”‚   :8090   â”‚         â”‚</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚</span></span>\n<span class=\"line\"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><h2 id=\"whats-next\">What&#39;s Next</h2>\n<ul>\n<li><a href=\"/docs/sovereign/docker/\">Starting Docker</a> - Bring up all services</li>\n<li><a href=\"/docs/sovereign/genesis/\">Genesis Initialization</a> - Understand the genesis process</li>\n<li><a href=\"/docs/sovereign/validators/\">Validators</a> - Configure multi-validator consensus</li>\n<li><a href=\"/docs/sovereign/monitoring/\">Monitoring</a> - Dashboard and health checks</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "npm install -g @tananetwork/tana"
      },
      {
        "lang": "bash",
        "code": "tana --version"
      },
      {
        "lang": "bash",
        "code": "# Create a new blockchain with genesis block\ntana new chain mynetwork --genesis"
      },
      {
        "lang": "bash",
        "code": "tana new user admin --name \"Network Admin\" --role sovereign\ntana deploy user admin"
      },
      {
        "lang": "bash",
        "code": "# Start infrastructure (PostgreSQL, Redis)\ndocker compose up -d\n\n# Start ledger service\nDATABASE_URL='postgres://...' tana ledger\n\n# Start consensus (for validators)\nDATABASE_URL='postgres://...' tana consensus"
      },
      {
        "lang": "bash",
        "code": "# On validator node 2\ntana new validator --port 9010 --http-port 9011 --peers ws://validator1:9000"
      }
    ],
    "tableOfContents": [
      {
        "id": "who-this-is-for",
        "text": "Who This Is For",
        "level": 2
      },
      {
        "id": "requirements",
        "text": "Requirements",
        "level": 2
      },
      {
        "id": "single-node-developmenttesting",
        "text": "Single Node (Development/Testing)",
        "level": 3
      },
      {
        "id": "production-multi-validator",
        "text": "Production (Multi-Validator)",
        "level": 3
      },
      {
        "id": "installation",
        "text": "Installation",
        "level": 2
      },
      {
        "id": "quick-overview",
        "text": "Quick Overview",
        "level": 2
      },
      {
        "id": "1-initialize-your-chain",
        "text": "1. Initialize Your Chain",
        "level": 3
      },
      {
        "id": "2-create-the-sovereign-user",
        "text": "2. Create the Sovereign User",
        "level": 3
      },
      {
        "id": "3-start-services",
        "text": "3. Start Services",
        "level": 3
      },
      {
        "id": "4-add-validators-multi-node",
        "text": "4. Add Validators (Multi-Node)",
        "level": 3
      },
      {
        "id": "network-architecture",
        "text": "Network Architecture",
        "level": 2
      },
      {
        "id": "whats-next",
        "text": "What's Next",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "sovereign",
      "deployment"
    ],
    "metadata": {
      "title": "Production Deployment",
      "description": "Deploy Tana blockchain to production",
      "sidebar": {
        "order": 4
      }
    },
    "content": "\nThis guide covers deploying the Tana blockchain infrastructure to production.\n\n## Prerequisites\n\n### Server Requirements\n- **CPU:** 4+ cores\n- **RAM:** 8GB+ minimum, 16GB recommended\n- **Storage:** 100GB+ SSD\n- **OS:** Ubuntu 22.04 LTS (recommended)\n- **Network:** Static IP, ports 80/443/8080 accessible\n\n### Software Requirements\n- Docker 24.0+\n- Docker Compose 2.0+\n- Bun 1.1.38+ (for migrations)\n- PostgreSQL 16 (via Docker)\n- Redis 7 (via Docker)\n\n### Domain Configuration\nConfigure DNS records for your domain:\n```\nA     blockchain.yourdomain.com    â†’ <SERVER_IP>\nAAAA  blockchain.yourdomain.com    â†’ <SERVER_IPv6>  (optional)\n```\n\n## Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                     yourdomain.com                           â”‚\nâ”‚                  (Main Website/Playground)                   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                            â”‚\n                            â†“ HTTPS\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚         blockchain.yourdomain.com (Load Balancer)           â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                            â”‚\n           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n           â†“                â†“                â†“\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚ Ledger   â”‚    â”‚  Edge    â”‚    â”‚ Runtime  â”‚\n    â”‚ Service  â”‚    â”‚ Server   â”‚    â”‚ Service  â”‚\n    â”‚  :8080   â”‚    â”‚  :8180   â”‚    â”‚          â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚                â”‚\n           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                    â†“\n            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n            â”‚  PostgreSQL  â”‚\n            â”‚     :5432    â”‚\n            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                    â”‚\n            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n            â”‚    Redis     â”‚\n            â”‚     :6379    â”‚\n            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Services Overview\n\n### Ledger Service (Port 8080)\n**Purpose:** Blockchain data API - users, balances, transactions\n\n**Key Endpoints:**\n- `GET /health` - Health check\n- `GET /users` - List all users\n- `POST /users` - Create user\n- `GET /balances` - Get all balances\n- `GET /transactions` - Get all transactions\n- `POST /transactions` - Create transaction\n\n### Edge Server (Port 8180)\n**Purpose:** Fast HTTP execution of smart contracts\n\n**Features:**\n- TypeScript contract execution\n- V8 isolate per request\n- Cloudflare Workers-style architecture\n- Sub-100ms response times\n\n## Installation\n\n### 1. Clone Repository\n```bash\ngit clone https://github.com/yourusername/tana.git\ncd tana\n```\n\n### 2. Create Production Environment File\n```bash\ncp .env.example .env.production\n```\n\nEdit `.env.production`:\n```bash\n# Database Configuration\nPOSTGRES_DB=tana\nPOSTGRES_USER=tana\nPOSTGRES_PASSWORD=<STRONG_PASSWORD_HERE>\n\n# Ledger URL (for all services)\nTANA_LEDGER_URL=https://blockchain.yourdomain.com\n\n# Service Configuration\nNODE_ENV=production\nLOG_LEVEL=info\n\n# CORS Origins\nALLOWED_ORIGINS=https://yourdomain.com,https://blockchain.yourdomain.com\n```\n\n### 3. Build Docker Images\n```bash\n# Build all services\ndocker-compose -f docker-compose.prod.yml build\n\n# Or build specific service\ndocker-compose -f docker-compose.prod.yml build tana-ledger\n```\n\n### 4. Initialize Database\n```bash\n# Start database services\ndocker-compose -f docker-compose.prod.yml up -d postgres redis\n\n# Wait for postgres to be ready\ndocker-compose -f docker-compose.prod.yml exec postgres pg_isready\n\n# Run migrations\ncd ledger\nbun run db:migrate\n\n# Seed default data\ncurl -X POST http://localhost:8080/balances/currencies/seed\n```\n\n### 5. Start Services\n```bash\n# Start all services\ndocker-compose -f docker-compose.prod.yml up -d\n\n# Check status\ndocker-compose -f docker-compose.prod.yml ps\n\n# View logs\ndocker-compose -f docker-compose.prod.yml logs -f\n```\n\n### 6. Verify Deployment\n```bash\n# Test ledger service\ncurl http://localhost:8080/health\ncurl http://localhost:8080/\n\n# Test endpoints\ncurl http://localhost:8080/users\ncurl http://localhost:8080/balances\ncurl http://localhost:8080/transactions\n```\n\n## Reverse Proxy Configuration\n\n### Using Nginx\n\nCreate `/etc/nginx/sites-available/blockchain.yourdomain.com`:\n\n```nginx\n# HTTP -> HTTPS redirect\nserver {\n    listen 80;\n    listen [::]:80;\n    server_name blockchain.yourdomain.com;\n\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n\n# HTTPS\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name blockchain.yourdomain.com;\n\n    # SSL certificates (Let's Encrypt)\n    ssl_certificate /etc/letsencrypt/live/blockchain.yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/blockchain.yourdomain.com/privkey.pem;\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n\n    # Security headers\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n    add_header X-Frame-Options \"SAMEORIGIN\" always;\n    add_header X-Content-Type-Options \"nosniff\" always;\n    add_header X-XSS-Protection \"1; mode=block\" always;\n\n    # CORS headers\n    add_header Access-Control-Allow-Origin \"https://yourdomain.com\" always;\n    add_header Access-Control-Allow-Methods \"GET, POST, OPTIONS\" always;\n    add_header Access-Control-Allow-Headers \"Content-Type, Authorization\" always;\n\n    # Rate limiting\n    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;\n    limit_req zone=api_limit burst=20 nodelay;\n\n    # Proxy to ledger service\n    location / {\n        proxy_pass http://localhost:8080;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n\n        # Timeouts\n        proxy_connect_timeout 30s;\n        proxy_send_timeout 30s;\n        proxy_read_timeout 30s;\n    }\n\n    # Health check endpoint (no rate limiting)\n    location /health {\n        proxy_pass http://localhost:8080/health;\n        access_log off;\n    }\n}\n```\n\nEnable and test:\n```bash\n# Enable site\nsudo ln -s /etc/nginx/sites-available/blockchain.yourdomain.com /etc/nginx/sites-enabled/\n\n# Test configuration\nsudo nginx -t\n\n# Reload nginx\nsudo systemctl reload nginx\n```\n\n### SSL Certificate (Let's Encrypt)\n```bash\n# Install certbot\nsudo apt update\nsudo apt install certbot python3-certbot-nginx\n\n# Get certificate\nsudo certbot --nginx -d blockchain.yourdomain.com\n\n# Auto-renewal is enabled by default\n# Test renewal\nsudo certbot renew --dry-run\n```\n\n## Monitoring & Maintenance\n\n### View Logs\n```bash\n# All services\ndocker-compose -f docker-compose.prod.yml logs -f\n\n# Specific service\ndocker-compose -f docker-compose.prod.yml logs -f tana-ledger\n\n# Last 100 lines\ndocker-compose -f docker-compose.prod.yml logs --tail=100 tana-ledger\n```\n\n### Database Backups\nCreate a backup script `/usr/local/bin/backup-tana.sh`:\n\n```bash\n#!/bin/bash\nBACKUP_DIR=\"/var/backups/tana\"\nTIMESTAMP=$(date +%Y%m%d_%H%M%S)\nmkdir -p $BACKUP_DIR\n\n# Backup database\ndocker-compose -f /path/to/tana/docker-compose.prod.yml exec -T postgres \\\n  pg_dump -U tana tana | gzip > \"$BACKUP_DIR/tana_$TIMESTAMP.sql.gz\"\n\n# Keep only last 7 days\nfind $BACKUP_DIR -name \"tana_*.sql.gz\" -mtime +7 -delete\n```\n\nAdd to crontab:\n```bash\n# Daily backup at 2 AM\n0 2 * * * /usr/local/bin/backup-tana.sh\n```\n\n### Health Monitoring\n```bash\n# Check service health\ncurl https://blockchain.yourdomain.com/health\n\n# Monitor container stats\ndocker stats\n\n# Check service status\ndocker-compose -f docker-compose.prod.yml ps\n```\n\n### Updates & Upgrades\n```bash\n# Pull latest code\ngit pull origin main\n\n# Rebuild images\ndocker-compose -f docker-compose.prod.yml build\n\n# Run database migrations\ncd ledger && bun run db:migrate && cd ..\n\n# Restart services (zero downtime)\ndocker-compose -f docker-compose.prod.yml up -d --no-deps --build tana-ledger\ndocker-compose -f docker-compose.prod.yml up -d --no-deps --build tana-edge\n```\n\n## Security Checklist\n\n- [ ] Strong PostgreSQL password set\n- [ ] SSL certificates installed and valid\n- [ ] Firewall configured (UFW or iptables)\n- [ ] Rate limiting enabled in Nginx\n- [ ] Services running as non-root user\n- [ ] Database not exposed to public internet\n- [ ] Redis not exposed to public internet\n- [ ] CORS properly configured\n- [ ] Security headers enabled\n- [ ] Regular backups configured\n- [ ] Monitoring and alerting set up\n- [ ] Secrets stored securely (not in git)\n- [ ] `TANA_LEDGER_URL` environment variable set correctly\n\n## Troubleshooting\n\n### Service Won't Start\n```bash\n# Check logs\ndocker-compose -f docker-compose.prod.yml logs tana-ledger\n\n# Check container status\ndocker-compose -f docker-compose.prod.yml ps\n\n# Restart specific service\ndocker-compose -f docker-compose.prod.yml restart tana-ledger\n```\n\n### Database Connection Issues\n```bash\n# Check postgres is running\ndocker-compose -f docker-compose.prod.yml ps postgres\n\n# Test connection manually\ndocker-compose -f docker-compose.prod.yml exec postgres \\\n  psql -U tana -d tana -c \"SELECT version();\"\n```\n\n### High Memory Usage\n```bash\n# Check resource usage\ndocker stats\n\n# Adjust resource limits in docker-compose.prod.yml\nservices:\n  tana-ledger:\n    deploy:\n      resources:\n        limits:\n          memory: 512M\n```\n\n### CORS Errors\nCheck `ALLOWED_ORIGINS` in `.env.production` includes all necessary domains:\n```bash\nALLOWED_ORIGINS=https://yourdomain.com,https://blockchain.yourdomain.com\n```\n\n## Performance Tuning\n\n### PostgreSQL Optimization\nEdit `docker-compose.prod.yml` to add PostgreSQL performance settings:\n\n```yaml\npostgres:\n  command: >\n    postgres\n    -c shared_buffers=256MB\n    -c effective_cache_size=1GB\n    -c maintenance_work_mem=128MB\n    -c checkpoint_completion_target=0.9\n    -c wal_buffers=16MB\n    -c default_statistics_target=100\n    -c random_page_cost=1.1\n    -c effective_io_concurrency=200\n    -c work_mem=16MB\n    -c min_wal_size=1GB\n    -c max_wal_size=4GB\n```\n\n## Cost Estimation\n\n### Minimum Setup (2 core VPS)\n- **DigitalOcean:** $12-24/month\n- **Hetzner:** â‚¬5-15/month\n- **Linode:** $12-24/month\n\n### Recommended Setup (4 core VPS)\n- **DigitalOcean:** $48/month\n- **Hetzner:** â‚¬20/month\n- **AWS Lightsail:** $40/month\n\n### Additional Costs\n- Domain: $10-20/year\n- Backups: $5-10/month (optional)\n- Monitoring: Free (self-hosted) or $20/month\n\n## Next Steps\n\nAfter successful deployment:\n1. Monitor logs for the first 24 hours\n2. Set up automated backups\n3. Configure uptime monitoring\n4. Test all API endpoints from your application\n5. Review and optimize performance\n\n## Related Documentation\n\n- [Environment Variables](/contributing/env-vars/) - Configuration options\n- [API Reference](/tana-api/intro/) - Ledger API endpoints\n- [Edge Server](/tana-edge/intro/) - Edge server documentation\n- [Development Setup](/contributing/setup/) - Local development guide\n",
    "html": "<p>This guide covers deploying the Tana blockchain infrastructure to production.</p>\n<h2 id=\"prerequisites\">Prerequisites</h2>\n<h3 id=\"server-requirements\">Server Requirements</h3>\n<ul>\n<li><strong>CPU:</strong> 4+ cores</li>\n<li><strong>RAM:</strong> 8GB+ minimum, 16GB recommended</li>\n<li><strong>Storage:</strong> 100GB+ SSD</li>\n<li><strong>OS:</strong> Ubuntu 22.04 LTS (recommended)</li>\n<li><strong>Network:</strong> Static IP, ports 80/443/8080 accessible</li>\n</ul>\n<h3 id=\"software-requirements\">Software Requirements</h3>\n<ul>\n<li>Docker 24.0+</li>\n<li>Docker Compose 2.0+</li>\n<li>Bun 1.1.38+ (for migrations)</li>\n<li>PostgreSQL 16 (via Docker)</li>\n<li>Redis 7 (via Docker)</li>\n</ul>\n<h3 id=\"domain-configuration\">Domain Configuration</h3>\n<p>Configure DNS records for your domain:</p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>A     blockchain.yourdomain.com    â†’ &#x3C;SERVER_IP></span></span>\n<span class=\"line\"><span>AAAA  blockchain.yourdomain.com    â†’ &#x3C;SERVER_IPv6>  (optional)</span></span></code></pre><h2 id=\"architecture\">Architecture</h2>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>\n<span class=\"line\"><span>â”‚                     yourdomain.com                           â”‚</span></span>\n<span class=\"line\"><span>â”‚                  (Main Website/Playground)                   â”‚</span></span>\n<span class=\"line\"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>\n<span class=\"line\"><span>                            â”‚</span></span>\n<span class=\"line\"><span>                            â†“ HTTPS</span></span>\n<span class=\"line\"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>\n<span class=\"line\"><span>â”‚         blockchain.yourdomain.com (Load Balancer)           â”‚</span></span>\n<span class=\"line\"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>\n<span class=\"line\"><span>                            â”‚</span></span>\n<span class=\"line\"><span>           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>\n<span class=\"line\"><span>           â†“                â†“                â†“</span></span>\n<span class=\"line\"><span>    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>\n<span class=\"line\"><span>    â”‚ Ledger   â”‚    â”‚  Edge    â”‚    â”‚ Runtime  â”‚</span></span>\n<span class=\"line\"><span>    â”‚ Service  â”‚    â”‚ Server   â”‚    â”‚ Service  â”‚</span></span>\n<span class=\"line\"><span>    â”‚  :8080   â”‚    â”‚  :8180   â”‚    â”‚          â”‚</span></span>\n<span class=\"line\"><span>    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>\n<span class=\"line\"><span>           â”‚                â”‚</span></span>\n<span class=\"line\"><span>           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>\n<span class=\"line\"><span>                    â†“</span></span>\n<span class=\"line\"><span>            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>\n<span class=\"line\"><span>            â”‚  PostgreSQL  â”‚</span></span>\n<span class=\"line\"><span>            â”‚     :5432    â”‚</span></span>\n<span class=\"line\"><span>            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>\n<span class=\"line\"><span>                    â”‚</span></span>\n<span class=\"line\"><span>            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>\n<span class=\"line\"><span>            â”‚    Redis     â”‚</span></span>\n<span class=\"line\"><span>            â”‚     :6379    â”‚</span></span>\n<span class=\"line\"><span>            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><h2 id=\"services-overview\">Services Overview</h2>\n<h3 id=\"ledger-service-port-8080\">Ledger Service (Port 8080)</h3>\n<p><strong>Purpose:</strong> Blockchain data API - users, balances, transactions</p>\n<p><strong>Key Endpoints:</strong></p>\n<ul>\n<li><code>GET /health</code> - Health check</li>\n<li><code>GET /users</code> - List all users</li>\n<li><code>POST /users</code> - Create user</li>\n<li><code>GET /balances</code> - Get all balances</li>\n<li><code>GET /transactions</code> - Get all transactions</li>\n<li><code>POST /transactions</code> - Create transaction</li>\n</ul>\n<h3 id=\"edge-server-port-8180\">Edge Server (Port 8180)</h3>\n<p><strong>Purpose:</strong> Fast HTTP execution of smart contracts</p>\n<p><strong>Features:</strong></p>\n<ul>\n<li>TypeScript contract execution</li>\n<li>V8 isolate per request</li>\n<li>Cloudflare Workers-style architecture</li>\n<li>Sub-100ms response times</li>\n</ul>\n<h2 id=\"installation\">Installation</h2>\n<h3 id=\"1-clone-repository\">1. Clone Repository</h3>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"2-create-production-environment-file\">2. Create Production Environment File</h3>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"bash\"></div>\n\n\n\n<p>Edit <code>.env.production</code>:</p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"3-build-docker-images\">3. Build Docker Images</h3>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"4-initialize-database\">4. Initialize Database</h3>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"5-start-services\">5. Start Services</h3>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"6-verify-deployment\">6. Verify Deployment</h3>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"reverse-proxy-configuration\">Reverse Proxy Configuration</h2>\n<h3 id=\"using-nginx\">Using Nginx</h3>\n<p>Create <code>/etc/nginx/sites-available/blockchain.yourdomain.com</code>:</p>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"nginx\"></div>\n\n\n\n<p>Enable and test:</p>\n<div class=\"code-block-placeholder\" data-index=\"8\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"ssl-certificate-lets-encrypt\">SSL Certificate (Let&#39;s Encrypt)</h3>\n<div class=\"code-block-placeholder\" data-index=\"9\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"monitoring--maintenance\">Monitoring &amp; Maintenance</h2>\n<h3 id=\"view-logs\">View Logs</h3>\n<div class=\"code-block-placeholder\" data-index=\"10\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"database-backups\">Database Backups</h3>\n<p>Create a backup script <code>/usr/local/bin/backup-tana.sh</code>:</p>\n<div class=\"code-block-placeholder\" data-index=\"11\" data-lang=\"bash\"></div>\n\n\n\n<p>Add to crontab:</p>\n<div class=\"code-block-placeholder\" data-index=\"12\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"health-monitoring\">Health Monitoring</h3>\n<div class=\"code-block-placeholder\" data-index=\"13\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"updates--upgrades\">Updates &amp; Upgrades</h3>\n<div class=\"code-block-placeholder\" data-index=\"14\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"security-checklist\">Security Checklist</h2>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> Strong PostgreSQL password set</li>\n<li><input disabled=\"\" type=\"checkbox\"> SSL certificates installed and valid</li>\n<li><input disabled=\"\" type=\"checkbox\"> Firewall configured (UFW or iptables)</li>\n<li><input disabled=\"\" type=\"checkbox\"> Rate limiting enabled in Nginx</li>\n<li><input disabled=\"\" type=\"checkbox\"> Services running as non-root user</li>\n<li><input disabled=\"\" type=\"checkbox\"> Database not exposed to public internet</li>\n<li><input disabled=\"\" type=\"checkbox\"> Redis not exposed to public internet</li>\n<li><input disabled=\"\" type=\"checkbox\"> CORS properly configured</li>\n<li><input disabled=\"\" type=\"checkbox\"> Security headers enabled</li>\n<li><input disabled=\"\" type=\"checkbox\"> Regular backups configured</li>\n<li><input disabled=\"\" type=\"checkbox\"> Monitoring and alerting set up</li>\n<li><input disabled=\"\" type=\"checkbox\"> Secrets stored securely (not in git)</li>\n<li><input disabled=\"\" type=\"checkbox\"> <code>TANA_LEDGER_URL</code> environment variable set correctly</li>\n</ul>\n<h2 id=\"troubleshooting\">Troubleshooting</h2>\n<h3 id=\"service-wont-start\">Service Won&#39;t Start</h3>\n<div class=\"code-block-placeholder\" data-index=\"15\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"database-connection-issues\">Database Connection Issues</h3>\n<div class=\"code-block-placeholder\" data-index=\"16\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"high-memory-usage\">High Memory Usage</h3>\n<div class=\"code-block-placeholder\" data-index=\"17\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"cors-errors\">CORS Errors</h3>\n<p>Check <code>ALLOWED_ORIGINS</code> in <code>.env.production</code> includes all necessary domains:</p>\n<div class=\"code-block-placeholder\" data-index=\"18\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"performance-tuning\">Performance Tuning</h2>\n<h3 id=\"postgresql-optimization\">PostgreSQL Optimization</h3>\n<p>Edit <code>docker-compose.prod.yml</code> to add PostgreSQL performance settings:</p>\n<div class=\"code-block-placeholder\" data-index=\"19\" data-lang=\"yaml\"></div>\n\n\n\n<h2 id=\"cost-estimation\">Cost Estimation</h2>\n<h3 id=\"minimum-setup-2-core-vps\">Minimum Setup (2 core VPS)</h3>\n<ul>\n<li><strong>DigitalOcean:</strong> $12-24/month</li>\n<li><strong>Hetzner:</strong> â‚¬5-15/month</li>\n<li><strong>Linode:</strong> $12-24/month</li>\n</ul>\n<h3 id=\"recommended-setup-4-core-vps\">Recommended Setup (4 core VPS)</h3>\n<ul>\n<li><strong>DigitalOcean:</strong> $48/month</li>\n<li><strong>Hetzner:</strong> â‚¬20/month</li>\n<li><strong>AWS Lightsail:</strong> $40/month</li>\n</ul>\n<h3 id=\"additional-costs\">Additional Costs</h3>\n<ul>\n<li>Domain: $10-20/year</li>\n<li>Backups: $5-10/month (optional)</li>\n<li>Monitoring: Free (self-hosted) or $20/month</li>\n</ul>\n<h2 id=\"next-steps\">Next Steps</h2>\n<p>After successful deployment:</p>\n<ol>\n<li>Monitor logs for the first 24 hours</li>\n<li>Set up automated backups</li>\n<li>Configure uptime monitoring</li>\n<li>Test all API endpoints from your application</li>\n<li>Review and optimize performance</li>\n</ol>\n<h2 id=\"related-documentation\">Related Documentation</h2>\n<ul>\n<li><a href=\"/contributing/env-vars/\">Environment Variables</a> - Configuration options</li>\n<li><a href=\"/tana-api/intro/\">API Reference</a> - Ledger API endpoints</li>\n<li><a href=\"/tana-edge/intro/\">Edge Server</a> - Edge server documentation</li>\n<li><a href=\"/contributing/setup/\">Development Setup</a> - Local development guide</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "git clone https://github.com/yourusername/tana.git\ncd tana"
      },
      {
        "lang": "bash",
        "code": "cp .env.example .env.production"
      },
      {
        "lang": "bash",
        "code": "# Database Configuration\nPOSTGRES_DB=tana\nPOSTGRES_USER=tana\nPOSTGRES_PASSWORD=<STRONG_PASSWORD_HERE>\n\n# Ledger URL (for all services)\nTANA_LEDGER_URL=https://blockchain.yourdomain.com\n\n# Service Configuration\nNODE_ENV=production\nLOG_LEVEL=info\n\n# CORS Origins\nALLOWED_ORIGINS=https://yourdomain.com,https://blockchain.yourdomain.com"
      },
      {
        "lang": "bash",
        "code": "# Build all services\ndocker-compose -f docker-compose.prod.yml build\n\n# Or build specific service\ndocker-compose -f docker-compose.prod.yml build tana-ledger"
      },
      {
        "lang": "bash",
        "code": "# Start database services\ndocker-compose -f docker-compose.prod.yml up -d postgres redis\n\n# Wait for postgres to be ready\ndocker-compose -f docker-compose.prod.yml exec postgres pg_isready\n\n# Run migrations\ncd ledger\nbun run db:migrate\n\n# Seed default data\ncurl -X POST http://localhost:8080/balances/currencies/seed"
      },
      {
        "lang": "bash",
        "code": "# Start all services\ndocker-compose -f docker-compose.prod.yml up -d\n\n# Check status\ndocker-compose -f docker-compose.prod.yml ps\n\n# View logs\ndocker-compose -f docker-compose.prod.yml logs -f"
      },
      {
        "lang": "bash",
        "code": "# Test ledger service\ncurl http://localhost:8080/health\ncurl http://localhost:8080/\n\n# Test endpoints\ncurl http://localhost:8080/users\ncurl http://localhost:8080/balances\ncurl http://localhost:8080/transactions"
      },
      {
        "lang": "nginx",
        "code": "# HTTP -> HTTPS redirect\nserver {\n    listen 80;\n    listen [::]:80;\n    server_name blockchain.yourdomain.com;\n\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n\n# HTTPS\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name blockchain.yourdomain.com;\n\n    # SSL certificates (Let's Encrypt)\n    ssl_certificate /etc/letsencrypt/live/blockchain.yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/blockchain.yourdomain.com/privkey.pem;\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n\n    # Security headers\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n    add_header X-Frame-Options \"SAMEORIGIN\" always;\n    add_header X-Content-Type-Options \"nosniff\" always;\n    add_header X-XSS-Protection \"1; mode=block\" always;\n\n    # CORS headers\n    add_header Access-Control-Allow-Origin \"https://yourdomain.com\" always;\n    add_header Access-Control-Allow-Methods \"GET, POST, OPTIONS\" always;\n    add_header Access-Control-Allow-Headers \"Content-Type, Authorization\" always;\n\n    # Rate limiting\n    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;\n    limit_req zone=api_limit burst=20 nodelay;\n\n    # Proxy to ledger service\n    location / {\n        proxy_pass http://localhost:8080;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n\n        # Timeouts\n        proxy_connect_timeout 30s;\n        proxy_send_timeout 30s;\n        proxy_read_timeout 30s;\n    }\n\n    # Health check endpoint (no rate limiting)\n    location /health {\n        proxy_pass http://localhost:8080/health;\n        access_log off;\n    }\n}"
      },
      {
        "lang": "bash",
        "code": "# Enable site\nsudo ln -s /etc/nginx/sites-available/blockchain.yourdomain.com /etc/nginx/sites-enabled/\n\n# Test configuration\nsudo nginx -t\n\n# Reload nginx\nsudo systemctl reload nginx"
      },
      {
        "lang": "bash",
        "code": "# Install certbot\nsudo apt update\nsudo apt install certbot python3-certbot-nginx\n\n# Get certificate\nsudo certbot --nginx -d blockchain.yourdomain.com\n\n# Auto-renewal is enabled by default\n# Test renewal\nsudo certbot renew --dry-run"
      },
      {
        "lang": "bash",
        "code": "# All services\ndocker-compose -f docker-compose.prod.yml logs -f\n\n# Specific service\ndocker-compose -f docker-compose.prod.yml logs -f tana-ledger\n\n# Last 100 lines\ndocker-compose -f docker-compose.prod.yml logs --tail=100 tana-ledger"
      },
      {
        "lang": "bash",
        "code": "#!/bin/bash\nBACKUP_DIR=\"/var/backups/tana\"\nTIMESTAMP=$(date +%Y%m%d_%H%M%S)\nmkdir -p $BACKUP_DIR\n\n# Backup database\ndocker-compose -f /path/to/tana/docker-compose.prod.yml exec -T postgres \\\n  pg_dump -U tana tana | gzip > \"$BACKUP_DIR/tana_$TIMESTAMP.sql.gz\"\n\n# Keep only last 7 days\nfind $BACKUP_DIR -name \"tana_*.sql.gz\" -mtime +7 -delete"
      },
      {
        "lang": "bash",
        "code": "# Daily backup at 2 AM\n0 2 * * * /usr/local/bin/backup-tana.sh"
      },
      {
        "lang": "bash",
        "code": "# Check service health\ncurl https://blockchain.yourdomain.com/health\n\n# Monitor container stats\ndocker stats\n\n# Check service status\ndocker-compose -f docker-compose.prod.yml ps"
      },
      {
        "lang": "bash",
        "code": "# Pull latest code\ngit pull origin main\n\n# Rebuild images\ndocker-compose -f docker-compose.prod.yml build\n\n# Run database migrations\ncd ledger && bun run db:migrate && cd ..\n\n# Restart services (zero downtime)\ndocker-compose -f docker-compose.prod.yml up -d --no-deps --build tana-ledger\ndocker-compose -f docker-compose.prod.yml up -d --no-deps --build tana-edge"
      },
      {
        "lang": "bash",
        "code": "# Check logs\ndocker-compose -f docker-compose.prod.yml logs tana-ledger\n\n# Check container status\ndocker-compose -f docker-compose.prod.yml ps\n\n# Restart specific service\ndocker-compose -f docker-compose.prod.yml restart tana-ledger"
      },
      {
        "lang": "bash",
        "code": "# Check postgres is running\ndocker-compose -f docker-compose.prod.yml ps postgres\n\n# Test connection manually\ndocker-compose -f docker-compose.prod.yml exec postgres \\\n  psql -U tana -d tana -c \"SELECT version();\""
      },
      {
        "lang": "bash",
        "code": "# Check resource usage\ndocker stats\n\n# Adjust resource limits in docker-compose.prod.yml\nservices:\n  tana-ledger:\n    deploy:\n      resources:\n        limits:\n          memory: 512M"
      },
      {
        "lang": "bash",
        "code": "ALLOWED_ORIGINS=https://yourdomain.com,https://blockchain.yourdomain.com"
      },
      {
        "lang": "yaml",
        "code": "postgres:\n  command: >\n    postgres\n    -c shared_buffers=256MB\n    -c effective_cache_size=1GB\n    -c maintenance_work_mem=128MB\n    -c checkpoint_completion_target=0.9\n    -c wal_buffers=16MB\n    -c default_statistics_target=100\n    -c random_page_cost=1.1\n    -c effective_io_concurrency=200\n    -c work_mem=16MB\n    -c min_wal_size=1GB\n    -c max_wal_size=4GB"
      }
    ],
    "tableOfContents": [
      {
        "id": "prerequisites",
        "text": "Prerequisites",
        "level": 2
      },
      {
        "id": "server-requirements",
        "text": "Server Requirements",
        "level": 3
      },
      {
        "id": "software-requirements",
        "text": "Software Requirements",
        "level": 3
      },
      {
        "id": "domain-configuration",
        "text": "Domain Configuration",
        "level": 3
      },
      {
        "id": "architecture",
        "text": "Architecture",
        "level": 2
      },
      {
        "id": "services-overview",
        "text": "Services Overview",
        "level": 2
      },
      {
        "id": "ledger-service-port-8080",
        "text": "Ledger Service (Port 8080)",
        "level": 3
      },
      {
        "id": "edge-server-port-8180",
        "text": "Edge Server (Port 8180)",
        "level": 3
      },
      {
        "id": "installation",
        "text": "Installation",
        "level": 2
      },
      {
        "id": "1-clone-repository",
        "text": "1. Clone Repository",
        "level": 3
      },
      {
        "id": "2-create-production-environment-file",
        "text": "2. Create Production Environment File",
        "level": 3
      },
      {
        "id": "3-build-docker-images",
        "text": "3. Build Docker Images",
        "level": 3
      },
      {
        "id": "4-initialize-database",
        "text": "4. Initialize Database",
        "level": 3
      },
      {
        "id": "5-start-services",
        "text": "5. Start Services",
        "level": 3
      },
      {
        "id": "6-verify-deployment",
        "text": "6. Verify Deployment",
        "level": 3
      },
      {
        "id": "reverse-proxy-configuration",
        "text": "Reverse Proxy Configuration",
        "level": 2
      },
      {
        "id": "using-nginx",
        "text": "Using Nginx",
        "level": 3
      },
      {
        "id": "ssl-certificate-lets-encrypt",
        "text": "SSL Certificate (Let's Encrypt)",
        "level": 3
      },
      {
        "id": "monitoring-maintenance",
        "text": "Monitoring & Maintenance",
        "level": 2
      },
      {
        "id": "view-logs",
        "text": "View Logs",
        "level": 3
      },
      {
        "id": "database-backups",
        "text": "Database Backups",
        "level": 3
      },
      {
        "id": "health-monitoring",
        "text": "Health Monitoring",
        "level": 3
      },
      {
        "id": "updates-upgrades",
        "text": "Updates & Upgrades",
        "level": 3
      },
      {
        "id": "security-checklist",
        "text": "Security Checklist",
        "level": 2
      },
      {
        "id": "troubleshooting",
        "text": "Troubleshooting",
        "level": 2
      },
      {
        "id": "service-wont-start",
        "text": "Service Won't Start",
        "level": 3
      },
      {
        "id": "database-connection-issues",
        "text": "Database Connection Issues",
        "level": 3
      },
      {
        "id": "high-memory-usage",
        "text": "High Memory Usage",
        "level": 3
      },
      {
        "id": "cors-errors",
        "text": "CORS Errors",
        "level": 3
      },
      {
        "id": "performance-tuning",
        "text": "Performance Tuning",
        "level": 2
      },
      {
        "id": "postgresql-optimization",
        "text": "PostgreSQL Optimization",
        "level": 3
      },
      {
        "id": "cost-estimation",
        "text": "Cost Estimation",
        "level": 2
      },
      {
        "id": "minimum-setup-2-core-vps",
        "text": "Minimum Setup (2 core VPS)",
        "level": 3
      },
      {
        "id": "recommended-setup-4-core-vps",
        "text": "Recommended Setup (4 core VPS)",
        "level": 3
      },
      {
        "id": "additional-costs",
        "text": "Additional Costs",
        "level": 3
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      },
      {
        "id": "related-documentation",
        "text": "Related Documentation",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "sovereign",
      "docker"
    ],
    "metadata": {
      "title": "Starting Docker",
      "description": "Bring up all Tana services with Docker Compose",
      "sidebar": {
        "order": 2
      }
    },
    "content": "\nThis guide covers how to start the complete Tana backend infrastructure using Docker Compose. All services are containerized and orchestrated with health-check-aware dependency ordering.\n\n## Quick Start\n\nFrom the `engine/` directory:\n\n```bash\ncd engine\n\n# Start everything\ndocker compose up -d\n\n# Check status\ndocker compose ps\n\n# View logs\ndocker compose logs -f\n```\n\nThat's it. Docker Compose handles the startup order automatically via health checks.\n\n## System Architecture\n\nTana consists of **10 services** organized into three layers:\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                         PUBLIC LAYER                                 â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                      â”‚\nâ”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚   â”‚                     tana-api (8080)                          â”‚  â”‚\nâ”‚   â”‚              API Gateway - ONLY PUBLIC PORT                  â”‚  â”‚\nâ”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                                      â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                       INTERNAL SERVICES (850X)                       â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                      â”‚\nâ”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚\nâ”‚   â”‚   ledger    â”‚  â”‚    queue    â”‚  â”‚    mesh     â”‚                â”‚\nâ”‚   â”‚    8501     â”‚  â”‚    8502     â”‚  â”‚    8503     â”‚                â”‚\nâ”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚\nâ”‚                                                                      â”‚\nâ”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚\nâ”‚   â”‚  identity   â”‚  â”‚  consensus  â”‚  â”‚    edge     â”‚                â”‚\nâ”‚   â”‚    8504     â”‚  â”‚  8505/9000  â”‚  â”‚    8506     â”‚                â”‚\nâ”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚\nâ”‚                                                                      â”‚\nâ”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚\nâ”‚   â”‚     t4      â”‚                                                   â”‚\nâ”‚   â”‚    8507     â”‚                                                   â”‚\nâ”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚\nâ”‚                                                                      â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                        INFRASTRUCTURE                                â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                      â”‚\nâ”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚\nâ”‚   â”‚       PostgreSQL        â”‚  â”‚         Redis           â”‚         â”‚\nâ”‚   â”‚          5432           â”‚  â”‚          6379           â”‚         â”‚\nâ”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚\nâ”‚                                                                      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Port Allocation Reference\n\n### Public Layer\n\n| Service | Port | Description |\n|---------|------|-------------|\n| **api** | 8080 | API Gateway - the only public-facing port |\n\n### Internal Services (850X Range)\n\n| Service | Port | Description |\n|---------|------|-------------|\n| **ledger** | 8501 | Blockchain state, users, blocks, transactions |\n| **queue** | 8502 | Transaction ingestion and Redis queue management |\n| **mesh** | 8503 | Network coordination and validator discovery |\n| **identity** | 8504 | QR authentication and session management |\n| **consensus** | 8505 | Validator coordination HTTP API |\n| **consensus** | 9000 | P2P WebSocket for validator communication |\n| **edge** | 8506 | HTTP contract execution (get/post handlers) |\n| **t4** | 8507 | Content-addressable static asset storage |\n\n### Infrastructure\n\n| Service | Port | Description |\n|---------|------|-------------|\n| **postgres** | 5432 | PostgreSQL database |\n| **redis** | 6379 | Transaction queue backend |\n\n## Service Descriptions\n\n### Infrastructure\n\n**PostgreSQL** - Primary database storing all blockchain state:\n- Users and accounts\n- Transactions and blocks\n- Contract deployments\n- Session data\n\n**Redis** - High-performance queue for:\n- Pending transactions\n- Inter-service communication\n- Caching\n\n### Stateless Services\n\n**mesh** (8503) - Network coordinator:\n- Validator registration and discovery\n- Heartbeat monitoring\n- Network topology management\n\n**t4** (8507) - Content storage:\n- Content-addressable file storage\n- Contract source code\n- Static assets\n\n### Stateful Services\n\n**ledger** (8501) - Blockchain state manager:\n- User account management\n- Balance tracking\n- Transaction history\n- Block storage and queries\n\n**queue** (8502) - Transaction ingestion:\n- Receives signed transactions\n- Validates transaction format\n- Queues for block inclusion\n\n**identity** (8504) - Authentication service:\n- QR code generation for mobile auth\n- Session management\n- Device linking\n\n**consensus** (8505, 9000) - Validator coordination:\n- Block production\n- P2P communication between validators\n- Vote collection and finalization\n\n**edge** (8506) - Contract HTTP server:\n- Executes contract `get()` and `post()` handlers\n- Fresh V8 isolate per request\n- Read-only contract execution\n\n### API Gateway\n\n**api** (8080) - Public API gateway:\n- Routes external requests to internal services\n- Single entry point for all API calls\n- Handles CORS and rate limiting\n\n## Startup Order\n\nDocker Compose automatically handles dependencies via health checks:\n\n```\n1. postgres, redis           (infrastructure, no dependencies)\n         â†“\n2. mesh, t4                  (stateless, no dependencies)\n         â†“\n3. queue                     (depends on redis)\n         â†“\n4. ledger                    (depends on postgres, redis, mesh, queue, t4)\n         â†“\n5. identity, notifications   (depends on postgres)\n         â†“\n6. consensus                 (depends on postgres, mesh, ledger)\n         â†“\n7. edge                      (standalone, can start anytime)\n         â†“\n8. api                       (depends on all services)\n```\n\n## Common Commands\n\n```bash\n# Start all services\ndocker compose up -d\n\n# Start only infrastructure (useful for local development)\ndocker compose up -d postgres redis\n\n# Check service status\ndocker compose ps\n\n# View logs for all services\ndocker compose logs -f\n\n# View logs for specific service\ndocker compose logs -f ledger\n\n# Restart a single service\ndocker compose restart ledger\n\n# Stop everything\ndocker compose down\n\n# Stop and remove volumes (DESTRUCTIVE - deletes all data)\ndocker compose down -v\n```\n\n## Health Checks\n\nAll services expose `/health` endpoints. Check overall system health:\n\n```bash\n# Check all services\nfor port in 8501 8502 8503 8504 8505 8506 8507 8080; do\n  echo -n \"Port $port: \"\n  curl -s http://localhost:$port/health | jq -r '.status // \"error\"'\ndone\n```\n\nOr use the CLI:\n\n```bash\ntana test\n```\n\n## Environment Variables\n\nKey environment variables used by the services:\n\n| Variable | Service | Description |\n|----------|---------|-------------|\n| `DATABASE_URL` | ledger, identity, notifications, consensus | PostgreSQL connection string |\n| `REDIS_URL` | queue, ledger | Redis connection string |\n| `MESH_URL` | ledger, consensus | Mesh service URL |\n| `VALIDATOR_ID` | consensus | Unique validator identifier |\n| `SOVEREIGN_PUBLIC_KEY` | mesh | Sovereign's Ed25519 public key |\n\n## Troubleshooting\n\n### Service won't start\n\nCheck dependencies are healthy:\n\n```bash\ndocker compose ps\ndocker compose logs <service-name>\n```\n\n### Port already in use\n\nFind and kill the process:\n\n```bash\nlsof -i :<port>\nkill <pid>\n```\n\n### Database connection errors\n\nEnsure PostgreSQL is healthy and accepting connections:\n\n```bash\ndocker compose exec postgres pg_isready -U tana\n```\n\n### Clean restart\n\n```bash\ndocker compose down\ndocker compose up -d\n```\n\n## Next Steps\n\n- [Genesis Initialization](/docs/sovereign/genesis/) - Create the first block\n- [Validators](/docs/sovereign/validators/) - Add validator nodes\n",
    "html": "<p>This guide covers how to start the complete Tana backend infrastructure using Docker Compose. All services are containerized and orchestrated with health-check-aware dependency ordering.</p>\n<h2 id=\"quick-start\">Quick Start</h2>\n<p>From the <code>engine/</code> directory:</p>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<p>That&#39;s it. Docker Compose handles the startup order automatically via health checks.</p>\n<h2 id=\"system-architecture\">System Architecture</h2>\n<p>Tana consists of <strong>10 services</strong> organized into three layers:</p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>\n<span class=\"line\"><span>â”‚                         PUBLIC LAYER                                 â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>\n<span class=\"line\"><span>â”‚                                                                      â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚                     tana-api (8080)                          â”‚  â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚              API Gateway - ONLY PUBLIC PORT                  â”‚  â”‚</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚</span></span>\n<span class=\"line\"><span>â”‚                                                                      â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>\n<span class=\"line\"><span>â”‚                       INTERNAL SERVICES (850X)                       â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>\n<span class=\"line\"><span>â”‚                                                                      â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚   ledger    â”‚  â”‚    queue    â”‚  â”‚    mesh     â”‚                â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚    8501     â”‚  â”‚    8502     â”‚  â”‚    8503     â”‚                â”‚</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚</span></span>\n<span class=\"line\"><span>â”‚                                                                      â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚  identity   â”‚  â”‚  consensus  â”‚  â”‚    edge     â”‚                â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚    8504     â”‚  â”‚  8505/9000  â”‚  â”‚    8506     â”‚                â”‚</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚</span></span>\n<span class=\"line\"><span>â”‚                                                                      â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚     t4      â”‚                                                   â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚    8507     â”‚                                                   â”‚</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚</span></span>\n<span class=\"line\"><span>â”‚                                                                      â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>\n<span class=\"line\"><span>â”‚                        INFRASTRUCTURE                                â”‚</span></span>\n<span class=\"line\"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>\n<span class=\"line\"><span>â”‚                                                                      â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚       PostgreSQL        â”‚  â”‚         Redis           â”‚         â”‚</span></span>\n<span class=\"line\"><span>â”‚   â”‚          5432           â”‚  â”‚          6379           â”‚         â”‚</span></span>\n<span class=\"line\"><span>â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚</span></span>\n<span class=\"line\"><span>â”‚                                                                      â”‚</span></span>\n<span class=\"line\"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><h2 id=\"port-allocation-reference\">Port Allocation Reference</h2>\n<h3 id=\"public-layer\">Public Layer</h3>\n<table>\n<thead>\n<tr>\n<th>Service</th>\n<th>Port</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>api</strong></td>\n<td>8080</td>\n<td>API Gateway - the only public-facing port</td>\n</tr>\n</tbody></table>\n<h3 id=\"internal-services-850x-range\">Internal Services (850X Range)</h3>\n<table>\n<thead>\n<tr>\n<th>Service</th>\n<th>Port</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>ledger</strong></td>\n<td>8501</td>\n<td>Blockchain state, users, blocks, transactions</td>\n</tr>\n<tr>\n<td><strong>queue</strong></td>\n<td>8502</td>\n<td>Transaction ingestion and Redis queue management</td>\n</tr>\n<tr>\n<td><strong>mesh</strong></td>\n<td>8503</td>\n<td>Network coordination and validator discovery</td>\n</tr>\n<tr>\n<td><strong>identity</strong></td>\n<td>8504</td>\n<td>QR authentication and session management</td>\n</tr>\n<tr>\n<td><strong>consensus</strong></td>\n<td>8505</td>\n<td>Validator coordination HTTP API</td>\n</tr>\n<tr>\n<td><strong>consensus</strong></td>\n<td>9000</td>\n<td>P2P WebSocket for validator communication</td>\n</tr>\n<tr>\n<td><strong>edge</strong></td>\n<td>8506</td>\n<td>HTTP contract execution (get/post handlers)</td>\n</tr>\n<tr>\n<td><strong>t4</strong></td>\n<td>8507</td>\n<td>Content-addressable static asset storage</td>\n</tr>\n</tbody></table>\n<h3 id=\"infrastructure\">Infrastructure</h3>\n<table>\n<thead>\n<tr>\n<th>Service</th>\n<th>Port</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>postgres</strong></td>\n<td>5432</td>\n<td>PostgreSQL database</td>\n</tr>\n<tr>\n<td><strong>redis</strong></td>\n<td>6379</td>\n<td>Transaction queue backend</td>\n</tr>\n</tbody></table>\n<h2 id=\"service-descriptions\">Service Descriptions</h2>\n<h3 id=\"infrastructure-1\">Infrastructure</h3>\n<p><strong>PostgreSQL</strong> - Primary database storing all blockchain state:</p>\n<ul>\n<li>Users and accounts</li>\n<li>Transactions and blocks</li>\n<li>Contract deployments</li>\n<li>Session data</li>\n</ul>\n<p><strong>Redis</strong> - High-performance queue for:</p>\n<ul>\n<li>Pending transactions</li>\n<li>Inter-service communication</li>\n<li>Caching</li>\n</ul>\n<h3 id=\"stateless-services\">Stateless Services</h3>\n<p><strong>mesh</strong> (8503) - Network coordinator:</p>\n<ul>\n<li>Validator registration and discovery</li>\n<li>Heartbeat monitoring</li>\n<li>Network topology management</li>\n</ul>\n<p><strong>t4</strong> (8507) - Content storage:</p>\n<ul>\n<li>Content-addressable file storage</li>\n<li>Contract source code</li>\n<li>Static assets</li>\n</ul>\n<h3 id=\"stateful-services\">Stateful Services</h3>\n<p><strong>ledger</strong> (8501) - Blockchain state manager:</p>\n<ul>\n<li>User account management</li>\n<li>Balance tracking</li>\n<li>Transaction history</li>\n<li>Block storage and queries</li>\n</ul>\n<p><strong>queue</strong> (8502) - Transaction ingestion:</p>\n<ul>\n<li>Receives signed transactions</li>\n<li>Validates transaction format</li>\n<li>Queues for block inclusion</li>\n</ul>\n<p><strong>identity</strong> (8504) - Authentication service:</p>\n<ul>\n<li>QR code generation for mobile auth</li>\n<li>Session management</li>\n<li>Device linking</li>\n</ul>\n<p><strong>consensus</strong> (8505, 9000) - Validator coordination:</p>\n<ul>\n<li>Block production</li>\n<li>P2P communication between validators</li>\n<li>Vote collection and finalization</li>\n</ul>\n<p><strong>edge</strong> (8506) - Contract HTTP server:</p>\n<ul>\n<li>Executes contract <code>get()</code> and <code>post()</code> handlers</li>\n<li>Fresh V8 isolate per request</li>\n<li>Read-only contract execution</li>\n</ul>\n<h3 id=\"api-gateway\">API Gateway</h3>\n<p><strong>api</strong> (8080) - Public API gateway:</p>\n<ul>\n<li>Routes external requests to internal services</li>\n<li>Single entry point for all API calls</li>\n<li>Handles CORS and rate limiting</li>\n</ul>\n<h2 id=\"startup-order\">Startup Order</h2>\n<p>Docker Compose automatically handles dependencies via health checks:</p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>1. postgres, redis           (infrastructure, no dependencies)</span></span>\n<span class=\"line\"><span>         â†“</span></span>\n<span class=\"line\"><span>2. mesh, t4                  (stateless, no dependencies)</span></span>\n<span class=\"line\"><span>         â†“</span></span>\n<span class=\"line\"><span>3. queue                     (depends on redis)</span></span>\n<span class=\"line\"><span>         â†“</span></span>\n<span class=\"line\"><span>4. ledger                    (depends on postgres, redis, mesh, queue, t4)</span></span>\n<span class=\"line\"><span>         â†“</span></span>\n<span class=\"line\"><span>5. identity, notifications   (depends on postgres)</span></span>\n<span class=\"line\"><span>         â†“</span></span>\n<span class=\"line\"><span>6. consensus                 (depends on postgres, mesh, ledger)</span></span>\n<span class=\"line\"><span>         â†“</span></span>\n<span class=\"line\"><span>7. edge                      (standalone, can start anytime)</span></span>\n<span class=\"line\"><span>         â†“</span></span>\n<span class=\"line\"><span>8. api                       (depends on all services)</span></span></code></pre><h2 id=\"common-commands\">Common Commands</h2>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"health-checks\">Health Checks</h2>\n<p>All services expose <code>/health</code> endpoints. Check overall system health:</p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"bash\"></div>\n\n\n\n<p>Or use the CLI:</p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"environment-variables\">Environment Variables</h2>\n<p>Key environment variables used by the services:</p>\n<table>\n<thead>\n<tr>\n<th>Variable</th>\n<th>Service</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>DATABASE_URL</code></td>\n<td>ledger, identity, notifications, consensus</td>\n<td>PostgreSQL connection string</td>\n</tr>\n<tr>\n<td><code>REDIS_URL</code></td>\n<td>queue, ledger</td>\n<td>Redis connection string</td>\n</tr>\n<tr>\n<td><code>MESH_URL</code></td>\n<td>ledger, consensus</td>\n<td>Mesh service URL</td>\n</tr>\n<tr>\n<td><code>VALIDATOR_ID</code></td>\n<td>consensus</td>\n<td>Unique validator identifier</td>\n</tr>\n<tr>\n<td><code>SOVEREIGN<em>PUBLIC</em>KEY</code></td>\n<td>mesh</td>\n<td>Sovereign&#39;s Ed25519 public key</td>\n</tr>\n</tbody></table>\n<h2 id=\"troubleshooting\">Troubleshooting</h2>\n<h3 id=\"service-wont-start\">Service won&#39;t start</h3>\n<p>Check dependencies are healthy:</p>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"port-already-in-use\">Port already in use</h3>\n<p>Find and kill the process:</p>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"database-connection-errors\">Database connection errors</h3>\n<p>Ensure PostgreSQL is healthy and accepting connections:</p>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"clean-restart\">Clean restart</h3>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/docs/sovereign/genesis/\">Genesis Initialization</a> - Create the first block</li>\n<li><a href=\"/docs/sovereign/validators/\">Validators</a> - Add validator nodes</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "cd engine\n\n# Start everything\ndocker compose up -d\n\n# Check status\ndocker compose ps\n\n# View logs\ndocker compose logs -f"
      },
      {
        "lang": "bash",
        "code": "# Start all services\ndocker compose up -d\n\n# Start only infrastructure (useful for local development)\ndocker compose up -d postgres redis\n\n# Check service status\ndocker compose ps\n\n# View logs for all services\ndocker compose logs -f\n\n# View logs for specific service\ndocker compose logs -f ledger\n\n# Restart a single service\ndocker compose restart ledger\n\n# Stop everything\ndocker compose down\n\n# Stop and remove volumes (DESTRUCTIVE - deletes all data)\ndocker compose down -v"
      },
      {
        "lang": "bash",
        "code": "# Check all services\nfor port in 8501 8502 8503 8504 8505 8506 8507 8080; do\n  echo -n \"Port $port: \"\n  curl -s http://localhost:$port/health | jq -r '.status // \"error\"'\ndone"
      },
      {
        "lang": "bash",
        "code": "tana test"
      },
      {
        "lang": "bash",
        "code": "docker compose ps\ndocker compose logs <service-name>"
      },
      {
        "lang": "bash",
        "code": "lsof -i :<port>\nkill <pid>"
      },
      {
        "lang": "bash",
        "code": "docker compose exec postgres pg_isready -U tana"
      },
      {
        "lang": "bash",
        "code": "docker compose down\ndocker compose up -d"
      }
    ],
    "tableOfContents": [
      {
        "id": "quick-start",
        "text": "Quick Start",
        "level": 2
      },
      {
        "id": "system-architecture",
        "text": "System Architecture",
        "level": 2
      },
      {
        "id": "port-allocation-reference",
        "text": "Port Allocation Reference",
        "level": 2
      },
      {
        "id": "public-layer",
        "text": "Public Layer",
        "level": 3
      },
      {
        "id": "internal-services-850x-range",
        "text": "Internal Services (850X Range)",
        "level": 3
      },
      {
        "id": "infrastructure",
        "text": "Infrastructure",
        "level": 3
      },
      {
        "id": "service-descriptions",
        "text": "Service Descriptions",
        "level": 2
      },
      {
        "id": "infrastructure",
        "text": "Infrastructure",
        "level": 3
      },
      {
        "id": "stateless-services",
        "text": "Stateless Services",
        "level": 3
      },
      {
        "id": "stateful-services",
        "text": "Stateful Services",
        "level": 3
      },
      {
        "id": "api-gateway",
        "text": "API Gateway",
        "level": 3
      },
      {
        "id": "startup-order",
        "text": "Startup Order",
        "level": 2
      },
      {
        "id": "common-commands",
        "text": "Common Commands",
        "level": 2
      },
      {
        "id": "health-checks",
        "text": "Health Checks",
        "level": 2
      },
      {
        "id": "environment-variables",
        "text": "Environment Variables",
        "level": 2
      },
      {
        "id": "troubleshooting",
        "text": "Troubleshooting",
        "level": 2
      },
      {
        "id": "service-wont-start",
        "text": "Service won't start",
        "level": 3
      },
      {
        "id": "port-already-in-use",
        "text": "Port already in use",
        "level": 3
      },
      {
        "id": "database-connection-errors",
        "text": "Database connection errors",
        "level": 3
      },
      {
        "id": "clean-restart",
        "text": "Clean restart",
        "level": 3
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "sovereign",
      "monitoring"
    ],
    "metadata": {
      "title": "Monitoring",
      "description": "Dashboard and health checks for your network",
      "sidebar": {
        "order": 4
      }
    },
    "content": "\nTana provides built-in monitoring tools to observe your network's health, track transactions, and manage validators.\n\n## Health Checks\n\n### Quick Health Check\n\n```bash\ntana test\n```\n\nThis checks:\n- Database connectivity\n- Migrations applied\n- Service availability\n- Block production status\n\n### Service Health Endpoints\n\nEach service exposes a `/health` endpoint:\n\n```bash\n# Ledger service\ncurl http://localhost:8080/health\n\n# Identity service\ncurl http://localhost:8090/health\n\n# Consensus service\ncurl http://localhost:9001/health\n\n# Mesh service\ncurl http://localhost:8190/health\n\n# Edge server\ncurl http://localhost:8082/health\n```\n\n## Unified Dashboard\n\nThe mesh service includes a web-based dashboard for monitoring:\n\n### Starting the Dashboard\n\n```bash\n# Start mesh service with dashboard\ntana mesh\n```\n\nAccess at: `http://localhost:8190`\n\n### Dashboard Views\n\nThe dashboard has four main views:\n\n| View | Description |\n|------|-------------|\n| **Blocks** | Recent blocks, transactions per block, finalization status |\n| **Events** | Real-time event stream from all services |\n| **Users** | User accounts, balances, search |\n| **Network** | Validator topology, chaos engineering controls |\n\n### Blocks View\n\nMonitor blockchain progress:\n- Block height and hash\n- Transactions per block\n- Producer (validator)\n- Finalization timestamps\n\n### Events View\n\nReal-time event streaming from the event-bus:\n- Transaction lifecycle events\n- Block production events\n- Consensus events\n- Filter by service, level, or category\n\n### Users View\n\nUser management:\n- Search users by username or ID\n- View balances across currencies\n- User role (sovereign, staff, user)\n- Transaction history\n\n### Network View\n\nNetwork topology and operations:\n- Validator status (online/offline)\n- Peer connections (force-directed graph)\n- Chaos engineering controls\n- Network health metrics\n\n## Chaos Engineering\n\nThe network view includes chaos engineering controls for testing fault tolerance:\n\n### Available Actions\n\n| Action | Description |\n|--------|-------------|\n| **Kill Validator** | Terminate a validator process |\n| **Partition** | Simulate network partition |\n| **Slow Network** | Add artificial latency |\n| **Restore** | Recover from chaos state |\n\n> **Warning:** Only use chaos controls in test environments!\n\n## Metrics\n\n### Block Production Metrics\n\n```bash\n# Latest block\ncurl http://localhost:8080/blocks/latest\n\n# Block production rate\ncurl http://localhost:8080/blocks?limit=10\n```\n\n### Transaction Metrics\n\n```bash\n# Pending transactions\ncurl http://localhost:8080/transactions/pending\n\n# Transaction throughput\ncurl http://localhost:8080/transactions/count\n```\n\n### Validator Metrics\n\n```bash\n# Registered validators\ncurl http://localhost:8190/validators\n\n# Validator health\ncurl http://localhost:9001/status\n```\n\n## Logging\n\n### Log Levels\n\nConfigure logging via environment:\n\n```bash\n# Development (verbose)\nLOG_LEVEL=debug tana ledger\n\n# Production (errors only)\nLOG_LEVEL=error tana ledger\n```\n\n### Event-Bus Integration\n\nFor structured logging across services, use the event-bus:\n\n```bash\n# Query recent events\ncurl http://localhost:8200/events?limit=100\n\n# Filter by service\ncurl http://localhost:8200/events?service=ledger\n\n# Filter by level\ncurl http://localhost:8200/events?level=error\n```\n\n## Alerting\n\nFor production deployments, integrate with external monitoring:\n\n### Prometheus Metrics\n\nExport metrics for Prometheus scraping:\n\n```bash\n# Metrics endpoint (if enabled)\ncurl http://localhost:8080/metrics\n```\n\n### Health Check Integration\n\nUse health endpoints with your monitoring stack:\n\n```yaml\n# Example: Docker health check\nhealthcheck:\n  test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8080/health\"]\n  interval: 30s\n  timeout: 10s\n  retries: 3\n```\n\n## Troubleshooting\n\n### Block Production Stalled\n\n1. Check validator health: `curl http://localhost:9001/health`\n2. Check Redis: `redis-cli ping`\n3. Check for consensus errors in logs\n4. Verify validators can reach each other\n\n### High Transaction Latency\n\n1. Check pending transaction count\n2. Verify Redis isn't overloaded\n3. Check database connection pool\n4. Monitor block production rate\n\n### Service Not Responding\n\n1. Check if process is running: `ps aux | grep tana`\n2. Check port availability: `lsof -i :8080`\n3. Review service logs\n4. Verify database connectivity\n\n## Next Steps\n\n- [Deployment](/docs/sovereign/deployment/) - Production deployment guide\n- [API Reference](/docs/tana-api/intro/) - Full API documentation\n",
    "html": "<p>Tana provides built-in monitoring tools to observe your network&#39;s health, track transactions, and manage validators.</p>\n<h2 id=\"health-checks\">Health Checks</h2>\n<h3 id=\"quick-health-check\">Quick Health Check</h3>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<p>This checks:</p>\n<ul>\n<li>Database connectivity</li>\n<li>Migrations applied</li>\n<li>Service availability</li>\n<li>Block production status</li>\n</ul>\n<h3 id=\"service-health-endpoints\">Service Health Endpoints</h3>\n<p>Each service exposes a <code>/health</code> endpoint:</p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"unified-dashboard\">Unified Dashboard</h2>\n<p>The mesh service includes a web-based dashboard for monitoring:</p>\n<h3 id=\"starting-the-dashboard\">Starting the Dashboard</h3>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"bash\"></div>\n\n\n\n<p>Access at: <code>http://localhost:8190</code></p>\n<h3 id=\"dashboard-views\">Dashboard Views</h3>\n<p>The dashboard has four main views:</p>\n<table>\n<thead>\n<tr>\n<th>View</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Blocks</strong></td>\n<td>Recent blocks, transactions per block, finalization status</td>\n</tr>\n<tr>\n<td><strong>Events</strong></td>\n<td>Real-time event stream from all services</td>\n</tr>\n<tr>\n<td><strong>Users</strong></td>\n<td>User accounts, balances, search</td>\n</tr>\n<tr>\n<td><strong>Network</strong></td>\n<td>Validator topology, chaos engineering controls</td>\n</tr>\n</tbody></table>\n<h3 id=\"blocks-view\">Blocks View</h3>\n<p>Monitor blockchain progress:</p>\n<ul>\n<li>Block height and hash</li>\n<li>Transactions per block</li>\n<li>Producer (validator)</li>\n<li>Finalization timestamps</li>\n</ul>\n<h3 id=\"events-view\">Events View</h3>\n<p>Real-time event streaming from the event-bus:</p>\n<ul>\n<li>Transaction lifecycle events</li>\n<li>Block production events</li>\n<li>Consensus events</li>\n<li>Filter by service, level, or category</li>\n</ul>\n<h3 id=\"users-view\">Users View</h3>\n<p>User management:</p>\n<ul>\n<li>Search users by username or ID</li>\n<li>View balances across currencies</li>\n<li>User role (sovereign, staff, user)</li>\n<li>Transaction history</li>\n</ul>\n<h3 id=\"network-view\">Network View</h3>\n<p>Network topology and operations:</p>\n<ul>\n<li>Validator status (online/offline)</li>\n<li>Peer connections (force-directed graph)</li>\n<li>Chaos engineering controls</li>\n<li>Network health metrics</li>\n</ul>\n<h2 id=\"chaos-engineering\">Chaos Engineering</h2>\n<p>The network view includes chaos engineering controls for testing fault tolerance:</p>\n<h3 id=\"available-actions\">Available Actions</h3>\n<table>\n<thead>\n<tr>\n<th>Action</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Kill Validator</strong></td>\n<td>Terminate a validator process</td>\n</tr>\n<tr>\n<td><strong>Partition</strong></td>\n<td>Simulate network partition</td>\n</tr>\n<tr>\n<td><strong>Slow Network</strong></td>\n<td>Add artificial latency</td>\n</tr>\n<tr>\n<td><strong>Restore</strong></td>\n<td>Recover from chaos state</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p><strong>Warning:</strong> Only use chaos controls in test environments!</p>\n</blockquote>\n<h2 id=\"metrics\">Metrics</h2>\n<h3 id=\"block-production-metrics\">Block Production Metrics</h3>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"transaction-metrics\">Transaction Metrics</h3>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"validator-metrics\">Validator Metrics</h3>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"logging\">Logging</h2>\n<h3 id=\"log-levels\">Log Levels</h3>\n<p>Configure logging via environment:</p>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"event-bus-integration\">Event-Bus Integration</h3>\n<p>For structured logging across services, use the event-bus:</p>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"alerting\">Alerting</h2>\n<p>For production deployments, integrate with external monitoring:</p>\n<h3 id=\"prometheus-metrics\">Prometheus Metrics</h3>\n<p>Export metrics for Prometheus scraping:</p>\n<div class=\"code-block-placeholder\" data-index=\"8\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"health-check-integration\">Health Check Integration</h3>\n<p>Use health endpoints with your monitoring stack:</p>\n<div class=\"code-block-placeholder\" data-index=\"9\" data-lang=\"yaml\"></div>\n\n\n\n<h2 id=\"troubleshooting\">Troubleshooting</h2>\n<h3 id=\"block-production-stalled\">Block Production Stalled</h3>\n<ol>\n<li>Check validator health: <code>curl http://localhost:9001/health</code></li>\n<li>Check Redis: <code>redis-cli ping</code></li>\n<li>Check for consensus errors in logs</li>\n<li>Verify validators can reach each other</li>\n</ol>\n<h3 id=\"high-transaction-latency\">High Transaction Latency</h3>\n<ol>\n<li>Check pending transaction count</li>\n<li>Verify Redis isn&#39;t overloaded</li>\n<li>Check database connection pool</li>\n<li>Monitor block production rate</li>\n</ol>\n<h3 id=\"service-not-responding\">Service Not Responding</h3>\n<ol>\n<li>Check if process is running: <code>ps aux | grep tana</code></li>\n<li>Check port availability: <code>lsof -i :8080</code></li>\n<li>Review service logs</li>\n<li>Verify database connectivity</li>\n</ol>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/docs/sovereign/deployment/\">Deployment</a> - Production deployment guide</li>\n<li><a href=\"/docs/tana-api/intro/\">API Reference</a> - Full API documentation</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "tana test"
      },
      {
        "lang": "bash",
        "code": "# Ledger service\ncurl http://localhost:8080/health\n\n# Identity service\ncurl http://localhost:8090/health\n\n# Consensus service\ncurl http://localhost:9001/health\n\n# Mesh service\ncurl http://localhost:8190/health\n\n# Edge server\ncurl http://localhost:8082/health"
      },
      {
        "lang": "bash",
        "code": "# Start mesh service with dashboard\ntana mesh"
      },
      {
        "lang": "bash",
        "code": "# Latest block\ncurl http://localhost:8080/blocks/latest\n\n# Block production rate\ncurl http://localhost:8080/blocks?limit=10"
      },
      {
        "lang": "bash",
        "code": "# Pending transactions\ncurl http://localhost:8080/transactions/pending\n\n# Transaction throughput\ncurl http://localhost:8080/transactions/count"
      },
      {
        "lang": "bash",
        "code": "# Registered validators\ncurl http://localhost:8190/validators\n\n# Validator health\ncurl http://localhost:9001/status"
      },
      {
        "lang": "bash",
        "code": "# Development (verbose)\nLOG_LEVEL=debug tana ledger\n\n# Production (errors only)\nLOG_LEVEL=error tana ledger"
      },
      {
        "lang": "bash",
        "code": "# Query recent events\ncurl http://localhost:8200/events?limit=100\n\n# Filter by service\ncurl http://localhost:8200/events?service=ledger\n\n# Filter by level\ncurl http://localhost:8200/events?level=error"
      },
      {
        "lang": "bash",
        "code": "# Metrics endpoint (if enabled)\ncurl http://localhost:8080/metrics"
      },
      {
        "lang": "yaml",
        "code": "# Example: Docker health check\nhealthcheck:\n  test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8080/health\"]\n  interval: 30s\n  timeout: 10s\n  retries: 3"
      }
    ],
    "tableOfContents": [
      {
        "id": "health-checks",
        "text": "Health Checks",
        "level": 2
      },
      {
        "id": "quick-health-check",
        "text": "Quick Health Check",
        "level": 3
      },
      {
        "id": "service-health-endpoints",
        "text": "Service Health Endpoints",
        "level": 3
      },
      {
        "id": "unified-dashboard",
        "text": "Unified Dashboard",
        "level": 2
      },
      {
        "id": "starting-the-dashboard",
        "text": "Starting the Dashboard",
        "level": 3
      },
      {
        "id": "dashboard-views",
        "text": "Dashboard Views",
        "level": 3
      },
      {
        "id": "blocks-view",
        "text": "Blocks View",
        "level": 3
      },
      {
        "id": "events-view",
        "text": "Events View",
        "level": 3
      },
      {
        "id": "users-view",
        "text": "Users View",
        "level": 3
      },
      {
        "id": "network-view",
        "text": "Network View",
        "level": 3
      },
      {
        "id": "chaos-engineering",
        "text": "Chaos Engineering",
        "level": 2
      },
      {
        "id": "available-actions",
        "text": "Available Actions",
        "level": 3
      },
      {
        "id": "metrics",
        "text": "Metrics",
        "level": 2
      },
      {
        "id": "block-production-metrics",
        "text": "Block Production Metrics",
        "level": 3
      },
      {
        "id": "transaction-metrics",
        "text": "Transaction Metrics",
        "level": 3
      },
      {
        "id": "validator-metrics",
        "text": "Validator Metrics",
        "level": 3
      },
      {
        "id": "logging",
        "text": "Logging",
        "level": 2
      },
      {
        "id": "log-levels",
        "text": "Log Levels",
        "level": 3
      },
      {
        "id": "event-bus-integration",
        "text": "Event-Bus Integration",
        "level": 3
      },
      {
        "id": "alerting",
        "text": "Alerting",
        "level": 2
      },
      {
        "id": "prometheus-metrics",
        "text": "Prometheus Metrics",
        "level": 3
      },
      {
        "id": "health-check-integration",
        "text": "Health Check Integration",
        "level": 3
      },
      {
        "id": "troubleshooting",
        "text": "Troubleshooting",
        "level": 2
      },
      {
        "id": "block-production-stalled",
        "text": "Block Production Stalled",
        "level": 3
      },
      {
        "id": "high-transaction-latency",
        "text": "High Transaction Latency",
        "level": 3
      },
      {
        "id": "service-not-responding",
        "text": "Service Not Responding",
        "level": 3
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "sovereign",
      "validators"
    ],
    "metadata": {
      "title": "Validators",
      "description": "Setting up multi-validator consensus",
      "sidebar": {
        "order": 3
      }
    },
    "content": "\nValidators are nodes that participate in consensus to produce blocks. A multi-validator network provides decentralization and fault tolerance.\n\n## Single vs Multi-Validator\n\n| Setup | Use Case | Fault Tolerance |\n|-------|----------|-----------------|\n| **Single validator** | Development, testing | None |\n| **3 validators** | Small production | Tolerates 1 failure |\n| **5 validators** | Production | Tolerates 2 failures |\n| **7+ validators** | High availability | Tolerates 3+ failures |\n\n## Creating a Validator\n\nOn each validator node:\n\n```bash\n# Install Tana CLI\nnpm install -g @tananetwork/tana\n\n# Create validator identity\ntana new validator --port 9000 --http-port 9001\n```\n\nOutput:\n\n```\nğŸ”§ Creating validator node...\n\nâœ… Validator initialized: val_abc12345\nğŸ“ Config saved to: ~/.config/tana/validator.json\nğŸ”‘ Public key: ed25519_...\nğŸŒ WebSocket URL: ws://localhost:9000\nğŸŒ HTTP API: http://localhost:9001\n```\n\n## Validator Configuration\n\nThe validator config is stored at `~/.config/tana/validator.json`:\n\n```json\n{\n  \"validatorId\": \"val_abc12345\",\n  \"publicKey\": \"ed25519_...\",\n  \"privateKey\": \"ed25519_...\",\n  \"wsPort\": 9000,\n  \"httpPort\": 9001,\n  \"wsUrl\": \"ws://localhost:9000\",\n  \"peers\": [],\n  \"createdAt\": \"2024-11-24T00:00:00Z\"\n}\n```\n\n## Multi-Validator Setup\n\n### Step 1: First Validator (Leader)\n\nOn the first machine:\n\n```bash\ntana new validator --port 9000 --http-port 9001\n```\n\nNote the WebSocket URL: `ws://validator1.example.com:9000`\n\n### Step 2: Additional Validators\n\nOn each additional machine, specify the first validator as a peer:\n\n```bash\n# Validator 2\ntana new validator --port 9000 --http-port 9001 \\\n  --peers ws://validator1.example.com:9000\n\n# Validator 3\ntana new validator --port 9000 --http-port 9001 \\\n  --peers ws://validator1.example.com:9000,ws://validator2.example.com:9000\n```\n\n### Step 3: Start Services\n\nOn each validator node:\n\n```bash\n# Start infrastructure\ndocker compose up -d\n\n# Start consensus service\nDATABASE_URL='postgres://...' REDIS_URL='redis://...' tana consensus\n```\n\n## Network Topology\n\nValidators communicate via WebSocket for P2P consensus:\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Validator 1 â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚ Validator 2 â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚ Validator 3 â”‚\nâ”‚   :9000     â”‚       â”‚   :9000     â”‚       â”‚   :9000     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜\n       â”‚                     â”‚                     â”‚\n       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                       â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”\n                       â”‚   Redis   â”‚\n                       â”‚  (shared) â”‚\n                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Port Allocations\n\n| Port | Service | Description |\n|------|---------|-------------|\n| 9000 | Consensus P2P | WebSocket validator-to-validator |\n| 9001 | Consensus API | HTTP health checks |\n| 9010 | Validator 2 P2P | (for local multi-validator testing) |\n| 9011 | Validator 2 API | |\n| 9020 | Validator 3 P2P | |\n| 9021 | Validator 3 API | |\n\n## Shared Infrastructure\n\nAll validators share:\n\n- **Redis** - Transaction queue (must be network-accessible)\n- **Genesis hash** - Same genesis block\n\nEach validator has:\n\n- **PostgreSQL** - Own database (state replicated via consensus)\n- **Keypair** - Unique validator identity\n\n## Local Multi-Validator Testing\n\nFor testing multiple validators on one machine:\n\n```bash\n# Terminal 1 - Validator 1\ntana new validator --port 9000 --http-port 9001\nDATABASE_URL='...' tana consensus\n\n# Terminal 2 - Validator 2\ntana new validator --port 9010 --http-port 9011 --peers ws://localhost:9000\nDATABASE_URL='...' tana consensus\n\n# Terminal 3 - Validator 3\ntana new validator --port 9020 --http-port 9021 --peers ws://localhost:9000,ws://localhost:9010\nDATABASE_URL='...' tana consensus\n```\n\n## Health Checks\n\nCheck validator status:\n\n```bash\n# Consensus service health\ncurl http://localhost:9001/health\n\n# Check connected peers\ncurl http://localhost:9001/peers\n\n# Block production status\ncurl http://localhost:9001/status\n```\n\n## Mesh Registration\n\nValidators auto-register with the mesh service via heartbeats:\n\n```bash\n# Start mesh service\ntana mesh\n\n# View registered validators\ncurl http://localhost:8190/validators\n```\n\n## Production Considerations\n\n### Network Security\n\n- Use TLS for WebSocket connections in production\n- Configure firewall rules for validator ports\n- Use private network for validator-to-validator traffic\n\n### High Availability\n\n- Deploy validators across multiple regions/zones\n- Use managed PostgreSQL for reliability\n- Monitor validator health with alerting\n\n### Validator Keys\n\n- Store private keys securely (consider HSM for production)\n- Back up validator configs\n- Rotate keys periodically\n\n## Troubleshooting\n\n### \"Connection refused\" to peers\n\n- Ensure firewall allows WebSocket port (9000)\n- Verify peer URL is correct\n- Check if peer validator is running\n\n### Block production stopped\n\n- Check Redis connectivity\n- Verify at least one validator is healthy\n- Check consensus logs for errors\n\n### State divergence\n\n- Validators must start from same genesis\n- Check for network partitions\n- May need to resync from a healthy validator\n\n## Next Steps\n\n- [Monitoring](/docs/sovereign/monitoring/) - Dashboard and observability\n- [Deployment](/docs/sovereign/deployment/) - Production deployment guide\n",
    "html": "<p>Validators are nodes that participate in consensus to produce blocks. A multi-validator network provides decentralization and fault tolerance.</p>\n<h2 id=\"single-vs-multi-validator\">Single vs Multi-Validator</h2>\n<table>\n<thead>\n<tr>\n<th>Setup</th>\n<th>Use Case</th>\n<th>Fault Tolerance</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Single validator</strong></td>\n<td>Development, testing</td>\n<td>None</td>\n</tr>\n<tr>\n<td><strong>3 validators</strong></td>\n<td>Small production</td>\n<td>Tolerates 1 failure</td>\n</tr>\n<tr>\n<td><strong>5 validators</strong></td>\n<td>Production</td>\n<td>Tolerates 2 failures</td>\n</tr>\n<tr>\n<td><strong>7+ validators</strong></td>\n<td>High availability</td>\n<td>Tolerates 3+ failures</td>\n</tr>\n</tbody></table>\n<h2 id=\"creating-a-validator\">Creating a Validator</h2>\n<p>On each validator node:</p>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<p>Output:</p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>ğŸ”§ Creating validator node...</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>âœ… Validator initialized: val_abc12345</span></span>\n<span class=\"line\"><span>ğŸ“ Config saved to: ~/.config/tana/validator.json</span></span>\n<span class=\"line\"><span>ğŸ”‘ Public key: ed25519_...</span></span>\n<span class=\"line\"><span>ğŸŒ WebSocket URL: ws://localhost:9000</span></span>\n<span class=\"line\"><span>ğŸŒ HTTP API: http://localhost:9001</span></span></code></pre><h2 id=\"validator-configuration\">Validator Configuration</h2>\n<p>The validator config is stored at <code>~/.config/tana/validator.json</code>:</p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"json\"></div>\n\n\n\n<h2 id=\"multi-validator-setup\">Multi-Validator Setup</h2>\n<h3 id=\"step-1-first-validator-leader\">Step 1: First Validator (Leader)</h3>\n<p>On the first machine:</p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"bash\"></div>\n\n\n\n<p>Note the WebSocket URL: <code>ws://validator1.example.com:9000</code></p>\n<h3 id=\"step-2-additional-validators\">Step 2: Additional Validators</h3>\n<p>On each additional machine, specify the first validator as a peer:</p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"step-3-start-services\">Step 3: Start Services</h3>\n<p>On each validator node:</p>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"network-topology\">Network Topology</h2>\n<p>Validators communicate via WebSocket for P2P consensus:</p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>\n<span class=\"line\"><span>â”‚ Validator 1 â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚ Validator 2 â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚ Validator 3 â”‚</span></span>\n<span class=\"line\"><span>â”‚   :9000     â”‚       â”‚   :9000     â”‚       â”‚   :9000     â”‚</span></span>\n<span class=\"line\"><span>â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜</span></span>\n<span class=\"line\"><span>       â”‚                     â”‚                     â”‚</span></span>\n<span class=\"line\"><span>       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>\n<span class=\"line\"><span>                             â”‚</span></span>\n<span class=\"line\"><span>                       â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”</span></span>\n<span class=\"line\"><span>                       â”‚   Redis   â”‚</span></span>\n<span class=\"line\"><span>                       â”‚  (shared) â”‚</span></span>\n<span class=\"line\"><span>                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><h2 id=\"port-allocations\">Port Allocations</h2>\n<table>\n<thead>\n<tr>\n<th>Port</th>\n<th>Service</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>9000</td>\n<td>Consensus P2P</td>\n<td>WebSocket validator-to-validator</td>\n</tr>\n<tr>\n<td>9001</td>\n<td>Consensus API</td>\n<td>HTTP health checks</td>\n</tr>\n<tr>\n<td>9010</td>\n<td>Validator 2 P2P</td>\n<td>(for local multi-validator testing)</td>\n</tr>\n<tr>\n<td>9011</td>\n<td>Validator 2 API</td>\n<td></td>\n</tr>\n<tr>\n<td>9020</td>\n<td>Validator 3 P2P</td>\n<td></td>\n</tr>\n<tr>\n<td>9021</td>\n<td>Validator 3 API</td>\n<td></td>\n</tr>\n</tbody></table>\n<h2 id=\"shared-infrastructure\">Shared Infrastructure</h2>\n<p>All validators share:</p>\n<ul>\n<li><strong>Redis</strong> - Transaction queue (must be network-accessible)</li>\n<li><strong>Genesis hash</strong> - Same genesis block</li>\n</ul>\n<p>Each validator has:</p>\n<ul>\n<li><strong>PostgreSQL</strong> - Own database (state replicated via consensus)</li>\n<li><strong>Keypair</strong> - Unique validator identity</li>\n</ul>\n<h2 id=\"local-multi-validator-testing\">Local Multi-Validator Testing</h2>\n<p>For testing multiple validators on one machine:</p>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"health-checks\">Health Checks</h2>\n<p>Check validator status:</p>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"mesh-registration\">Mesh Registration</h2>\n<p>Validators auto-register with the mesh service via heartbeats:</p>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"production-considerations\">Production Considerations</h2>\n<h3 id=\"network-security\">Network Security</h3>\n<ul>\n<li>Use TLS for WebSocket connections in production</li>\n<li>Configure firewall rules for validator ports</li>\n<li>Use private network for validator-to-validator traffic</li>\n</ul>\n<h3 id=\"high-availability\">High Availability</h3>\n<ul>\n<li>Deploy validators across multiple regions/zones</li>\n<li>Use managed PostgreSQL for reliability</li>\n<li>Monitor validator health with alerting</li>\n</ul>\n<h3 id=\"validator-keys\">Validator Keys</h3>\n<ul>\n<li>Store private keys securely (consider HSM for production)</li>\n<li>Back up validator configs</li>\n<li>Rotate keys periodically</li>\n</ul>\n<h2 id=\"troubleshooting\">Troubleshooting</h2>\n<h3 id=\"connection-refused-to-peers\">&quot;Connection refused&quot; to peers</h3>\n<ul>\n<li>Ensure firewall allows WebSocket port (9000)</li>\n<li>Verify peer URL is correct</li>\n<li>Check if peer validator is running</li>\n</ul>\n<h3 id=\"block-production-stopped\">Block production stopped</h3>\n<ul>\n<li>Check Redis connectivity</li>\n<li>Verify at least one validator is healthy</li>\n<li>Check consensus logs for errors</li>\n</ul>\n<h3 id=\"state-divergence\">State divergence</h3>\n<ul>\n<li>Validators must start from same genesis</li>\n<li>Check for network partitions</li>\n<li>May need to resync from a healthy validator</li>\n</ul>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/docs/sovereign/monitoring/\">Monitoring</a> - Dashboard and observability</li>\n<li><a href=\"/docs/sovereign/deployment/\">Deployment</a> - Production deployment guide</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "# Install Tana CLI\nnpm install -g @tananetwork/tana\n\n# Create validator identity\ntana new validator --port 9000 --http-port 9001"
      },
      {
        "lang": "json",
        "code": "{\n  \"validatorId\": \"val_abc12345\",\n  \"publicKey\": \"ed25519_...\",\n  \"privateKey\": \"ed25519_...\",\n  \"wsPort\": 9000,\n  \"httpPort\": 9001,\n  \"wsUrl\": \"ws://localhost:9000\",\n  \"peers\": [],\n  \"createdAt\": \"2024-11-24T00:00:00Z\"\n}"
      },
      {
        "lang": "bash",
        "code": "tana new validator --port 9000 --http-port 9001"
      },
      {
        "lang": "bash",
        "code": "# Validator 2\ntana new validator --port 9000 --http-port 9001 \\\n  --peers ws://validator1.example.com:9000\n\n# Validator 3\ntana new validator --port 9000 --http-port 9001 \\\n  --peers ws://validator1.example.com:9000,ws://validator2.example.com:9000"
      },
      {
        "lang": "bash",
        "code": "# Start infrastructure\ndocker compose up -d\n\n# Start consensus service\nDATABASE_URL='postgres://...' REDIS_URL='redis://...' tana consensus"
      },
      {
        "lang": "bash",
        "code": "# Terminal 1 - Validator 1\ntana new validator --port 9000 --http-port 9001\nDATABASE_URL='...' tana consensus\n\n# Terminal 2 - Validator 2\ntana new validator --port 9010 --http-port 9011 --peers ws://localhost:9000\nDATABASE_URL='...' tana consensus\n\n# Terminal 3 - Validator 3\ntana new validator --port 9020 --http-port 9021 --peers ws://localhost:9000,ws://localhost:9010\nDATABASE_URL='...' tana consensus"
      },
      {
        "lang": "bash",
        "code": "# Consensus service health\ncurl http://localhost:9001/health\n\n# Check connected peers\ncurl http://localhost:9001/peers\n\n# Block production status\ncurl http://localhost:9001/status"
      },
      {
        "lang": "bash",
        "code": "# Start mesh service\ntana mesh\n\n# View registered validators\ncurl http://localhost:8190/validators"
      }
    ],
    "tableOfContents": [
      {
        "id": "single-vs-multi-validator",
        "text": "Single vs Multi-Validator",
        "level": 2
      },
      {
        "id": "creating-a-validator",
        "text": "Creating a Validator",
        "level": 2
      },
      {
        "id": "validator-configuration",
        "text": "Validator Configuration",
        "level": 2
      },
      {
        "id": "multi-validator-setup",
        "text": "Multi-Validator Setup",
        "level": 2
      },
      {
        "id": "step-1-first-validator-leader",
        "text": "Step 1: First Validator (Leader)",
        "level": 3
      },
      {
        "id": "step-2-additional-validators",
        "text": "Step 2: Additional Validators",
        "level": 3
      },
      {
        "id": "step-3-start-services",
        "text": "Step 3: Start Services",
        "level": 3
      },
      {
        "id": "network-topology",
        "text": "Network Topology",
        "level": 2
      },
      {
        "id": "port-allocations",
        "text": "Port Allocations",
        "level": 2
      },
      {
        "id": "shared-infrastructure",
        "text": "Shared Infrastructure",
        "level": 2
      },
      {
        "id": "local-multi-validator-testing",
        "text": "Local Multi-Validator Testing",
        "level": 2
      },
      {
        "id": "health-checks",
        "text": "Health Checks",
        "level": 2
      },
      {
        "id": "mesh-registration",
        "text": "Mesh Registration",
        "level": 2
      },
      {
        "id": "production-considerations",
        "text": "Production Considerations",
        "level": 2
      },
      {
        "id": "network-security",
        "text": "Network Security",
        "level": 3
      },
      {
        "id": "high-availability",
        "text": "High Availability",
        "level": 3
      },
      {
        "id": "validator-keys",
        "text": "Validator Keys",
        "level": 3
      },
      {
        "id": "troubleshooting",
        "text": "Troubleshooting",
        "level": 2
      },
      {
        "id": "connection-refused-to-peers",
        "text": "\"Connection refused\" to peers",
        "level": 3
      },
      {
        "id": "block-production-stopped",
        "text": "Block production stopped",
        "level": 3
      },
      {
        "id": "state-divergence",
        "text": "State divergence",
        "level": 3
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "tana-edge",
      "examples"
    ],
    "metadata": {
      "title": "Edge Examples",
      "description": "Complete examples for building contracts with tana-edge",
      "sidebar": {
        "order": 2
      }
    },
    "content": "\nReal-world examples of building HTTP APIs with tana-edge.\n\n## Hello World\n\nThe simplest possible edge contract:\n\n```typescript title=\"contracts/hello/get.ts\"\nimport { Request, Response } from 'tana/net'\n\nexport function Get(req: Request) {\n  return Response.json({\n    message: 'Hello from tana-edge!',\n    timestamp: Date.now()\n  })\n}\n```\n\n**Test it:**\n```bash\ncurl http://localhost:8082/hello\n```\n\n## POST with JSON Body\n\nHandle POST requests with JSON data:\n\n```typescript title=\"contracts/echo/post.ts\"\nimport { Request, Response } from 'tana/net'\nimport { console } from 'tana/core'\n\nexport function Post(req: Request, body: any) {\n  console.log('Received:', body)\n\n  return Response.json({\n    echo: body,\n    received: Date.now()\n  })\n}\n```\n\n**Test it:**\n```bash\ncurl -X POST http://localhost:8082/echo \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\":\"test\",\"value\":42}'\n```\n\n## Blockchain Queries\n\nQuery blockchain state from your contract:\n\n```typescript title=\"contracts/account/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { block } from 'tana/block'\n\nexport async function Get(req: Request) {\n  // Get user balance from blockchain\n  const balance = await block.getBalance('alice', 'USD')\n\n  // Get blockchain context\n  const height = block.getHeight()\n  const timestamp = block.getTimestamp()\n\n  return Response.json({\n    user: 'alice',\n    balance,\n    blockHeight: Number(height),\n    timestamp\n  })\n}\n```\n\n**Response:**\n```json\n{\n  \"status\": 200,\n  \"body\": {\n    \"user\": \"alice\",\n    \"balance\": 1000,\n    \"blockHeight\": 12345,\n    \"timestamp\": 1762631458341\n  }\n}\n```\n\n## Persistent Storage\n\n\n```typescript title=\"contracts/counter/get.ts\"\nimport { Request, Response } from 'tana/net'\n\nexport async function Get(req: Request) {\n  // Get current count\n  const count = await data.get('count') || 0\n\n  // Increment\n  await data.set('count', count + 1)\n  await data.commit()\n\n  return Response.json({\n    count: count + 1,\n    message: 'Counter incremented!'\n  })\n}\n```\n\nEvery request increments the counter, and the value persists!\n\n## KV Storage\n\nModern key-value storage with Cloudflare Workers API:\n\n```typescript title=\"contracts/sessions/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { kv } from 'tana/kv'\n\nexport async function Get(req: Request) {\n  const sessionId = req.query.id\n\n  if (!sessionId) {\n    return Response.json({ error: 'Missing session ID' }, 400)\n  }\n\n  // Get session from KV\n  const session = await kv.get(`session:${sessionId}`, { type: 'json' })\n\n  if (!session) {\n    return Response.json({ error: 'Session not found' }, 404)\n  }\n\n  return Response.json({ session })\n}\n```\n\n```typescript title=\"contracts/sessions/post.ts\"\nimport { Request, Response } from 'tana/net'\nimport { kv } from 'tana/kv'\n\nexport async function Post(req: Request, body: any) {\n  const { action, sessionId, userId } = body\n\n  if (action === 'create') {\n    const session = {\n      userId,\n      createdAt: Date.now(),\n      lastActivity: Date.now()\n    }\n    await kv.put(`session:${sessionId}`, session)\n    return Response.json({ success: true, session })\n  }\n\n  if (action === 'delete') {\n    await kv.delete(`session:${sessionId}`)\n    return Response.json({ success: true })\n  }\n\n  return Response.json({ error: 'Unknown action' }, 400)\n}\n```\n\n**Test it:**\n```bash\n# Create session\ncurl -X POST http://localhost:8082/sessions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"action\":\"create\",\"sessionId\":\"xyz123\",\"userId\":\"alice\"}'\n\n# Get session\ncurl http://localhost:8082/sessions?id=xyz123\n\n# Delete session\ncurl -X POST http://localhost:8082/sessions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"action\":\"delete\",\"sessionId\":\"xyz123\"}'\n```\n\n## Transaction Staging\n\nStage blockchain transactions from edge:\n\n```typescript title=\"contracts/transfer/post.ts\"\nimport { Request, Response } from 'tana/net'\nimport { tx } from 'tana/tx'\nimport { console } from 'tana/core'\n\nexport function Post(req: Request, body: any) {\n  const { from, to, amount, currency } = body\n\n  // Stage a transfer transaction\n  tx.transfer(from, to, amount, currency)\n\n  // Get staged changes\n  const changes = tx.getChanges()\n\n  console.log('Staged changes:', changes)\n\n  return Response.json({\n    message: 'Transfer staged',\n    changes,\n    note: 'Call tx.execute() to commit to blockchain'\n  })\n}\n```\n\n**Test it:**\n```bash\ncurl -X POST http://localhost:8082/transfer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"from\":\"alice\",\"to\":\"bob\",\"amount\":100,\"currency\":\"USD\"}'\n```\n\n## External API Calls\n\nFetch data from external services:\n\n```typescript title=\"contracts/pokemon/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { fetch } from 'tana/utils'\n\nexport async function Get(req: Request) {\n  // Fetch from external API (whitelisted domain)\n  const response = await fetch('https://pokeapi.co/api/v2/pokemon/pikachu')\n  const pokemon = await response.json()\n\n  return Response.json({\n    name: pokemon.name,\n    height: pokemon.height,\n    weight: pokemon.weight,\n    abilities: pokemon.abilities.map(a => a.ability.name)\n  })\n}\n```\n\n**Note:** Only whitelisted domains are allowed (pokeapi.co, tana.dev, localhost)\n\n## Custom Status Codes\n\nReturn appropriate HTTP status codes:\n\n```typescript title=\"contracts/users/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { block } from 'tana/block'\n\nexport async function Get(req: Request) {\n  const userId = req.query.id\n\n  if (!userId) {\n    return Response.json(\n      { error: 'Missing user ID' },\n      400  // Bad Request\n    )\n  }\n\n  const user = await block.getUser(userId)\n\n  if (!user) {\n    return Response.json(\n      { error: 'User not found' },\n      404  // Not Found\n    )\n  }\n\n  return Response.json({ user })  // 200 OK\n}\n```\n\n## Complete Example: API with All Features\n\nA full-featured contract using all available modules:\n\n```typescript title=\"contracts/api/get.ts\"\nimport { Request, Response } from 'tana/net'\nimport { console } from 'tana/core'\nimport { block } from 'tana/block'\nimport { tx } from 'tana/tx'\n\nexport async function Get(req: Request) {\n  console.log('API request received')\n\n  try {\n    // 1. Read analytics (read-only in GET)\n    const visits = (await kv.get('visits', { type: 'json' })) || 0\n    const lastVisit = await kv.get('lastVisit', { type: 'json' })\n\n    // 2. Get blockchain context\n    const height = Number(block.getHeight())\n    const gasLimit = Number(block.getGasLimit())\n    const timestamp = block.getTimestamp()\n\n    // 3. Query user balance\n    const balance = await block.getBalance('alice', 'USD')\n\n    // 4. Stage a transaction (for demo)\n    tx.transfer('alice', 'bob', 10, 'USD')\n    const stagedTx = tx.getChanges()\n\n    // 5. Return comprehensive response\n    return Response.json({\n      api: {\n        version: '1.0.0',\n        totalVisits: visits + 1,\n        lastVisit: Date.now()\n      },\n      blockchain: {\n        height,\n        timestamp,\n        gasLimit\n      },\n      user: {\n        id: 'alice',\n        balance\n      },\n      transactions: {\n        staged: stagedTx.length,\n        preview: stagedTx\n      }\n    })\n  } catch (error) {\n    console.error('Error:', error)\n    return Response.json(\n      { error: error.message },\n      500\n    )\n  }\n}\n```\n\n**Response:**\n```json\n{\n  \"status\": 200,\n  \"body\": {\n    \"api\": {\n      \"version\": \"1.0.0\",\n      \"totalVisits\": 5,\n      \"lastVisit\": 1762631458341\n    },\n    \"blockchain\": {\n      \"height\": 12345,\n      \"timestamp\": 1762631458341,\n      \"gasLimit\": 1000000\n    },\n    \"user\": {\n      \"id\": \"alice\",\n      \"balance\": 1000\n    },\n    \"transactions\": {\n      \"staged\": 1,\n      \"preview\": [\n        {\n          \"type\": \"transfer\",\n          \"from\": \"alice\",\n          \"to\": \"bob\",\n          \"amount\": 10,\n          \"currency\": \"USD\"\n        }\n      ]\n    }\n  }\n}\n```\n\n## Module Reference\n\nQuick reference for all available modules:\n\n```typescript\n// tana/core - Logging and version info\nimport { console } from 'tana/core'\nconsole.log('message')\nconsole.error('error')\n\n// tana/net - HTTP primitives\nimport { Request, Response } from 'tana/net'\nResponse.json(data, 200)\nResponse.text('hello', 200)\n\n// tana/block - Blockchain queries\nimport { block } from 'tana/block'\nawait block.getBalance(userId, currency)\nawait block.getUser(userId)\nawait block.getTransaction(txId)\nblock.getHeight()\nblock.getTimestamp()\nblock.getHash()\n\n// tana/kv - Cloudflare Workers KV\nimport { kv } from 'tana/kv'\nawait kv.put(key, value)\nawait kv.get(key, { type: 'json' })\nawait kv.delete(key)\nawait kv.list({ prefix: 'user:' })\n\n// tana/tx - Transaction staging\nimport { tx } from 'tana/tx'\ntx.transfer(from, to, amount, currency)\ntx.setBalance(userId, amount, currency)\ntx.getChanges()\ntx.execute()\n\n// tana/utils - External HTTP\nimport { fetch } from 'tana/utils'\nconst response = await fetch(url)\nconst data = await response.json()\n```\n\n## Next Steps\n\n- **[API Reference](/tana-api/modules/)** - Detailed module documentation\n- **[Architecture](/guides/architecture/)** - Understanding the hybrid model\n- **[CLI Guide](/tana-cli/intro/)** - Deploy contracts to blockchain\n",
    "html": "<p>Real-world examples of building HTTP APIs with tana-edge.</p>\n<h2 id=\"hello-world\">Hello World</h2>\n<p>The simplest possible edge contract:</p>\n<pre data-language=\"typescript title=\"contracts/hello/get.ts\"\" class=\"shiki github-dark\"><code>import { Request, Response } from 'tana/net'\n\nexport function Get(req: Request) {\n  return Response.json({\n    message: 'Hello from tana-edge!',\n    timestamp: Date.now()\n  })\n}</code></pre><p><strong>Test it:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"post-with-json-body\">POST with JSON Body</h2>\n<p>Handle POST requests with JSON data:</p>\n<pre data-language=\"typescript title=\"contracts/echo/post.ts\"\" class=\"shiki github-dark\"><code>import { Request, Response } from 'tana/net'\nimport { console } from 'tana/core'\n\nexport function Post(req: Request, body: any) {\n  console.log('Received:', body)\n\n  return Response.json({\n    echo: body,\n    received: Date.now()\n  })\n}</code></pre><p><strong>Test it:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"blockchain-queries\">Blockchain Queries</h2>\n<p>Query blockchain state from your contract:</p>\n<pre data-language=\"typescript title=\"contracts/account/get.ts\"\" class=\"shiki github-dark\"><code>import { Request, Response } from 'tana/net'\nimport { block } from 'tana/block'\n\nexport async function Get(req: Request) {\n  // Get user balance from blockchain\n  const balance = await block.getBalance('alice', 'USD')\n\n  // Get blockchain context\n  const height = block.getHeight()\n  const timestamp = block.getTimestamp()\n\n  return Response.json({\n    user: 'alice',\n    balance,\n    blockHeight: Number(height),\n    timestamp\n  })\n}</code></pre><p><strong>Response:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"json\"></div>\n\n\n\n<h2 id=\"persistent-storage\">Persistent Storage</h2>\n<pre data-language=\"typescript title=\"contracts/counter/get.ts\"\" class=\"shiki github-dark\"><code>import { Request, Response } from 'tana/net'\n\nexport async function Get(req: Request) {\n  // Get current count\n  const count = await data.get('count') || 0\n\n  // Increment\n  await data.set('count', count + 1)\n  await data.commit()\n\n  return Response.json({\n    count: count + 1,\n    message: 'Counter incremented!'\n  })\n}</code></pre><p>Every request increments the counter, and the value persists!</p>\n<h2 id=\"kv-storage\">KV Storage</h2>\n<p>Modern key-value storage with Cloudflare Workers API:</p>\n<pre data-language=\"typescript title=\"contracts/sessions/get.ts\"\" class=\"shiki github-dark\"><code>import { Request, Response } from 'tana/net'\nimport { kv } from 'tana/kv'\n\nexport async function Get(req: Request) {\n  const sessionId = req.query.id\n\n  if (!sessionId) {\n    return Response.json({ error: 'Missing session ID' }, 400)\n  }\n\n  // Get session from KV\n  const session = await kv.get(`session:${sessionId}`, { type: 'json' })\n\n  if (!session) {\n    return Response.json({ error: 'Session not found' }, 404)\n  }\n\n  return Response.json({ session })\n}</code></pre><pre data-language=\"typescript title=\"contracts/sessions/post.ts\"\" class=\"shiki github-dark\"><code>import { Request, Response } from 'tana/net'\nimport { kv } from 'tana/kv'\n\nexport async function Post(req: Request, body: any) {\n  const { action, sessionId, userId } = body\n\n  if (action === 'create') {\n    const session = {\n      userId,\n      createdAt: Date.now(),\n      lastActivity: Date.now()\n    }\n    await kv.put(`session:${sessionId}`, session)\n    return Response.json({ success: true, session })\n  }\n\n  if (action === 'delete') {\n    await kv.delete(`session:${sessionId}`)\n    return Response.json({ success: true })\n  }\n\n  return Response.json({ error: 'Unknown action' }, 400)\n}</code></pre><p><strong>Test it:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"transaction-staging\">Transaction Staging</h2>\n<p>Stage blockchain transactions from edge:</p>\n<pre data-language=\"typescript title=\"contracts/transfer/post.ts\"\" class=\"shiki github-dark\"><code>import { Request, Response } from 'tana/net'\nimport { tx } from 'tana/tx'\nimport { console } from 'tana/core'\n\nexport function Post(req: Request, body: any) {\n  const { from, to, amount, currency } = body\n\n  // Stage a transfer transaction\n  tx.transfer(from, to, amount, currency)\n\n  // Get staged changes\n  const changes = tx.getChanges()\n\n  console.log('Staged changes:', changes)\n\n  return Response.json({\n    message: 'Transfer staged',\n    changes,\n    note: 'Call tx.execute() to commit to blockchain'\n  })\n}</code></pre><p><strong>Test it:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"external-api-calls\">External API Calls</h2>\n<p>Fetch data from external services:</p>\n<pre data-language=\"typescript title=\"contracts/pokemon/get.ts\"\" class=\"shiki github-dark\"><code>import { Request, Response } from 'tana/net'\nimport { fetch } from 'tana/utils'\n\nexport async function Get(req: Request) {\n  // Fetch from external API (whitelisted domain)\n  const response = await fetch('https://pokeapi.co/api/v2/pokemon/pikachu')\n  const pokemon = await response.json()\n\n  return Response.json({\n    name: pokemon.name,\n    height: pokemon.height,\n    weight: pokemon.weight,\n    abilities: pokemon.abilities.map(a => a.ability.name)\n  })\n}</code></pre><p><strong>Note:</strong> Only whitelisted domains are allowed (pokeapi.co, tana.dev, localhost)</p>\n<h2 id=\"custom-status-codes\">Custom Status Codes</h2>\n<p>Return appropriate HTTP status codes:</p>\n<pre data-language=\"typescript title=\"contracts/users/get.ts\"\" class=\"shiki github-dark\"><code>import { Request, Response } from 'tana/net'\nimport { block } from 'tana/block'\n\nexport async function Get(req: Request) {\n  const userId = req.query.id\n\n  if (!userId) {\n    return Response.json(\n      { error: 'Missing user ID' },\n      400  // Bad Request\n    )\n  }\n\n  const user = await block.getUser(userId)\n\n  if (!user) {\n    return Response.json(\n      { error: 'User not found' },\n      404  // Not Found\n    )\n  }\n\n  return Response.json({ user })  // 200 OK\n}</code></pre><h2 id=\"complete-example-api-with-all-features\">Complete Example: API with All Features</h2>\n<p>A full-featured contract using all available modules:</p>\n<pre data-language=\"typescript title=\"contracts/api/get.ts\"\" class=\"shiki github-dark\"><code>import { Request, Response } from 'tana/net'\nimport { console } from 'tana/core'\nimport { block } from 'tana/block'\nimport { tx } from 'tana/tx'\n\nexport async function Get(req: Request) {\n  console.log('API request received')\n\n  try {\n    // 1. Read analytics (read-only in GET)\n    const visits = (await kv.get('visits', { type: 'json' })) || 0\n    const lastVisit = await kv.get('lastVisit', { type: 'json' })\n\n    // 2. Get blockchain context\n    const height = Number(block.getHeight())\n    const gasLimit = Number(block.getGasLimit())\n    const timestamp = block.getTimestamp()\n\n    // 3. Query user balance\n    const balance = await block.getBalance('alice', 'USD')\n\n    // 4. Stage a transaction (for demo)\n    tx.transfer('alice', 'bob', 10, 'USD')\n    const stagedTx = tx.getChanges()\n\n    // 5. Return comprehensive response\n    return Response.json({\n      api: {\n        version: '1.0.0',\n        totalVisits: visits + 1,\n        lastVisit: Date.now()\n      },\n      blockchain: {\n        height,\n        timestamp,\n        gasLimit\n      },\n      user: {\n        id: 'alice',\n        balance\n      },\n      transactions: {\n        staged: stagedTx.length,\n        preview: stagedTx\n      }\n    })\n  } catch (error) {\n    console.error('Error:', error)\n    return Response.json(\n      { error: error.message },\n      500\n    )\n  }\n}</code></pre><p><strong>Response:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"json\"></div>\n\n\n\n<h2 id=\"module-reference\">Module Reference</h2>\n<p>Quick reference for all available modules:</p>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"typescript\"></div>\n\n\n\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><strong><a href=\"/tana-api/modules/\">API Reference</a></strong> - Detailed module documentation</li>\n<li><strong><a href=\"/guides/architecture/\">Architecture</a></strong> - Understanding the hybrid model</li>\n<li><strong><a href=\"/tana-cli/intro/\">CLI Guide</a></strong> - Deploy contracts to blockchain</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "curl http://localhost:8082/hello"
      },
      {
        "lang": "bash",
        "code": "curl -X POST http://localhost:8082/echo \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\":\"test\",\"value\":42}'"
      },
      {
        "lang": "json",
        "code": "{\n  \"status\": 200,\n  \"body\": {\n    \"user\": \"alice\",\n    \"balance\": 1000,\n    \"blockHeight\": 12345,\n    \"timestamp\": 1762631458341\n  }\n}"
      },
      {
        "lang": "bash",
        "code": "# Create session\ncurl -X POST http://localhost:8082/sessions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"action\":\"create\",\"sessionId\":\"xyz123\",\"userId\":\"alice\"}'\n\n# Get session\ncurl http://localhost:8082/sessions?id=xyz123\n\n# Delete session\ncurl -X POST http://localhost:8082/sessions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"action\":\"delete\",\"sessionId\":\"xyz123\"}'"
      },
      {
        "lang": "bash",
        "code": "curl -X POST http://localhost:8082/transfer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"from\":\"alice\",\"to\":\"bob\",\"amount\":100,\"currency\":\"USD\"}'"
      },
      {
        "lang": "json",
        "code": "{\n  \"status\": 200,\n  \"body\": {\n    \"api\": {\n      \"version\": \"1.0.0\",\n      \"totalVisits\": 5,\n      \"lastVisit\": 1762631458341\n    },\n    \"blockchain\": {\n      \"height\": 12345,\n      \"timestamp\": 1762631458341,\n      \"gasLimit\": 1000000\n    },\n    \"user\": {\n      \"id\": \"alice\",\n      \"balance\": 1000\n    },\n    \"transactions\": {\n      \"staged\": 1,\n      \"preview\": [\n        {\n          \"type\": \"transfer\",\n          \"from\": \"alice\",\n          \"to\": \"bob\",\n          \"amount\": 10,\n          \"currency\": \"USD\"\n        }\n      ]\n    }\n  }\n}"
      },
      {
        "lang": "typescript",
        "code": "// tana/core - Logging and version info\nimport { console } from 'tana/core'\nconsole.log('message')\nconsole.error('error')\n\n// tana/net - HTTP primitives\nimport { Request, Response } from 'tana/net'\nResponse.json(data, 200)\nResponse.text('hello', 200)\n\n// tana/block - Blockchain queries\nimport { block } from 'tana/block'\nawait block.getBalance(userId, currency)\nawait block.getUser(userId)\nawait block.getTransaction(txId)\nblock.getHeight()\nblock.getTimestamp()\nblock.getHash()\n\n// tana/kv - Cloudflare Workers KV\nimport { kv } from 'tana/kv'\nawait kv.put(key, value)\nawait kv.get(key, { type: 'json' })\nawait kv.delete(key)\nawait kv.list({ prefix: 'user:' })\n\n// tana/tx - Transaction staging\nimport { tx } from 'tana/tx'\ntx.transfer(from, to, amount, currency)\ntx.setBalance(userId, amount, currency)\ntx.getChanges()\ntx.execute()\n\n// tana/utils - External HTTP\nimport { fetch } from 'tana/utils'\nconst response = await fetch(url)\nconst data = await response.json()"
      }
    ],
    "tableOfContents": [
      {
        "id": "hello-world",
        "text": "Hello World",
        "level": 2
      },
      {
        "id": "post-with-json-body",
        "text": "POST with JSON Body",
        "level": 2
      },
      {
        "id": "blockchain-queries",
        "text": "Blockchain Queries",
        "level": 2
      },
      {
        "id": "persistent-storage",
        "text": "Persistent Storage",
        "level": 2
      },
      {
        "id": "kv-storage",
        "text": "KV Storage",
        "level": 2
      },
      {
        "id": "transaction-staging",
        "text": "Transaction Staging",
        "level": 2
      },
      {
        "id": "external-api-calls",
        "text": "External API Calls",
        "level": 2
      },
      {
        "id": "custom-status-codes",
        "text": "Custom Status Codes",
        "level": 2
      },
      {
        "id": "complete-example-api-with-all-features",
        "text": "Complete Example: API with All Features",
        "level": 2
      },
      {
        "id": "module-reference",
        "text": "Module Reference",
        "level": 2
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  },
  {
    "slug": [
      "tana-edge",
      "intro"
    ],
    "metadata": {
      "title": "Edge Server",
      "description": "Deploy the HTTP server for off-chain contract execution",
      "sidebar": {
        "order": 1
      }
    },
    "content": "\nThe Edge server (`tana-edge`) serves HTTP endpoints for your smart contracts. It handles `get()` and `post()` functions with millisecond latency while the blockchain handles consensus operations.\n\n## Why Edge?\n\n| Operation | Blockchain | Edge |\n|-----------|------------|------|\n| `init()`, `contract()` | âœ… Consensus, state changes | - |\n| `get()`, `post()` | - | âœ… Fast HTTP, read-only |\n\nThis hybrid model gives you:\n- **Speed** - HTTP requests in <100ms\n- **No gas fees** - Read operations are free\n- **Scalability** - Stateless, horizontally scalable\n\n## Installation\n\n```bash\nnpm install -g @tananetwork/tana\n```\n\nThe `tana-edge` binary is included with the CLI package.\n\n## Starting Edge\n\n```bash\n# Start edge server\ntana-edge --port 8082 --contracts ./contracts\n\n# Or with environment variables\nDATABASE_URL='postgres://...' tana-edge\n```\n\n## Configuration\n\n| Option | Default | Description |\n|--------|---------|-------------|\n| `--port` | `8082` | HTTP port |\n| `--contracts` | `./contracts` | Contracts directory |\n| `--cors` | `*` | CORS origin |\n\n**Environment Variables:**\n\n```bash\nDATABASE_URL='postgres://...'  # For blockchain queries\nEDGE_PORT=8082\nCONTRACTS_DIR=./contracts\n```\n\n## Contract Routing\n\nContracts are routed by path:\n\n```\nGET  http://localhost:8082/mycontract  â†’ contracts/mycontract get() function\nPOST http://localhost:8082/mycontract  â†’ contracts/mycontract post() function\n```\n\nIn production with subdomain routing:\n\n```\nGET  https://mycontract.tana.network  â†’ mycontract get()\nPOST https://mycontract.tana.network  â†’ mycontract post()\n```\n\n## Deploying Contracts\n\nContracts deployed via `tana deploy contract` are automatically available on edge:\n\n```bash\n# Deploy contract\ntana deploy contract ./myapp.ts\n\n# Test on edge\ncurl http://localhost:8082/myapp\n```\n\n## Production Setup\n\n### Systemd Service\n\n```ini\n# /etc/systemd/system/tana-edge.service\n[Unit]\nDescription=Tana Edge Server\nAfter=network.target\n\n[Service]\nType=simple\nUser=tana\nEnvironment=DATABASE_URL=postgres://...\nExecStart=/usr/local/bin/tana-edge --port 8082\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n```\n\n```bash\nsudo systemctl enable tana-edge\nsudo systemctl start tana-edge\n```\n\n### Nginx Reverse Proxy\n\n```nginx\n# Subdomain routing\nserver {\n    listen 443 ssl;\n    server_name *.tana.network;\n\n    location / {\n        proxy_pass http://localhost:8082;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n    }\n}\n```\n\n### Docker\n\n```bash\ndocker run -d \\\n  -p 8082:8082 \\\n  -e DATABASE_URL='postgres://...' \\\n  tananetwork/edge\n```\n\n## Health Checks\n\n```bash\n# Health endpoint\ncurl http://localhost:8082/health\n\n# Response\n{\"status\": \"ok\", \"version\": \"0.1.0\"}\n```\n\n## Performance\n\n- **Latency**: <100ms (fresh V8 isolate per request)\n- **Throughput**: 1000+ requests/second per instance\n- **Memory**: Isolated per-request\n- **Scaling**: Horizontal (stateless)\n\n## Troubleshooting\n\n### \"Contract not found\"\n\n- Verify contract is deployed: `curl http://localhost:8080/contracts`\n- Check contracts directory path\n- Ensure contract has `get()` or `post()` function\n\n### Slow responses\n\n- Check database connectivity\n- Monitor V8 isolate creation time\n- Consider connection pooling for PostgreSQL\n\n### CORS errors\n\n- Configure `--cors` flag or `CORS_ORIGIN` env var\n- For development: `--cors '*'`\n\n## Next Steps\n\n- [Examples](/docs/tana-edge/examples/) - Contract code samples\n- [Monitoring](/docs/sovereign/monitoring/) - Health checks and metrics\n",
    "html": "<p>The Edge server (<code>tana-edge</code>) serves HTTP endpoints for your smart contracts. It handles <code>get()</code> and <code>post()</code> functions with millisecond latency while the blockchain handles consensus operations.</p>\n<h2 id=\"why-edge\">Why Edge?</h2>\n<table>\n<thead>\n<tr>\n<th>Operation</th>\n<th>Blockchain</th>\n<th>Edge</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>init()</code>, <code>contract()</code></td>\n<td>âœ… Consensus, state changes</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code>get()</code>, <code>post()</code></td>\n<td>-</td>\n<td>âœ… Fast HTTP, read-only</td>\n</tr>\n</tbody></table>\n<p>This hybrid model gives you:</p>\n<ul>\n<li><strong>Speed</strong> - HTTP requests in &lt;100ms</li>\n<li><strong>No gas fees</strong> - Read operations are free</li>\n<li><strong>Scalability</strong> - Stateless, horizontally scalable</li>\n</ul>\n<h2 id=\"installation\">Installation</h2>\n<div class=\"code-block-placeholder\" data-index=\"0\" data-lang=\"bash\"></div>\n\n\n\n<p>The <code>tana-edge</code> binary is included with the CLI package.</p>\n<h2 id=\"starting-edge\">Starting Edge</h2>\n<div class=\"code-block-placeholder\" data-index=\"1\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"configuration\">Configuration</h2>\n<table>\n<thead>\n<tr>\n<th>Option</th>\n<th>Default</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>--port</code></td>\n<td><code>8082</code></td>\n<td>HTTP port</td>\n</tr>\n<tr>\n<td><code>--contracts</code></td>\n<td><code>./contracts</code></td>\n<td>Contracts directory</td>\n</tr>\n<tr>\n<td><code>--cors</code></td>\n<td><code>*</code></td>\n<td>CORS origin</td>\n</tr>\n</tbody></table>\n<p><strong>Environment Variables:</strong></p>\n<div class=\"code-block-placeholder\" data-index=\"2\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"contract-routing\">Contract Routing</h2>\n<p>Contracts are routed by path:</p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>GET  http://localhost:8082/mycontract  â†’ contracts/mycontract get() function</span></span>\n<span class=\"line\"><span>POST http://localhost:8082/mycontract  â†’ contracts/mycontract post() function</span></span></code></pre><p>In production with subdomain routing:</p>\n<pre data-language=\"text\" class=\"shiki line-numbers github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>GET  https://mycontract.tana.network  â†’ mycontract get()</span></span>\n<span class=\"line\"><span>POST https://mycontract.tana.network  â†’ mycontract post()</span></span></code></pre><h2 id=\"deploying-contracts\">Deploying Contracts</h2>\n<p>Contracts deployed via <code>tana deploy contract</code> are automatically available on edge:</p>\n<div class=\"code-block-placeholder\" data-index=\"3\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"production-setup\">Production Setup</h2>\n<h3 id=\"systemd-service\">Systemd Service</h3>\n<div class=\"code-block-placeholder\" data-index=\"4\" data-lang=\"ini\"></div>\n\n\n\n\n\n<div class=\"code-block-placeholder\" data-index=\"5\" data-lang=\"bash\"></div>\n\n\n\n<h3 id=\"nginx-reverse-proxy\">Nginx Reverse Proxy</h3>\n<div class=\"code-block-placeholder\" data-index=\"6\" data-lang=\"nginx\"></div>\n\n\n\n<h3 id=\"docker\">Docker</h3>\n<div class=\"code-block-placeholder\" data-index=\"7\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"health-checks\">Health Checks</h2>\n<div class=\"code-block-placeholder\" data-index=\"8\" data-lang=\"bash\"></div>\n\n\n\n<h2 id=\"performance\">Performance</h2>\n<ul>\n<li><strong>Latency</strong>: &lt;100ms (fresh V8 isolate per request)</li>\n<li><strong>Throughput</strong>: 1000+ requests/second per instance</li>\n<li><strong>Memory</strong>: Isolated per-request</li>\n<li><strong>Scaling</strong>: Horizontal (stateless)</li>\n</ul>\n<h2 id=\"troubleshooting\">Troubleshooting</h2>\n<h3 id=\"contract-not-found\">&quot;Contract not found&quot;</h3>\n<ul>\n<li>Verify contract is deployed: <code>curl http://localhost:8080/contracts</code></li>\n<li>Check contracts directory path</li>\n<li>Ensure contract has <code>get()</code> or <code>post()</code> function</li>\n</ul>\n<h3 id=\"slow-responses\">Slow responses</h3>\n<ul>\n<li>Check database connectivity</li>\n<li>Monitor V8 isolate creation time</li>\n<li>Consider connection pooling for PostgreSQL</li>\n</ul>\n<h3 id=\"cors-errors\">CORS errors</h3>\n<ul>\n<li>Configure <code>--cors</code> flag or <code>CORS_ORIGIN</code> env var</li>\n<li>For development: <code>--cors &#39;*&#39;</code></li>\n</ul>\n<h2 id=\"next-steps\">Next Steps</h2>\n<ul>\n<li><a href=\"/docs/tana-edge/examples/\">Examples</a> - Contract code samples</li>\n<li><a href=\"/docs/sovereign/monitoring/\">Monitoring</a> - Health checks and metrics</li>\n</ul>\n",
    "codeBlocks": [
      {
        "lang": "bash",
        "code": "npm install -g @tananetwork/tana"
      },
      {
        "lang": "bash",
        "code": "# Start edge server\ntana-edge --port 8082 --contracts ./contracts\n\n# Or with environment variables\nDATABASE_URL='postgres://...' tana-edge"
      },
      {
        "lang": "bash",
        "code": "DATABASE_URL='postgres://...'  # For blockchain queries\nEDGE_PORT=8082\nCONTRACTS_DIR=./contracts"
      },
      {
        "lang": "bash",
        "code": "# Deploy contract\ntana deploy contract ./myapp.ts\n\n# Test on edge\ncurl http://localhost:8082/myapp"
      },
      {
        "lang": "ini",
        "code": "# /etc/systemd/system/tana-edge.service\n[Unit]\nDescription=Tana Edge Server\nAfter=network.target\n\n[Service]\nType=simple\nUser=tana\nEnvironment=DATABASE_URL=postgres://...\nExecStart=/usr/local/bin/tana-edge --port 8082\nRestart=always\n\n[Install]\nWantedBy=multi-user.target"
      },
      {
        "lang": "bash",
        "code": "sudo systemctl enable tana-edge\nsudo systemctl start tana-edge"
      },
      {
        "lang": "nginx",
        "code": "# Subdomain routing\nserver {\n    listen 443 ssl;\n    server_name *.tana.network;\n\n    location / {\n        proxy_pass http://localhost:8082;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n    }\n}"
      },
      {
        "lang": "bash",
        "code": "docker run -d \\\n  -p 8082:8082 \\\n  -e DATABASE_URL='postgres://...' \\\n  tananetwork/edge"
      },
      {
        "lang": "bash",
        "code": "# Health endpoint\ncurl http://localhost:8082/health\n\n# Response\n{\"status\": \"ok\", \"version\": \"0.1.0\"}"
      }
    ],
    "tableOfContents": [
      {
        "id": "why-edge",
        "text": "Why Edge?",
        "level": 2
      },
      {
        "id": "installation",
        "text": "Installation",
        "level": 2
      },
      {
        "id": "starting-edge",
        "text": "Starting Edge",
        "level": 2
      },
      {
        "id": "configuration",
        "text": "Configuration",
        "level": 2
      },
      {
        "id": "contract-routing",
        "text": "Contract Routing",
        "level": 2
      },
      {
        "id": "deploying-contracts",
        "text": "Deploying Contracts",
        "level": 2
      },
      {
        "id": "production-setup",
        "text": "Production Setup",
        "level": 2
      },
      {
        "id": "systemd-service",
        "text": "Systemd Service",
        "level": 3
      },
      {
        "id": "nginx-reverse-proxy",
        "text": "Nginx Reverse Proxy",
        "level": 3
      },
      {
        "id": "docker",
        "text": "Docker",
        "level": 3
      },
      {
        "id": "health-checks",
        "text": "Health Checks",
        "level": 2
      },
      {
        "id": "performance",
        "text": "Performance",
        "level": 2
      },
      {
        "id": "troubleshooting",
        "text": "Troubleshooting",
        "level": 2
      },
      {
        "id": "contract-not-found",
        "text": "\"Contract not found\"",
        "level": 3
      },
      {
        "id": "slow-responses",
        "text": "Slow responses",
        "level": 3
      },
      {
        "id": "cors-errors",
        "text": "CORS errors",
        "level": 3
      },
      {
        "id": "next-steps",
        "text": "Next Steps",
        "level": 2
      }
    ]
  }
]