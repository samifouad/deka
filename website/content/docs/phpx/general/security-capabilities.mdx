---
title: "Security and Capabilities"
description: "Configure deka.security and CLI allow/deny flags for a default-deny PHPX runtime."
section: "phpx"
category: "general"
categoryLabel: "Language"
categoryOrder: 9
version: "latest"
---

PHPX security is enforced by default with a capability gate.

## Default model

- default-deny for sensitive host operations
- `deny` rules override `allow` rules
- runtime prompts only on TTY, unless `--no-prompt` is set

## `deka.security` in `deka.json`

```json
{
  "deka": {
    "security": {
      "allow": {
        "read": ["./app", "./php_modules"],
        "net": ["localhost:5432"],
        "run": ["git"],
        "dynamic": false
      },
      "deny": {
        "run": ["sh", "bash"],
        "dynamic": true
      },
      "prompt": true
    }
  }
}
```

## CLI overrides

```sh
deka run main.phpx --allow-read=./app --allow-net=localhost:5432
deka run main.phpx --deny-run=sh,bash --deny-dynamic --no-prompt
deka serve main.phpx --allow-all
```

`--deny-*` always wins over `--allow-*`.

## Capability buckets

- `read`: filesystem reads
- `write`: filesystem writes
- `net`: outbound network (host:port)
- `env`: environment variable access
- `run`: subprocess execution
- `dynamic`: eval/dynamic execution and dynamic Wasm loading paths
- `wasm`: Wasm import execution allowlist
- `db`: database client operations

## Subprocess risk model

Granting `run` can bypass most sandbox guarantees because child processes run with host privileges.
Use explicit allowlists:

```sh
deka run tools.phpx --allow-run=git,whoami
```

## Common failure and fix

If you see a capability deny error, either:

1. add the minimal allow rule in `deka.security`, or
2. pass a temporary CLI allow flag for local debugging.

Prefer policy changes in `deka.json` so CI/dev/prod stay consistent.
